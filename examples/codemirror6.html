<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Firepad with codemirror</title></head><body> <h1>Firepad Ace + Codemirror6 demo!</h1> <p>Example of realtime collaboration using firebase.</p> <p>Write in the ACE editor above and check the result in the Codemirror 6 editor below (or vice-versa).</p> <p id="ace-editor"></p> <p id="codemirror-editor"></p> <script type="module">function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function i(e,t,i,n){Object.defineProperty(e,t,{get:i,set:n,enumerable:!0,configurable:!0})}var n={},s={},r=t.parcelRequire59dd;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in s){var t=s[e];delete s[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){s[e]=t},t.parcelRequire59dd=r),r.register("jevmL",(function(e,t){!function(){var e=function(){return this}();e||"undefined"==typeof window||(e=window);var t=function(e,i,n){"string"==typeof e?(2==arguments.length&&(n=i),t.modules[e]||(t.payloads[e]=n,t.modules[e]=null)):t.original?t.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace())};t.modules={},t.payloads={};var i,n,s=function(e,t,i){if("string"==typeof t){var n=a(e,t);if(null!=n)return i&&i(),n}else if("[object Array]"===Object.prototype.toString.call(t)){for(var s=[],o=0,l=t.length;o<l;++o){var h=a(e,t[o]);if(null==h&&r.original)return;s.push(h)}return i&&i.apply(null,s)||!0}},r=function(e,t){var i=s("",e,t);return null==i&&r.original?r.original.apply(this,arguments):i},o=function(e,t){if(-1!==t.indexOf("!")){var i=t.split("!");return o(e,i[0])+"!"+o(e,i[1])}if("."==t.charAt(0))for(t=e.split("/").slice(0,-1).join("/")+"/"+t;-1!==t.indexOf(".")&&n!=t;){var n=t;t=t.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}return t},a=function(e,i){i=o(e,i);var n=t.modules[i];if(!n){if("function"==typeof(n=t.payloads[i])){var r={},a={id:i,uri:"",exports:r,packaged:!0},l=n((function(e,t){return s(i,e,t)}),r,a);r=l||a.exports,t.modules[i]=r,delete t.payloads[i]}n=t.modules[i]=r||n}return n};n=e,(i="ace")&&(e[i]||(e[i]={}),n=e[i]),n.define&&n.define.packaged||(t.original=n.define,n.define=t,n.define.packaged=!0),n.require&&n.require.packaged||(r.original=n.require,n.require=r,n.require.packaged=!0)}(),ace.define("ace/lib/es6-shim",["require","exports","module"],(function(e,t,i){function n(e,t,i){Object.defineProperty(e,t,{value:i,enumerable:!1,writable:!0,configurable:!0})}String.prototype.startsWith||n(String.prototype,"startsWith",(function(e,t){return t=t||0,this.lastIndexOf(e,t)===t})),String.prototype.endsWith||n(String.prototype,"endsWith",(function(e,t){var i=this;(void 0===t||t>i.length)&&(t=i.length),t-=e.length;var n=i.indexOf(e,t);return-1!==n&&n===t})),String.prototype.repeat||n(String.prototype,"repeat",(function(e){for(var t="",i=this;e>0;)1&e&&(t+=i),(e>>=1)&&(i+=i);return t})),String.prototype.includes||n(String.prototype,"includes",(function(e,t){return-1!=this.indexOf(e,t)})),Object.assign||(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];null!=n&&Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t}),Object.values||(Object.values=function(e){return Object.keys(e).map((function(t){return e[t]}))}),Array.prototype.find||n(Array.prototype,"find",(function(e){for(var t=this.length,i=arguments[1],n=0;n<t;n++){var s=this[n];if(e.call(i,s,n,this))return s}})),Array.prototype.findIndex||n(Array.prototype,"findIndex",(function(e){for(var t=this.length,i=arguments[1],n=0;n<t;n++){var s=this[n];if(e.call(i,s,n,this))return n}})),Array.prototype.includes||n(Array.prototype,"includes",(function(e,t){return-1!=this.indexOf(e,t)})),Array.prototype.fill||n(Array.prototype,"fill",(function(e){for(var t=this,i=t.length>>>0,n=arguments[1],s=n>>0,r=s<0?Math.max(i+s,0):Math.min(s,i),o=arguments[2],a=void 0===o?i:o>>0,l=a<0?Math.max(i+a,0):Math.min(a,i);r<l;)t[r]=e,r++;return t})),Array.of||n(Array,"of",(function(){return Array.prototype.slice.call(arguments)}))})),ace.define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/es6-shim"],(function(e,t,i){e("./es6-shim")})),ace.define("ace/lib/useragent",["require","exports","module"],(function(e,t,i){t.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},t.getOS=function(){return t.isMac?t.OS.MAC:t.isLinux?t.OS.LINUX:t.OS.WINDOWS};var n="object"==typeof navigator?navigator:{},s=(/mac|win|linux/i.exec(n.platform)||["other"])[0].toLowerCase(),r=n.userAgent||"",o=n.appName||"";t.isWin="win"==s,t.isMac="mac"==s,t.isLinux="linux"==s,t.isIE="Microsoft Internet Explorer"==o||o.indexOf("MSAppHost")>=0?parseFloat((r.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((r.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),t.isOldIE=t.isIE&&t.isIE<9,t.isGecko=t.isMozilla=r.match(/ Gecko\/\d+/),t.isOpera="object"==typeof opera&&"[object Opera]"==Object.prototype.toString.call(window.opera),t.isWebKit=parseFloat(r.split("WebKit/")[1])||void 0,t.isChrome=parseFloat(r.split(" Chrome/")[1])||void 0,t.isEdge=parseFloat(r.split(" Edge/")[1])||void 0,t.isAIR=r.indexOf("AdobeAIR")>=0,t.isAndroid=r.indexOf("Android")>=0,t.isChromeOS=r.indexOf(" CrOS ")>=0,t.isIOS=/iPad|iPhone|iPod/.test(r)&&!window.MSStream,t.isIOS&&(t.isMac=!0),t.isMobile=t.isIOS||t.isAndroid})),ace.define("ace/lib/dom",["require","exports","module","ace/lib/useragent"],(function(e,t,i){var n,s=e("./useragent");t.buildDom=function e(t,i,n){if("string"==typeof t&&t){var s=document.createTextNode(t);return i&&i.appendChild(s),s}if(!Array.isArray(t))return t&&t.appendChild&&i&&i.appendChild(t),t;if("string"!=typeof t[0]||!t[0]){for(var r=[],o=0;o<t.length;o++){var a=e(t[o],i,n);a&&r.push(a)}return r}var l=document.createElement(t[0]),h=t[1],c=1;h&&"object"==typeof h&&!Array.isArray(h)&&(c=2);for(o=c;o<t.length;o++)e(t[o],l,n);return 2==c&&Object.keys(h).forEach((function(e){var t=h[e];"class"===e?l.className=Array.isArray(t)?t.join(" "):t:"function"==typeof t||"value"==e||"$"==e[0]?l[e]=t:"ref"===e?n&&(n[t]=l):"style"===e?"string"==typeof t&&(l.style.cssText=t):null!=t&&l.setAttribute(e,t)})),i&&i.appendChild(l),l},t.getDocumentHead=function(e){return e||(e=document),e.head||e.getElementsByTagName("head")[0]||e.documentElement},t.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||"http://www.w3.org/1999/xhtml",e):document.createElement(e)},t.removeChildren=function(e){e.innerHTML=""},t.createTextNode=function(e,t){return(t?t.ownerDocument:document).createTextNode(e)},t.createFragment=function(e){return(e?e.ownerDocument:document).createDocumentFragment()},t.hasCssClass=function(e,t){return-1!==(e.className+"").split(/\s+/g).indexOf(t)},t.addCssClass=function(e,i){t.hasCssClass(e,i)||(e.className+=" "+i)},t.removeCssClass=function(e,t){for(var i=e.className.split(/\s+/g);;){var n=i.indexOf(t);if(-1==n)break;i.splice(n,1)}e.className=i.join(" ")},t.toggleCssClass=function(e,t){for(var i=e.className.split(/\s+/g),n=!0;;){var s=i.indexOf(t);if(-1==s)break;n=!1,i.splice(s,1)}return n&&i.push(t),e.className=i.join(" "),n},t.setCssClass=function(e,i,n){n?t.addCssClass(e,i):t.removeCssClass(e,i)},t.hasCssString=function(e,t){var i,n=0;if(i=(t=t||document).querySelectorAll("style"))for(;n<i.length;)if(i[n++].id===e)return!0},t.removeElementById=function(e,t){(t=t||document).getElementById(e)&&t.getElementById(e).remove()};var r=[];function o(){var e=r;r=null,e&&e.forEach((function(e){a(e[0],e[1])}))}function a(e,i,s){if("undefined"!=typeof document){if(r)if(s)o();else if(!1===s)return r.push([e,i]);if(!n){var a=s;s&&s.getRootNode&&(a=s.getRootNode())&&a!=s||(a=document);var l=a.ownerDocument||a;if(i&&t.hasCssString(i,a))return null;i&&(e+="\n/*# sourceURL=ace/css/"+i+" */");var h=t.createElement("style");h.appendChild(l.createTextNode(e)),i&&(h.id=i),a==l&&(a=t.getDocumentHead(l)),a.insertBefore(h,a.firstChild)}}}if(t.useStrictCSP=function(e){n=e,0==e?o():r||(r=[])},t.importCssString=a,t.importCssStylsheet=function(e,i){t.buildDom(["link",{rel:"stylesheet",href:e}],t.getDocumentHead(i))},t.scrollbarWidth=function(e){var i=t.createElement("ace_inner");i.style.width="100%",i.style.minWidth="0px",i.style.height="200px",i.style.display="block";var n=t.createElement("ace_outer"),s=n.style;s.position="absolute",s.left="-10000px",s.overflow="hidden",s.width="200px",s.minWidth="0px",s.height="150px",s.display="block",n.appendChild(i);var r=e.documentElement;r.appendChild(n);var o=i.offsetWidth;s.overflow="scroll";var a=i.offsetWidth;return o==a&&(a=n.clientWidth),r.removeChild(n),o-a},t.computedStyle=function(e,t){return window.getComputedStyle(e,"")||{}},t.setStyle=function(e,t,i){e[t]!==i&&(e[t]=i)},t.HAS_CSS_ANIMATION=!1,t.HAS_CSS_TRANSFORMS=!1,t.HI_DPI=!s.isWin||"undefined"!=typeof window&&window.devicePixelRatio>=1.5,s.isChromeOS&&(t.HI_DPI=!1),"undefined"!=typeof document){var l=document.createElement("div");t.HI_DPI&&void 0!==l.style.transform&&(t.HAS_CSS_TRANSFORMS=!0),s.isEdge||void 0===l.style.animationName||(t.HAS_CSS_ANIMATION=!0),l=null}t.HAS_CSS_TRANSFORMS?t.translate=function(e,t,i){e.style.transform="translate("+Math.round(t)+"px, "+Math.round(i)+"px)"}:t.translate=function(e,t,i){e.style.top=Math.round(i)+"px",e.style.left=Math.round(t)+"px"}})),ace.define("ace/lib/oop",["require","exports","module"],(function(e,t,i){t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.mixin=function(e,t){for(var i in t)e[i]=t[i];return e},t.implement=function(e,i){t.mixin(e,i)}})),ace.define("ace/lib/keys",["require","exports","module","ace/lib/oop"],(function(e,t,i){var n=e("./oop"),s=function(){var e,t,i={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta",91:"MetaLeft",92:"MetaRight",93:"ContextMenu"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,super:8,meta:8,command:8,cmd:8,control:1},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}};for(t in i.FUNCTION_KEYS)e=i.FUNCTION_KEYS[t].toLowerCase(),i[e]=parseInt(t,10);for(t in i.PRINTABLE_KEYS)e=i.PRINTABLE_KEYS[t].toLowerCase(),i[e]=parseInt(t,10);return n.mixin(i,i.MODIFIER_KEYS),n.mixin(i,i.PRINTABLE_KEYS),n.mixin(i,i.FUNCTION_KEYS),i.enter=i.return,i.escape=i.esc,i.del=i.delete,i[173]="-",function(){for(var e=["cmd","ctrl","alt","shift"],t=Math.pow(2,e.length);t--;)i.KEY_MODS[t]=e.filter((function(e){return t&i.KEY_MODS[e]})).join("-")+"-"}(),i.KEY_MODS[0]="",i.KEY_MODS[-1]="input-",i}();n.mixin(t,s),t.keyCodeToString=function(e){var t=s[e];return"string"!=typeof t&&(t=String.fromCharCode(e)),t.toLowerCase()}})),ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],(function(e,t,i){var n,s=e("./keys"),r=e("./useragent"),o=null,a=0;function l(){return null==n&&function(){n=!1;try{document.createComment("").addEventListener("test",(function(){}),{get passive(){n={passive:!1}}})}catch(e){}}(),n}function h(e,t,i){this.elem=e,this.type=t,this.callback=i}h.prototype.destroy=function(){u(this.elem,this.type,this.callback),this.elem=this.type=this.callback=void 0};var c=t.addListener=function(e,t,i,n){e.addEventListener(t,i,l()),n&&n.$toDestroy.push(new h(e,t,i))},u=t.removeListener=function(e,t,i){e.removeEventListener(t,i,l())};t.stopEvent=function(e){return t.stopPropagation(e),t.preventDefault(e),!1},t.stopPropagation=function(e){e.stopPropagation&&e.stopPropagation()},t.preventDefault=function(e){e.preventDefault&&e.preventDefault()},t.getButton=function(e){return"dblclick"==e.type?0:"contextmenu"==e.type||r.isMac&&e.ctrlKey&&!e.altKey&&!e.shiftKey?2:e.button},t.capture=function(e,t,i){var n=e&&e.ownerDocument||document;function s(e){t&&t(e),i&&i(e),u(n,"mousemove",t),u(n,"mouseup",s),u(n,"dragstart",s)}return c(n,"mousemove",t),c(n,"mouseup",s),c(n,"dragstart",s),s},t.addMouseWheelListener=function(e,t,i){c(e,"wheel",(function(e){var i=e.deltaX||0,n=e.deltaY||0;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=.15*i,e.wheelY=.15*n;break;case e.DOM_DELTA_LINE:e.wheelX=15*i,e.wheelY=15*n;break;case e.DOM_DELTA_PAGE:e.wheelX=150*i,e.wheelY=150*n}t(e)}),i)},t.addMultiMouseDownListener=function(e,i,n,s,o){var a,l,h,u=0,d={2:"dblclick",3:"tripleclick",4:"quadclick"};function f(e){if(0!==t.getButton(e)?u=0:e.detail>1?++u>4&&(u=1):u=1,r.isIE){var o=Math.abs(e.clientX-a)>5||Math.abs(e.clientY-l)>5;h&&!o||(u=1),h&&clearTimeout(h),h=setTimeout((function(){h=null}),i[u-1]||600),1==u&&(a=e.clientX,l=e.clientY)}if(e._clicks=u,n[s]("mousedown",e),u>4)u=0;else if(u>1)return n[s](d[u],e)}Array.isArray(e)||(e=[e]),e.forEach((function(e){c(e,"mousedown",f,o)}))};var d=function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)};function f(e,t,i){var n=d(t);if(!r.isMac&&o){if(t.getModifierState&&(t.getModifierState("OS")||t.getModifierState("Win"))&&(n|=8),o.altGr){if(3==(3&n))return;o.altGr=0}if(18===i||17===i){var l="location"in t?t.location:t.keyLocation;if(17===i&&1===l)1==o[i]&&(a=t.timeStamp);else if(18===i&&3===n&&2===l){t.timeStamp-a<50&&(o.altGr=!0)}}}if((i in s.MODIFIER_KEYS&&(i=-1),!n&&13===i)&&(3===(l="location"in t?t.location:t.keyLocation)&&(e(t,n,-i),t.defaultPrevented)))return;if(r.isChromeOS&&8&n){if(e(t,n,i),t.defaultPrevented)return;n&=-9}return!!(n||i in s.FUNCTION_KEYS||i in s.PRINTABLE_KEYS)&&e(t,n,i)}function p(){o=Object.create(null)}if(t.getModifierString=function(e){return s.KEY_MODS[d(e)]},t.addCommandKeyListener=function(e,i,n){if(r.isOldGecko||r.isOpera&&!("KeyboardEvent"in window)){var s=null;c(e,"keydown",(function(e){s=e.keyCode}),n),c(e,"keypress",(function(e){return f(i,e,s)}),n)}else{var a=null;c(e,"keydown",(function(e){o[e.keyCode]=(o[e.keyCode]||0)+1;var t=f(i,e,e.keyCode);return a=e.defaultPrevented,t}),n),c(e,"keypress",(function(e){a&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&&(t.stopEvent(e),a=null)}),n),c(e,"keyup",(function(e){o[e.keyCode]=null}),n),o||(p(),c(window,"focus",p))}},"object"==typeof window&&window.postMessage&&!r.isOldIE){var g=1;t.nextTick=function(e,i){i=i||window;var n="zero-timeout-message-"+g++,s=function(r){r.data==n&&(t.stopPropagation(r),u(i,"message",s),e())};c(i,"message",s),i.postMessage(n,"*")}}t.$idleBlocked=!1,t.onIdle=function(e,i){return setTimeout((function i(){t.$idleBlocked?setTimeout(i,100):e()}),i)},t.$idleBlockId=null,t.blockIdle=function(e){t.$idleBlockId&&clearTimeout(t.$idleBlockId),t.$idleBlocked=!0,t.$idleBlockId=setTimeout((function(){t.$idleBlocked=!1}),e||100)},t.nextFrame="object"==typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),t.nextFrame?t.nextFrame=t.nextFrame.bind(window):t.nextFrame=function(e){setTimeout(e,17)}})),ace.define("ace/range",["require","exports","module"],(function(e,t,i){var n=function(e,t,i,n){this.start={row:e,column:t},this.end={row:i,column:n}};(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(e,t){return 0==this.compare(e,t)},this.compareRange=function(e){var t,i=e.end,n=e.start;return 1==(t=this.compare(i.row,i.column))?1==(t=this.compare(n.row,n.column))?2:0==t?1:0:-1==t?-2:-1==(t=this.compare(n.row,n.column))?-1:1==t?42:0},this.comparePoint=function(e){return this.compare(e.row,e.column)},this.containsRange=function(e){return 0==this.comparePoint(e.start)&&0==this.comparePoint(e.end)},this.intersects=function(e){var t=this.compareRange(e);return-1==t||0==t||1==t},this.isEnd=function(e,t){return this.end.row==e&&this.end.column==t},this.isStart=function(e,t){return this.start.row==e&&this.start.column==t},this.setStart=function(e,t){"object"==typeof e?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=t)},this.setEnd=function(e,t){"object"==typeof e?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=t)},this.inside=function(e,t){return 0==this.compare(e,t)&&(!this.isEnd(e,t)&&!this.isStart(e,t))},this.insideStart=function(e,t){return 0==this.compare(e,t)&&!this.isEnd(e,t)},this.insideEnd=function(e,t){return 0==this.compare(e,t)&&!this.isStart(e,t)},this.compare=function(e,t){return this.isMultiLine()||e!==this.start.row?e<this.start.row?-1:e>this.end.row?1:this.start.row===e?t>=this.start.column?0:-1:this.end.row===e?t<=this.end.column?0:1:0:t<this.start.column?-1:t>this.end.column?1:0},this.compareStart=function(e,t){return this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.compareEnd=function(e,t){return this.end.row==e&&this.end.column==t?1:this.compare(e,t)},this.compareInside=function(e,t){return this.end.row==e&&this.end.column==t?1:this.start.row==e&&this.start.column==t?-1:this.compare(e,t)},this.clipRows=function(e,t){if(this.end.row>t)var i={row:t+1,column:0};else if(this.end.row<e)i={row:e,column:0};if(this.start.row>t)var s={row:t+1,column:0};else if(this.start.row<e)s={row:e,column:0};return n.fromPoints(s||this.start,i||this.end)},this.extend=function(e,t){var i=this.compare(e,t);if(0==i)return this;if(-1==i)var s={row:e,column:t};else var r={row:e,column:t};return n.fromPoints(s||this.start,r||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return n.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new n(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new n(this.start.row,0,this.end.row,0)},this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start),i=e.documentToScreenPosition(this.end);return new n(t.row,t.column,i.row,i.column)},this.moveBy=function(e,t){this.start.row+=e,this.start.column+=t,this.end.row+=e,this.end.column+=t}}).call(n.prototype),n.fromPoints=function(e,t){return new n(e.row,e.column,t.row,t.column)},n.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},n.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},t.Range=n})),ace.define("ace/lib/lang",["require","exports","module"],(function(e,t,i){t.last=function(e){return e[e.length-1]},t.stringReverse=function(e){return e.split("").reverse().join("")},t.stringRepeat=function(e,t){for(var i="";t>0;)1&t&&(i+=e),(t>>=1)&&(e+=e);return i};var n=/^\s\s*/,s=/\s\s*$/;t.stringTrimLeft=function(e){return e.replace(n,"")},t.stringTrimRight=function(e){return e.replace(s,"")},t.copyObject=function(e){var t={};for(var i in e)t[i]=e[i];return t},t.copyArray=function(e){for(var t=[],i=0,n=e.length;i<n;i++)e[i]&&"object"==typeof e[i]?t[i]=this.copyObject(e[i]):t[i]=e[i];return t},t.deepCopy=function e(t){if("object"!=typeof t||!t)return t;var i;if(Array.isArray(t)){i=[];for(var n=0;n<t.length;n++)i[n]=e(t[n]);return i}if("[object Object]"!==Object.prototype.toString.call(t))return t;for(var n in i={},t)i[n]=e(t[n]);return i},t.arrayToMap=function(e){for(var t={},i=0;i<e.length;i++)t[e[i]]=1;return t},t.createMap=function(e){var t=Object.create(null);for(var i in e)t[i]=e[i];return t},t.arrayRemove=function(e,t){for(var i=0;i<=e.length;i++)t===e[i]&&e.splice(i,1)},t.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},t.escapeHTML=function(e){return(""+e).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},t.getMatchOffsets=function(e,t){var i=[];return e.replace(t,(function(e){i.push({offset:arguments[arguments.length-2],length:e.length})})),i},t.deferredCall=function(e){var t=null,i=function(){t=null,e()},n=function(e){return n.cancel(),t=setTimeout(i,e||0),n};return n.schedule=n,n.call=function(){return this.cancel(),e(),n},n.cancel=function(){return clearTimeout(t),t=null,n},n.isPending=function(){return t},n},t.delayedCall=function(e,t){var i=null,n=function(){i=null,e()},s=function(e){null==i&&(i=setTimeout(n,e||t))};return s.delay=function(e){i&&clearTimeout(i),i=setTimeout(n,e||t)},s.schedule=s,s.call=function(){this.cancel(),e()},s.cancel=function(){i&&clearTimeout(i),i=null},s.isPending=function(){return i},s}})),ace.define("ace/clipboard",["require","exports","module"],(function(e,t,i){var n;i.exports={lineMode:!1,pasteCancelled:function(){return!!(n&&n>Date.now()-50)||(n=!1)},cancel:function(){n=Date.now()}}})),ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/clipboard","ace/lib/keys"],(function(e,t,i){var n=e("../lib/event"),s=e("../lib/useragent"),r=e("../lib/dom"),o=e("../lib/lang"),a=e("../clipboard"),l=s.isChrome<18,h=s.isIE,c=s.isChrome>63,u=400,d=e("../lib/keys"),f=d.KEY_MODS,p=s.isIOS,g=p?/\s/:/\n/,m=s.isMobile;t.TextInput=function(e,t){var i=r.createElement("textarea");i.className="ace_text-input",i.setAttribute("wrap","off"),i.setAttribute("autocorrect","off"),i.setAttribute("autocapitalize","off"),i.setAttribute("spellcheck",!1),i.style.opacity="0",e.insertBefore(i,e.firstChild);var v=!1,w=!1,y=!1,b=!1,_="";m||(i.style.fontSize="1px");var C=!1,S=!1,x="",k=0,A=0,E=0;try{var T=document.activeElement===i}catch(e){}n.addListener(i,"blur",(function(e){S||(t.onBlur(e),T=!1)}),t),n.addListener(i,"focus",(function(e){if(!S){if(T=!0,s.isEdge)try{if(!document.hasFocus())return}catch(e){}t.onFocus(e),s.isEdge?setTimeout(M):M()}}),t),this.$focusScroll=!1,this.focus=function(){if(_||c||"browser"==this.$focusScroll)return i.focus({preventScroll:!0});var e=i.style.top;i.style.position="fixed",i.style.top="0px";try{var t=0!=i.getBoundingClientRect().top}catch(e){return}var n=[];if(t)for(var s=i.parentElement;s&&1==s.nodeType;)n.push(s),s.setAttribute("ace_nocontext",!0),s=!s.parentElement&&s.getRootNode?s.getRootNode().host:s.parentElement;i.focus({preventScroll:!0}),t&&n.forEach((function(e){e.removeAttribute("ace_nocontext")})),setTimeout((function(){i.style.position="","0px"==i.style.top&&(i.style.top=e)}),0)},this.blur=function(){i.blur()},this.isFocused=function(){return T},t.on("beforeEndOperation",(function(){var e=t.curOp,n=e&&e.command&&e.command.name;if("insertstring"!=n){var s=n&&(e.docChanged||e.selectionChanged);y&&s&&(x=i.value="",W()),M()}}));var M=p?function(e){if(T&&(!v||e)&&!b){e||(e="");var n="\n ab"+e+"cde fg\n";n!=i.value&&(i.value=x=n);var s=4+(e.length||(t.selection.isEmpty()?0:1));4==k&&A==s||i.setSelectionRange(4,s),k=4,A=s}}:function(){if(!y&&!b&&(T||R)){y=!0;var e=0,n=0,s="";if(t.session){var r=t.selection,o=r.getRange(),a=r.cursor.row;if(e=o.start.column,n=o.end.column,s=t.session.getLine(a),o.start.row!=a){var l=t.session.getLine(a-1);e=o.start.row<a-1?0:e,n+=l.length+1,s=l+"\n"+s}else if(o.end.row!=a){var h=t.session.getLine(a+1);n=o.end.row>a+1?h.length:n,n+=s.length+1,s=s+"\n"+h}else m&&a>0&&(s="\n"+s,n+=1,e+=1);s.length>u&&(e<u&&n<u?s=s.slice(0,u):(s="\n",e==n?e=n=0:(e=0,n=1)))}var c=s+"\n\n";if(c!=x&&(i.value=x=c,k=A=c.length),R&&(k=i.selectionStart,A=i.selectionEnd),A!=n||k!=e||i.selectionEnd!=A)try{i.setSelectionRange(e,n),k=e,A=n}catch(e){}y=!1}};this.resetSelection=M,T&&t.onFocus();var L=null;this.setInputHandler=function(e){L=e},this.getInputHandler=function(){return L};var R=!1,$=function(e,n){if(R&&(R=!1),w)return M(),e&&t.onPaste(e),w=!1,"";for(var r=i.selectionStart,o=i.selectionEnd,a=k,l=x.length-A,h=e,c=e.length-r,u=e.length-o,d=0;a>0&&x[d]==e[d];)d++,a--;for(h=h.slice(d),d=1;l>0&&x.length-d>k-1&&x[x.length-d]==e[e.length-d];)d++,l--;c-=d-1,u-=d-1;var f=h.length-d+1;if(f<0&&(a=-f,f=0),h=h.slice(0,f),!(n||h||c||a||l||u))return"";b=!0;var p=!1;return s.isAndroid&&". "==h&&(h="  ",p=!0),h&&!a&&!l&&!c&&!u||C?t.onTextInput(h):t.onTextInput(h,{extendLeft:a,extendRight:l,restoreStart:c,restoreEnd:u}),b=!1,x=e,k=r,A=o,E=u,p?"\n":h},I=function(e){if(y)return B();if(e&&e.inputType){if("historyUndo"==e.inputType)return t.execCommand("undo");if("historyRedo"==e.inputType)return t.execCommand("redo")}var n=i.value,s=$(n,!0);(n.length>500||g.test(s)||m&&k<1&&k==A)&&M()},O=function(e,t,i){var n=e.clipboardData||window.clipboardData;if(n&&!l){var s=h||i?"Text":"text/plain";try{return t?!1!==n.setData(s,t):n.getData(s)}catch(e){if(!i)return O(e,t,!0)}}},D=function(e,s){var r=t.getCopyText();if(!r)return n.preventDefault(e);O(e,r)?(p&&(M(r),v=r,setTimeout((function(){v=!1}),10)),s?t.onCut():t.onCopy(),n.preventDefault(e)):(v=!0,i.value=r,i.select(),setTimeout((function(){v=!1,M(),s?t.onCut():t.onCopy()})))},N=function(e){D(e,!0)},P=function(e){D(e,!1)},F=function(e){var r=O(e);a.pasteCancelled()||("string"==typeof r?(r&&t.onPaste(r,e),s.isIE&&setTimeout(M),n.preventDefault(e)):(i.value="",w=!0))};n.addCommandKeyListener(i,t.onCommandKey.bind(t),t),n.addListener(i,"select",(function(e){var n;y||(v?v=!1:0===(n=i).selectionStart&&n.selectionEnd>=x.length&&n.value===x&&x&&n.selectionEnd!==A?(t.selectAll(),M()):m&&i.selectionStart!=k&&M())}),t),n.addListener(i,"input",I,t),n.addListener(i,"cut",N,t),n.addListener(i,"copy",P,t),n.addListener(i,"paste",F,t),"oncut"in i&&"oncopy"in i&&"onpaste"in i||n.addListener(e,"keydown",(function(e){if((!s.isMac||e.metaKey)&&e.ctrlKey)switch(e.keyCode){case 67:P(e);break;case 86:F(e);break;case 88:N(e)}}),t);var B=function(){if(y&&t.onCompositionUpdate&&!t.$readOnly){if(C)return H();if(y.useTextareaForIME)t.onCompositionUpdate(i.value);else{var e=i.value;$(e),y.markerRange&&(y.context&&(y.markerRange.start.column=y.selectionStart=y.context.compositionStartOffset),y.markerRange.end.column=y.markerRange.start.column+A-y.selectionStart+E)}}},W=function(e){t.onCompositionEnd&&!t.$readOnly&&(y=!1,t.onCompositionEnd(),t.off("mousedown",H),e&&I())};function H(){S=!0,i.blur(),i.focus(),S=!1}var V,z=o.delayedCall(B,50).schedule.bind(null,null);function U(){clearTimeout(V),V=setTimeout((function(){_&&(i.style.cssText=_,_=""),t.renderer.$isMousePressed=!1,t.renderer.$keepTextAreaAtCursor&&t.renderer.$moveTextAreaToCursor()}),0)}n.addListener(i,"compositionstart",(function(e){if(!y&&t.onCompositionStart&&!t.$readOnly&&(y={},!C)){e.data&&(y.useTextareaForIME=!1),setTimeout(B,0),t._signal("compositionStart"),t.on("mousedown",H);var n=t.getSelectionRange();n.end.row=n.start.row,n.end.column=n.start.column,y.markerRange=n,y.selectionStart=k,t.onCompositionStart(y),y.useTextareaForIME?(x=i.value="",k=0,A=0):(i.msGetInputContext&&(y.context=i.msGetInputContext()),i.getInputContext&&(y.context=i.getInputContext()))}}),t),n.addListener(i,"compositionupdate",B,t),n.addListener(i,"keyup",(function(e){27==e.keyCode&&i.value.length<i.selectionStart&&(y||(x=i.value),k=A=-1,M()),z()}),t),n.addListener(i,"keydown",z,t),n.addListener(i,"compositionend",W,t),this.getElement=function(){return i},this.setCommandMode=function(e){C=e,i.readOnly=!1},this.setReadOnly=function(e){C||(i.readOnly=e)},this.setCopyWithEmptySelection=function(e){},this.onContextMenu=function(e){R=!0,M(),t._emit("nativecontextmenu",{target:t,domEvent:e}),this.moveToMouse(e,!0)},this.moveToMouse=function(e,o){_||(_=i.style.cssText),i.style.cssText=(o?"z-index:100000;":"")+(s.isIE?"opacity:0.1;":"")+"text-indent: -"+(k+A)*t.renderer.characterWidth*.5+"px;";var a=t.container.getBoundingClientRect(),l=r.computedStyle(t.container),h=a.top+(parseInt(l.borderTopWidth)||0),c=a.left+(parseInt(a.borderLeftWidth)||0),u=a.bottom-h-i.clientHeight-2,d=function(e){r.translate(i,e.clientX-c-2,Math.min(e.clientY-h-2,u))};d(e),"mousedown"==e.type&&(t.renderer.$isMousePressed=!0,clearTimeout(V),s.isWin&&n.capture(t.container,d,U))},this.onContextMenuClose=U;var q=function(e){t.textInput.onContextMenu(e),U()};n.addListener(i,"mouseup",q,t),n.addListener(i,"mousedown",(function(e){e.preventDefault(),U()}),t),n.addListener(t.renderer.scroller,"contextmenu",q,t),n.addListener(i,"contextmenu",q,t),p&&function(e,t,i){var n=null,s=!1;i.addEventListener("keydown",(function(e){n&&clearTimeout(n),s=!0}),!0),i.addEventListener("keyup",(function(e){n=setTimeout((function(){s=!1}),100)}),!0);var r=function(e){if(document.activeElement===i&&!(s||y||t.$mouseHandler.isMousePressed||v)){var n=i.selectionStart,r=i.selectionEnd,o=null,a=0;if(0==n?o=d.up:1==n?o=d.home:r>A&&"\n"==x[r]?o=d.end:n<k&&" "==x[n-1]?(o=d.left,a=f.option):n<k||n==k&&A!=k&&n==r?o=d.left:r>A&&x.slice(0,r).split("\n").length>2?o=d.down:r>A&&" "==x[r-1]?(o=d.right,a=f.option):(r>A||r==A&&A!=k&&n==r)&&(o=d.right),n!==r&&(a|=f.shift),o){if(!t.onCommandKey({},a,o)&&t.commands){o=d.keyCodeToString(o);var l=t.commands.findKeyCommand(a,o);l&&t.execCommand(l)}k=n,A=r,M("")}}};document.addEventListener("selectionchange",r),t.on("destroy",(function(){document.removeEventListener("selectionchange",r)}))}(0,t,i),this.destroy=function(){i.parentElement&&i.parentElement.removeChild(i)}},t.$setUserAgentForTests=function(e,t){m=e,p=t}})),ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/useragent"],(function(e,t,i){var n=e("../lib/useragent");function s(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler("mousedown",this.onMouseDown.bind(e)),t.setDefaultHandler("dblclick",this.onDoubleClick.bind(e)),t.setDefaultHandler("tripleclick",this.onTripleClick.bind(e)),t.setDefaultHandler("quadclick",this.onQuadClick.bind(e)),t.setDefaultHandler("mousewheel",this.onMouseWheel.bind(e));["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"].forEach((function(t){e[t]=this[t]}),this),e.selectByLines=this.extendSelectionBy.bind(e,"getLineRange"),e.selectByWords=this.extendSelectionBy.bind(e,"getWordRange")}function r(e,t){if(e.start.row==e.end.row)var i=2*t.column-e.start.column-e.end.column;else if(e.start.row!=e.end.row-1||e.start.column||e.end.column)i=2*t.row-e.start.row-e.end.row;else var i=t.column-4;return i<0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}(function(){this.onMouseDown=function(e){var t=e.inSelection(),i=e.getDocumentPosition();this.mousedownEvent=e;var s=this.editor,r=e.getButton();return 0!==r?((s.getSelectionRange().isEmpty()||1==r)&&s.selection.moveToPosition(i),void(2==r&&(s.textInput.onContextMenu(e.domEvent),n.isMozilla||e.preventDefault()))):(this.mousedownEvent.time=Date.now(),!t||s.isFocused()||(s.focus(),!this.$focusTimeout||this.$clickSelection||s.inMultiSelectMode)?(this.captureMouse(e),this.startSelect(i,e.domEvent._clicks>1),e.preventDefault()):(this.setState("focusWait"),void this.captureMouse(e)))},this.startSelect=function(e,t){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var i=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?i.selection.selectToPosition(e):t||i.selection.moveToPosition(e),t||this.select(),i.renderer.scroller.setCapture&&i.renderer.scroller.setCapture(),i.setStyle("ace_selecting"),this.setState("select"))},this.select=function(){var e,t=this.editor,i=t.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var n=this.$clickSelection.comparePoint(i);if(-1==n)e=this.$clickSelection.end;else if(1==n)e=this.$clickSelection.start;else{var s=r(this.$clickSelection,i);i=s.cursor,e=s.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(i),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,i=this.editor,n=i.renderer.screenToTextCoordinates(this.x,this.y),s=i.selection[e](n.row,n.column);if(this.$clickSelection){var o=this.$clickSelection.comparePoint(s.start),a=this.$clickSelection.comparePoint(s.end);if(-1==o&&a<=0)t=this.$clickSelection.end,s.end.row==n.row&&s.end.column==n.column||(n=s.start);else if(1==a&&o>=0)t=this.$clickSelection.start,s.start.row==n.row&&s.start.column==n.column||(n=s.end);else if(-1==o&&1==a)n=s.end,t=s.start;else{var l=r(this.$clickSelection,n);n=l.cursor,t=l.anchor}i.selection.setSelectionAnchor(t.row,t.column)}i.selection.selectToPosition(n),i.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var e,t,i,n,s=(e=this.mousedownEvent.x,t=this.mousedownEvent.y,i=this.x,n=this.y,Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))),r=Date.now();(s>0||r-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var t=e.getDocumentPosition(),i=this.editor,n=i.session.getBracketRange(t);n?(n.isEmpty()&&(n.start.column--,n.end.column++),this.setState("select")):(n=i.selection.getWordRange(t.row,t.column),this.setState("selectByWords")),this.$clickSelection=n,this.select()},this.onTripleClick=function(e){var t=e.getDocumentPosition(),i=this.editor;this.setState("selectByLines");var n=i.getSelectionRange();n.isMultiLine()&&n.contains(t.row,t.column)?(this.$clickSelection=i.selection.getLineRange(n.start.row),this.$clickSelection.end=i.selection.getLineRange(n.end.row).end):this.$clickSelection=i.selection.getLineRange(t.row),this.select()},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(e){if(!e.getAccelKey()){e.getShiftKey()&&e.wheelY&&!e.wheelX&&(e.wheelX=e.wheelY,e.wheelY=0);var t=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var i=this.$lastScroll,n=e.domEvent.timeStamp,s=n-i.t,r=s?e.wheelX/s:i.vx,o=s?e.wheelY/s:i.vy;s<550&&(r=(r+i.vx)/2,o=(o+i.vy)/2);var a=Math.abs(r/o),l=!1;if(a>=1&&t.renderer.isScrollableBy(e.wheelX*e.speed,0)&&(l=!0),a<=1&&t.renderer.isScrollableBy(0,e.wheelY*e.speed)&&(l=!0),l)i.allowed=n;else if(n-i.allowed<550){Math.abs(r)<=1.5*Math.abs(i.vx)&&Math.abs(o)<=1.5*Math.abs(i.vy)?(l=!0,i.allowed=n):i.allowed=0}return i.t=n,i.vx=r,i.vy=o,l?(t.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()):void 0}}}).call(s.prototype),t.DefaultHandlers=s})),ace.define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],(function(e,t,i){e("./lib/oop");var n=e("./lib/dom"),s="ace_tooltip";function r(e){this.isOpen=!1,this.$element=null,this.$parentNode=e}(function(){this.$init=function(){return this.$element=n.createElement("div"),this.$element.className=s,this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(e){this.getElement().textContent=e},this.setHtml=function(e){this.getElement().innerHTML=e},this.setPosition=function(e,t){this.getElement().style.left=e+"px",this.getElement().style.top=t+"px"},this.setClassName=function(e){n.addCssClass(this.getElement(),e)},this.show=function(e,t,i){null!=e&&this.setText(e),null!=t&&null!=i&&this.setPosition(t,i),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.getElement().className=s,this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth},this.destroy=function(){this.isOpen=!1,this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)}}).call(r.prototype),t.Tooltip=r})),ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"],(function(e,t,i){var n=e("../lib/dom"),s=e("../lib/oop"),r=e("../lib/event"),o=e("../tooltip").Tooltip;function a(e){o.call(this,e)}s.inherits(a,o),function(){this.setPosition=function(e,t){var i=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight,s=this.getWidth(),r=this.getHeight();(e+=15)+s>i&&(e-=e+s-i),(t+=15)+r>n&&(t-=20+r),o.prototype.setPosition.call(this,e,t)}}.call(a.prototype),t.GutterHandler=function(e){var t,i,s,o=e.editor,l=o.renderer.$gutterLayer,h=new a(o.container);function c(){t&&(t=clearTimeout(t)),s&&(h.hide(),s=null,o._signal("hideGutterTooltip",h),o.off("mousewheel",c))}function u(e){h.setPosition(e.x,e.y)}e.editor.setDefaultHandler("guttermousedown",(function(t){if(o.isFocused()&&0==t.getButton()&&"foldWidgets"!=l.getRegion(t)){var i=t.getDocumentPosition().row,n=o.session.selection;if(t.getShiftKey())n.selectTo(i,0);else{if(2==t.domEvent.detail)return o.selectAll(),t.preventDefault();e.$clickSelection=o.selection.getLineRange(i)}return e.setState("selectByLines"),e.captureMouse(t),t.preventDefault()}})),e.editor.setDefaultHandler("guttermousemove",(function(r){var a=r.domEvent.target||r.domEvent.srcElement;if(n.hasCssClass(a,"ace_fold-widget"))return c();s&&e.$tooltipFollowsMouse&&u(r),i=r,t||(t=setTimeout((function(){t=null,i&&!e.isMousePressed?function(){var t=i.getDocumentPosition().row,n=l.$annotations[t];if(!n)return c();if(t==o.session.getLength()){var r=o.renderer.pixelToScreenCoordinates(0,i.y).row,a=i.$pos;if(r>o.session.documentToScreenRow(a.row,a.column))return c()}if(s!=n){s=n.text.join("<br/>"),h.setHtml(s);var d=n.className;if(d&&h.setClassName(d.trim()),h.show(),o._signal("showGutterTooltip",h),o.on("mousewheel",c),e.$tooltipFollowsMouse)u(i);else{var f=i.domEvent.target.getBoundingClientRect(),p=h.getElement().style;p.left=f.right+"px",p.top=f.bottom+"px"}}}():c()}),50))})),r.addListener(o.renderer.$gutter,"mouseout",(function(e){i=null,s&&!t&&(t=setTimeout((function(){t=null,c()}),50))}),o),o.on("changeSession",c)}})),ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],(function(e,t,i){var n=e("../lib/event"),s=e("../lib/useragent"),r=t.MouseEvent=function(e,t){this.domEvent=e,this.editor=t,this.x=this.clientX=e.clientX,this.y=this.clientY=e.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};(function(){this.stopPropagation=function(){n.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){n.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos||(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY)),this.$pos},this.inSelection=function(){if(null!==this.$inSelection)return this.$inSelection;var e=this.editor.getSelectionRange();if(e.isEmpty())this.$inSelection=!1;else{var t=this.getDocumentPosition();this.$inSelection=e.contains(t.row,t.column)}return this.$inSelection},this.getButton=function(){return n.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=s.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(r.prototype)})),ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],(function(e,t,i){var n=e("../lib/dom"),s=e("../lib/event"),r=e("../lib/useragent");function o(e){var t=e.editor,i=n.createElement("div");i.style.cssText="top:-100px;position:absolute;z-index:2147483647;opacity:0.5",i.textContent=" ";["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"].forEach((function(t){e[t]=this[t]}),this),t.on("mousedown",this.onMouseDown.bind(e));var o,l,h,c,u,d,f,p,g,m,v,w=t.container,y=0;function b(){var e=d;(function(e,i){var n=Date.now(),s=!i||e.row!=i.row,r=!i||e.column!=i.column;!m||s||r?(t.moveCursorToPosition(e),m=n,v={x:l,y:h}):a(v.x,v.y,l,h)>5?m=null:n-m>=200&&(t.renderer.scrollCursorIntoView(),m=null)})(d=t.renderer.screenToTextCoordinates(l,h),e),function(e,i){var n=Date.now(),s=t.renderer.layerConfig.lineHeight,r=t.renderer.layerConfig.characterWidth,o=t.renderer.scroller.getBoundingClientRect(),a={x:{left:l-o.left,right:o.right-l},y:{top:h-o.top,bottom:o.bottom-h}},c=Math.min(a.x.left,a.x.right),u=Math.min(a.y.top,a.y.bottom),d={row:e.row,column:e.column};c/r<=2&&(d.column+=a.x.left<a.x.right?-3:2),u/s<=1&&(d.row+=a.y.top<a.y.bottom?-1:1);var f=e.row!=d.row,p=e.column!=d.column,m=!i||e.row!=i.row;f||p&&!m?g?n-g>=200&&t.renderer.scrollCursorIntoView(d):g=n:g=null}(d,e)}function _(){u=t.selection.toOrientedRange(),o=t.session.addMarker(u,"ace_selection",t.getSelectionStyle()),t.clearSelection(),t.isFocused()&&t.renderer.$cursorLayer.setBlinking(!1),clearInterval(c),b(),c=setInterval(b,20),y=0,s.addListener(document,"mousemove",x)}function C(){clearInterval(c),t.session.removeMarker(o),o=null,t.selection.fromOrientedRange(u),t.isFocused()&&!p&&t.$resetCursorStyle(),u=null,d=null,y=0,g=null,m=null,s.removeListener(document,"mousemove",x)}this.onDragStart=function(e){if(this.cancelDrag||!w.draggable){var n=this;return setTimeout((function(){n.startSelect(),n.captureMouse(e)}),0),e.preventDefault()}u=t.getSelectionRange();var s=e.dataTransfer;s.effectAllowed=t.getReadOnly()?"copy":"copyMove",t.container.appendChild(i),s.setDragImage&&s.setDragImage(i,0,0),setTimeout((function(){t.container.removeChild(i)})),s.clearData(),s.setData("Text",t.session.getTextRange()),p=!0,this.setState("drag")},this.onDragEnd=function(e){if(w.draggable=!1,p=!1,this.setState(null),!t.getReadOnly()){var i=e.dataTransfer.dropEffect;f||"move"!=i||t.session.remove(t.getSelectionRange()),t.$resetCursorStyle()}this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(e){if(!t.getReadOnly()&&k(e.dataTransfer))return l=e.clientX,h=e.clientY,o||_(),y++,e.dataTransfer.dropEffect=f=A(e),s.preventDefault(e)},this.onDragOver=function(e){if(!t.getReadOnly()&&k(e.dataTransfer))return l=e.clientX,h=e.clientY,o||(_(),y++),null!==S&&(S=null),e.dataTransfer.dropEffect=f=A(e),s.preventDefault(e)},this.onDragLeave=function(e){if(--y<=0&&o)return C(),f=null,s.preventDefault(e)},this.onDrop=function(e){if(d){var i=e.dataTransfer;if(p)switch(f){case"move":u=u.contains(d.row,d.column)?{start:d,end:d}:t.moveText(u,d);break;case"copy":u=t.moveText(u,d,!0)}else{var n=i.getData("Text");u={start:d,end:t.session.insert(d,n)},t.focus(),f=null}return C(),s.preventDefault(e)}},s.addListener(w,"dragstart",this.onDragStart.bind(e),t),s.addListener(w,"dragend",this.onDragEnd.bind(e),t),s.addListener(w,"dragenter",this.onDragEnter.bind(e),t),s.addListener(w,"dragover",this.onDragOver.bind(e),t),s.addListener(w,"dragleave",this.onDragLeave.bind(e),t),s.addListener(w,"drop",this.onDrop.bind(e),t);var S=null;function x(){null==S&&(S=setTimeout((function(){null!=S&&o&&C()}),20))}function k(e){var t=e.types;return!t||Array.prototype.some.call(t,(function(e){return"text/plain"==e||"Text"==e}))}function A(e){var t=["copy","copymove","all","uninitialized"],i=r.isMac?e.altKey:e.ctrlKey,n="uninitialized";try{n=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var s="none";return i&&t.indexOf(n)>=0?s="copy":["move","copymove","linkmove","all","uninitialized"].indexOf(n)>=0?s="move":t.indexOf(n)>=0&&(s="copy"),s}}function a(e,t,i,n){return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))}(function(){this.dragWait=function(){Date.now()-this.mousedownEvent.time>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){this.editor.container.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.$resetCursorStyle(),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor;e.container.draggable=!0,e.renderer.$cursorLayer.setBlinking(!1),e.setStyle("ace_dragging");var t=r.isWin?"default":"move";e.renderer.setCursorStyle(t),this.setState("dragReady")},this.onMouseDrag=function(e){var t=this.editor.container;r.isIE&&"dragReady"==this.state&&(a(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)>3&&t.dragDrop());"dragWait"===this.state&&(a(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)>0&&(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition())))},this.onMouseDown=function(e){if(this.$dragEnabled){this.mousedownEvent=e;var t=this.editor,i=e.inSelection(),n=e.getButton();if(1===(e.domEvent.detail||1)&&0===n&&i){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var s=e.domEvent.target||e.domEvent.srcElement;if("unselectable"in s&&(s.unselectable="on"),t.getDragDelay()){if(r.isWebKit)this.cancelDrag=!0,t.container.draggable=!0;this.setState("dragWait")}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}}).call(o.prototype),t.DragdropHandler=o})),ace.define("ace/mouse/touch_handler",["require","exports","module","ace/mouse/mouse_event","ace/lib/event","ace/lib/dom"],(function(e,t,i){var n=e("./mouse_event").MouseEvent,s=e("../lib/event"),r=e("../lib/dom");t.addTouchListeners=function(e,t){var i,o,a,l,h,c,u,d,f,p="scroll",g=0,m=0,v=0,w=0;function y(){var e=window.navigator&&window.navigator.clipboard,i=!1,n=function(n){var s,o,a=n.target.getAttribute("action");if("more"==a||!i)return i=!i,s=t.getCopyText(),o=t.session.getUndoManager().hasUndo(),void f.replaceChild(r.buildDom(i?["span",!s&&["span",{class:"ace_mobile-button",action:"selectall"},"Select All"],s&&["span",{class:"ace_mobile-button",action:"copy"},"Copy"],s&&["span",{class:"ace_mobile-button",action:"cut"},"Cut"],e&&["span",{class:"ace_mobile-button",action:"paste"},"Paste"],o&&["span",{class:"ace_mobile-button",action:"undo"},"Undo"],["span",{class:"ace_mobile-button",action:"find"},"Find"],["span",{class:"ace_mobile-button",action:"openCommandPallete"},"Pallete"]]:["span"]),f.firstChild);"paste"==a?e.readText().then((function(e){t.execCommand(a,e)})):a&&("cut"!=a&&"copy"!=a||(e?e.writeText(t.getCopyText()):document.execCommand("copy")),t.execCommand(a)),f.firstChild.style.display="none",i=!1,"openCommandPallete"!=a&&t.focus()};f=r.buildDom(["div",{class:"ace_mobile-menu",ontouchstart:function(e){p="menu",e.stopPropagation(),e.preventDefault(),t.textInput.focus()},ontouchend:function(e){e.stopPropagation(),e.preventDefault(),n(e)},onclick:n},["span"],["span",{class:"ace_mobile-button",action:"more"},"..."]],t.container)}function b(){f||y();var e=t.selection.cursor,i=t.renderer.textToScreenCoordinates(e.row,e.column),n=t.renderer.textToScreenCoordinates(0,0).pageX,s=t.renderer.scrollLeft,r=t.container.getBoundingClientRect();f.style.top=i.pageY-r.top-3+"px",i.pageX-r.left<r.width-70?(f.style.left="",f.style.right="10px"):(f.style.right="",f.style.left=n+s-r.left+"px"),f.style.display="",f.firstChild.style.display="none",t.on("input",_)}function _(e){f&&(f.style.display="none"),t.off("input",_)}function C(){h=null,clearTimeout(h);var e=t.selection.getRange(),i=e.contains(u.row,u.column);!e.isEmpty()&&i||(t.selection.moveToPosition(u),t.selection.selectWord()),p="wait",b()}s.addListener(e,"contextmenu",(function(e){d&&t.textInput.getElement().focus()}),t),s.addListener(e,"touchstart",(function(e){var s=e.touches;if(h||s.length>1)return clearTimeout(h),h=null,a=-1,void(p="zoom");d=t.$mouseHandler.isMousePressed=!0;var r=t.renderer.layerConfig.lineHeight,c=t.renderer.layerConfig.lineHeight,f=e.timeStamp;l=f;var y=s[0],b=y.clientX,_=y.clientY;Math.abs(i-b)+Math.abs(o-_)>r&&(a=-1),i=e.clientX=b,o=e.clientY=_,v=w=0;var S=new n(e,t);if(u=S.getDocumentPosition(),f-a<500&&1==s.length&&!g)m++,e.preventDefault(),e.button=0,function(){h=null,clearTimeout(h),t.selection.moveToPosition(u);var e=m>=2?t.selection.getLineRange(u.row):t.session.getBracketRange(u);e&&!e.isEmpty()?t.selection.setRange(e):t.selection.selectWord(),p="wait"}();else{m=0;var x=t.selection.cursor,k=t.selection.isEmpty()?x:t.selection.anchor,A=t.renderer.$cursorLayer.getPixelPosition(x,!0),E=t.renderer.$cursorLayer.getPixelPosition(k,!0),T=t.renderer.scroller.getBoundingClientRect(),M=t.renderer.layerConfig.offset,L=t.renderer.scrollLeft,R=function(e,t){return(e/=c)*e+(t=t/r-.75)*t};if(e.clientX<T.left)return void(p="zoom");var $=R(e.clientX-T.left-A.left+L,e.clientY-T.top-A.top+M),I=R(e.clientX-T.left-E.left+L,e.clientY-T.top-E.top+M);$<3.5&&I<3.5&&(p=$>I?"cursor":"anchor"),p=I<3.5?"anchor":$<3.5?"cursor":"scroll",h=setTimeout(C,450)}a=f}),t),s.addListener(e,"touchend",(function(e){d=t.$mouseHandler.isMousePressed=!1,c&&clearInterval(c),"zoom"==p?(p="",g=0):h?(t.selection.moveToPosition(u),g=0,b()):"scroll"==p?(g+=60,c=setInterval((function(){g--<=0&&(clearInterval(c),c=null),Math.abs(v)<.01&&(v=0),Math.abs(w)<.01&&(w=0),g<20&&(v*=.9),g<20&&(w*=.9);var e=t.session.getScrollTop();t.renderer.scrollBy(10*v,10*w),e==t.session.getScrollTop()&&(g=0)}),10),_()):b(),clearTimeout(h),h=null}),t),s.addListener(e,"touchmove",(function(e){h&&(clearTimeout(h),h=null);var s=e.touches;if(!(s.length>1||"zoom"==p)){var r=s[0],a=i-r.clientX,c=o-r.clientY;if("wait"==p){if(!(a*a+c*c>4))return e.preventDefault();p="cursor"}i=r.clientX,o=r.clientY,e.clientX=r.clientX,e.clientY=r.clientY;var u=e.timeStamp,d=u-l;if(l=u,"scroll"==p){var f=new n(e,t);f.speed=1,f.wheelX=a,f.wheelY=c,10*Math.abs(a)<Math.abs(c)&&(a=0),10*Math.abs(c)<Math.abs(a)&&(c=0),0!=d&&(v=a/d,w=c/d),t._emit("mousewheel",f),f.propagationStopped||(v=w=0)}else{var g=new n(e,t).getDocumentPosition();"cursor"==p?t.selection.moveCursorToPosition(g):"anchor"==p&&t.selection.setSelectionAnchor(g.row,g.column),t.renderer.scrollCursorIntoView(g),e.preventDefault()}}}),t)}})),ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"],(function(e,t,i){var n=e("./dom");t.get=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&t(i.responseText)},i.send(null)},t.loadScript=function(e,t){var i=n.getDocumentHead(),s=document.createElement("script");s.src=e,i.appendChild(s),s.onload=s.onreadystatechange=function(e,i){!i&&s.readyState&&"loaded"!=s.readyState&&"complete"!=s.readyState||(s=s.onload=s.onreadystatechange=null,i||t())}},t.qualifyURL=function(e){var t=document.createElement("a");return t.href=e,t.href}})),ace.define("ace/lib/event_emitter",["require","exports","module"],(function(e,t,i){var n={},s=function(){this.propagationStopped=!0},r=function(){this.defaultPrevented=!0};n._emit=n._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var i=this._eventRegistry[e]||[],n=this._defaultHandlers[e];if(i.length||n){"object"==typeof t&&t||(t={}),t.type||(t.type=e),t.stopPropagation||(t.stopPropagation=s),t.preventDefault||(t.preventDefault=r),i=i.slice();for(var o=0;o<i.length&&(i[o](t,this),!t.propagationStopped);o++);return n&&!t.defaultPrevented?n(t,this):void 0}},n._signal=function(e,t){var i=(this._eventRegistry||{})[e];if(i){i=i.slice();for(var n=0;n<i.length;n++)i[n](t,this)}},n.once=function(e,t){var i=this;if(this.on(e,(function n(){i.off(e,n),t.apply(null,arguments)})),!t)return new Promise((function(e){t=e}))},n.setDefaultHandler=function(e,t){var i=this._defaultHandlers;if(i||(i=this._defaultHandlers={_disabled_:{}}),i[e]){var n=i[e],s=i._disabled_[e];s||(i._disabled_[e]=s=[]),s.push(n);var r=s.indexOf(t);-1!=r&&s.splice(r,1)}i[e]=t},n.removeDefaultHandler=function(e,t){var i=this._defaultHandlers;if(i){var n=i._disabled_[e];if(i[e]==t)n&&this.setDefaultHandler(e,n.pop());else if(n){var s=n.indexOf(t);-1!=s&&n.splice(s,1)}}},n.on=n.addEventListener=function(e,t,i){this._eventRegistry=this._eventRegistry||{};var n=this._eventRegistry[e];return n||(n=this._eventRegistry[e]=[]),-1==n.indexOf(t)&&n[i?"unshift":"push"](t),t},n.off=n.removeListener=n.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var i=this._eventRegistry[e];if(i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}},n.removeAllListeners=function(e){e||(this._eventRegistry=this._defaultHandlers=void 0),this._eventRegistry&&(this._eventRegistry[e]=void 0),this._defaultHandlers&&(this._defaultHandlers[e]=void 0)},t.EventEmitter=n})),ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],(function(e,t,i){var n=e("./oop"),s=e("./event_emitter").EventEmitter,r={setOptions:function(e){Object.keys(e).forEach((function(t){this.setOption(t,e[t])}),this)},getOptions:function(e){var t={};if(e)Array.isArray(e)||(t=e,e=Object.keys(t));else{var i=this.$options;e=Object.keys(i).filter((function(e){return!i[e].hidden}))}return e.forEach((function(e){t[e]=this.getOption(e)}),this),t},setOption:function(e,t){if(this["$"+e]!==t){var i=this.$options[e];if(!i)return o('misspelled option "'+e+'"');if(i.forwardTo)return this[i.forwardTo]&&this[i.forwardTo].setOption(e,t);i.handlesSet||(this["$"+e]=t),i&&i.set&&i.set.call(this,t)}},getOption:function(e){var t=this.$options[e];return t?t.forwardTo?this[t.forwardTo]&&this[t.forwardTo].getOption(e):t&&t.get?t.get.call(this):this["$"+e]:o('misspelled option "'+e+'"')}};function o(e){"undefined"!=typeof console&&console.warn&&console.warn.apply(console,arguments)}function a(e,t){var i=new Error(e);i.data=t,"object"==typeof console&&console.error&&console.error(i),setTimeout((function(){throw i}))}var l=function(){this.$defaultOptions={}};(function(){n.implement(this,s),this.defineOptions=function(e,t,i){return e.$options||(this.$defaultOptions[t]=e.$options={}),Object.keys(i).forEach((function(t){var n=i[t];"string"==typeof n&&(n={forwardTo:n}),n.name||(n.name=t),e.$options[n.name]=n,"initialValue"in n&&(e["$"+n.name]=n.initialValue)})),n.implement(e,r),this},this.resetOptions=function(e){Object.keys(e.$options).forEach((function(t){var i=e.$options[t];"value"in i&&e.setOption(t,i.value)}))},this.setDefaultValue=function(e,t,i){if(!e){for(e in this.$defaultOptions)if(this.$defaultOptions[e][t])break;if(!this.$defaultOptions[e][t])return!1}var n=this.$defaultOptions[e]||(this.$defaultOptions[e]={});n[t]&&(n.forwardTo?this.setDefaultValue(n.forwardTo,t,i):n[t].value=i)},this.setDefaultValues=function(e,t){Object.keys(t).forEach((function(i){this.setDefaultValue(e,i,t[i])}),this)},this.warn=o,this.reportError=a}).call(l.prototype),t.AppConfig=l})),ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/dom","ace/lib/app_config"],(function(e,t,i){var n=e("./lib/lang"),s=(e("./lib/oop"),e("./lib/net")),r=e("./lib/dom"),o=e("./lib/app_config").AppConfig;i.exports=t=new o;var a=function(){return this||"undefined"!=typeof window&&window}(),l={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1,useStrictCSP:null};t.get=function(e){if(!l.hasOwnProperty(e))throw new Error("Unknown config key: "+e);return l[e]},t.set=function(e,t){if(l.hasOwnProperty(e))l[e]=t;else if(0==this.setDefaultValue("",e,t))throw new Error("Unknown config key: "+e);"useStrictCSP"==e&&r.useStrictCSP(t)},t.all=function(){return n.copyObject(l)},t.$modes={},t.moduleUrl=function(e,t){if(l.$moduleUrls[e])return l.$moduleUrls[e];var i=e.split("/"),n="snippets"==(t=t||i[i.length-2]||"")?"/":"-",s=i[i.length-1];if("worker"==t&&"-"==n){var r=new RegExp("^"+t+"[\\-_]|[\\-_]"+t+"$","g");s=s.replace(r,"")}(!s||s==t)&&i.length>1&&(s=i[i.length-2]);var o=l[t+"Path"];return null==o?o=l.basePath:"/"==n&&(t=n=""),o&&"/"!=o.slice(-1)&&(o+="/"),o+t+n+s+this.get("suffix")},t.setModuleUrl=function(e,t){return l.$moduleUrls[e]=t},t.$loading={},t.loadModule=function(i,n){var r,o;Array.isArray(i)&&(o=i[0],i=i[1]);try{r=e(i)}catch(e){}if(r&&!t.$loading[i])return n&&n(r);if(t.$loading[i]||(t.$loading[i]=[]),t.$loading[i].push(n),!(t.$loading[i].length>1)){var a=function(){e([i],(function(e){t._emit("load.module",{name:i,module:e});var n=t.$loading[i];t.$loading[i]=null,n.forEach((function(t){t&&t(e)}))}))};if(!t.get("packaged"))return a();s.loadScript(t.moduleUrl(i,o),a),h()}};var h=function(){l.basePath||l.workerPath||l.modePath||l.themePath||Object.keys(l.$moduleUrls).length||(console.error("Unable to infer path to ace from script src,","use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes","or with webpack use ace/webpack-resolver"),h=function(){})};function c(n){if(a&&a.document){l.packaged=n||e.packaged||i.packaged||a.define&&define.packaged;for(var s,r={},o="",h=document.currentScript||document._currentScript,c=(h&&h.ownerDocument||document).getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u],f=d.src||d.getAttribute("src");if(f){for(var p=d.attributes,g=0,m=p.length;g<m;g++){var v=p[g];0===v.name.indexOf("data-ace-")&&(r[(s=v.name.replace(/^data-ace-/,""),s.replace(/-(.)/g,(function(e,t){return t.toUpperCase()})))]=v.value)}var w=f.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);w&&(o=w[1])}}for(var y in o&&(r.base=r.base||o,r.packaged=!0),r.basePath=r.base,r.workerPath=r.workerPath||r.base,r.modePath=r.modePath||r.base,r.themePath=r.themePath||r.base,delete r.base,r)void 0!==r[y]&&t.set(y,r[y])}}c(!0),t.init=c,t.version="1.6.0"})),ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/mouse/touch_handler","ace/config"],(function(e,t,i){var n=e("../lib/event"),s=e("../lib/useragent"),r=e("./default_handlers").DefaultHandlers,o=e("./default_gutter_handler").GutterHandler,a=e("./mouse_event").MouseEvent,l=e("./dragdrop_handler").DragdropHandler,h=e("./touch_handler").addTouchListeners,c=e("../config"),u=function(e){var t=this;this.editor=e,new r(this),new o(this),new l(this);var i=function(t){(!document.hasFocus||!document.hasFocus()||!e.isFocused()&&document.activeElement==(e.textInput&&e.textInput.getElement()))&&window.focus(),e.focus(),setTimeout((function(){e.isFocused()||e.focus()}))},a=e.renderer.getMouseEventTarget();n.addListener(a,"click",this.onMouseEvent.bind(this,"click"),e),n.addListener(a,"mousemove",this.onMouseMove.bind(this,"mousemove"),e),n.addMultiMouseDownListener([a,e.renderer.scrollBarV&&e.renderer.scrollBarV.inner,e.renderer.scrollBarH&&e.renderer.scrollBarH.inner,e.textInput&&e.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent",e),n.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,"mousewheel"),e),h(e.container,e);var c=e.renderer.$gutter;n.addListener(c,"mousedown",this.onMouseEvent.bind(this,"guttermousedown"),e),n.addListener(c,"click",this.onMouseEvent.bind(this,"gutterclick"),e),n.addListener(c,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"),e),n.addListener(c,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"),e),n.addListener(a,"mousedown",i,e),n.addListener(c,"mousedown",i,e),s.isIE&&e.renderer.scrollBarV&&(n.addListener(e.renderer.scrollBarV.element,"mousedown",i,e),n.addListener(e.renderer.scrollBarH.element,"mousedown",i,e)),e.on("mousemove",(function(i){if(!t.state&&!t.$dragDelay&&t.$dragEnabled){var n=e.renderer.screenToTextCoordinates(i.x,i.y),s=e.session.selection.getRange(),r=e.renderer;!s.isEmpty()&&s.insideStart(n.row,n.column)?r.setCursorStyle("default"):r.setCursorStyle("")}}),e)};(function(){this.onMouseEvent=function(e,t){this.editor.session&&this.editor._emit(e,new a(t,this.editor))},this.onMouseMove=function(e,t){var i=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;i&&i.length&&this.editor._emit(e,new a(t,this.editor))},this.onMouseWheel=function(e,t){var i=new a(t,this.editor);i.speed=2*this.$scrollSpeed,i.wheelX=t.wheelX,i.wheelY=t.wheelY,this.editor._emit(e,i)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;var i=this.editor,r=this.editor.renderer;r.$isMousePressed=!0;var o=this,l=function(e){if(e){if(s.isWebKit&&!e.which&&o.releaseMouse)return o.releaseMouse();o.x=e.clientX,o.y=e.clientY,t&&t(e),o.mouseEvent=new a(e,o.editor),o.$mouseMoved=!0}},h=function(e){i.off("beforeEndOperation",u),clearInterval(d),i.session&&c(),o[o.state+"End"]&&o[o.state+"End"](e),o.state="",o.isMousePressed=r.$isMousePressed=!1,r.$keepTextAreaAtCursor&&r.$moveTextAreaToCursor(),o.$onCaptureMouseMove=o.releaseMouse=null,e&&o.onMouseEvent("mouseup",e),i.endOperation()},c=function(){o[o.state]&&o[o.state](),o.$mouseMoved=!1};if(s.isOldIE&&"dblclick"==e.domEvent.type)return setTimeout((function(){h(e)}));var u=function(e){o.releaseMouse&&i.curOp.command.name&&i.curOp.selectionChanged&&(o[o.state+"End"]&&o[o.state+"End"](),o.state="",o.releaseMouse())};i.on("beforeEndOperation",u),i.startOperation({command:{name:"mouse"}}),o.$onCaptureMouseMove=l,o.releaseMouse=n.capture(this.editor.container,l,h);var d=setInterval(c,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var e=function(t){t&&t.domEvent&&"contextmenu"!=t.domEvent.type||(this.editor.off("nativecontextmenu",e),t&&t.domEvent&&n.stopEvent(t.domEvent))}.bind(this);setTimeout(e,10),this.editor.on("nativecontextmenu",e)},this.destroy=function(){this.releaseMouse&&this.releaseMouse()}}).call(u.prototype),c.defineOptions(u.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:s.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=u})),ace.define("ace/mouse/fold_handler",["require","exports","module","ace/lib/dom"],(function(e,t,i){var n=e("../lib/dom");t.FoldHandler=function(e){e.on("click",(function(t){var i=t.getDocumentPosition(),s=e.session,r=s.getFoldAt(i.row,i.column,1);r&&(t.getAccelKey()?s.removeFold(r):s.expandFold(r),t.stop());var o=t.domEvent&&t.domEvent.target;o&&n.hasCssClass(o,"ace_inline_button")&&n.hasCssClass(o,"ace_toggle_wrap")&&(s.setOption("wrap",!s.getUseWrapMode()),e.renderer.scrollCursorIntoView())})),e.on("gutterclick",(function(t){if("foldWidgets"==e.renderer.$gutterLayer.getRegion(t)){var i=t.getDocumentPosition().row,n=e.session;n.foldWidgets&&n.foldWidgets[i]&&e.session.onFoldWidgetClick(i,t),e.isFocused()||e.focus(),t.stop()}})),e.on("gutterdblclick",(function(t){if("foldWidgets"==e.renderer.$gutterLayer.getRegion(t)){var i=t.getDocumentPosition().row,n=e.session,s=n.getParentFoldRangeData(i,!0),r=s.range||s.firstRange;if(r){i=r.start.row;var o=n.getFoldAt(i,n.getLine(i).length,1);o?n.removeFold(o):(n.addFold("...",r),e.renderer.scrollCursorIntoView({row:r.start.row,column:0}))}t.stop()}}))}})),ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],(function(e,t,i){var n=e("../lib/keys"),s=e("../lib/event"),r=function(e){this.$editor=e,this.$data={editor:e},this.$handlers=[],this.setDefaultHandler(e.commands)};(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=e,this.addKeyboardHandler(e,0)},this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]!=e){for(;t[t.length-1]&&t[t.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)}},this.addKeyboardHandler=function(e,t){if(e){"function"!=typeof e||e.handleKeyboard||(e.handleKeyboard=e);var i=this.$handlers.indexOf(e);-1!=i&&this.$handlers.splice(i,1),null==t?this.$handlers.push(e):this.$handlers.splice(t,0,e),-1==i&&e.attach&&e.attach(this.$editor)}},this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);return-1!=t&&(this.$handlers.splice(t,1),e.detach&&e.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.getStatusText=function(){var e=this.$data,t=e.editor;return this.$handlers.map((function(i){return i.getStatusText&&i.getStatusText(t,e)||""})).filter(Boolean).join(" ")},this.$callKeyboardHandlers=function(e,t,i,n){for(var r,o=!1,a=this.$editor.commands,l=this.$handlers.length;l--&&!((r=this.$handlers[l].handleKeyboard(this.$data,e,t,i,n))&&r.command&&((o="null"==r.command||a.exec(r.command,this.$editor,r.args,n))&&n&&-1!=e&&1!=r.passEvent&&1!=r.command.passEvent&&s.stopEvent(n),o)););return o||-1!=e||(r={command:"insertstring"},o=a.exec("insertstring",this.$editor,t)),o&&this.$editor._signal&&this.$editor._signal("keyboardActivity",r),o},this.onCommandKey=function(e,t,i){var s=n.keyCodeToString(i);return this.$callKeyboardHandlers(t,s,i,e)},this.onTextInput=function(e){return this.$callKeyboardHandlers(-1,e)}}).call(r.prototype),t.KeyBinding=r})),ace.define("ace/lib/bidiutil",["require","exports","module"],(function(e,t,i){var n=0,s=0,r=!1,o=!1,a=!1,l=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],h=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],c=11,u=18,d=[u,u,u,u,u,u,u,u,u,6,5,6,8,5,u,u,u,u,u,u,u,u,u,u,u,u,u,u,5,5,5,6,8,4,4,c,c,c,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,u,u,u,u,u,u,5,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,9,4,c,c,c,c,4,4,4,4,0,4,4,u,4,4,c,c,2,2,4,0,4,4,4,2,0,4,4,4,4,4],f=[8,8,8,8,8,8,8,8,8,8,8,u,u,u,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,c,c,c,c,c,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8];function p(e,t,i){if(!(s<e))if(1!=e||1!=n||o)for(var r,a,l,h,c=i.length,u=0;u<c;){if(t[u]>=e){for(r=u+1;r<c&&t[r]>=e;)r++;for(a=u,l=r-1;a<l;a++,l--)h=i[a],i[a]=i[l],i[l]=h;u=r}u++}else i.reverse()}function g(e,t,i,s){var l,h,d,f,p=t[s];switch(p){case 0:case 1:r=!1;case 4:case 3:return p;case 2:return r?3:2;case 7:return r=!0,!0,1;case 8:return 4;case 9:return s<1||s+1>=t.length||2!=(l=i[s-1])&&3!=l||2!=(h=t[s+1])&&3!=h?4:(r&&(h=3),h==l?h:4);case 10:return 2==(l=s>0?i[s-1]:5)&&s+1<t.length&&2==t[s+1]?2:4;case c:if(s>0&&2==i[s-1])return 2;if(r)return 4;for(f=s+1,d=t.length;f<d&&t[f]==c;)f++;return f<d&&2==t[f]?2:4;case 12:for(d=t.length,f=s+1;f<d&&12==t[f];)f++;if(f<d){var g=e[s],m=g>=1425&&g<=2303||64286==g;if(l=t[f],m&&(1==l||7==l))return 1}return s<1||5==(l=t[s-1])?4:i[s-1];case 5:return r=!1,o=!0,n;case 6:return a=!0,4;case 13:case 14:case 16:case 17:case 15:r=!1;case u:return 4}}function m(e){var t=e.charCodeAt(0),i=t>>8;return 0==i?t>191?0:d[t]:5==i?/[\u0591-\u05f4]/.test(e)?1:0:6==i?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(e)?12:/[\u0660-\u0669\u066b-\u066c]/.test(e)?3:1642==t?c:/[\u06f0-\u06f9]/.test(e)?2:7:32==i&&t<=8287?f[255&t]:254==i&&t>=65136?7:4}t.L=0,t.R=1,t.EN=2,t.ON_R=3,t.AN=4,t.R_H=5,t.B=6,t.RLE=7,t.DOT="·",t.doBidiReorder=function(e,i,c){if(e.length<2)return{};var d=e.split(""),f=new Array(d.length),v=new Array(d.length),w=[];n=c?1:0,function(e,t,i,c){var u=n?h:l,d=null,f=null,p=null,v=0,w=null,y=-1,b=null,_=null,C=[];if(!c)for(b=0,c=[];b<i;b++)c[b]=m(e[b]);for(s=n,r=!1,!1,o=!1,a=!1,_=0;_<i;_++){if(d=v,C[_]=f=g(e,c,C,_),w=240&(v=u[d][f]),v&=15,t[_]=p=u[v][5],w>0)if(16==w){for(b=y;b<_;b++)t[b]=1;y=-1}else y=-1;if(u[v][6])-1==y&&(y=_);else if(y>-1){for(b=y;b<_;b++)t[b]=p;y=-1}5==c[_]&&(t[_]=0),s|=p}if(a)for(b=0;b<i;b++)if(6==c[b]){t[b]=n;for(var S=b-1;S>=0&&8==c[S];S--)t[S]=n}}(d,w,d.length,i);for(var y=0;y<f.length;f[y]=y,y++);p(2,w,f),p(1,w,f);for(y=0;y<f.length-1;y++)3===i[y]?w[y]=t.AN:1===w[y]&&(i[y]>7&&i[y]<13||4===i[y]||i[y]===u)?w[y]=t.ON_R:y>0&&"ل"===d[y-1]&&/\u0622|\u0623|\u0625|\u0627/.test(d[y])&&(w[y-1]=w[y]=t.R_H,y++);d[d.length-1]===t.DOT&&(w[d.length-1]=t.B),"‫"===d[0]&&(w[0]=t.RLE);for(y=0;y<f.length;y++)v[y]=w[f[y]];return{logicalFromVisual:f,bidiLevels:v}},t.hasBidiCharacters=function(e,t){for(var i=!1,n=0;n<e.length;n++)t[n]=m(e.charAt(n)),i||1!=t[n]&&7!=t[n]&&3!=t[n]||(i=!0);return i},t.getVisualFromLogicalIdx=function(e,t){for(var i=0;i<t.logicalFromVisual.length;i++)if(t.logicalFromVisual[i]==e)return i;return 0}})),ace.define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang"],(function(e,t,i){var n=e("./lib/bidiutil"),s=e("./lib/lang"),r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/,o=function(e){this.session=e,this.bidiMap={},this.currentRow=null,this.bidiUtil=n,this.charWidths=[],this.EOL="¬",this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line="",this.wrapIndent=0,this.EOF="¶",this.RLE="‫",this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=r.test(e.getValue())};(function(){this.isBidiRow=function(e,t,i){return!!this.seenBidi&&(e!==this.currentRow&&(this.currentRow=e,this.updateRowLine(t,i),this.updateBidiMap()),this.bidiMap.bidiLevels)},this.onChange=function(e){this.seenBidi?this.currentRow=null:"insert"==e.action&&r.test(e.lines.join("\n"))&&(this.seenBidi=!0,this.currentRow=null)},this.getDocumentRow=function(){var e=0,t=this.session.$screenRowCache;if(t.length){var i=this.session.$getRowCacheIndex(t,this.currentRow);i>=0&&(e=this.session.$docRowCache[i])}return e},this.getSplitIndex=function(){var e=0,t=this.session.$screenRowCache;if(t.length)for(var i,n=this.session.$getRowCacheIndex(t,this.currentRow);this.currentRow-e>0&&(i=this.session.$getRowCacheIndex(t,this.currentRow-e-1))===n;)n=i,e++;else e=this.currentRow;return e},this.updateRowLine=function(e,t){void 0===e&&(e=this.getDocumentRow());var i=e===this.session.getLength()-1?this.EOF:this.EOL;if(this.wrapIndent=0,this.line=this.session.getLine(e),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE,this.session.$useWrapMode){var r=this.session.$wrapData[e];r&&(void 0===t&&(t=this.getSplitIndex()),t>0&&r.length?(this.wrapIndent=r.indent,this.wrapOffset=this.wrapIndent*this.charWidths[n.L],this.line=t<r.length?this.line.substring(r[t-1],r[t]):this.line.substring(r[r.length-1])):this.line=this.line.substring(0,r[t])),t==r.length&&(this.line+=this.showInvisibles?i:n.DOT)}else this.line+=this.showInvisibles?i:n.DOT;var o,a=this.session,l=0;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,(function(e,t){return"\t"===e||a.isFullWidth(e.charCodeAt(0))?(o="\t"===e?a.getScreenTabSize(t+l):2,l+=o-1,s.stringRepeat(n.DOT,o)):e})),this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==n.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},this.updateBidiMap=function(){var e=[];n.hasBidiCharacters(this.line,e)||this.isRtlDir?this.bidiMap=n.doBidiReorder(this.line,e,this.isRtlDir):this.bidiMap={}},this.markAsDirty=function(){this.currentRow=null},this.updateCharacterWidths=function(e){if(this.characterWidth!==e.$characterSize.width){this.fontMetrics=e;var t=this.characterWidth=e.$characterSize.width,i=e.$measureCharWidth("ה");this.charWidths[n.L]=this.charWidths[n.EN]=this.charWidths[n.ON_R]=t,this.charWidths[n.R]=this.charWidths[n.AN]=i,this.charWidths[n.R_H]=.45*i,this.charWidths[n.B]=this.charWidths[n.RLE]=0,this.currentRow=null}},this.setShowInvisibles=function(e){this.showInvisibles=e,this.currentRow=null},this.setEolChar=function(e){this.EOL=e},this.setContentWidth=function(e){this.contentWidth=e},this.isRtlLine=function(e){return!!this.$isRtl||(null!=e?this.session.getLine(e).charAt(0)==this.RLE:this.isRtlDir)},this.setRtlDirection=function(e,t){for(var i=e.getCursorPosition(),n=e.selection.getSelectionAnchor().row;n<=i.row;n++)t||e.session.getLine(n).charAt(0)!==e.session.$bidiHandler.RLE?t&&e.session.getLine(n).charAt(0)!==e.session.$bidiHandler.RLE&&e.session.doc.insert({column:0,row:n},e.session.$bidiHandler.RLE):e.session.doc.removeInLine(n,0,1)},this.getPosLeft=function(e){e-=this.wrapIndent;var t=this.line.charAt(0)===this.RLE?1:0,i=e>t?this.session.getOverwrite()?e:e-1:t,s=n.getVisualFromLogicalIdx(i,this.bidiMap),r=this.bidiMap.bidiLevels,o=0;!this.session.getOverwrite()&&e<=t&&r[s]%2!=0&&s++;for(var a=0;a<s;a++)o+=this.charWidths[r[a]];return!this.session.getOverwrite()&&e>t&&r[s]%2==0&&(o+=this.charWidths[r[s]]),this.wrapIndent&&(o+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&&(o+=this.rtlLineOffset),o},this.getSelections=function(e,t){var i,n=this.bidiMap,s=n.bidiLevels,r=[],o=0,a=Math.min(e,t)-this.wrapIndent,l=Math.max(e,t)-this.wrapIndent,h=!1,c=!1,u=0;this.wrapIndent&&(o+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var d,f=0;f<s.length;f++)d=n.logicalFromVisual[f],i=s[f],(h=d>=a&&d<l)&&!c?u=o:!h&&c&&r.push({left:u,width:o-u}),o+=this.charWidths[i],c=h;if(h&&f===s.length&&r.push({left:u,width:o-u}),this.isRtlDir)for(var p=0;p<r.length;p++)r[p].left+=this.rtlLineOffset;return r},this.offsetToCol=function(e){this.isRtlDir&&(e-=this.rtlLineOffset);var t=0,i=(e=Math.max(e,0),0),n=0,s=this.bidiMap.bidiLevels,r=this.charWidths[s[n]];for(this.wrapIndent&&(e-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);e>i+r/2;){if(i+=r,n===s.length-1){r=0;break}r=this.charWidths[s[++n]]}return n>0&&s[n-1]%2!=0&&s[n]%2==0?(e<i&&n--,t=this.bidiMap.logicalFromVisual[n]):n>0&&s[n-1]%2==0&&s[n]%2!=0?t=1+(e>i?this.bidiMap.logicalFromVisual[n]:this.bidiMap.logicalFromVisual[n-1]):this.isRtlDir&&n===s.length-1&&0===r&&s[n-1]%2==0||!this.isRtlDir&&0===n&&s[n]%2!=0?t=1+this.bidiMap.logicalFromVisual[n]:(n>0&&s[n-1]%2!=0&&0!==r&&n--,t=this.bidiMap.logicalFromVisual[n]),0===t&&this.isRtlDir&&t++,t+this.wrapIndent}}).call(o.prototype),t.BidiHandler=o})),ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],(function(e,t,i){var n=e("./lib/oop"),s=e("./lib/lang"),r=e("./lib/event_emitter").EventEmitter,o=e("./range").Range,a=function(e){this.session=e,this.doc=e.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var t=this;this.cursor.on("change",(function(e){t.$cursorChanged=!0,t.$silent||t._emit("changeCursor"),t.$isEmpty||t.$silent||t._emit("changeSelection"),t.$keepDesiredColumnOnChange||e.old.column==e.value.column||(t.$desiredColumn=null)})),this.anchor.on("change",(function(){t.$anchorChanged=!0,t.$isEmpty||t.$silent||t._emit("changeSelection")}))};(function(){n.implement(this,r),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},this.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(e,t){this.$isEmpty=!1,this.anchor.setPosition(e,t)},this.getAnchor=this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.isBackwards=function(){var e=this.anchor,t=this.lead;return e.row>t.row||e.row==t.row&&e.column>t.column},this.getRange=function(){var e=this.anchor,t=this.lead;return this.$isEmpty?o.fromPoints(t,t):this.isBackwards()?o.fromPoints(t,e):o.fromPoints(e,t)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},this.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},this.setRange=this.setSelectionRange=function(e,t){var i=t?e.end:e.start,n=t?e.start:e.end;this.$setSelection(i.row,i.column,n.row,n.column)},this.$setSelection=function(e,t,i,n){if(!this.$silent){var s=this.$isEmpty,r=this.inMultiSelectMode;this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(e,t),this.cursor.setPosition(i,n),this.$isEmpty=!o.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&&this._emit("changeCursor"),(this.$cursorChanged||this.$anchorChanged||s!=this.$isEmpty||r)&&this._emit("changeSelection")}},this.$moveSelection=function(e){var t=this.lead;this.$isEmpty&&this.setSelectionAnchor(t.row,t.column),e.call(this)},this.selectTo=function(e,t){this.$moveSelection((function(){this.moveCursorTo(e,t)}))},this.selectToPosition=function(e){this.$moveSelection((function(){this.moveCursorToPosition(e)}))},this.moveTo=function(e,t){this.clearSelection(),this.moveCursorTo(e,t)},this.moveToPosition=function(e){this.clearSelection(),this.moveCursorToPosition(e)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(e,t){if(void 0===t){var i=e||this.lead;e=i.row,t=i.column}return this.session.getWordRange(e,t)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var e=this.getCursor(),t=this.session.getAWordRange(e.row,e.column);this.setSelectionRange(t)},this.getLineRange=function(e,t){var i,n="number"==typeof e?e:this.lead.row,s=this.session.getFoldLine(n);return s?(n=s.start.row,i=s.end.row):i=n,!0===t?new o(n,0,i,this.session.getLine(i).length):new o(n,0,i+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.wouldMoveIntoSoftTab=function(e,t,i){var n=e.column,s=e.column+t;return i<0&&(n=e.column-t,s=e.column),this.session.isTabStop(e)&&this.doc.getLine(e.row).slice(n,s).split(" ").length-1==t},this.moveCursorLeft=function(){var e,t=this.lead.getPosition();if(e=this.session.getFoldAt(t.row,t.column,-1))this.moveCursorTo(e.start.row,e.start.column);else if(0===t.column)t.row>0&&this.moveCursorTo(t.row-1,this.doc.getLine(t.row-1).length);else{var i=this.session.getTabSize();this.wouldMoveIntoSoftTab(t,i,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-i):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){var e,t=this.lead.getPosition();if(e=this.session.getFoldAt(t.row,t.column,1))this.moveCursorTo(e.end.row,e.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0);else{var i=this.session.getTabSize();t=this.lead;this.wouldMoveIntoSoftTab(t,i,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,i):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var e=this.lead.row,t=this.lead.column,i=this.session.documentToScreenRow(e,t),n=this.session.screenToDocumentPosition(i,0),s=this.session.getDisplayLine(e,null,n.row,n.column).match(/^\s*/);s[0].length==t||this.session.$useEmacsStyleLineStart||(n.column+=s[0].length),this.moveCursorToPosition(n)},this.moveCursorLineEnd=function(){var e=this.lead,t=this.session.getDocumentLastRowColumnPosition(e.row,e.column);if(this.lead.column==t.column){var i=this.session.getLine(t.row);if(t.column==i.length){var n=i.search(/\s+$/);n>0&&(t.column=n)}}this.moveCursorTo(t.row,t.column)},this.moveCursorFileEnd=function(){var e=this.doc.getLength()-1,t=this.doc.getLine(e).length;this.moveCursorTo(e,t)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var e=this.lead.row,t=this.lead.column,i=this.doc.getLine(e),n=i.substring(t);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var s=this.session.getFoldAt(e,t,1);if(s)this.moveCursorTo(s.end.row,s.end.column);else{if(this.session.nonTokenRe.exec(n)&&(t+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,n=i.substring(t)),t>=i.length)return this.moveCursorTo(e,i.length),this.moveCursorRight(),void(e<this.doc.getLength()-1&&this.moveCursorWordRight());this.session.tokenRe.exec(n)&&(t+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(e,t)}},this.moveCursorLongWordLeft=function(){var e,t=this.lead.row,i=this.lead.column;if(e=this.session.getFoldAt(t,i,-1))this.moveCursorTo(e.start.row,e.start.column);else{var n=this.session.getFoldStringAt(t,i,-1);null==n&&(n=this.doc.getLine(t).substring(0,i));var r=s.stringReverse(n);if(this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(r)&&(i-=this.session.nonTokenRe.lastIndex,r=r.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0),i<=0)return this.moveCursorTo(t,0),this.moveCursorLeft(),void(t>0&&this.moveCursorWordLeft());this.session.tokenRe.exec(r)&&(i-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(t,i)}},this.$shortWordEndIndex=function(e){var t,i=0,n=/\s/,s=this.session.tokenRe;if(s.lastIndex=0,this.session.tokenRe.exec(e))i=this.session.tokenRe.lastIndex;else{for(;(t=e[i])&&n.test(t);)i++;if(i<1)for(s.lastIndex=0;(t=e[i])&&!s.test(t);)if(s.lastIndex=0,i++,n.test(t)){if(i>2){i--;break}for(;(t=e[i])&&n.test(t);)i++;if(i>2)break}}return s.lastIndex=0,i},this.moveCursorShortWordRight=function(){var e=this.lead.row,t=this.lead.column,i=this.doc.getLine(e),n=i.substring(t),s=this.session.getFoldAt(e,t,1);if(s)return this.moveCursorTo(s.end.row,s.end.column);if(t==i.length){var r=this.doc.getLength();do{e++,n=this.doc.getLine(e)}while(e<r&&/^\s*$/.test(n));/^\s+/.test(n)||(n=""),t=0}var o=this.$shortWordEndIndex(n);this.moveCursorTo(e,t+o)},this.moveCursorShortWordLeft=function(){var e,t=this.lead.row,i=this.lead.column;if(e=this.session.getFoldAt(t,i,-1))return this.moveCursorTo(e.start.row,e.start.column);var n=this.session.getLine(t).substring(0,i);if(0===i){do{t--,n=this.doc.getLine(t)}while(t>0&&/^\s*$/.test(n));i=n.length,/\s+$/.test(n)||(n="")}var r=s.stringReverse(n),o=this.$shortWordEndIndex(r);return this.moveCursorTo(t,i-o)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(e,t){var i,n=this.session.documentToScreenPosition(this.lead.row,this.lead.column);if(0===t&&(0!==e&&(this.session.$bidiHandler.isBidiRow(n.row,this.lead.row)?(i=this.session.$bidiHandler.getPosLeft(n.column),n.column=Math.round(i/this.session.$bidiHandler.charWidths[0])):i=n.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?n.column=this.$desiredColumn:this.$desiredColumn=n.column),0!=e&&this.session.lineWidgets&&this.session.lineWidgets[this.lead.row]){var s=this.session.lineWidgets[this.lead.row];e<0?e-=s.rowsAbove||0:e>0&&(e+=s.rowCount-(s.rowsAbove||0))}var r=this.session.screenToDocumentPosition(n.row+e,n.column,i);0!==e&&0===t&&r.row===this.lead.row&&(r.column,this.lead.column),this.moveCursorTo(r.row,r.column+t,0===t)},this.moveCursorToPosition=function(e){this.moveCursorTo(e.row,e.column)},this.moveCursorTo=function(e,t,i){var n=this.session.getFoldAt(e,t,1);n&&(e=n.start.row,t=n.start.column),this.$keepDesiredColumnOnChange=!0;var s=this.session.getLine(e);/[\uDC00-\uDFFF]/.test(s.charAt(t))&&s.charAt(t-1)&&(this.lead.row==e&&this.lead.column==t+1?t-=1:t+=1),this.lead.setPosition(e,t),this.$keepDesiredColumnOnChange=!1,i||(this.$desiredColumn=null)},this.moveCursorToScreen=function(e,t,i){var n=this.session.screenToDocumentPosition(e,t);this.moveCursorTo(n.row,n.column,i)},this.detach=function(){this.lead.detach(),this.anchor.detach()},this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start),this.$desiredColumn=e.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(e){var t=this.getRange();return e?(e.start.column=t.start.column,e.start.row=t.start.row,e.end.column=t.end.column,e.end.row=t.end.row):e=t,e.cursor=this.isBackwards()?e.start:e.end,e.desiredColumn=this.$desiredColumn,e},this.getRangeOfMovements=function(e){var t=this.getCursor();try{e(this);var i=this.getCursor();return o.fromPoints(t,i)}catch(e){return o.fromPoints(t,t)}finally{this.moveCursorToPosition(t)}},this.toJSON=function(){if(this.rangeCount)var e=this.ranges.map((function(e){var t=e.clone();return t.isBackwards=e.cursor==e.start,t}));else(e=this.getRange()).isBackwards=this.isBackwards();return e},this.fromJSON=function(e){if(null==e.start){if(this.rangeList&&e.length>1){this.toSingleRange(e[0]);for(var t=e.length;t--;){var i=o.fromPoints(e[t].start,e[t].end);e[t].isBackwards&&(i.cursor=i.start),this.addRange(i,!0)}return}e=e[0]}this.rangeList&&this.toSingleRange(e),this.setSelectionRange(e,e.isBackwards)},this.isEqual=function(e){if((e.length||this.rangeCount)&&e.length!=this.rangeCount)return!1;if(!e.length||!this.ranges)return this.getRange().isEqual(e);for(var t=this.ranges.length;t--;)if(!this.ranges[t].isEqual(e[t]))return!1;return!0}}).call(a.prototype),t.Selection=a})),ace.define("ace/tokenizer",["require","exports","module","ace/config"],(function(e,t,i){var n=e("./config"),s=2e3,r=function(e){for(var t in this.states=e,this.regExps={},this.matchMappings={},this.states){for(var i=this.states[t],n=[],s=0,r=this.matchMappings[t]={defaultToken:"text"},o="g",a=[],l=0;l<i.length;l++){var h=i[l];if(h.defaultToken&&(r.defaultToken=h.defaultToken),h.caseInsensitive&&-1===o.indexOf("i")&&(o+="i"),h.unicode&&-1===o.indexOf("u")&&(o+="u"),null!=h.regex){h.regex instanceof RegExp&&(h.regex=h.regex.toString().slice(1,-1));var c=h.regex,u=new RegExp("(?:("+c+")|(.))").exec("a").length-2;Array.isArray(h.token)?1==h.token.length||1==u?h.token=h.token[0]:u-1!=h.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:h,groupCount:u-1}),h.token=h.token[0]):(h.tokenArray=h.token,h.token=null,h.onMatch=this.$arrayTokens):"function"!=typeof h.token||h.onMatch||(h.onMatch=u>1?this.$applyToken:h.token),u>1&&(/\\\d/.test(h.regex)?c=h.regex.replace(/\\([0-9]+)/g,(function(e,t){return"\\"+(parseInt(t,10)+s+1)})):(u=1,c=this.removeCapturingGroups(h.regex)),h.splitRegex||"string"==typeof h.token||a.push(h)),r[s]=l,s+=u,n.push(c),h.onMatch||(h.onMatch=null)}}n.length||(r[0]=0,n.push("$")),a.forEach((function(e){e.splitRegex=this.createSplitterRegexp(e.regex,o)}),this),this.regExps[t]=new RegExp("("+n.join(")|(")+")|($)",o)}};(function(){this.$setMaxTokenCount=function(e){s=0|e},this.$applyToken=function(e){var t=this.splitRegex.exec(e).slice(1),i=this.token.apply(this,t);if("string"==typeof i)return[{type:i,value:e}];for(var n=[],s=0,r=i.length;s<r;s++)t[s]&&(n[n.length]={type:i[s],value:t[s]});return n},this.$arrayTokens=function(e){if(!e)return[];var t=this.splitRegex.exec(e);if(!t)return"text";for(var i=[],n=this.tokenArray,s=0,r=n.length;s<r;s++)t[s+1]&&(i[i.length]={type:n[s],value:t[s+1]});return i},this.removeCapturingGroups=function(e){return e.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!<]|(\()/g,(function(e,t){return t?"(?:":e}))},this.createSplitterRegexp=function(e,t){if(-1!=e.indexOf("(?=")){var i=0,n=!1,s={};e.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,(function(e,t,r,o,a,l){return n?n="]"!=a:a?n=!0:o?(i==s.stack&&(s.end=l+1,s.stack=-1),i--):r&&(i++,1!=r.length&&(s.stack=i,s.start=l)),e})),null!=s.end&&/^\)*$/.test(e.substr(s.end))&&(e=e.substring(0,s.start)+e.substr(s.end))}return"^"!=e.charAt(0)&&(e="^"+e),"$"!=e.charAt(e.length-1)&&(e+="$"),new RegExp(e,(t||"").replace("g",""))},this.getLineTokens=function(e,t){if(t&&"string"!=typeof t){var i=t.slice(0);"#tmp"===(t=i[0])&&(i.shift(),t=i.shift())}else i=[];var n=t||"start",r=this.states[n];r||(n="start",r=this.states[n]);var o=this.matchMappings[n],a=this.regExps[n];a.lastIndex=0;for(var l,h=[],c=0,u=0,d={type:null,value:""};l=a.exec(e);){var f=o.defaultToken,p=null,g=l[0],m=a.lastIndex;if(m-g.length>c){var v=e.substring(c,m-g.length);d.type==f?d.value+=v:(d.type&&h.push(d),d={type:f,value:v})}for(var w=0;w<l.length-2;w++)if(void 0!==l[w+1]){f=(p=r[o[w]]).onMatch?p.onMatch(g,n,i,e):p.token,p.next&&(n="string"==typeof p.next?p.next:p.next(n,i),(r=this.states[n])||(this.reportError("state doesn't exist",n),n="start",r=this.states[n]),o=this.matchMappings[n],c=m,(a=this.regExps[n]).lastIndex=m),p.consumeLineEnd&&(c=m);break}if(g)if("string"==typeof f)p&&!1===p.merge||d.type!==f?(d.type&&h.push(d),d={type:f,value:g}):d.value+=g;else if(f){d.type&&h.push(d),d={type:null,value:""};for(w=0;w<f.length;w++)h.push(f[w])}if(c==e.length)break;if(c=m,u++>s){for(u>2*e.length&&this.reportError("infinite loop with in ace tokenizer",{startState:t,line:e});c<e.length;)d.type&&h.push(d),d={value:e.substring(c,c+=500),type:"overflow"};n="start",i=[];break}}return d.type&&h.push(d),i.length>1&&i[0]!==n&&i.unshift("#tmp",n),{tokens:h,state:i.length?i:n}},this.reportError=n.reportError}).call(r.prototype),t.Tokenizer=r})),ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],(function(e,t,i){var n=e("../lib/lang"),s=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(e,t){if(t)for(var i in e){for(var n=e[i],s=0;s<n.length;s++){var r=n[s];(r.next||r.onMatch)&&("string"==typeof r.next&&0!==r.next.indexOf(t)&&(r.next=t+r.next),r.nextState&&0!==r.nextState.indexOf(t)&&(r.nextState=t+r.nextState))}this.$rules[t+i]=n}else for(var i in e)this.$rules[i]=e[i]},this.getRules=function(){return this.$rules},this.embedRules=function(e,t,i,s,r){var o="function"==typeof e?(new e).getRules():e;if(s)for(var a=0;a<s.length;a++)s[a]=t+s[a];else for(var l in s=[],o)s.push(t+l);if(this.addRules(o,t),i){var h=Array.prototype[r?"push":"unshift"];for(a=0;a<s.length;a++)h.apply(this.$rules[s[a]],n.deepCopy(i))}this.$embeds||(this.$embeds=[]),this.$embeds.push(t)},this.getEmbeds=function(){return this.$embeds};var e=function(e,t){return("start"!=e||t.length)&&t.unshift(this.nextState,e),this.nextState},t=function(e,t){return t.shift(),t.shift()||"start"};this.normalizeRules=function(){var i=0,n=this.$rules;Object.keys(n).forEach((function s(r){var o=n[r];o.processed=!0;for(var a=0;a<o.length;a++){var l=o[a],h=null;Array.isArray(l)&&(h=l,l={}),!l.regex&&l.start&&(l.regex=l.start,l.next||(l.next=[]),l.next.push({defaultToken:l.token},{token:l.token+".end",regex:l.end||l.start,next:"pop"}),l.token=l.token+".start",l.push=!0);var c=l.next||l.push;if(c&&Array.isArray(c)){var u=l.stateName;u||("string"!=typeof(u=l.token)&&(u=u[0]||""),n[u]&&(u+=i++)),n[u]=c,l.next=u,s(u)}else"pop"==c&&(l.next=t);if(l.push&&(l.nextState=l.next||l.push,l.next=e,delete l.push),l.rules)for(var d in l.rules)n[d]?n[d].push&&n[d].push.apply(n[d],l.rules[d]):n[d]=l.rules[d];var f="string"==typeof l?l:l.include;if(f&&(h=Array.isArray(f)?f.map((function(e){return n[e]})):n[f]),h){var p=[a,1].concat(h);l.noEscape&&(p=p.filter((function(e){return!e.next}))),o.splice.apply(o,p),a--}l.keywordMap&&(l.token=this.createKeywordMapper(l.keywordMap,l.defaultToken||"text",l.caseInsensitive),delete l.defaultToken)}}),this)},this.createKeywordMapper=function(e,t,i,n){var s=Object.create(null);return this.$keywordList=[],Object.keys(e).forEach((function(t){for(var r=e[t].split(n||"|"),o=r.length;o--;){var a=r[o];this.$keywordList.push(a),i&&(a=a.toLowerCase()),s[a]=t}}),this),e=null,i?function(e){return s[e.toLowerCase()]||t}:function(e){return s[e]||t}},this.getKeywords=function(){return this.$keywords}}).call(s.prototype),t.TextHighlightRules=s})),ace.define("ace/mode/behaviour",["require","exports","module"],(function(e,t,i){var n=function(){this.$behaviours={}};(function(){this.add=function(e,t,i){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][t]=i},this.addBehaviours=function(e){for(var t in e)for(var i in e[t])this.add(t,i,e[t][i])},this.remove=function(e){this.$behaviours&&this.$behaviours[e]&&delete this.$behaviours[e]},this.inherit=function(e,t){if("function"==typeof e)var i=(new e).getBehaviours(t);else i=e.getBehaviours(t);this.addBehaviours(i)},this.getBehaviours=function(e){if(e){for(var t={},i=0;i<e.length;i++)this.$behaviours[e[i]]&&(t[e[i]]=this.$behaviours[e[i]]);return t}return this.$behaviours}}).call(n.prototype),t.Behaviour=n})),ace.define("ace/token_iterator",["require","exports","module","ace/range"],(function(e,t,i){var n=e("./range").Range,s=function(e,t,i){this.$session=e,this.$row=t,this.$rowTokens=e.getTokens(t);var n=e.getTokenAt(t,i);this.$tokenIndex=n?n.index:-1};(function(){this.stepBackward=function(){for(this.$tokenIndex-=1;this.$tokenIndex<0;){if(this.$row-=1,this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){var e;for(this.$tokenIndex+=1;this.$tokenIndex>=this.$rowTokens.length;){if(this.$row+=1,e||(e=this.$session.getLength()),this.$row>=e)return this.$row=e-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var e=this.$rowTokens,t=this.$tokenIndex,i=e[t].start;if(void 0!==i)return i;for(i=0;t>0;)i+=e[t-=1].value.length;return i},this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},this.getCurrentTokenRange=function(){var e=this.$rowTokens[this.$tokenIndex],t=this.getCurrentTokenColumn();return new n(this.$row,t,this.$row,t+e.value.length)}}).call(s.prototype),t.TokenIterator=s})),ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],(function(e,t,i){var n,s=e("../../lib/oop"),r=e("../behaviour").Behaviour,o=e("../../token_iterator").TokenIterator,a=e("../../lib/lang"),l=["text","paren.rparen","rparen","paren","punctuation.operator"],h=["text","paren.rparen","rparen","paren","punctuation.operator","comment"],c={},u={'"':'"',"'":"'"},d=function(e){var t=-1;if(e.multiSelect&&(t=e.selection.index,c.rangeCount!=e.multiSelect.rangeCount&&(c={rangeCount:e.multiSelect.rangeCount})),c[t])return n=c[t];n=c[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},f=function(e,t,i,n){var s=e.end.row-e.start.row;return{text:i+t+n,selection:[0,e.start.column+1,s,e.end.column+(s?0:1)]}},p=function(e){this.add("braces","insertion",(function(t,i,s,r,o){var l=s.getCursorPosition(),h=r.doc.getLine(l.row);if("{"==o){d(s);var c=s.getSelectionRange(),u=r.doc.getTextRange(c);if(""!==u&&"{"!==u&&s.getWrapBehavioursEnabled())return f(c,u,"{","}");if(p.isSaneInsertion(s,r))return/[\]\}\)]/.test(h[l.column])||s.inMultiSelectMode||e&&e.braces?(p.recordAutoInsert(s,r,"}"),{text:"{}",selection:[1,1]}):(p.recordMaybeInsert(s,r,"{"),{text:"{",selection:[1,1]})}else if("}"==o){if(d(s),"}"==h.substring(l.column,l.column+1))if(null!==r.$findOpeningBracket("}",{column:l.column+1,row:l.row})&&p.isAutoInsertedClosing(l,h,o))return p.popAutoInsertedClosing(),{text:"",selection:[1,1]}}else{if("\n"==o||"\r\n"==o){d(s);var g="";if(p.isMaybeInsertedClosing(l,h)&&(g=a.stringRepeat("}",n.maybeInsertedBrackets),p.clearMaybeInsertedClosing()),"}"===h.substring(l.column,l.column+1)){var m=r.findMatchingBracket({row:l.row,column:l.column+1},"}");if(!m)return null;var v=this.$getIndent(r.getLine(m.row))}else{if(!g)return void p.clearMaybeInsertedClosing();v=this.$getIndent(h)}var w=v+r.getTabString();return{text:"\n"+w+"\n"+v+g,selection:[1,w.length,1,w.length]}}p.clearMaybeInsertedClosing()}})),this.add("braces","deletion",(function(e,t,i,s,r){var o=s.doc.getTextRange(r);if(!r.isMultiLine()&&"{"==o){if(d(i),"}"==s.doc.getLine(r.start.row).substring(r.end.column,r.end.column+1))return r.end.column++,r;n.maybeInsertedBrackets--}})),this.add("parens","insertion",(function(e,t,i,n,s){if("("==s){d(i);var r=i.getSelectionRange(),o=n.doc.getTextRange(r);if(""!==o&&i.getWrapBehavioursEnabled())return f(r,o,"(",")");if(p.isSaneInsertion(i,n))return p.recordAutoInsert(i,n,")"),{text:"()",selection:[1,1]}}else if(")"==s){d(i);var a=i.getCursorPosition(),l=n.doc.getLine(a.row);if(")"==l.substring(a.column,a.column+1))if(null!==n.$findOpeningBracket(")",{column:a.column+1,row:a.row})&&p.isAutoInsertedClosing(a,l,s))return p.popAutoInsertedClosing(),{text:"",selection:[1,1]}}})),this.add("parens","deletion",(function(e,t,i,n,s){var r=n.doc.getTextRange(s);if(!s.isMultiLine()&&"("==r&&(d(i),")"==n.doc.getLine(s.start.row).substring(s.start.column+1,s.start.column+2)))return s.end.column++,s})),this.add("brackets","insertion",(function(e,t,i,n,s){if("["==s){d(i);var r=i.getSelectionRange(),o=n.doc.getTextRange(r);if(""!==o&&i.getWrapBehavioursEnabled())return f(r,o,"[","]");if(p.isSaneInsertion(i,n))return p.recordAutoInsert(i,n,"]"),{text:"[]",selection:[1,1]}}else if("]"==s){d(i);var a=i.getCursorPosition(),l=n.doc.getLine(a.row);if("]"==l.substring(a.column,a.column+1))if(null!==n.$findOpeningBracket("]",{column:a.column+1,row:a.row})&&p.isAutoInsertedClosing(a,l,s))return p.popAutoInsertedClosing(),{text:"",selection:[1,1]}}})),this.add("brackets","deletion",(function(e,t,i,n,s){var r=n.doc.getTextRange(s);if(!s.isMultiLine()&&"["==r&&(d(i),"]"==n.doc.getLine(s.start.row).substring(s.start.column+1,s.start.column+2)))return s.end.column++,s})),this.add("string_dquotes","insertion",(function(e,t,i,n,s){var r=n.$mode.$quotes||u;if(1==s.length&&r[s]){if(this.lineCommentStart&&-1!=this.lineCommentStart.indexOf(s))return;d(i);var o=s,a=i.getSelectionRange(),l=n.doc.getTextRange(a);if(!(""===l||1==l.length&&r[l])&&i.getWrapBehavioursEnabled())return f(a,l,o,o);if(!l){var h=i.getCursorPosition(),c=n.doc.getLine(h.row),p=c.substring(h.column-1,h.column),g=c.substring(h.column,h.column+1),m=n.getTokenAt(h.row,h.column),v=n.getTokenAt(h.row,h.column+1);if("\\"==p&&m&&/escape/.test(m.type))return null;var w,y=m&&/string|escape/.test(m.type),b=!v||/string|escape/.test(v.type);if(g==o)(w=y!==b)&&/string\.end/.test(v.type)&&(w=!1);else{if(y&&!b)return null;if(y&&b)return null;var _=n.$mode.tokenRe;_.lastIndex=0;var C=_.test(p);_.lastIndex=0;var S=_.test(p);if(C||S)return null;if(g&&!/[\s;,.})\]\\]/.test(g))return null;var x=c[h.column-2];if(p==o&&(x==o||_.test(x)))return null;w=!0}return{text:w?o+o:"",selection:[1,1]}}}})),this.add("string_dquotes","deletion",(function(e,t,i,n,s){var r=n.$mode.$quotes||u,o=n.doc.getTextRange(s);if(!s.isMultiLine()&&r.hasOwnProperty(o)&&(d(i),n.doc.getLine(s.start.row).substring(s.start.column+1,s.start.column+2)==o))return s.end.column++,s}))};p.isSaneInsertion=function(e,t){var i=e.getCursorPosition(),n=new o(t,i.row,i.column);if(!this.$matchTokenType(n.getCurrentToken()||"text",l)){if(/[)}\]]/.test(e.session.getLine(i.row)[i.column]))return!0;var s=new o(t,i.row,i.column+1);if(!this.$matchTokenType(s.getCurrentToken()||"text",l))return!1}return n.stepForward(),n.getCurrentTokenRow()!==i.row||this.$matchTokenType(n.getCurrentToken()||"text",h)},p.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},p.recordAutoInsert=function(e,t,i){var s=e.getCursorPosition(),r=t.doc.getLine(s.row);this.isAutoInsertedClosing(s,r,n.autoInsertedLineEnd[0])||(n.autoInsertedBrackets=0),n.autoInsertedRow=s.row,n.autoInsertedLineEnd=i+r.substr(s.column),n.autoInsertedBrackets++},p.recordMaybeInsert=function(e,t,i){var s=e.getCursorPosition(),r=t.doc.getLine(s.row);this.isMaybeInsertedClosing(s,r)||(n.maybeInsertedBrackets=0),n.maybeInsertedRow=s.row,n.maybeInsertedLineStart=r.substr(0,s.column)+i,n.maybeInsertedLineEnd=r.substr(s.column),n.maybeInsertedBrackets++},p.isAutoInsertedClosing=function(e,t,i){return n.autoInsertedBrackets>0&&e.row===n.autoInsertedRow&&i===n.autoInsertedLineEnd[0]&&t.substr(e.column)===n.autoInsertedLineEnd},p.isMaybeInsertedClosing=function(e,t){return n.maybeInsertedBrackets>0&&e.row===n.maybeInsertedRow&&t.substr(e.column)===n.maybeInsertedLineEnd&&t.substr(0,e.column)==n.maybeInsertedLineStart},p.popAutoInsertedClosing=function(){n.autoInsertedLineEnd=n.autoInsertedLineEnd.substr(1),n.autoInsertedBrackets--},p.clearMaybeInsertedClosing=function(){n&&(n.maybeInsertedBrackets=0,n.maybeInsertedRow=-1)},s.inherits(p,r),t.CstyleBehaviour=p})),ace.define("ace/unicode",["require","exports","module"],(function(e,t,i){for(var n=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],s=0,r=[],o=0;o<n.length;o+=2)r.push(s+=n[o]),n[o+1]&&r.push(45,s+=n[o+1]);t.wordChars=String.fromCharCode.apply(null,r)})),ace.define("ace/mode/text",["require","exports","module","ace/config","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],(function(e,t,i){var n=e("../config"),s=e("../tokenizer").Tokenizer,r=e("./text_highlight_rules").TextHighlightRules,o=e("./behaviour/cstyle").CstyleBehaviour,a=e("../unicode"),l=e("../lib/lang"),h=e("../token_iterator").TokenIterator,c=e("../range").Range,u=function(){this.HighlightRules=r};(function(){this.$defaultBehaviour=new o,this.tokenRe=new RegExp("^["+a.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+a.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new s(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(e,t,i,n){var s=t.doc,r=!0,o=!0,a=1/0,h=t.getTabSize(),c=!1;if(this.lineCommentStart){if(Array.isArray(this.lineCommentStart))g=this.lineCommentStart.map(l.escapeRegExp).join("|"),f=this.lineCommentStart[0];else g=l.escapeRegExp(this.lineCommentStart),f=this.lineCommentStart;g=new RegExp("^(\\s*)(?:"+g+") ?"),c=t.getUseSoftTabs();w=function(e,t){var i=e.match(g);if(i){var n=i[1].length,r=i[0].length;d(e,n,r)||" "!=i[0][r-1]||r--,s.removeInLine(t,n,r)}};var u=f+" ",d=(v=function(e,t){r&&!/\S/.test(e)||(d(e,a,a)?s.insertInLine({row:t,column:a},u):s.insertInLine({row:t,column:a},f))},y=function(e,t){return g.test(e)},function(e,t,i){for(var n=0;t--&&" "==e.charAt(t);)n++;if(n%h!=0)return!1;for(n=0;" "==e.charAt(i++);)n++;return h>2?n%h!=h-1:n%h==0})}else{if(!this.blockComment)return!1;var f=this.blockComment.start,p=this.blockComment.end,g=new RegExp("^(\\s*)(?:"+l.escapeRegExp(f)+")"),m=new RegExp("(?:"+l.escapeRegExp(p)+")\\s*$"),v=function(e,t){y(e,t)||r&&!/\S/.test(e)||(s.insertInLine({row:t,column:e.length},p),s.insertInLine({row:t,column:a},f))},w=function(e,t){var i;(i=e.match(m))&&s.removeInLine(t,e.length-i[0].length,e.length),(i=e.match(g))&&s.removeInLine(t,i[1].length,i[0].length)},y=function(e,i){if(g.test(e))return!0;for(var n=t.getTokens(i),s=0;s<n.length;s++)if("comment"===n[s].type)return!0}}function b(e){for(var t=i;t<=n;t++)e(s.getLine(t),t)}var _=1/0;b((function(e,t){var i=e.search(/\S/);-1!==i?(i<a&&(a=i),o&&!y(e,t)&&(o=!1)):_>e.length&&(_=e.length)})),a==1/0&&(a=_,r=!1,o=!1),c&&a%h!=0&&(a=Math.floor(a/h)*h),b(o?w:v)},this.toggleBlockComment=function(e,t,i,n){var s=this.blockComment;if(s){!s.start&&s[0]&&(s=s[0]);var r,o,a=(g=new h(t,n.row,n.column)).getCurrentToken(),l=(t.selection,t.selection.toOrientedRange());if(a&&/comment/.test(a.type)){for(var u,d;a&&/comment/.test(a.type);){if(-1!=(m=a.value.indexOf(s.start))){var f=g.getCurrentTokenRow(),p=g.getCurrentTokenColumn()+m;u=new c(f,p,f,p+s.start.length);break}a=g.stepBackward()}var g;for(a=(g=new h(t,n.row,n.column)).getCurrentToken();a&&/comment/.test(a.type);){var m;if(-1!=(m=a.value.indexOf(s.end))){f=g.getCurrentTokenRow(),p=g.getCurrentTokenColumn()+m;d=new c(f,p,f,p+s.end.length);break}a=g.stepForward()}d&&t.remove(d),u&&(t.remove(u),r=u.start.row,o=-s.start.length)}else o=s.start.length,r=i.start.row,t.insert(i.end,s.end),t.insert(i.start,s.start);l.start.row==r&&(l.start.column+=o),l.end.row==r&&(l.end.column+=o),t.selection.fromOrientedRange(l)}},this.getNextLineIndent=function(e,t,i){return this.$getIndent(t)},this.checkOutdent=function(e,t,i){return!1},this.autoOutdent=function(e,t,i){},this.$getIndent=function(e){return e.match(/^\s*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){for(var t in this.$embeds=[],this.$modes={},e)if(e[t]){var i=e[t],s=i.prototype.$id,r=n.$modes[s];r||(n.$modes[s]=r=new i),n.$modes[t]||(n.$modes[t]=r),this.$embeds.push(t),this.$modes[t]=r}var o=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"];for(t=0;t<o.length;t++)!function(e){var i=o[t],n=e[i];e[o[t]]=function(){return this.$delegator(i,arguments,n)}}(this)},this.$delegator=function(e,t,i){var n=t[0]||"start";if("string"!=typeof n){if(Array.isArray(n[2])){var s=n[2][n[2].length-1];if(o=this.$modes[s])return o[e].apply(o,[n[1]].concat([].slice.call(t,1)))}n=n[0]||"start"}for(var r=0;r<this.$embeds.length;r++)if(this.$modes[this.$embeds[r]]){var o,a=n.split(this.$embeds[r]);if(!a[0]&&a[1])return t[0]=a[1],(o=this.$modes[this.$embeds[r]])[e].apply(o,t)}var l=i.apply(this,t);return i?l:void 0},this.transformAction=function(e,t,i,n,s){if(this.$behaviour){var r=this.$behaviour.getBehaviours();for(var o in r)if(r[o][t]){var a=r[o][t].apply(this,arguments);if(a)return a}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,i=[];for(var n in t)for(var s=t[n],r=0,o=s.length;r<o;r++)if("string"==typeof s[r].token)/keyword|support|storage/.test(s[r].token)&&i.push(s[r].regex);else if("object"==typeof s[r].token)for(var a=0,l=s[r].token.length;a<l;a++)if(/keyword|support|storage/.test(s[r].token[a])){n=s[r].regex.match(/\(.+?\)/g)[a];i.push(n.substr(1,n.length-2))}this.completionKeywords=i}return e?i.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,i,n){return(this.$keywordList||this.$createKeywordList()).map((function(e){return{name:e,value:e,score:0,meta:"keyword"}}))},this.$id="ace/mode/text"}).call(u.prototype),t.Mode=u})),ace.define("ace/apply_delta",["require","exports","module"],(function(e,t,i){t.applyDelta=function(e,t,i){var n=t.start.row,s=t.start.column,r=e[n]||"";switch(t.action){case"insert":if(1===t.lines.length)e[n]=r.substring(0,s)+t.lines[0]+r.substring(s);else{var o=[n,1].concat(t.lines);e.splice.apply(e,o),e[n]=r.substring(0,s)+e[n],e[n+t.lines.length-1]+=r.substring(s)}break;case"remove":var a=t.end.column,l=t.end.row;n===l?e[n]=r.substring(0,s)+r.substring(a):e.splice(n,l-n+1,r.substring(0,s)+e[l].substring(a))}}})),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],(function(e,t,i){var n=e("./lib/oop"),s=e("./lib/event_emitter").EventEmitter,r=t.Anchor=function(e,t,i){this.$onChange=this.onChange.bind(this),this.attach(e),void 0===i?this.setPosition(t.row,t.column):this.setPosition(t,i)};(function(){function e(e,t,i){var n=i?e.column<=t.column:e.column<t.column;return e.row<t.row||e.row==t.row&&n}n.implement(this,s),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(t){if(!(t.start.row==t.end.row&&t.start.row!=this.row||t.start.row>this.row)){var i=function(t,i,n){var s="insert"==t.action,r=(s?1:-1)*(t.end.row-t.start.row),o=(s?1:-1)*(t.end.column-t.start.column),a=t.start,l=s?a:t.end;return e(i,a,n)?{row:i.row,column:i.column}:e(l,i,!n)?{row:i.row+r,column:i.column+(i.row==l.row?o:0)}:{row:a.row,column:a.column}}(t,{row:this.row,column:this.column},this.$insertRight);this.setPosition(i.row,i.column,!0)}},this.setPosition=function(e,t,i){var n;if(n=i?{row:e,column:t}:this.$clipPositionToDocument(e,t),this.row!=n.row||this.column!=n.column){var s={row:this.row,column:this.column};this.row=n.row,this.column=n.column,this._signal("change",{old:s,value:n})}},this.detach=function(){this.document.off("change",this.$onChange)},this.attach=function(e){this.document=e||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(e,t){var i={};return e>=this.document.getLength()?(i.row=Math.max(0,this.document.getLength()-1),i.column=this.document.getLine(i.row).length):e<0?(i.row=0,i.column=0):(i.row=e,i.column=Math.min(this.document.getLine(i.row).length,Math.max(0,t))),t<0&&(i.column=0),i}}).call(r.prototype)})),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],(function(e,t,i){var n=e("./lib/oop"),s=e("./apply_delta").applyDelta,r=e("./lib/event_emitter").EventEmitter,o=e("./range").Range,a=e("./anchor").Anchor,l=function(e){this.$lines=[""],0===e.length?this.$lines=[""]:Array.isArray(e)?this.insertMergedLines({row:0,column:0},e):this.insert({row:0,column:0},e)};(function(){n.implement(this,r),this.setValue=function(e){var t=this.getLength()-1;this.remove(new o(0,0,t,this.getLine(t).length)),this.insert({row:0,column:0},e)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(e,t){return new a(this,e,t)},0==="aaa".split(/a/).length?this.$split=function(e){return e.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(e){return e.split(/\r\n|\r|\n/)},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=t?t[1]:"\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(e){this.$newLineMode!==e&&(this.$newLineMode=e,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(e){return"\r\n"==e||"\r"==e||"\n"==e},this.getLine=function(e){return this.$lines[e]||""},this.getLines=function(e,t){return this.$lines.slice(e,t+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(e){return this.getLinesForRange(e).join(this.getNewLineCharacter())},this.getLinesForRange=function(e){var t;if(e.start.row===e.end.row)t=[this.getLine(e.start.row).substring(e.start.column,e.end.column)];else{(t=this.getLines(e.start.row,e.end.row))[0]=(t[0]||"").substring(e.start.column);var i=t.length-1;e.end.row-e.start.row==i&&(t[i]=t[i].substring(0,e.end.column))}return t},this.insertLines=function(e,t){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(e,t)},this.removeLines=function(e,t){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(e,t)},this.insertNewLine=function(e){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(e,["",""])},this.insert=function(e,t){return this.getLength()<=1&&this.$detectNewLine(t),this.insertMergedLines(e,this.$split(t))},this.insertInLine=function(e,t){var i=this.clippedPos(e.row,e.column),n=this.pos(e.row,e.column+t.length);return this.applyDelta({start:i,end:n,action:"insert",lines:[t]},!0),this.clonePos(n)},this.clippedPos=function(e,t){var i=this.getLength();void 0===e?e=i:e<0?e=0:e>=i&&(e=i-1,t=void 0);var n=this.getLine(e);return null==t&&(t=n.length),{row:e,column:t=Math.min(Math.max(t,0),n.length)}},this.clonePos=function(e){return{row:e.row,column:e.column}},this.pos=function(e,t){return{row:e,column:t}},this.$clipPosition=function(e){var t=this.getLength();return e.row>=t?(e.row=Math.max(0,t-1),e.column=this.getLine(t-1).length):(e.row=Math.max(0,e.row),e.column=Math.min(Math.max(e.column,0),this.getLine(e.row).length)),e},this.insertFullLines=function(e,t){var i=0;(e=Math.min(Math.max(e,0),this.getLength()))<this.getLength()?(t=t.concat([""]),i=0):(t=[""].concat(t),e--,i=this.$lines[e].length),this.insertMergedLines({row:e,column:i},t)},this.insertMergedLines=function(e,t){var i=this.clippedPos(e.row,e.column),n={row:i.row+t.length-1,column:(1==t.length?i.column:0)+t[t.length-1].length};return this.applyDelta({start:i,end:n,action:"insert",lines:t}),this.clonePos(n)},this.remove=function(e){var t=this.clippedPos(e.start.row,e.start.column),i=this.clippedPos(e.end.row,e.end.column);return this.applyDelta({start:t,end:i,action:"remove",lines:this.getLinesForRange({start:t,end:i})}),this.clonePos(t)},this.removeInLine=function(e,t,i){var n=this.clippedPos(e,t),s=this.clippedPos(e,i);return this.applyDelta({start:n,end:s,action:"remove",lines:this.getLinesForRange({start:n,end:s})},!0),this.clonePos(n)},this.removeFullLines=function(e,t){e=Math.min(Math.max(0,e),this.getLength()-1);var i=(t=Math.min(Math.max(0,t),this.getLength()-1))==this.getLength()-1&&e>0,n=t<this.getLength()-1,s=i?e-1:e,r=i?this.getLine(s).length:0,a=n?t+1:t,l=n?0:this.getLine(a).length,h=new o(s,r,a,l),c=this.$lines.slice(e,t+1);return this.applyDelta({start:h.start,end:h.end,action:"remove",lines:this.getLinesForRange(h)}),c},this.removeNewLine=function(e){e<this.getLength()-1&&e>=0&&this.applyDelta({start:this.pos(e,this.getLine(e).length),end:this.pos(e+1,0),action:"remove",lines:["",""]})},this.replace=function(e,t){return e instanceof o||(e=o.fromPoints(e.start,e.end)),0===t.length&&e.isEmpty()?e.start:t==this.getTextRange(e)?e.end:(this.remove(e),t?this.insert(e.start,t):e.start)},this.applyDeltas=function(e){for(var t=0;t<e.length;t++)this.applyDelta(e[t])},this.revertDeltas=function(e){for(var t=e.length-1;t>=0;t--)this.revertDelta(e[t])},this.applyDelta=function(e,t){var i="insert"==e.action;(i?e.lines.length<=1&&!e.lines[0]:!o.comparePoints(e.start,e.end))||(i&&e.lines.length>2e4?this.$splitAndapplyLargeDelta(e,2e4):(s(this.$lines,e,t),this._signal("change",e)))},this.$safeApplyDelta=function(e){var t=this.$lines.length;("remove"==e.action&&e.start.row<t&&e.end.row<t||"insert"==e.action&&e.start.row<=t)&&this.applyDelta(e)},this.$splitAndapplyLargeDelta=function(e,t){for(var i=e.lines,n=i.length-t+1,s=e.start.row,r=e.start.column,o=0,a=0;o<n;o=a){a+=t-1;var l=i.slice(o,a);l.push(""),this.applyDelta({start:this.pos(s+o,r),end:this.pos(s+a,r=0),action:e.action,lines:l},!0)}e.lines=i.slice(o),e.start.row=s+o,e.start.column=r,this.applyDelta(e,!0)},this.revertDelta=function(e){this.$safeApplyDelta({start:this.clonePos(e.start),end:this.clonePos(e.end),action:"insert"==e.action?"remove":"insert",lines:e.lines.slice()})},this.indexToPosition=function(e,t){for(var i=this.$lines||this.getAllLines(),n=this.getNewLineCharacter().length,s=t||0,r=i.length;s<r;s++)if((e-=i[s].length+n)<0)return{row:s,column:e+i[s].length+n};return{row:r-1,column:e+i[r-1].length+n}},this.positionToIndex=function(e,t){for(var i=this.$lines||this.getAllLines(),n=this.getNewLineCharacter().length,s=0,r=Math.min(e.row,i.length),o=t||0;o<r;++o)s+=i[o].length+n;return s+e.column}}).call(l.prototype),t.Document=l})),ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],(function(e,t,i){var n=e("./lib/oop"),s=e("./lib/event_emitter").EventEmitter,r=function(e,t){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=e;var i=this;this.$worker=function(){if(i.running){for(var e=new Date,t=i.currentLine,n=-1,s=i.doc,r=t;i.lines[t];)t++;var o=s.getLength(),a=0;for(i.running=!1;t<o;){i.$tokenizeRow(t),n=t;do{t++}while(i.lines[t]);if(++a%5==0&&new Date-e>20){i.running=setTimeout(i.$worker,20);break}}i.currentLine=t,-1==n&&(n=t),r<=n&&i.fireUpdateEvent(r,n)}}};(function(){n.implement(this,s),this.setTokenizer=function(e){this.tokenizer=e,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(e){this.doc=e,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(e,t){var i={first:e,last:t};this._signal("update",{data:i})},this.start=function(e){this.currentLine=Math.min(e||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(e){var t=e.start.row,i=e.end.row-t;if(0===i)this.lines[t]=null;else if("remove"==e.action)this.lines.splice(t,i+1,null),this.states.splice(t,i+1,null);else{var n=Array(i+1);n.unshift(t,1),this.lines.splice.apply(this.lines,n),this.states.splice.apply(this.states,n)}this.currentLine=Math.min(t,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(e){return this.lines[e]||this.$tokenizeRow(e)},this.getState=function(e){return this.currentLine==e&&this.$tokenizeRow(e),this.states[e]||"start"},this.$tokenizeRow=function(e){var t=this.doc.getLine(e),i=this.states[e-1],n=this.tokenizer.getLineTokens(t,i,e);return this.states[e]+""!=n.state+""?(this.states[e]=n.state,this.lines[e+1]=null,this.currentLine>e+1&&(this.currentLine=e+1)):this.currentLine==e&&(this.currentLine=e+1),this.lines[e]=n.tokens},this.cleanup=function(){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.removeAllListeners()}}).call(r.prototype),t.BackgroundTokenizer=r})),ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],(function(e,t,i){var n=e("./lib/lang"),s=(e("./lib/oop"),e("./range").Range),r=function(e,t,i){this.setRegexp(e),this.clazz=t,this.type=i||"text"};(function(){this.MAX_RANGES=500,this.setRegexp=function(e){this.regExp+""!=e+""&&(this.regExp=e,this.cache=[])},this.update=function(e,t,i,r){if(this.regExp)for(var o=r.firstRow,a=r.lastRow,l={},h=o;h<=a;h++){var c=this.cache[h];null==c&&((c=n.getMatchOffsets(i.getLine(h),this.regExp)).length>this.MAX_RANGES&&(c=c.slice(0,this.MAX_RANGES)),c=c.map((function(e){return new s(h,e.offset,h,e.offset+e.length)})),this.cache[h]=c.length?c:"");for(var u=c.length;u--;){var d=c[u].toScreenRange(i),f=d.toString();l[f]||(l[f]=!0,t.drawSingleLineMarker(e,d,this.clazz,r))}}}}).call(r.prototype),t.SearchHighlight=r})),ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"],(function(e,t,i){var n=e("../range").Range;function s(e,t){this.foldData=e,Array.isArray(t)?this.folds=t:t=this.folds=[t];var i=t[t.length-1];this.range=new n(t[0].start.row,t[0].start.column,i.end.row,i.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach((function(e){e.setFoldLine(this)}),this)}(function(){this.shiftRow=function(e){this.start.row+=e,this.end.row+=e,this.folds.forEach((function(t){t.start.row+=e,t.end.row+=e}))},this.addFold=function(e){if(e.sameRow){if(e.start.row<this.startRow||e.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(e),this.folds.sort((function(e,t){return-e.range.compareEnd(t.start.row,t.start.column)})),this.range.compareEnd(e.start.row,e.start.column)>0?(this.end.row=e.end.row,this.end.column=e.end.column):this.range.compareStart(e.end.row,e.end.column)<0&&(this.start.row=e.start.row,this.start.column=e.start.column)}else if(e.start.row==this.end.row)this.folds.push(e),this.end.row=e.end.row,this.end.column=e.end.column;else{if(e.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(e),this.start.row=e.start.row,this.start.column=e.start.column}e.foldLine=this},this.containsRow=function(e){return e>=this.start.row&&e<=this.end.row},this.walk=function(e,t,i){var n,s,r=0,o=this.folds,a=!0;null==t&&(t=this.end.row,i=this.end.column);for(var l=0;l<o.length;l++){if(-1==(s=(n=o[l]).range.compareStart(t,i)))return void e(null,t,i,r,a);if(!e(null,n.start.row,n.start.column,r,a)&&e(n.placeholder,n.start.row,n.start.column,r)||0===s)return;a=!n.sameRow,r=n.end.column}e(null,t,i,r,a)},this.getNextFoldTo=function(e,t){for(var i,n,s=0;s<this.folds.length;s++){if(-1==(n=(i=this.folds[s]).range.compareEnd(e,t)))return{fold:i,kind:"after"};if(0===n)return{fold:i,kind:"inside"}}return null},this.addRemoveChars=function(e,t,i){var n,s,r=this.getNextFoldTo(e,t);if(r)if(n=r.fold,"inside"==r.kind&&n.start.column!=t&&n.start.row!=e)window.console&&window.console.log(e,t,n);else if(n.start.row==e){var o=(s=this.folds).indexOf(n);for(0===o&&(this.start.column+=i);o<s.length;o++){if((n=s[o]).start.column+=i,!n.sameRow)return;n.end.column+=i}this.end.column+=i}},this.split=function(e,t){var i=this.getNextFoldTo(e,t);if(!i||"inside"==i.kind)return null;var n=i.fold,r=this.folds,o=this.foldData,a=r.indexOf(n),l=r[a-1];this.end.row=l.end.row,this.end.column=l.end.column;var h=new s(o,r=r.splice(a,r.length-a));return o.splice(o.indexOf(this)+1,0,h),h},this.merge=function(e){for(var t=e.folds,i=0;i<t.length;i++)this.addFold(t[i]);var n=this.foldData;n.splice(n.indexOf(e),1)},this.toString=function(){var e=[this.range.toString()+": ["];return this.folds.forEach((function(t){e.push("  "+t.toString())})),e.push("]"),e.join("\n")},this.idxToPosition=function(e){for(var t=0,i=0;i<this.folds.length;i++){var n=this.folds[i];if((e-=n.start.column-t)<0)return{row:n.start.row,column:n.start.column+e};if((e-=n.placeholder.length)<0)return n.start;t=n.end.column}return{row:this.end.row,column:this.end.column+e}}}).call(s.prototype),t.FoldLine=s})),ace.define("ace/range_list",["require","exports","module","ace/range"],(function(e,t,i){var n=e("./range").Range.comparePoints,s=function(){this.ranges=[],this.$bias=1};(function(){this.comparePoints=n,this.pointIndex=function(e,t,i){for(var s=this.ranges,r=i||0;r<s.length;r++){var o=s[r],a=n(e,o.end);if(!(a>0)){var l=n(e,o.start);return 0===a?t&&0!==l?-r-2:r:l>0||0===l&&!t?r:-r-1}}return-r-1},this.add=function(e){var t=!e.isEmpty(),i=this.pointIndex(e.start,t);i<0&&(i=-i-1);var n=this.pointIndex(e.end,t,i);return n<0?n=-n-1:n++,this.ranges.splice(i,n-i,e)},this.addList=function(e){for(var t=[],i=e.length;i--;)t.push.apply(t,this.add(e[i]));return t},this.substractPoint=function(e){var t=this.pointIndex(e);if(t>=0)return this.ranges.splice(t,1)},this.merge=function(){for(var e,t=[],i=this.ranges,s=(i=i.sort((function(e,t){return n(e.start,t.start)})))[0],r=1;r<i.length;r++){e=s,s=i[r];var o=n(e.end,s.start);o<0||(0!=o||e.isEmpty()||s.isEmpty())&&(n(e.end,s.end)<0&&(e.end.row=s.end.row,e.end.column=s.end.column),i.splice(r,1),t.push(s),s=e,r--)}return this.ranges=i,t},this.contains=function(e,t){return this.pointIndex({row:e,column:t})>=0},this.containsPoint=function(e){return this.pointIndex(e)>=0},this.rangeAtPoint=function(e){var t=this.pointIndex(e);if(t>=0)return this.ranges[t]},this.clipRows=function(e,t){var i=this.ranges;if(i[0].start.row>t||i[i.length-1].start.row<e)return[];var n=this.pointIndex({row:e,column:0});n<0&&(n=-n-1);var s=this.pointIndex({row:t,column:0},n);s<0&&(s=-s-1);for(var r=[],o=n;o<s;o++)r.push(i[o]);return r},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(e){this.session&&this.detach(),this.session=e,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},this.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)},this.$onChange=function(e){for(var t=e.start,i=e.end,n=t.row,s=i.row,r=this.ranges,o=0,a=r.length;o<a;o++){if((c=r[o]).end.row>=n)break}if("insert"==e.action)for(var l=s-n,h=-t.column+i.column;o<a;o++){if((c=r[o]).start.row>n)break;if(c.start.row==n&&c.start.column>=t.column&&(c.start.column==t.column&&this.$bias<=0||(c.start.column+=h,c.start.row+=l)),c.end.row==n&&c.end.column>=t.column){if(c.end.column==t.column&&this.$bias<0)continue;c.end.column==t.column&&h>0&&o<a-1&&c.end.column>c.start.column&&c.end.column==r[o+1].start.column&&(c.end.column-=h),c.end.column+=h,c.end.row+=l}}else for(l=n-s,h=t.column-i.column;o<a;o++){if((c=r[o]).start.row>s)break;c.end.row<s&&(n<c.end.row||n==c.end.row&&t.column<c.end.column)?(c.end.row=n,c.end.column=t.column):c.end.row==s?c.end.column<=i.column?(l||c.end.column>t.column)&&(c.end.column=t.column,c.end.row=t.row):(c.end.column+=h,c.end.row+=l):c.end.row>s&&(c.end.row+=l),c.start.row<s&&(n<c.start.row||n==c.start.row&&t.column<c.start.column)?(c.start.row=n,c.start.column=t.column):c.start.row==s?c.start.column<=i.column?(l||c.start.column>t.column)&&(c.start.column=t.column,c.start.row=t.row):(c.start.column+=h,c.start.row+=l):c.start.row>s&&(c.start.row+=l)}if(0!=l&&o<a)for(;o<a;o++){var c;(c=r[o]).start.row+=l,c.end.row+=l}}}).call(s.prototype),t.RangeList=s})),ace.define("ace/edit_session/fold",["require","exports","module","ace/range_list","ace/lib/oop"],(function(e,t,i){var n=e("../range_list").RangeList,s=e("../lib/oop"),r=t.Fold=function(e,t){this.foldLine=null,this.placeholder=t,this.range=e,this.start=e.start,this.end=e.end,this.sameRow=e.start.row==e.end.row,this.subFolds=this.ranges=[]};function o(e,t){e.row-=t.row,0==e.row&&(e.column-=t.column)}function a(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row}s.inherits(r,n),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(e){this.foldLine=e,this.subFolds.forEach((function(t){t.setFoldLine(e)}))},this.clone=function(){var e=this.range.clone(),t=new r(e,this.placeholder);return this.subFolds.forEach((function(e){t.subFolds.push(e.clone())})),t.collapseChildren=this.collapseChildren,t},this.addSubFold=function(e){if(!this.range.isEqual(e)){var t,i;t=e,i=this.start,o(t.start,i),o(t.end,i);for(var n=e.start.row,s=e.start.column,r=0,a=-1;r<this.subFolds.length&&1==(a=this.subFolds[r].range.compare(n,s));r++);var l=this.subFolds[r],h=0;if(0==a){if(l.range.containsRange(e))return l.addSubFold(e);h=1}n=e.range.end.row,s=e.range.end.column;var c=r;for(a=-1;c<this.subFolds.length&&1==(a=this.subFolds[c].range.compare(n,s));c++);0==a&&c++;for(var u=this.subFolds.splice(r,c-r,e),d=0==a?u.length-1:u.length,f=h;f<d;f++)e.addSubFold(u[f]);return e.setFoldLine(this.foldLine),e}},this.restoreRange=function(e){return function(e,t){a(e.start,t),a(e.end,t)}(e,this.start)}}.call(r.prototype)})),ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"],(function(e,t,i){var n=e("../range").Range,s=e("./fold_line").FoldLine,r=e("./fold").Fold,o=e("../token_iterator").TokenIterator;t.Folding=function(){this.getFoldAt=function(e,t,i){var n=this.getFoldLine(e);if(!n)return null;for(var s=n.folds,r=0;r<s.length;r++){var o=s[r].range;if(o.contains(e,t)){if(1==i&&o.isEnd(e,t)&&!o.isEmpty())continue;if(-1==i&&o.isStart(e,t)&&!o.isEmpty())continue;return s[r]}}},this.getFoldsInRange=function(e){var t=e.start,i=e.end,n=this.$foldData,s=[];t.column+=1,i.column-=1;for(var r=0;r<n.length;r++){var o=n[r].range.compareRange(e);if(2!=o){if(-2==o)break;for(var a=n[r].folds,l=0;l<a.length;l++){var h=a[l];if(-2==(o=h.range.compareRange(e)))break;if(2!=o){if(42==o)break;s.push(h)}}}}return t.column-=1,i.column+=1,s},this.getFoldsInRangeList=function(e){if(Array.isArray(e)){var t=[];e.forEach((function(e){t=t.concat(this.getFoldsInRange(e))}),this)}else t=this.getFoldsInRange(e);return t},this.getAllFolds=function(){for(var e=[],t=this.$foldData,i=0;i<t.length;i++)for(var n=0;n<t[i].folds.length;n++)e.push(t[i].folds[n]);return e},this.getFoldStringAt=function(e,t,i,n){if(!(n=n||this.getFoldLine(e)))return null;for(var s,r,o={end:{column:0}},a=0;a<n.folds.length;a++){var l=(r=n.folds[a]).range.compareEnd(e,t);if(-1==l){s=this.getLine(r.start.row).substring(o.end.column,r.start.column);break}if(0===l)return null;o=r}return s||(s=this.getLine(r.start.row).substring(o.end.column)),-1==i?s.substring(0,t-o.end.column):1==i?s.substring(t-o.end.column):s},this.getFoldLine=function(e,t){var i=this.$foldData,n=0;for(t&&(n=i.indexOf(t)),-1==n&&(n=0);n<i.length;n++){var s=i[n];if(s.start.row<=e&&s.end.row>=e)return s;if(s.end.row>e)return null}return null},this.getNextFoldLine=function(e,t){var i=this.$foldData,n=0;for(t&&(n=i.indexOf(t)),-1==n&&(n=0);n<i.length;n++){var s=i[n];if(s.end.row>=e)return s}return null},this.getFoldedRowCount=function(e,t){for(var i=this.$foldData,n=t-e+1,s=0;s<i.length;s++){var r=i[s],o=r.end.row,a=r.start.row;if(o>=t){a<t&&(a>=e?n-=t-a:n=0);break}o>=e&&(n-=a>=e?o-a:o-e+1)}return n},this.$addFoldLine=function(e){return this.$foldData.push(e),this.$foldData.sort((function(e,t){return e.start.row-t.start.row})),e},this.addFold=function(e,t){var i,n=this.$foldData,o=!1;e instanceof r?i=e:(i=new r(t,e)).collapseChildren=t.collapseChildren,this.$clipRangeToDocument(i.range);var a=i.start.row,l=i.start.column,h=i.end.row,c=i.end.column,u=this.getFoldAt(a,l,1),d=this.getFoldAt(h,c,-1);if(u&&d==u)return u.addSubFold(i);u&&!u.range.isStart(a,l)&&this.removeFold(u),d&&!d.range.isEnd(h,c)&&this.removeFold(d);var f=this.getFoldsInRange(i.range);f.length>0&&(this.removeFolds(f),i.collapseChildren||f.forEach((function(e){i.addSubFold(e)})));for(var p=0;p<n.length;p++){var g=n[p];if(h==g.start.row){g.addFold(i),o=!0;break}if(a==g.end.row){if(g.addFold(i),o=!0,!i.sameRow){var m=n[p+1];if(m&&m.start.row==h){g.merge(m);break}}break}if(h<=g.start.row)break}return o||(g=this.$addFoldLine(new s(this.$foldData,i))),this.$useWrapMode?this.$updateWrapData(g.start.row,g.start.row):this.$updateRowLengthCache(g.start.row,g.start.row),this.$modified=!0,this._signal("changeFold",{data:i,action:"add"}),i},this.addFolds=function(e){e.forEach((function(e){this.addFold(e)}),this)},this.removeFold=function(e){var t=e.foldLine,i=t.start.row,n=t.end.row,s=this.$foldData,r=t.folds;if(1==r.length)s.splice(s.indexOf(t),1);else if(t.range.isEnd(e.end.row,e.end.column))r.pop(),t.end.row=r[r.length-1].end.row,t.end.column=r[r.length-1].end.column;else if(t.range.isStart(e.start.row,e.start.column))r.shift(),t.start.row=r[0].start.row,t.start.column=r[0].start.column;else if(e.sameRow)r.splice(r.indexOf(e),1);else{var o=t.split(e.start.row,e.start.column);(r=o.folds).shift(),o.start.row=r[0].start.row,o.start.column=r[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(i,n):this.$updateRowLengthCache(i,n)),this.$modified=!0,this._signal("changeFold",{data:e,action:"remove"})},this.removeFolds=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i]);t.forEach((function(e){this.removeFold(e)}),this),this.$modified=!0},this.expandFold=function(e){this.removeFold(e),e.subFolds.forEach((function(t){e.restoreRange(t),this.addFold(t)}),this),e.collapseChildren>0&&this.foldAll(e.start.row+1,e.end.row,e.collapseChildren-1),e.subFolds=[]},this.expandFolds=function(e){e.forEach((function(e){this.expandFold(e)}),this)},this.unfold=function(e,t){var i,s;if(null==e)i=new n(0,0,this.getLength(),0),null==t&&(t=!0);else if("number"==typeof e)i=new n(e,0,e,this.getLine(e).length);else if("row"in e)i=n.fromPoints(e,e);else{if(Array.isArray(e))return s=[],e.forEach((function(e){s=s.concat(this.unfold(e))}),this),s;i=e}for(var r=s=this.getFoldsInRangeList(i);1==s.length&&n.comparePoints(s[0].start,i.start)<0&&n.comparePoints(s[0].end,i.end)>0;)this.expandFolds(s),s=this.getFoldsInRangeList(i);if(0!=t?this.removeFolds(s):this.expandFolds(s),r.length)return r},this.isRowFolded=function(e,t){return!!this.getFoldLine(e,t)},this.getRowFoldEnd=function(e,t){var i=this.getFoldLine(e,t);return i?i.end.row:e},this.getRowFoldStart=function(e,t){var i=this.getFoldLine(e,t);return i?i.start.row:e},this.getFoldDisplayLine=function(e,t,i,n,s){null==n&&(n=e.start.row),null==s&&(s=0),null==t&&(t=e.end.row),null==i&&(i=this.getLine(t).length);var r=this.doc,o="";return e.walk((function(e,t,i,a){if(!(t<n)){if(t==n){if(i<s)return;a=Math.max(s,a)}o+=null!=e?e:r.getLine(t).substring(a,i)}}),t,i),o},this.getDisplayLine=function(e,t,i,n){var s,r=this.getFoldLine(e);return r?this.getFoldDisplayLine(r,e,t,i,n):(s=this.doc.getLine(e)).substring(n||0,t||s.length)},this.$cloneFoldData=function(){var e=[];return e=this.$foldData.map((function(t){var i=t.folds.map((function(e){return e.clone()}));return new s(e,i)}))},this.toggleFold=function(e){var t,i,n=this.selection.getRange();if(n.isEmpty()){var s=n.start;if(t=this.getFoldAt(s.row,s.column))return void this.expandFold(t);(i=this.findMatchingBracket(s))?1==n.comparePoint(i)?n.end=i:(n.start=i,n.start.column++,n.end.column--):(i=this.findMatchingBracket({row:s.row,column:s.column+1}))?(1==n.comparePoint(i)?n.end=i:n.start=i,n.start.column++):n=this.getCommentFoldRange(s.row,s.column)||n}else{var r=this.getFoldsInRange(n);if(e&&r.length)return void this.expandFolds(r);1==r.length&&(t=r[0])}if(t||(t=this.getFoldAt(n.start.row,n.start.column)),t&&t.range.toString()==n.toString())this.expandFold(t);else{var o="...";if(!n.isMultiLine()){if((o=this.getTextRange(n)).length<4)return;o=o.trim().substring(0,2)+".."}this.addFold(o,n)}},this.getCommentFoldRange=function(e,t,i){var s=new o(this,e,t),r=s.getCurrentToken(),a=r&&r.type;if(r&&/^comment|string/.test(a)){"comment"==(a=a.match(/comment|string/)[0])&&(a+="|doc-start");var l=new RegExp(a),h=new n;if(1!=i){do{r=s.stepBackward()}while(r&&l.test(r.type));s.stepForward()}if(h.start.row=s.getCurrentTokenRow(),h.start.column=s.getCurrentTokenColumn()+2,s=new o(this,e,t),-1!=i){var c=-1;do{if(r=s.stepForward(),-1==c){var u=this.getState(s.$row);l.test(u)||(c=s.$row)}else if(s.$row>c)break}while(r&&l.test(r.type));r=s.stepBackward()}else r=s.getCurrentToken();return h.end.row=s.getCurrentTokenRow(),h.end.column=s.getCurrentTokenColumn()+r.value.length-2,h}},this.foldAll=function(e,t,i,n){null==i&&(i=1e5);var s=this.foldWidgets;if(s){t=t||this.getLength();for(var r=e=e||0;r<t;r++)if(null==s[r]&&(s[r]=this.getFoldWidget(r)),"start"==s[r]&&(!n||n(r))){var o=this.getFoldWidgetRange(r);o&&o.isMultiLine()&&o.end.row<=t&&o.start.row>=e&&(r=o.end.row,o.collapseChildren=i,this.addFold("...",o))}}},this.foldToLevel=function(e){for(this.foldAll();e-- >0;)this.unfold(null,!1)},this.foldAllComments=function(){var e=this;this.foldAll(null,null,null,(function(t){for(var i=e.getTokens(t),n=0;n<i.length;n++){var s=i[n];if("text"!=s.type||!/^\s+$/.test(s.value))return!!/comment/.test(s.type)}}))},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(e){if(!this.$foldStyles[e])throw new Error("invalid fold style: "+e+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle!=e){this.$foldStyle=e,"manual"==e&&this.unfold();var t=this.$foldMode;this.$setFolding(null),this.$setFolding(t)}},this.$setFolding=function(e){this.$foldMode!=e&&(this.$foldMode=e,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),e&&"manual"!=this.$foldStyle?(this.foldWidgets=[],this.getFoldWidget=e.getFoldWidget.bind(e,this,this.$foldStyle),this.getFoldWidgetRange=e.getFoldWidgetRange.bind(e,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)):this.foldWidgets=null)},this.getParentFoldRangeData=function(e,t){var i=this.foldWidgets;if(!i||t&&i[e])return{};for(var n,s=e-1;s>=0;){var r=i[s];if(null==r&&(r=i[s]=this.getFoldWidget(s)),"start"==r){var o=this.getFoldWidgetRange(s);if(n||(n=o),o&&o.end.row>=e)break}s--}return{range:-1!==s&&o,firstRange:n}},this.onFoldWidgetClick=function(e,t){var i={children:(t=t.domEvent).shiftKey,all:t.ctrlKey||t.metaKey,siblings:t.altKey};if(!this.$toggleFoldWidget(e,i)){var n=t.target||t.srcElement;n&&/ace_fold-widget/.test(n.className)&&(n.className+=" ace_invalid")}},this.$toggleFoldWidget=function(e,t){if(this.getFoldWidget){var i=this.getFoldWidget(e),n=this.getLine(e),s="end"===i?-1:1,r=this.getFoldAt(e,-1===s?0:n.length,s);if(r)return t.children||t.all?this.removeFold(r):this.expandFold(r),r;var o=this.getFoldWidgetRange(e,!0);if(o&&!o.isMultiLine()&&(r=this.getFoldAt(o.start.row,o.start.column,1))&&o.isEqual(r.range))return this.removeFold(r),r;if(t.siblings){var a=this.getParentFoldRangeData(e);if(a.range)var l=a.range.start.row+1,h=a.range.end.row;this.foldAll(l,h,t.all?1e4:0)}else t.children?(h=o?o.end.row:this.getLength(),this.foldAll(e+1,h,t.all?1e4:0)):o&&(t.all&&(o.collapseChildren=1e4),this.addFold("...",o));return o}},this.toggleFoldWidget=function(e){var t=this.selection.getCursor().row;t=this.getRowFoldStart(t);var i=this.$toggleFoldWidget(t,{});if(!i){var n=this.getParentFoldRangeData(t,!0);if(i=n.range||n.firstRange){t=i.start.row;var s=this.getFoldAt(t,this.getLine(t).length,1);s?this.removeFold(s):this.addFold("...",i)}}},this.updateFoldWidgets=function(e){var t=e.start.row,i=e.end.row-t;if(0===i)this.foldWidgets[t]=null;else if("remove"==e.action)this.foldWidgets.splice(t,i+1,null);else{var n=Array(i+1);n.unshift(t,1),this.foldWidgets.splice.apply(this.foldWidgets,n)}},this.tokenizerUpdateFoldWidgets=function(e){var t=e.data;t.first!=t.last&&this.foldWidgets.length>t.first&&this.foldWidgets.splice(t.first,this.foldWidgets.length)}}})),ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],(function(e,t,i){var n=e("../token_iterator").TokenIterator,s=e("../range").Range;t.BracketMatch=function(){this.findMatchingBracket=function(e,t){if(0==e.column)return null;var i=t||this.getLine(e.row).charAt(e.column-1);if(""==i)return null;var n=i.match(/([\(\[\{])|([\)\]\}])/);return n?n[1]?this.$findClosingBracket(n[1],e):this.$findOpeningBracket(n[2],e):null},this.getBracketRange=function(e){var t,i=this.getLine(e.row),n=!0,r=i.charAt(e.column-1),o=r&&r.match(/([\(\[\{])|([\)\]\}])/);if(o||(r=i.charAt(e.column),e={row:e.row,column:e.column+1},o=r&&r.match(/([\(\[\{])|([\)\]\}])/),n=!1),!o)return null;if(o[1]){if(!(a=this.$findClosingBracket(o[1],e)))return null;t=s.fromPoints(e,a),n||(t.end.column++,t.start.column--),t.cursor=t.end}else{var a;if(!(a=this.$findOpeningBracket(o[2],e)))return null;t=s.fromPoints(a,e),n||(t.start.column++,t.end.column--),t.cursor=t.start}return t},this.getMatchingBracketRanges=function(e){var t=this.getLine(e.row),i=t.charAt(e.column-1),n=i&&i.match(/([\(\[\{])|([\)\]\}])/);if(n||(i=t.charAt(e.column),e={row:e.row,column:e.column+1},n=i&&i.match(/([\(\[\{])|([\)\]\}])/)),!n)return null;var r=new s(e.row,e.column-1,e.row,e.column),o=n[1]?this.$findClosingBracket(n[1],e):this.$findOpeningBracket(n[2],e);return o?[r,new s(o.row,o.column,o.row,o.column+1)]:[r]},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"},this.$findOpeningBracket=function(e,t,i){var s=this.$brackets[e],r=1,o=new n(this,t.row,t.column),a=o.getCurrentToken();if(a||(a=o.stepForward()),a){i||(i=new RegExp("(\\.?"+a.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+"));for(var l=t.column-o.getCurrentTokenColumn()-2,h=a.value;;){for(;l>=0;){var c=h.charAt(l);if(c==s){if(0==(r-=1))return{row:o.getCurrentTokenRow(),column:l+o.getCurrentTokenColumn()}}else c==e&&(r+=1);l-=1}do{a=o.stepBackward()}while(a&&!i.test(a.type));if(null==a)break;l=(h=a.value).length-1}return null}},this.$findClosingBracket=function(e,t,i){var s=this.$brackets[e],r=1,o=new n(this,t.row,t.column),a=o.getCurrentToken();if(a||(a=o.stepForward()),a){i||(i=new RegExp("(\\.?"+a.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+"));for(var l=t.column-o.getCurrentTokenColumn();;){for(var h=a.value,c=h.length;l<c;){var u=h.charAt(l);if(u==s){if(0==(r-=1))return{row:o.getCurrentTokenRow(),column:l+o.getCurrentTokenColumn()}}else u==e&&(r+=1);l+=1}do{a=o.stepForward()}while(a&&!i.test(a.type));if(null==a)break;l=0}return null}}}})),ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"],(function(e,t,i){var n=e("./lib/oop"),s=e("./lib/lang"),r=e("./bidihandler").BidiHandler,o=e("./config"),a=e("./lib/event_emitter").EventEmitter,l=e("./selection").Selection,h=e("./mode/text").Mode,c=e("./range").Range,u=e("./document").Document,d=e("./background_tokenizer").BackgroundTokenizer,f=e("./search_highlight").SearchHighlight,p=function(e,t){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id="session"+ ++p.$uid,this.$foldData.toString=function(){return this.join("\n")},this.bgTokenizer=new d((new h).getTokenizer(),this);var i=this;this.bgTokenizer.on("update",(function(e){i._signal("tokenizerUpdate",e)})),this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this),"object"==typeof e&&e.getLine||(e=new u(e)),this.setDocument(e),this.selection=new l(this),this.$bidiHandler=new r(this),o.resetOptions(this),this.setMode(t),o._signal("session",this),this.destroyed=!1};p.$uid=0,function(){n.implement(this,a),this.setDocument=function(e){this.doc&&this.doc.off("change",this.$onChange),this.doc=e,e.on("change",this.$onChange),this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc},this.$resetRowCache=function(e){if(!e)return this.$docRowCache=[],void(this.$screenRowCache=[]);var t=this.$docRowCache.length,i=this.$getRowCacheIndex(this.$docRowCache,e)+1;t>i&&(this.$docRowCache.splice(i,t),this.$screenRowCache.splice(i,t))},this.$getRowCacheIndex=function(e,t){for(var i=0,n=e.length-1;i<=n;){var s=i+n>>1,r=e[s];if(t>r)i=s+1;else{if(!(t<r))return s;n=s-1}}return i-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.destroyed||this.bgTokenizer.start(0)},this.onChangeFold=function(e){var t=e.data;this.$resetRowCache(t.start.row)},this.onChange=function(e){this.$modified=!0,this.$bidiHandler.onChange(e),this.$resetRowCache(e.start.row);var t=this.$updateInternalDataOnChange(e);!this.$fromUndo&&this.$undoManager&&(t&&t.length&&(this.$undoManager.add({action:"removeFolds",folds:t},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(e,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer.$updateOnChange(e),this._signal("change",e)},this.setValue=function(e){this.doc.setValue(e),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(e){return this.bgTokenizer.getState(e)},this.getTokens=function(e){return this.bgTokenizer.getTokens(e)},this.getTokenAt=function(e,t){var i,n=this.bgTokenizer.getTokens(e),s=0;if(null==t){var r=n.length-1;s=this.getLine(e).length}else for(r=0;r<n.length&&!((s+=n[r].value.length)>=t);r++);return(i=n[r])?(i.index=r,i.start=s-i.value.length,i):null},this.setUndoManager=function(e){if(this.$undoManager=e,this.$informUndoManager&&this.$informUndoManager.cancel(),e){var t=this;e.addSession(this),this.$syncInformUndoManager=function(){t.$informUndoManager.cancel(),t.mergeUndoDeltas=!1},this.$informUndoManager=s.delayedCall(this.$syncInformUndoManager)}else this.$syncInformUndoManager=function(){}},this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?s.stringRepeat(" ",this.getTabSize()):"\t"},this.setUseSoftTabs=function(e){this.setOption("useSoftTabs",e)},this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},this.setTabSize=function(e){this.setOption("tabSize",e)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(e){return this.$useSoftTabs&&e.column%this.$tabSize==0},this.setNavigateWithinSoftTabs=function(e){this.setOption("navigateWithinSoftTabs",e)},this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},this.$overwrite=!1,this.setOverwrite=function(e){this.setOption("overwrite",e)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(e,t){this.$decorations[e]||(this.$decorations[e]=""),this.$decorations[e]+=" "+t,this._signal("changeBreakpoint",{})},this.removeGutterDecoration=function(e,t){this.$decorations[e]=(this.$decorations[e]||"").replace(" "+t,""),this._signal("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(e){this.$breakpoints=[];for(var t=0;t<e.length;t++)this.$breakpoints[e[t]]="ace_breakpoint";this._signal("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},this.setBreakpoint=function(e,t){void 0===t&&(t="ace_breakpoint"),t?this.$breakpoints[e]=t:delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.clearBreakpoint=function(e){delete this.$breakpoints[e],this._signal("changeBreakpoint",{})},this.addMarker=function(e,t,i,n){var s=this.$markerId++,r={range:e,type:i||"line",renderer:"function"==typeof i?i:null,clazz:t,inFront:!!n,id:s};return n?(this.$frontMarkers[s]=r,this._signal("changeFrontMarker")):(this.$backMarkers[s]=r,this._signal("changeBackMarker")),s},this.addDynamicMarker=function(e,t){if(e.update){var i=this.$markerId++;return e.id=i,e.inFront=!!t,t?(this.$frontMarkers[i]=e,this._signal("changeFrontMarker")):(this.$backMarkers[i]=e,this._signal("changeBackMarker")),e}},this.removeMarker=function(e){var t=this.$frontMarkers[e]||this.$backMarkers[e];t&&(delete(t.inFront?this.$frontMarkers:this.$backMarkers)[e],this._signal(t.inFront?"changeFrontMarker":"changeBackMarker"))},this.getMarkers=function(e){return e?this.$frontMarkers:this.$backMarkers},this.highlight=function(e){if(!this.$searchHighlight){var t=new f(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(t)}this.$searchHighlight.setRegexp(e)},this.highlightLines=function(e,t,i,n){"number"!=typeof t&&(i=t,t=e),i||(i="ace_step");var s=new c(e,0,t,1/0);return s.id=this.addMarker(s,i,"fullLine",n),s},this.setAnnotations=function(e){this.$annotations=e,this._signal("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(e){var t=e.match(/^.*?(\r?\n)/m);this.$autoNewLine=t?t[1]:"\n"},this.getWordRange=function(e,t){var i=this.getLine(e),n=!1;if(t>0&&(n=!!i.charAt(t-1).match(this.tokenRe)),n||(n=!!i.charAt(t).match(this.tokenRe)),n)var s=this.tokenRe;else if(/^\s+$/.test(i.slice(t-1,t+1)))s=/\s/;else s=this.nonTokenRe;var r=t;if(r>0){do{r--}while(r>=0&&i.charAt(r).match(s));r++}for(var o=t;o<i.length&&i.charAt(o).match(s);)o++;return new c(e,r,e,o)},this.getAWordRange=function(e,t){for(var i=this.getWordRange(e,t),n=this.getLine(i.end.row);n.charAt(i.end.column).match(/[ \t]/);)i.end.column+=1;return i},this.setNewLineMode=function(e){this.doc.setNewLineMode(e)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(e){this.setOption("useWorker",e)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var t=e.data;this.bgTokenizer.start(t.first),this._signal("tokenizerUpdate",e)},this.$modes=o.$modes,this.$mode=null,this.$modeId=null,this.setMode=function(e,t){if(e&&"object"==typeof e){if(e.getTokenizer)return this.$onChangeMode(e);var i=e,n=i.path}else n=e||"ace/mode/text";if(this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new h),this.$modes[n]&&!i)return this.$onChangeMode(this.$modes[n]),void(t&&t());this.$modeId=n,o.loadModule(["mode",n],function(e){if(this.$modeId!==n)return t&&t();this.$modes[n]&&!i?this.$onChangeMode(this.$modes[n]):e&&e.Mode&&(e=new e.Mode(i),i||(this.$modes[n]=e,e.$id=n),this.$onChangeMode(e)),t&&t()}.bind(this)),this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0)},this.$onChangeMode=function(e,t){if(t||(this.$modeId=e.$id),this.$mode!==e){var i=this.$mode;this.$mode=e,this.$stopWorker(),this.$useWorker&&this.$startWorker();var n=e.getTokenizer();if(void 0!==n.on){var s=this.onReloadTokenizer.bind(this);n.on("update",s)}this.bgTokenizer.setTokenizer(n),this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=e.tokenRe,this.nonTokenRe=e.nonTokenRe,t||(e.attachToSession&&e.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(e.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode",{oldMode:i,mode:e}))}},this.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){o.warn("Could not load worker",e),this.$worker=null}},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(e){this.$scrollTop===e||isNaN(e)||(this.$scrollTop=e,this._signal("changeScrollTop",e))},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(e){this.$scrollLeft===e||isNaN(e)||(this.$scrollLeft=e,this._signal("changeScrollLeft",e))},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(null!=this.lineWidgetsWidth)return this.lineWidgetsWidth;var e=0;return this.lineWidgets.forEach((function(t){t&&t.screenWidth>e&&(e=t.screenWidth)})),this.lineWidgetWidth=e},this.$computeWidth=function(e){if(this.$modified||e){if(this.$modified=!1,this.$useWrapMode)return this.screenWidth=this.$wrapLimit;for(var t=this.doc.getAllLines(),i=this.$rowLengthCache,n=0,s=0,r=this.$foldData[s],o=r?r.start.row:1/0,a=t.length,l=0;l<a;l++){if(l>o){if((l=r.end.row+1)>=a)break;o=(r=this.$foldData[s++])?r.start.row:1/0}null==i[l]&&(i[l]=this.$getStringScreenWidth(t[l])[0]),i[l]>n&&(n=i[l])}this.screenWidth=n}},this.getLine=function(e){return this.doc.getLine(e)},this.getLines=function(e,t){return this.doc.getLines(e,t)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(e){return this.doc.getTextRange(e||this.selection.getRange())},this.insert=function(e,t){return this.doc.insert(e,t)},this.remove=function(e){return this.doc.remove(e)},this.removeFullLines=function(e,t){return this.doc.removeFullLines(e,t)},this.undoChanges=function(e,t){if(e.length){this.$fromUndo=!0;for(var i=e.length-1;-1!=i;i--){var n=e[i];"insert"==n.action||"remove"==n.action?this.doc.revertDelta(n):n.folds&&this.addFolds(n.folds)}!t&&this.$undoSelect&&(e.selectionBefore?this.selection.fromJSON(e.selectionBefore):this.selection.setRange(this.$getUndoSelection(e,!0))),this.$fromUndo=!1}},this.redoChanges=function(e,t){if(e.length){this.$fromUndo=!0;for(var i=0;i<e.length;i++){var n=e[i];"insert"!=n.action&&"remove"!=n.action||this.doc.$safeApplyDelta(n)}!t&&this.$undoSelect&&(e.selectionAfter?this.selection.fromJSON(e.selectionAfter):this.selection.setRange(this.$getUndoSelection(e,!1))),this.$fromUndo=!1}},this.setUndoSelect=function(e){this.$undoSelect=e},this.$getUndoSelection=function(e,t){function i(e){return t?"insert"!==e.action:"insert"===e.action}for(var n,s,r=0;r<e.length;r++){var o=e[r];o.start&&(n?i(o)?(s=o.start,-1==n.compare(s.row,s.column)&&n.setStart(s),s=o.end,1==n.compare(s.row,s.column)&&n.setEnd(s)):(s=o.start,-1==n.compare(s.row,s.column)&&(n=c.fromPoints(o.start,o.start))):n=i(o)?c.fromPoints(o.start,o.end):c.fromPoints(o.start,o.start))}return n},this.replace=function(e,t){return this.doc.replace(e,t)},this.moveText=function(e,t,i){var n=this.getTextRange(e),s=this.getFoldsInRange(e),r=c.fromPoints(t,t);if(!i){this.remove(e);var o=e.start.row-e.end.row;(h=o?-e.end.column:e.start.column-e.end.column)&&(r.start.row==e.end.row&&r.start.column>e.end.column&&(r.start.column+=h),r.end.row==e.end.row&&r.end.column>e.end.column&&(r.end.column+=h)),o&&r.start.row>=e.end.row&&(r.start.row+=o,r.end.row+=o)}if(r.end=this.insert(r.start,n),s.length){var a=e.start,l=r.start,h=(o=l.row-a.row,l.column-a.column);this.addFolds(s.map((function(e){return(e=e.clone()).start.row==a.row&&(e.start.column+=h),e.end.row==a.row&&(e.end.column+=h),e.start.row+=o,e.end.row+=o,e})))}return r},this.indentRows=function(e,t,i){i=i.replace(/\t/g,this.getTabString());for(var n=e;n<=t;n++)this.doc.insertInLine({row:n,column:0},i)},this.outdentRows=function(e){for(var t=e.collapseRows(),i=new c(0,0,0,0),n=this.getTabSize(),s=t.start.row;s<=t.end.row;++s){var r=this.getLine(s);i.start.row=s,i.end.row=s;for(var o=0;o<n&&" "==r.charAt(o);++o);o<n&&"\t"==r.charAt(o)?(i.start.column=o,i.end.column=o+1):(i.start.column=0,i.end.column=o),this.remove(i)}},this.$moveLines=function(e,t,i){if(e=this.getRowFoldStart(e),t=this.getRowFoldEnd(t),i<0){if((s=this.getRowFoldStart(e+i))<0)return 0;var n=s-e}else if(i>0){var s;if((s=this.getRowFoldEnd(t+i))>this.doc.getLength()-1)return 0;n=s-t}else{e=this.$clipRowToDocument(e);n=(t=this.$clipRowToDocument(t))-e+1}var r=new c(e,0,t,Number.MAX_VALUE),o=this.getFoldsInRange(r).map((function(e){return(e=e.clone()).start.row+=n,e.end.row+=n,e})),a=0==i?this.doc.getLines(e,t):this.doc.removeFullLines(e,t);return this.doc.insertFullLines(e+n,a),o.length&&this.addFolds(o),n},this.moveLinesUp=function(e,t){return this.$moveLines(e,t,-1)},this.moveLinesDown=function(e,t){return this.$moveLines(e,t,1)},this.duplicateLines=function(e,t){return this.$moveLines(e,t,0)},this.$clipRowToDocument=function(e){return Math.max(0,Math.min(e,this.doc.getLength()-1))},this.$clipColumnToRow=function(e,t){return t<0?0:Math.min(this.doc.getLine(e).length,t)},this.$clipPositionToDocument=function(e,t){if(t=Math.max(0,t),e<0)e=0,t=0;else{var i=this.doc.getLength();e>=i?(e=i-1,t=this.doc.getLine(i-1).length):t=Math.min(this.doc.getLine(e).length,t)}return{row:e,column:t}},this.$clipRangeToDocument=function(e){e.start.row<0?(e.start.row=0,e.start.column=0):e.start.column=this.$clipColumnToRow(e.start.row,e.start.column);var t=this.doc.getLength()-1;return e.end.row>t?(e.end.row=t,e.end.column=this.doc.getLine(t).length):e.end.column=this.$clipColumnToRow(e.end.row,e.end.column),e},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(e){if(e!=this.$useWrapMode){if(this.$useWrapMode=e,this.$modified=!0,this.$resetRowCache(0),e){var t=this.getLength();this.$wrapData=Array(t),this.$updateWrapData(0,t-1)}this._signal("changeWrapMode")}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(e,t){this.$wrapLimitRange.min===e&&this.$wrapLimitRange.max===t||(this.$wrapLimitRange={min:e,max:t},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode"))},this.adjustWrapLimit=function(e,t){var i=this.$wrapLimitRange;i.max<0&&(i={min:t,max:t});var n=this.$constrainWrapLimit(e,i.min,i.max);return n!=this.$wrapLimit&&n>1&&(this.$wrapLimit=n,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0)},this.$constrainWrapLimit=function(e,t,i){return t&&(e=Math.max(t,e)),i&&(e=Math.min(i,e)),e},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(e){this.setWrapLimitRange(e,e)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(e){var t=this.$useWrapMode,i=e.action,n=e.start,s=e.end,r=n.row,o=s.row,a=o-r,l=null;if(this.$updating=!0,0!=a)if("remove"===i){this[t?"$wrapData":"$rowLengthCache"].splice(r,a);var h=this.$foldData;l=this.getFoldsInRange(e),this.removeFolds(l);var c=0;if(g=this.getFoldLine(s.row)){g.addRemoveChars(s.row,s.column,n.column-s.column),g.shiftRow(-a);var u=this.getFoldLine(r);u&&u!==g&&(u.merge(g),g=u),c=h.indexOf(g)+1}for(;c<h.length;c++){(g=h[c]).start.row>=s.row&&g.shiftRow(-a)}o=r}else{var d=Array(a);d.unshift(r,0);var f=t?this.$wrapData:this.$rowLengthCache;f.splice.apply(f,d);h=this.$foldData,c=0;if(g=this.getFoldLine(r)){var p=g.range.compareInside(n.row,n.column);0==p?(g=g.split(n.row,n.column))&&(g.shiftRow(a),g.addRemoveChars(o,0,s.column-n.column)):-1==p&&(g.addRemoveChars(r,0,s.column-n.column),g.shiftRow(a)),c=h.indexOf(g)+1}for(;c<h.length;c++){var g;(g=h[c]).start.row>=r&&g.shiftRow(a)}}else a=Math.abs(e.start.column-e.end.column),"remove"===i&&(l=this.getFoldsInRange(e),this.removeFolds(l),a=-a),(g=this.getFoldLine(r))&&g.addRemoveChars(r,n.column,a);return t&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,t?this.$updateWrapData(r,o):this.$updateRowLengthCache(r,o),l},this.$updateRowLengthCache=function(e,t,i){this.$rowLengthCache[e]=null,this.$rowLengthCache[t]=null},this.$updateWrapData=function(i,n){var s,r,o=this.doc.getAllLines(),a=this.getTabSize(),l=this.$wrapData,h=this.$wrapLimit,c=i;for(n=Math.min(n,o.length-1);c<=n;)(r=this.getFoldLine(c,r))?(s=[],r.walk(function(i,n,r,a){var l;if(null!=i){(l=this.$getDisplayTokens(i,s.length))[0]=e;for(var h=1;h<l.length;h++)l[h]=t}else l=this.$getDisplayTokens(o[n].substring(a,r),s.length);s=s.concat(l)}.bind(this),r.end.row,o[r.end.row].length+1),l[r.start.row]=this.$computeWrapSplits(s,h,a),c=r.end.row+1):(s=this.$getDisplayTokens(o[c]),l[c]=this.$computeWrapSplits(s,h,a),c++)};var e=3,t=4;function i(e){return!(e<4352)&&(e>=4352&&e<=4447||e>=4515&&e<=4519||e>=4602&&e<=4607||e>=9001&&e<=9002||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12283||e>=12288&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12589||e>=12593&&e<=12686||e>=12688&&e<=12730||e>=12736&&e<=12771||e>=12784&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=13054||e>=13056&&e<=19903||e>=19968&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=55216&&e<=55238||e>=55243&&e<=55291||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=65281&&e<=65376||e>=65504&&e<=65510)}this.$computeWrapSplits=function(i,n,s){if(0==i.length)return[];var r=[],o=i.length,a=0,l=0,h=this.$wrapAsCode,c=this.$indentedSoftWrap,u=n<=Math.max(2*s,8)||!1===c?0:Math.floor(n/2);function d(e){for(var t=e-a,n=a;n<e;n++){var o=i[n];12!==o&&2!==o||(t-=1)}r.length||(f=function(){var e=0;if(0===u)return e;if(c)for(var t=0;t<i.length;t++){var n=i[t];if(10==n)e+=1;else{if(11!=n){if(12==n)continue;break}e+=s}}return h&&!1!==c&&(e+=s),Math.min(e,u)}(),r.indent=f),l+=t,r.push(l),a=e}for(var f=0;o-a>n-f;){var p=a+n-f;if(i[p-1]>=10&&i[p]>=10)d(p);else if(i[p]!=e&&i[p]!=t){for(var g=Math.max(p-(n-(n>>2)),a-1);p>g&&i[p]<e;)p--;if(h){for(;p>g&&i[p]<e;)p--;for(;p>g&&9==i[p];)p--}else for(;p>g&&i[p]<10;)p--;p>g?d(++p):(2==i[p=a+n]&&p--,d(p-f))}else{for(;p!=a-1&&i[p]!=e;p--);if(p>a){d(p);continue}for(p=a+n;p<i.length&&i[p]==t;p++);if(p==i.length)break;d(p)}}return r},this.$getDisplayTokens=function(e,t){var n,s=[];t=t||0;for(var r=0;r<e.length;r++){var o=e.charCodeAt(r);if(9==o){n=this.getScreenTabSize(s.length+t),s.push(11);for(var a=1;a<n;a++)s.push(12)}else 32==o?s.push(10):o>39&&o<48||o>57&&o<64?s.push(9):o>=4352&&i(o)?s.push(1,2):s.push(1)}return s},this.$getStringScreenWidth=function(e,t,n){if(0==t)return[0,0];var s,r;for(null==t&&(t=1/0),n=n||0,r=0;r<e.length&&(9==(s=e.charCodeAt(r))?n+=this.getScreenTabSize(n):s>=4352&&i(s)?n+=2:n+=1,!(n>t));r++);return[n,r]},this.lineWidgets=null,this.getRowLength=function(e){var t=1;return this.lineWidgets&&(t+=this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0),this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+t:t},this.getRowLineCount=function(e){return this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1:1},this.getRowWrapIndent=function(e){if(this.$useWrapMode){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE),i=this.$wrapData[t.row];return i.length&&i[0]<t.column?i.indent:0}return 0},this.getScreenLastRowColumn=function(e){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE);return this.documentToScreenColumn(t.row,t.column)},this.getDocumentLastRowColumn=function(e,t){var i=this.documentToScreenRow(e,t);return this.getScreenLastRowColumn(i)},this.getDocumentLastRowColumnPosition=function(e,t){var i=this.documentToScreenRow(e,t);return this.screenToDocumentPosition(i,Number.MAX_VALUE/10)},this.getRowSplitData=function(e){return this.$useWrapMode?this.$wrapData[e]:void 0},this.getScreenTabSize=function(e){return this.$tabSize-(e%this.$tabSize|0)},this.screenToDocumentRow=function(e,t){return this.screenToDocumentPosition(e,t).row},this.screenToDocumentColumn=function(e,t){return this.screenToDocumentPosition(e,t).column},this.screenToDocumentPosition=function(e,t,i){if(e<0)return{row:0,column:0};var n,s,r=0,o=0,a=0,l=0,h=this.$screenRowCache,c=this.$getRowCacheIndex(h,e),u=h.length;if(u&&c>=0){a=h[c],r=this.$docRowCache[c];var d=e>h[u-1]}else d=!u;for(var f=this.getLength()-1,p=this.getNextFoldLine(r),g=p?p.start.row:1/0;a<=e&&!(a+(l=this.getRowLength(r))>e||r>=f);)a+=l,++r>g&&(r=p.end.row+1,g=(p=this.getNextFoldLine(r,p))?p.start.row:1/0),d&&(this.$docRowCache.push(r),this.$screenRowCache.push(a));if(p&&p.start.row<=r)n=this.getFoldDisplayLine(p),r=p.start.row;else{if(a+l<=e||r>f)return{row:f,column:this.getLine(f).length};n=this.getLine(r),p=null}var m=0,v=Math.floor(e-a);if(this.$useWrapMode){var w=this.$wrapData[r];w&&(s=w[v],v>0&&w.length&&(m=w.indent,o=w[v-1]||w[w.length-1],n=n.substring(o)))}return void 0!==i&&this.$bidiHandler.isBidiRow(a+v,r,v)&&(t=this.$bidiHandler.offsetToCol(i)),o+=this.$getStringScreenWidth(n,t-m)[1],this.$useWrapMode&&o>=s&&(o=s-1),p?p.idxToPosition(o):{row:r,column:o}},this.documentToScreenPosition=function(e,t){if(void 0===t)var i=this.$clipPositionToDocument(e.row,e.column);else i=this.$clipPositionToDocument(e,t);e=i.row,t=i.column;var n,s=0,r=null;(n=this.getFoldAt(e,t,1))&&(e=n.start.row,t=n.start.column);var o,a=0,l=this.$docRowCache,h=this.$getRowCacheIndex(l,e),c=l.length;if(c&&h>=0){a=l[h],s=this.$screenRowCache[h];var u=e>l[c-1]}else u=!c;for(var d=this.getNextFoldLine(a),f=d?d.start.row:1/0;a<e;){if(a>=f){if((o=d.end.row+1)>e)break;f=(d=this.getNextFoldLine(o,d))?d.start.row:1/0}else o=a+1;s+=this.getRowLength(a),a=o,u&&(this.$docRowCache.push(a),this.$screenRowCache.push(s))}var p="";d&&a>=f?(p=this.getFoldDisplayLine(d,e,t),r=d.start.row):(p=this.getLine(e).substring(0,t),r=e);var g=0;if(this.$useWrapMode){var m=this.$wrapData[r];if(m){for(var v=0;p.length>=m[v];)s++,v++;p=p.substring(m[v-1]||0,p.length),g=v>0?m.indent:0}}return this.lineWidgets&&this.lineWidgets[a]&&this.lineWidgets[a].rowsAbove&&(s+=this.lineWidgets[a].rowsAbove),{row:s,column:g+this.$getStringScreenWidth(p)[0]}},this.documentToScreenColumn=function(e,t){return this.documentToScreenPosition(e,t).column},this.documentToScreenRow=function(e,t){return this.documentToScreenPosition(e,t).row},this.getScreenLength=function(){var e=0,t=null;if(this.$useWrapMode)for(var i=this.$wrapData.length,n=0,s=(a=0,(t=this.$foldData[a++])?t.start.row:1/0);n<i;){var r=this.$wrapData[n];e+=r?r.length+1:1,++n>s&&(n=t.end.row+1,s=(t=this.$foldData[a++])?t.start.row:1/0)}else{e=this.getLength();for(var o=this.$foldData,a=0;a<o.length;a++)e-=(t=o[a]).end.row-t.start.row}return this.lineWidgets&&(e+=this.$getWidgetScreenLength()),e},this.$setFontMetrics=function(e){this.$enableVarChar&&(this.$getStringScreenWidth=function(t,i,n){if(0===i)return[0,0];var s,r;for(i||(i=1/0),n=n||0,r=0;r<t.length&&!((n+="\t"===(s=t.charAt(r))?this.getScreenTabSize(n):e.getCharacterWidth(s))>i);r++);return[n,r]})},this.destroy=function(){this.destroyed||(this.bgTokenizer.setDocument(null),this.bgTokenizer.cleanup(),this.destroyed=!0),this.$stopWorker(),this.removeAllListeners(),this.doc&&this.doc.off("change",this.$onChange),this.selection.detach()},this.isFullWidth=i}.call(p.prototype),e("./edit_session/folding").Folding.call(p.prototype),e("./edit_session/bracket_match").BracketMatch.call(p.prototype),o.defineOptions(p.prototype,"session",{wrap:{set:function(e){if(e&&"off"!=e?"free"==e?e=!0:"printMargin"==e?e=-1:"string"==typeof e&&(e=parseInt(e,10)||!1):e=!1,this.$wrap!=e)if(this.$wrap=e,e){var t="number"==typeof e?e:null;this.setWrapLimitRange(t,t),this.setUseWrapMode(!0)}else this.setUseWrapMode(!1)},get:function(){return this.getUseWrapMode()?-1==this.$wrap?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(e){(e="auto"==e?"text"!=this.$mode.type:"text"!=e)!=this.$wrapAsCode&&(this.$wrapAsCode=e,this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(e){this.$useWorker=e,this.$stopWorker(),e&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(e){(e=parseInt(e))>0&&this.$tabSize!==e&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=e,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(e){this.setFoldStyle(e)},handlesSet:!0},overwrite:{set:function(e){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(e){this.doc.setNewLineMode(e)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(e){this.setMode(e)},get:function(){return this.$modeId},handlesSet:!0}}),t.EditSession=p})),ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],(function(e,t,i){var n=e("./lib/lang"),s=e("./lib/oop"),r=e("./range").Range,o=function(){this.$options={}};(function(){this.set=function(e){return s.mixin(this.$options,e),this},this.getOptions=function(){return n.copyObject(this.$options)},this.setOptions=function(e){this.$options=e},this.find=function(e){var t=this.$options,i=this.$matchIterator(e,t);if(!i)return!1;var n=null;return i.forEach((function(e,i,s,o){return n=new r(e,i,s,o),!(i==o&&t.start&&t.start.start&&0!=t.skipCurrent&&n.isEqual(t.start))||(n=null,!1)})),n},this.findAll=function(e){var t=this.$options;if(!t.needle)return[];this.$assembleRegExp(t);var i=t.range,s=i?e.getLines(i.start.row,i.end.row):e.doc.getAllLines(),o=[],a=t.re;if(t.$isMultiLine){var l,h=a.length,c=s.length-h;e:for(var u=a.offset||0;u<=c;u++){for(var d=0;d<h;d++)if(-1==s[u+d].search(a[d]))continue e;var f=s[u],p=s[u+h-1],g=f.length-f.match(a[0])[0].length,m=p.match(a[h-1])[0].length;l&&l.end.row===u&&l.end.column>g||(o.push(l=new r(u,g,u+h-1,m)),h>2&&(u=u+h-2))}}else for(var v=0;v<s.length;v++){var w=n.getMatchOffsets(s[v],a);for(d=0;d<w.length;d++){var y=w[d];o.push(new r(v,y.offset,v,y.offset+y.length))}}if(i){var b=i.start.column,_=i.start.column;for(v=0,d=o.length-1;v<d&&o[v].start.column<b&&o[v].start.row==i.start.row;)v++;for(;v<d&&o[d].end.column>_&&o[d].end.row==i.end.row;)d--;for(o=o.slice(v,d+1),v=0,d=o.length;v<d;v++)o[v].start.row+=i.start.row,o[v].end.row+=i.start.row}return o},this.replace=function(e,t){var i=this.$options,n=this.$assembleRegExp(i);if(i.$isMultiLine)return t;if(n){var s=n.exec(e);if(!s||s[0].length!=e.length)return null;if(t=e.replace(n,t),i.preserveCase){t=t.split("");for(var r=Math.min(e.length,e.length);r--;){var o=e[r];o&&o.toLowerCase()!=o?t[r]=t[r].toUpperCase():t[r]=t[r].toLowerCase()}t=t.join("")}return t}},this.$assembleRegExp=function(e,t){if(e.needle instanceof RegExp)return e.re=e.needle;var i=e.needle;if(!e.needle)return e.re=!1;e.regExp||(i=n.escapeRegExp(i)),e.wholeWord&&(i=function(e,t){function i(e){return/\w/.test(e)||t.regExp?"\\b":""}return i(e[0])+e+i(e[e.length-1])}(i,e));var s=e.caseSensitive?"gm":"gmi";if(e.$isMultiLine=!t&&/[\n\r]/.test(i),e.$isMultiLine)return e.re=this.$assembleMultilineRegExp(i,s);try{var r=new RegExp(i,s)}catch(e){r=!1}return e.re=r},this.$assembleMultilineRegExp=function(e,t){for(var i=e.replace(/\r\n|\r|\n/g,"$\n^").split("\n"),n=[],s=0;s<i.length;s++)try{n.push(new RegExp(i[s],t))}catch(e){return!1}return n},this.$matchIterator=function(e,t){var i=this.$assembleRegExp(t);if(!i)return!1;var n=1==t.backwards,s=0!=t.skipCurrent,r=t.range,o=t.start;o||(o=r?r[n?"end":"start"]:e.selection.getRange()),o.start&&(o=o[s!=n?"end":"start"]);var a=r?r.start.row:0,l=r?r.end.row:e.getLength()-1;if(n)var h=function(e){var i=o.row;if(!u(i,o.column,e)){for(i--;i>=a;i--)if(u(i,Number.MAX_VALUE,e))return;if(0!=t.wrap)for(i=l,a=o.row;i>=a;i--)if(u(i,Number.MAX_VALUE,e))return}};else h=function(e){var i=o.row;if(!u(i,o.column,e)){for(i+=1;i<=l;i++)if(u(i,0,e))return;if(0!=t.wrap)for(i=a,l=o.row;i<=l;i++)if(u(i,0,e))return}};if(t.$isMultiLine)var c=i.length,u=function(t,s,r){var o=n?t-c+1:t;if(!(o<0||o+c>e.getLength())){var a=e.getLine(o),l=a.search(i[0]);if(!(!n&&l<s||-1===l)){for(var h=1;h<c;h++)if(-1==(a=e.getLine(o+h)).search(i[h]))return;var u=a.match(i[c-1])[0].length;if(!(n&&u>s))return!!r(o,l,o+c-1,u)||void 0}}};else if(n)u=function(t,n,s){var r,o=e.getLine(t),a=[],l=0;for(i.lastIndex=0;r=i.exec(o);){var h=r[0].length;if(l=r.index,!h){if(l>=o.length)break;i.lastIndex=l+=1}if(r.index+h>n)break;a.push(r.index,h)}for(var c=a.length-1;c>=0;c-=2){var u=a[c-1];if(s(t,u,t,u+(h=a[c])))return!0}};else u=function(t,n,s){var r,o,a=e.getLine(t);for(i.lastIndex=n;o=i.exec(a);){var l=o[0].length;if(s(t,r=o.index,t,r+l))return!0;if(!l&&(i.lastIndex=r+=1,r>=a.length))return!1}};return{forEach:h}}}).call(o.prototype),t.Search=o})),ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],(function(e,t,i){var n=e("../lib/keys"),s=e("../lib/useragent"),r=n.KEY_MODS;function o(e,t){this.platform=t||(s.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(e),this.$singleCommand=!0}function a(e,t){o.call(this,e,t),this.$singleCommand=!1}a.prototype=o.prototype,function(){function e(e){return"object"==typeof e&&e.bindKey&&e.bindKey.position||(e.isDefault?-100:0)}this.addCommand=function(e){this.commands[e.name]&&this.removeCommand(e),this.commands[e.name]=e,e.bindKey&&this._buildKeyHash(e)},this.removeCommand=function(e,t){var i=e&&("string"==typeof e?e:e.name);e=this.commands[i],t||delete this.commands[i];var n=this.commandKeyBinding;for(var s in n){var r=n[s];if(r==e)delete n[s];else if(Array.isArray(r)){var o=r.indexOf(e);-1!=o&&(r.splice(o,1),1==r.length&&(n[s]=r[0]))}}},this.bindKey=function(e,t,i){if("object"==typeof e&&e&&(null==i&&(i=e.position),e=e[this.platform]),e)return"function"==typeof t?this.addCommand({exec:t,bindKey:e,name:t.name||e}):void e.split("|").forEach((function(e){var n="";if(-1!=e.indexOf(" ")){var s=e.split(/\s+/);e=s.pop(),s.forEach((function(e){var t=this.parseKeys(e),i=r[t.hashId]+t.key;n+=(n?" ":"")+i,this._addCommandToBinding(n,"chainKeys")}),this),n+=" "}var o=this.parseKeys(e),a=r[o.hashId]+o.key;this._addCommandToBinding(n+a,t,i)}),this)},this._addCommandToBinding=function(t,i,n){var s,r=this.commandKeyBinding;if(i)if(!r[t]||this.$singleCommand)r[t]=i;else{Array.isArray(r[t])?-1!=(s=r[t].indexOf(i))&&r[t].splice(s,1):r[t]=[r[t]],"number"!=typeof n&&(n=e(i));var o=r[t];for(s=0;s<o.length;s++){if(e(o[s])>n)break}o.splice(s,0,i)}else delete r[t]},this.addCommands=function(e){e&&Object.keys(e).forEach((function(t){var i=e[t];if(i){if("string"==typeof i)return this.bindKey(i,t);"function"==typeof i&&(i={exec:i}),"object"==typeof i&&(i.name||(i.name=t),this.addCommand(i))}}),this)},this.removeCommands=function(e){Object.keys(e).forEach((function(t){this.removeCommand(e[t])}),this)},this.bindKeys=function(e){Object.keys(e).forEach((function(t){this.bindKey(t,e[t])}),this)},this._buildKeyHash=function(e){this.bindKey(e.bindKey,e)},this.parseKeys=function(e){var t=e.toLowerCase().split(/[\-\+]([\-\+])?/).filter((function(e){return e})),i=t.pop(),s=n[i];if(n.FUNCTION_KEYS[s])i=n.FUNCTION_KEYS[s].toLowerCase();else{if(!t.length)return{key:i,hashId:-1};if(1==t.length&&"shift"==t[0])return{key:i.toUpperCase(),hashId:-1}}for(var r=0,o=t.length;o--;){var a=n.KEY_MODS[t[o]];if(null==a)return"undefined"!=typeof console&&console.error("invalid modifier "+t[o]+" in "+e),!1;r|=a}return{key:i,hashId:r}},this.findKeyCommand=function(e,t){var i=r[e]+t;return this.commandKeyBinding[i]},this.handleKeyboard=function(e,t,i,n){if(!(n<0)){var s=r[t]+i,o=this.commandKeyBinding[s];return e.$keyChain&&(e.$keyChain+=" "+s,o=this.commandKeyBinding[e.$keyChain]||o),!o||"chainKeys"!=o&&"chainKeys"!=o[o.length-1]?(e.$keyChain&&(t&&4!=t||1!=i.length?(-1==t||n>0)&&(e.$keyChain=""):e.$keyChain=e.$keyChain.slice(0,-s.length-1)),{command:o}):(e.$keyChain=e.$keyChain||s,{command:"null"})}},this.getStatusText=function(e,t){return t.$keyChain||""}}.call(o.prototype),t.HashHandler=o,t.MultiHashHandler=a})),ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],(function(e,t,i){var n=e("../lib/oop"),s=e("../keyboard/hash_handler").MultiHashHandler,r=e("../lib/event_emitter").EventEmitter,o=function(e,t){s.call(this,t,e),this.byName=this.commands,this.setDefaultHandler("exec",(function(e){return e.args?e.command.exec(e.editor,e.args,e.event,!1):e.command.exec(e.editor,{},e.event,!0)}))};n.inherits(o,s),function(){n.implement(this,r),this.exec=function(e,t,i){if(Array.isArray(e)){for(var n=e.length;n--;)if(this.exec(e[n],t,i))return!0;return!1}if("string"==typeof e&&(e=this.commands[e]),!e)return!1;if(t&&t.$readOnly&&!e.readOnly)return!1;if(0!=this.$checkCommandState&&e.isAvailable&&!e.isAvailable(t))return!1;var s={editor:t,command:e,args:i};return s.returnValue=this._emit("exec",s),this._signal("afterExec",s),!1!==s.returnValue},this.toggleRecording=function(e){if(!this.$inReplay)return e&&e._emit("changeStatus"),this.recording?(this.macro.pop(),this.off("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0)},this.replay=function(e){if(!this.$inReplay&&this.macro){if(this.recording)return this.toggleRecording(e);try{this.$inReplay=!0,this.macro.forEach((function(t){"string"==typeof t?this.exec(t,e):this.exec(t[0],e,t[1])}),this)}finally{this.$inReplay=!1}}},this.trimMacro=function(e){return e.map((function(e){return"string"!=typeof e[0]&&(e[0]=e[0].name),e[1]||(e=e[0]),e}))}}.call(o.prototype),t.CommandManager=o})),ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],(function(e,t,i){var n=e("../lib/lang"),s=e("../config"),r=e("../range").Range;function o(e,t){return{win:e,mac:t}}t.commands=[{name:"showSettingsMenu",description:"Show settings menu",bindKey:o("Ctrl-,","Command-,"),exec:function(e){s.loadModule("ace/ext/settings_menu",(function(t){t.init(e),e.showSettingsMenu()}))},readOnly:!0},{name:"goToNextError",description:"Go to next error",bindKey:o("Alt-E","F4"),exec:function(e){s.loadModule("./ext/error_marker",(function(t){t.showErrorMarker(e,1)}))},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",description:"Go to previous error",bindKey:o("Alt-Shift-E","Shift-F4"),exec:function(e){s.loadModule("./ext/error_marker",(function(t){t.showErrorMarker(e,-1)}))},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:o("Ctrl-A","Command-A"),exec:function(e){e.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:o(null,"Ctrl-L"),exec:function(e){e.centerSelection()},readOnly:!0},{name:"gotoline",description:"Go to line...",bindKey:o("Ctrl-L","Command-L"),exec:function(e,t){"number"!=typeof t||isNaN(t)||e.gotoLine(t),e.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:o("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(e){e.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:o("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(e){e.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",description:"Toggle fold widget",bindKey:o("F2","F2"),exec:function(e){e.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",description:"Toggle parent fold widget",bindKey:o("Alt-F2","Alt-F2"),exec:function(e){e.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:o(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldAllComments",description:"Fold all comments",bindKey:o(null,"Ctrl-Command-Option-0"),exec:function(e){e.session.foldAllComments()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:o("Alt-0","Command-Option-0"),exec:function(e){e.session.foldAll(),e.session.unfold(e.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:o("Alt-Shift-0","Command-Option-Shift-0"),exec:function(e){e.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:o("Ctrl-K","Command-G"),exec:function(e){e.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:o("Ctrl-Shift-K","Command-Shift-G"),exec:function(e){e.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:o("Alt-K","Ctrl-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:o("Alt-Shift-K","Ctrl-Shift-G"),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:o("Ctrl-F","Command-F"),exec:function(e){s.loadModule("ace/ext/searchbox",(function(t){t.Search(e)}))},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(e){e.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:o("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:o("Ctrl-Home","Command-Home|Command-Up"),exec:function(e){e.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:o("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(e){e.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",description:"Go line up",bindKey:o("Up","Up|Ctrl-P"),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:o("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:o("Ctrl-End","Command-End|Command-Down"),exec:function(e){e.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:o("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(e){e.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:o("Down","Down|Ctrl-N"),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:o("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(e){e.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:o("Ctrl-Left","Option-Left"),exec:function(e){e.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",bindKey:o("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:o("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(e){e.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:o("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:o("Left","Left|Ctrl-B"),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:o("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(e){e.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",bindKey:o("Ctrl-Right","Option-Right"),exec:function(e){e.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:o("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:o("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(e){e.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:o("Shift-Right","Shift-Right"),exec:function(e){e.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:o("Right","Right|Ctrl-F"),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",bindKey:"Shift-PageDown",exec:function(e){e.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:o(null,"Option-PageDown"),exec:function(e){e.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:o("PageDown","PageDown|Ctrl-V"),exec:function(e){e.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(e){e.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:o(null,"Option-PageUp"),exec:function(e){e.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(e){e.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:o("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:o("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",description:"Select line start",bindKey:"Shift-Home",exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:o("Ctrl-Alt-E","Command-Option-E"),exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:o("Ctrl-Shift-E","Command-Shift-E"),exec:function(e){e.commands.replay(e)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:o("Ctrl-\\|Ctrl-P","Command-\\"),exec:function(e){e.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:o("Ctrl-Shift-\\|Ctrl-Shift-P","Command-Shift-\\"),exec:function(e){e.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:o("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(e){e.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:o(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(e){},readOnly:!0},{name:"cut",description:"Cut",exec:function(e){var t=e.$copyWithEmptySelection&&e.selection.isEmpty()?e.selection.getLineRange():e.selection.getRange();e._emit("cut",t),t.isEmpty()||e.session.remove(t),e.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(e,t){e.$handlePaste(t)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:o("Ctrl-D","Command-D"),exec:function(e){e.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",description:"Duplicate selection",bindKey:o("Ctrl-Shift-D","Command-Shift-D"),exec:function(e){e.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:o("Ctrl-Alt-S","Command-Alt-S"),exec:function(e){e.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:o("Ctrl-/","Command-/"),exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:o("Ctrl-Shift-/","Command-Shift-/"),exec:function(e){e.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:o("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(e){e.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:o("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(e){e.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:o("Ctrl-H","Command-Option-F"),exec:function(e){s.loadModule("ace/ext/searchbox",(function(t){t.Search(e,!0)}))}},{name:"undo",description:"Undo",bindKey:o("Ctrl-Z","Command-Z"),exec:function(e){e.undo()}},{name:"redo",description:"Redo",bindKey:o("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(e){e.redo()}},{name:"copylinesup",description:"Copy lines up",bindKey:o("Alt-Shift-Up","Command-Option-Up"),exec:function(e){e.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:o("Alt-Up","Option-Up"),exec:function(e){e.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:o("Alt-Shift-Down","Command-Option-Down"),exec:function(e){e.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:o("Alt-Down","Option-Down"),exec:function(e){e.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:o("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(e){e.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:o("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(e){e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:o("Shift-Delete",null),exec:function(e){if(!e.selection.isEmpty())return!1;e.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:o("Alt-Backspace","Command-Backspace"),exec:function(e){e.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:o("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(e){e.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",bindKey:o("Ctrl-Shift-Backspace",null),exec:function(e){var t=e.selection.getRange();t.start.column=0,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:o("Ctrl-Shift-Delete",null),exec:function(e){var t=e.selection.getRange();t.end.column=Number.MAX_VALUE,e.session.remove(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:o("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(e){e.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:o("Ctrl-Delete","Alt-Delete"),exec:function(e){e.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:o("Shift-Tab","Shift-Tab"),exec:function(e){e.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",bindKey:o("Tab","Tab"),exec:function(e){e.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:o("Ctrl-[","Ctrl-["),exec:function(e){e.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:o("Ctrl-]","Ctrl-]"),exec:function(e){e.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",exec:function(e,t){e.insert(t)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(e,t){e.insert(n.stringRepeat(t.text||"",t.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:o(null,"Ctrl-O"),exec:function(e){e.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:o("Alt-Shift-X","Ctrl-T"),exec:function(e){e.transposeLetters()},multiSelectAction:function(e){e.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:o("Ctrl-U","Ctrl-U"),exec:function(e){e.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:o("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(e){e.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"autoindent",description:"Auto Indent",bindKey:o(null,null),exec:function(e){e.autoIndent()},multiSelectAction:"forEachLine",scrollIntoView:"animate"},{name:"expandtoline",description:"Expand to line",bindKey:o("Ctrl-Shift-L","Command-Shift-L"),exec:function(e){var t=e.selection.getRange();t.start.column=t.end.column=0,t.end.row++,e.selection.setRange(t,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"joinlines",description:"Join lines",bindKey:o(null,null),exec:function(e){for(var t=e.selection.isBackwards(),i=t?e.selection.getSelectionLead():e.selection.getSelectionAnchor(),s=t?e.selection.getSelectionAnchor():e.selection.getSelectionLead(),o=e.session.doc.getLine(i.row).length,a=e.session.doc.getTextRange(e.selection.getRange()).replace(/\n\s*/," ").length,l=e.session.doc.getLine(i.row),h=i.row+1;h<=s.row+1;h++){var c=n.stringTrimLeft(n.stringTrimRight(e.session.doc.getLine(h)));0!==c.length&&(c=" "+c),l+=c}s.row+1<e.session.doc.getLength()-1&&(l+=e.session.doc.getNewLineCharacter()),e.clearSelection(),e.session.doc.replace(new r(i.row,0,s.row+2,0),l),a>0?(e.selection.moveCursorTo(i.row,i.column),e.selection.selectTo(i.row,i.column+a)):(o=e.session.doc.getLine(i.row).length>o?o+1:o,e.selection.moveCursorTo(i.row,o))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:o(null,null),exec:function(e){var t=e.session.doc.getLength()-1,i=e.session.doc.getLine(t).length,n=e.selection.rangeList.ranges,s=[];n.length<1&&(n=[e.selection.getRange()]);for(var o=0;o<n.length;o++)o==n.length-1&&(n[o].end.row===t&&n[o].end.column===i||s.push(new r(n[o].end.row,n[o].end.column,t,i))),0===o?0===n[o].start.row&&0===n[o].start.column||s.push(new r(0,0,n[o].start.row,n[o].start.column)):s.push(new r(n[o-1].end.row,n[o-1].end.column,n[o].start.row,n[o].start.column));e.exitMultiSelectMode(),e.clearSelection();for(o=0;o<s.length;o++)e.selection.addRange(s[o],!1)},readOnly:!0,scrollIntoView:"none"},{name:"addLineAfter",description:"Add new line after the current line",exec:function(e){e.selection.clearSelection(),e.navigateLineEnd(),e.insert("\n")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"addLineBefore",description:"Add new line before the current line",exec:function(e){e.selection.clearSelection();var t=e.getCursorPosition();e.selection.moveTo(t.row-1,Number.MAX_VALUE),e.insert("\n"),0===t.row&&e.navigateUp()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"openCommandPallete",description:"Open command pallete",bindKey:o("F1","F1"),exec:function(e){e.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:o(null,null),exec:function(e){e.prompt({$type:"modes"})},readOnly:!0}];for(var a=1;a<9;a++)t.commands.push({name:"foldToLevel"+a,description:"Fold To Level "+a,level:a,exec:function(e){e.session.foldToLevel(this.level)},scrollIntoView:"center",readOnly:!0})})),ace.define("ace/editor",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator","ace/clipboard"],(function(e,t,i){e("./lib/fixoldbrowsers");var n=e("./lib/oop"),s=e("./lib/dom"),r=e("./lib/lang"),o=e("./lib/useragent"),a=e("./keyboard/textinput").TextInput,l=e("./mouse/mouse_handler").MouseHandler,h=e("./mouse/fold_handler").FoldHandler,c=e("./keyboard/keybinding").KeyBinding,u=e("./edit_session").EditSession,d=e("./search").Search,f=e("./range").Range,p=e("./lib/event_emitter").EventEmitter,g=e("./commands/command_manager").CommandManager,m=e("./commands/default_commands").commands,v=e("./config"),w=e("./token_iterator").TokenIterator,y=e("./clipboard"),b=function(e,t,i){this.$toDestroy=[];var n=e.getContainerElement();this.container=n,this.renderer=e,this.id="editor"+ ++b.$uid,this.commands=new g(o.isMac?"mac":"win",m),"object"==typeof document&&(this.textInput=new a(e.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new l(this),new h(this)),this.keyBinding=new c(this),this.$search=(new d).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=r.delayedCall(function(){this._signal("input",{}),this.session&&!this.session.destroyed&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",(function(e,t){t._$emitInputEvent.schedule(31)})),this.setSession(t||i&&i.session||new u("")),v.resetOptions(this),i&&this.setOptions(i),v._signal("editor",this)};b.$uid=0,function(){n.implement(this,p),this.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0),this.commands.on("afterExec",this.endOperation.bind(this),!0),this.$opResetTimer=r.delayedCall(this.endOperation.bind(this,!0)),this.on("change",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.docChanged=!0}.bind(this),!0),this.on("changeSelection",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(e){if(this.curOp){if(!e||this.curOp.command)return;this.prevOp=this.curOp}e||(this.previousCommand=null,e={}),this.$opResetTimer.schedule(),this.curOp=this.session.curOp={command:e.command||{},args:e.args,scrollTop:this.renderer.scrollTop},this.curOp.selectionBefore=this.selection.toJSON()},this.endOperation=function(e){if(this.curOp&&this.session){if(e&&!1===e.returnValue||!this.session)return this.curOp=null;if(1==e&&this.curOp.command&&"mouse"==this.curOp.command.name)return;if(this._signal("beforeEndOperation"),!this.curOp)return;var t=this.curOp.command,i=t&&t.scrollIntoView;if(i){switch(i){case"center-animate":i="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var n=this.selection.getRange(),s=this.renderer.layerConfig;(n.start.row>=s.lastRow||n.end.row<=s.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}"animate"==i&&this.renderer.animateScrolling(this.curOp.scrollTop)}var r=this.selection.toJSON();this.curOp.selectionAfter=r,this.$lastSel=this.selection.toJSON(),this.session.getUndoManager().addSelection(r),this.prevOp=this.curOp,this.curOp=null}},this.$mergeableCommands=["backspace","del","insertstring"],this.$historyTracker=function(e){if(this.$mergeUndoDeltas){var t=this.prevOp,i=this.$mergeableCommands,n=t.command&&e.command.name==t.command.name;if("insertstring"==e.command.name){var s=e.args;void 0===this.mergeNextCommand&&(this.mergeNextCommand=!0),n=n&&this.mergeNextCommand&&(!/\s/.test(s)||/\s/.test(t.args)),this.mergeNextCommand=!0}else n=n&&-1!==i.indexOf(e.command.name);"always"!=this.$mergeUndoDeltas&&Date.now()-this.sequenceStartTime>2e3&&(n=!1),n?this.session.mergeUndoDeltas=!0:-1!==i.indexOf(e.command.name)&&(this.sequenceStartTime=Date.now())}},this.setKeyboardHandler=function(e,t){if(e&&"string"==typeof e&&"ace"!=e){this.$keybindingId=e;var i=this;v.loadModule(["keybinding",e],(function(n){i.$keybindingId==e&&i.keyBinding.setKeyboardHandler(n&&n.handler),t&&t()}))}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(e),t&&t()},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(e){if(this.session!=e){this.curOp&&this.endOperation(),this.curOp={};var t=this.session;if(t){this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange);var i=this.session.getSelection();i.off("changeCursor",this.$onCursorChange),i.off("changeSelection",this.$onSelectionChange)}this.session=e,e?(this.$onDocumentChange=this.onDocumentChange.bind(this),e.on("change",this.$onDocumentChange),this.renderer.setSession(e),this.$onChangeMode=this.onChangeMode.bind(this),e.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),e.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),e.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),e.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),e.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),e.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=e.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(e)),this._signal("changeSession",{session:e,oldSession:t}),this.curOp=null,t&&t._signal("changeEditor",{oldEditor:this}),e&&e._signal("changeEditor",{editor:this}),e&&!e.destroyed&&e.bgTokenizer.scheduleStart()}},this.getSession=function(){return this.session},this.setValue=function(e,t){return this.session.doc.setValue(e),t?1==t?this.navigateFileEnd():-1==t&&this.navigateFileStart():this.selectAll(),e},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(e){this.renderer.onResize(e)},this.setTheme=function(e,t){this.renderer.setTheme(e,t)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(e){this.renderer.setStyle(e)},this.unsetStyle=function(e){this.renderer.unsetStyle(e)},this.getFontSize=function(){return this.getOption("fontSize")||s.computedStyle(this.container).fontSize},this.setFontSize=function(e){this.setOption("fontSize",e)},this.$highlightBrackets=function(){if(!this.$highlightPending){var e=this;this.$highlightPending=!0,setTimeout((function(){e.$highlightPending=!1;var t=e.session;if(t&&!t.destroyed){t.$bracketHighlight&&(t.$bracketHighlight.markerIds.forEach((function(e){t.removeMarker(e)})),t.$bracketHighlight=null);var i=t.getMatchingBracketRanges(e.getCursorPosition());if(!i&&t.$mode.getMatching&&(i=t.$mode.getMatching(e.session)),i){var n="ace_bracket";Array.isArray(i)?1==i.length&&(n="ace_error_bracket"):i=[i],2==i.length&&(0==f.comparePoints(i[0].end,i[1].start)?i=[f.fromPoints(i[0].start,i[1].end)]:0==f.comparePoints(i[0].start,i[1].end)&&(i=[f.fromPoints(i[1].start,i[0].end)])),t.$bracketHighlight={ranges:i,markerIds:i.map((function(e){return t.addMarker(e,n,"text")}))}}}}),50)}},this.$highlightTags=function(){if(!this.$highlightTagPending){var e=this;this.$highlightTagPending=!0,setTimeout((function(){e.$highlightTagPending=!1;var t=e.session;if(t&&!t.destroyed){var i=e.getCursorPosition(),n=new w(e.session,i.row,i.column),s=n.getCurrentToken();if(!s||!/\b(?:tag-open|tag-name)/.test(s.type))return t.removeMarker(t.$tagHighlight),void(t.$tagHighlight=null);if(-1===s.type.indexOf("tag-open")||(s=n.stepForward())){var r=s.value,o=s.value,a=0,l=n.stepBackward();if("<"===l.value)do{l=s,(s=n.stepForward())&&(-1!==s.type.indexOf("tag-name")?r===(o=s.value)&&("<"===l.value?a++:"</"===l.value&&a--):r===o&&"/>"===s.value&&a--)}while(s&&a>=0);else{do{if(s=l,l=n.stepBackward(),s)if(-1!==s.type.indexOf("tag-name"))r===s.value&&("<"===l.value?a++:"</"===l.value&&a--);else if("/>"===s.value){for(var h=0,c=l;c;){if(-1!==c.type.indexOf("tag-name")&&c.value===r){a--;break}if("<"===c.value)break;c=n.stepBackward(),h++}for(var u=0;u<h;u++)n.stepForward()}}while(l&&a<=0);n.stepForward()}if(!s)return t.removeMarker(t.$tagHighlight),void(t.$tagHighlight=null);var d=n.getCurrentTokenRow(),p=n.getCurrentTokenColumn(),g=new f(d,p,d,p+s.value.length),m=t.$backMarkers[t.$tagHighlight];t.$tagHighlight&&null!=m&&0!==g.compareRange(m.range)&&(t.removeMarker(t.$tagHighlight),t.$tagHighlight=null),t.$tagHighlight||(t.$tagHighlight=t.addMarker(g,"ace_bracket","text"))}}}),50)}},this.focus=function(){this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(e){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",e))},this.onBlur=function(e){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",e))},this.$cursorChange=function(){this.renderer.updateCursor(),this.$highlightBrackets(),this.$highlightTags(),this.$updateHighlightActiveLine()},this.onDocumentChange=function(e){var t=this.session.$useWrapMode,i=e.start.row==e.end.row?e.end.row:1/0;this.renderer.updateLines(e.start.row,i,t),this._signal("change",e),this.$cursorChange()},this.onTokenizerUpdate=function(e){var t=e.data;this.renderer.updateLines(t.first,t.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this._signal("changeSelection")},this.$updateHighlightActiveLine=function(){var e,t=this.getSession();if(this.$highlightActiveLine&&("line"==this.$selectionStyle&&this.selection.isMultiLine()||(e=this.getCursorPosition()),this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(e=!1),!this.renderer.$maxLines||1!==this.session.getLength()||this.renderer.$minLines>1||(e=!1)),t.$highlightLineMarker&&!e)t.removeMarker(t.$highlightLineMarker.id),t.$highlightLineMarker=null;else if(!t.$highlightLineMarker&&e){var i=new f(e.row,e.column,e.row,1/0);i.id=t.addMarker(i,"ace_active-line","screenLine"),t.$highlightLineMarker=i}else e&&(t.$highlightLineMarker.start.row=e.row,t.$highlightLineMarker.end.row=e.row,t.$highlightLineMarker.start.column=e.column,t._signal("changeBackMarker"))},this.onSelectionChange=function(e){var t=this.session;if(t.$selectionMarker&&t.removeMarker(t.$selectionMarker),t.$selectionMarker=null,this.selection.isEmpty())this.$updateHighlightActiveLine();else{var i=this.selection.getRange(),n=this.getSelectionStyle();t.$selectionMarker=t.addMarker(i,"ace_selection",n)}var s=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(s),this._signal("changeSelection")},this.$getSelectionHighLightRegexp=function(){var e=this.session,t=this.getSelectionRange();if(!t.isEmpty()&&!t.isMultiLine()){var i=t.start.column,n=t.end.column,s=e.getLine(t.start.row),r=s.substring(i,n);if(!(r.length>5e3)&&/[\w\d]/.test(r)){var o=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:r}),a=s.substring(i-1,n+1);if(o.test(a))return o}}},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit("changeMode",e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var e=this.getSelectedText(),t=this.session.doc.getNewLineCharacter(),i=!1;if(!e&&this.$copyWithEmptySelection){i=!0;for(var n=this.selection.getAllRanges(),s=0;s<n.length;s++){var r=n[s];s&&n[s-1].start.row==r.start.row||(e+=this.session.getLine(r.start.row)+t)}}var o={text:e};return this._signal("copy",o),y.lineMode=!!i&&o.text,o.text},this.onCopy=function(){this.commands.exec("copy",this)},this.onCut=function(){this.commands.exec("cut",this)},this.onPaste=function(e,t){var i={text:e,event:t};this.commands.exec("paste",this,i)},this.$handlePaste=function(e){"string"==typeof e&&(e={text:e}),this._signal("paste",e);var t=e.text,i=t===y.lineMode,n=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)i?n.insert({row:this.selection.lead.row,column:0},t):this.insert(t);else if(i)this.selection.rangeList.ranges.forEach((function(e){n.insert({row:e.start.row,column:0},t)}));else{var s=t.split(/\r\n|\r|\n/),r=this.selection.rangeList.ranges,o=!(2!=s.length||s[0]&&s[1]);if(s.length!=r.length||o)return this.commands.exec("insertstring",this,t);for(var a=r.length;a--;){var l=r[a];l.isEmpty()||n.remove(l),n.insert(l.start,s[a])}}},this.execCommand=function(e,t){return this.commands.exec(e,this,t)},this.insert=function(e,t){var i=this.session,n=i.getMode(),s=this.getCursorPosition();if(this.getBehavioursEnabled()&&!t){var r=n.transformAction(i.getState(s.row),"insertion",this,i,e);r&&(e!==r.text&&(this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1)),e=r.text)}if("\t"==e&&(e=this.session.getTabString()),this.selection.isEmpty()){if(this.session.getOverwrite()&&-1==e.indexOf("\n")){(o=new f.fromPoints(s,s)).end.column+=e.length,this.session.remove(o)}}else{var o=this.getSelectionRange();s=this.session.remove(o),this.clearSelection()}if("\n"==e||"\r\n"==e){var a=i.getLine(s.row);if(s.column>a.search(/\S|$/)){var l=a.substr(s.column).search(/\S|$/);i.doc.removeInLine(s.row,s.column,s.column+l)}}this.clearSelection();var h=s.column,c=i.getState(s.row),u=(a=i.getLine(s.row),n.checkOutdent(c,a,e));if(i.insert(s,e),r&&r.selection&&(2==r.selection.length?this.selection.setSelectionRange(new f(s.row,h+r.selection[0],s.row,h+r.selection[1])):this.selection.setSelectionRange(new f(s.row+r.selection[0],r.selection[1],s.row+r.selection[2],r.selection[3]))),this.$enableAutoIndent){if(i.getDocument().isNewLine(e)){var d=n.getNextLineIndent(c,a.slice(0,s.column),i.getTabString());i.insert({row:s.row+1,column:0},d)}u&&n.autoOutdent(c,i,s.row)}},this.autoIndent=function(){var e,t,i=this.session,n=i.getMode();if(this.selection.isEmpty())e=0,t=i.doc.getLength()-1;else{var s=this.getSelectionRange();e=s.start.row,t=s.end.row}for(var r,o,a,l="",h="",c="",u=i.getTabString(),d=e;d<=t;d++)d>0&&(l=i.getState(d-1),h=i.getLine(d-1),c=n.getNextLineIndent(l,h,u)),r=i.getLine(d),c!==(o=n.$getIndent(r))&&(o.length>0&&(a=new f(d,0,d,o.length),i.remove(a)),c.length>0&&i.insert({row:d,column:0},c)),n.autoOutdent(l,i,d)},this.onTextInput=function(e,t){if(!t)return this.keyBinding.onTextInput(e);this.startOperation({command:{name:"insertstring"}});var i=this.applyComposition.bind(this,e,t);this.selection.rangeCount?this.forEachSelection(i):i(),this.endOperation()},this.applyComposition=function(e,t){var i;(t.extendLeft||t.extendRight)&&((i=this.selection.getRange()).start.column-=t.extendLeft,i.end.column+=t.extendRight,i.start.column<0&&(i.start.row--,i.start.column+=this.session.getLine(i.start.row).length+1),this.selection.setRange(i),e||i.isEmpty()||this.remove());(!e&&this.selection.isEmpty()||this.insert(e,!0),t.restoreStart||t.restoreEnd)&&((i=this.selection.getRange()).start.column-=t.restoreStart,i.end.column-=t.restoreEnd,this.selection.setRange(i))},this.onCommandKey=function(e,t,i){return this.keyBinding.onCommandKey(e,t,i)},this.setOverwrite=function(e){this.session.setOverwrite(e)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(e){this.setOption("scrollSpeed",e)},this.getScrollSpeed=function(){return this.getOption("scrollSpeed")},this.setDragDelay=function(e){this.setOption("dragDelay",e)},this.getDragDelay=function(){return this.getOption("dragDelay")},this.setSelectionStyle=function(e){this.setOption("selectionStyle",e)},this.getSelectionStyle=function(){return this.getOption("selectionStyle")},this.setHighlightActiveLine=function(e){this.setOption("highlightActiveLine",e)},this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.setHighlightSelectedWord=function(e){this.setOption("highlightSelectedWord",e)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(e){this.renderer.setAnimatedScroll(e)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(e){this.renderer.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(e){this.renderer.setDisplayIndentGuides(e)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setShowPrintMargin=function(e){this.renderer.setShowPrintMargin(e)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(e){this.renderer.setPrintMarginColumn(e)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(e){this.setOption("readOnly",e)},this.getReadOnly=function(){return this.getOption("readOnly")},this.setBehavioursEnabled=function(e){this.setOption("behavioursEnabled",e)},this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},this.setWrapBehavioursEnabled=function(e){this.setOption("wrapBehavioursEnabled",e)},this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},this.setShowFoldWidgets=function(e){this.setOption("showFoldWidgets",e)},this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.remove=function(e){this.selection.isEmpty()&&("left"==e?this.selection.selectLeft():this.selection.selectRight());var t=this.getSelectionRange();if(this.getBehavioursEnabled()){var i=this.session,n=i.getState(t.start.row),s=i.getMode().transformAction(n,"deletion",this,i,t);if(0===t.end.column){var r=i.getTextRange(t);if("\n"==r[r.length-1]){var o=i.getLine(t.end.row);/^\s+$/.test(o)&&(t.end.column=o.length)}}s&&(t=s)}this.session.remove(t),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var e=this.getSelectionRange();e.start.column==e.end.column&&e.start.row==e.end.row&&(e.end.column=0,e.end.row++),this.session.remove(e),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var e=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(e)},this.transposeLetters=function(){if(this.selection.isEmpty()){var e=this.getCursorPosition(),t=e.column;if(0!==t){var i,n,s=this.session.getLine(e.row);t<s.length?(i=s.charAt(t)+s.charAt(t-1),n=new f(e.row,t-1,e.row,t+1)):(i=s.charAt(t-1)+s.charAt(t-2),n=new f(e.row,t-2,e.row,t)),this.session.replace(n,i),this.session.selection.moveToPosition(n.end)}}},this.toLowerCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),i=this.session.getTextRange(t);this.session.replace(t,i.toLowerCase()),this.selection.setSelectionRange(e)},this.toUpperCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var t=this.getSelectionRange(),i=this.session.getTextRange(t);this.session.replace(t,i.toUpperCase()),this.selection.setSelectionRange(e)},this.indent=function(){var e=this.session,t=this.getSelectionRange();if(!(t.start.row<t.end.row)){if(t.start.column<t.end.column){var i=e.getTextRange(t);if(!/^\s+$/.test(i)){c=this.$getSelectedRows();return void e.indentRows(c.first,c.last,"\t")}}var n=e.getLine(t.start.row),s=t.start,o=e.getTabSize(),a=e.documentToScreenColumn(s.row,s.column);if(this.session.getUseSoftTabs())var l=o-a%o,h=r.stringRepeat(" ",l);else{for(l=a%o;" "==n[t.start.column-1]&&l;)t.start.column--,l--;this.selection.setSelectionRange(t),h="\t"}return this.insert(h)}var c=this.$getSelectedRows();e.indentRows(c.first,c.last,"\t")},this.blockIndent=function(){var e=this.$getSelectedRows();this.session.indentRows(e.first,e.last,"\t")},this.blockOutdent=function(){var e=this.session.getSelection();this.session.outdentRows(e.getRange())},this.sortLines=function(){for(var e=this.$getSelectedRows(),t=this.session,i=[],n=e.first;n<=e.last;n++)i.push(t.getLine(n));i.sort((function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0}));var s=new f(0,0,0,0);for(n=e.first;n<=e.last;n++){var r=t.getLine(n);s.start.row=n,s.end.row=n,s.end.column=r.length,t.replace(s,i[n-e.first])}},this.toggleCommentLines=function(){var e=this.session.getState(this.getCursorPosition().row),t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(e,this.session,t.first,t.last)},this.toggleBlockComment=function(){var e=this.getCursorPosition(),t=this.session.getState(e.row),i=this.getSelectionRange();this.session.getMode().toggleBlockComment(t,this.session,i,e)},this.getNumberAt=function(e,t){var i=/[\-]?[0-9]+(?:\.[0-9]+)?/g;i.lastIndex=0;for(var n=this.session.getLine(e);i.lastIndex<t;){var s=i.exec(n);if(s.index<=t&&s.index+s[0].length>=t)return{value:s[0],start:s.index,end:s.index+s[0].length}}return null},this.modifyNumber=function(e){var t=this.selection.getCursor().row,i=this.selection.getCursor().column,n=new f(t,i-1,t,i),s=this.session.getTextRange(n);if(!isNaN(parseFloat(s))&&isFinite(s)){var r=this.getNumberAt(t,i);if(r){var o=r.value.indexOf(".")>=0?r.start+r.value.indexOf(".")+1:r.end,a=r.start+r.value.length-o,l=parseFloat(r.value);l*=Math.pow(10,a),o!==r.end&&i<o?e*=Math.pow(10,r.end-i-1):e*=Math.pow(10,r.end-i),l+=e;var h=(l/=Math.pow(10,a)).toFixed(a),c=new f(t,r.start,t,r.end);this.session.replace(c,h),this.moveCursorTo(t,Math.max(r.start+1,i+h.length-r.value.length))}}else this.toggleWord()},this.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["in","out"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]],this.toggleWord=function(){var e=this.selection.getCursor().row,t=this.selection.getCursor().column;this.selection.selectWord();var i=this.getSelectedText(),n=this.selection.getWordRange().start.column,s=i.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),o=t-n-1;o<0&&(o=0);var a=0,l=0,h=this;i.match(/[A-Za-z0-9_]+/)&&s.forEach((function(t,s){l=a+t.length,o>=a&&o<=l&&(i=t,h.selection.clearSelection(),h.moveCursorTo(e,a+n),h.selection.selectTo(e,l+n)),a=l}));for(var c,u=this.$toggleWordPairs,d=0;d<u.length;d++)for(var f=u[d],p=0;p<=1;p++){var g=+!p,m=i.match(new RegExp("^\\s?_?("+r.escapeRegExp(f[p])+")\\s?$","i"));if(m)i.match(new RegExp("([_]|^|\\s)("+r.escapeRegExp(m[1])+")($|\\s)","g"))&&(c=i.replace(new RegExp(r.escapeRegExp(f[p]),"i"),(function(e){var t=f[g];return e.toUpperCase()==e?t=t.toUpperCase():e.charAt(0).toUpperCase()==e.charAt(0)&&(t=t.substr(0,0)+f[g].charAt(0).toUpperCase()+t.substr(1)),t})),this.insert(c),c="")}},this.removeLines=function(){var e=this.$getSelectedRows();this.session.removeFullLines(e.first,e.last),this.clearSelection()},this.duplicateSelection=function(){var e=this.selection,t=this.session,i=e.getRange(),n=e.isBackwards();if(i.isEmpty()){var s=i.start.row;t.duplicateLines(s,s)}else{var r=n?i.start:i.end,o=t.insert(r,t.getTextRange(i),!1);i.start=r,i.end=o,e.setSelectionRange(i,n)}},this.moveLinesDown=function(){this.$moveLines(1,!1)},this.moveLinesUp=function(){this.$moveLines(-1,!1)},this.moveText=function(e,t,i){return this.session.moveText(e,t,i)},this.copyLinesUp=function(){this.$moveLines(-1,!0)},this.copyLinesDown=function(){this.$moveLines(1,!0)},this.$moveLines=function(e,t){var i,n,s=this.selection;if(!s.inMultiSelectMode||this.inVirtualSelectionMode){var r=s.toOrientedRange();i=this.$getSelectedRows(r),n=this.session.$moveLines(i.first,i.last,t?0:e),t&&-1==e&&(n=0),r.moveBy(n,0),s.fromOrientedRange(r)}else{var o=s.rangeList.ranges;s.rangeList.detach(this.session),this.inVirtualSelectionMode=!0;for(var a=0,l=0,h=o.length,c=0;c<h;c++){var u=c;o[c].moveBy(a,0);for(var d=(i=this.$getSelectedRows(o[c])).first,f=i.last;++c<h;){l&&o[c].moveBy(l,0);var p=this.$getSelectedRows(o[c]);if(t&&p.first!=f)break;if(!t&&p.first>f+1)break;f=p.last}for(c--,a=this.session.$moveLines(d,f,t?0:e),t&&-1==e&&(u=c+1);u<=c;)o[u].moveBy(a,0),u++;t||(a=0),l+=a}s.fromOrientedRange(s.ranges[0]),s.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},this.$getSelectedRows=function(e){return e=(e||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(e.start.row),last:this.session.getRowFoldEnd(e.end.row)}},this.onCompositionStart=function(e){this.renderer.showComposition(e)},this.onCompositionUpdate=function(e){this.renderer.setCompositionText(e)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(e){return e>=this.getFirstVisibleRow()&&e<=this.getLastVisibleRow()},this.isRowFullyVisible=function(e){return e>=this.renderer.getFirstFullyVisibleRow()&&e<=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(e,t){var i=this.renderer,n=this.renderer.layerConfig,s=e*Math.floor(n.height/n.lineHeight);!0===t?this.selection.$moveSelection((function(){this.moveCursorBy(s,0)})):!1===t&&(this.selection.moveCursorBy(s,0),this.selection.clearSelection());var r=i.scrollTop;i.scrollBy(0,s*n.lineHeight),null!=t&&i.scrollCursorIntoView(null,.5),i.animateScrolling(r)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(e){this.renderer.scrollToRow(e)},this.scrollToLine=function(e,t,i,n){this.renderer.scrollToLine(e,t,i,n)},this.centerSelection=function(){var e=this.getSelectionRange(),t={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCursor(t,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.selection.selectAll()},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(e,t){this.selection.moveCursorTo(e,t)},this.moveCursorToPosition=function(e){this.selection.moveCursorToPosition(e)},this.jumpToMatching=function(e,t){var i=this.getCursorPosition(),n=new w(this.session,i.row,i.column),s=n.getCurrentToken(),r=s||n.stepForward();if(r){var o,a,l=!1,h={},c=i.column-r.start,u={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(r.value.match(/[{}()\[\]]/g)){for(;c<r.value.length&&!l;c++)if(u[r.value[c]])switch(a=u[r.value[c]]+"."+r.type.replace("rparen","lparen"),isNaN(h[a])&&(h[a]=0),r.value[c]){case"(":case"[":case"{":h[a]++;break;case")":case"]":case"}":h[a]--,-1===h[a]&&(o="bracket",l=!0)}}else-1!==r.type.indexOf("tag-name")&&(isNaN(h[r.value])&&(h[r.value]=0),"<"===s.value?h[r.value]++:"</"===s.value&&h[r.value]--,-1===h[r.value]&&(o="tag",l=!0));l||(s=r,r=n.stepForward(),c=0)}while(r&&!l);if(o){var d,p;if("bracket"===o)(d=this.session.getBracketRange(i))||(p=(d=new f(n.getCurrentTokenRow(),n.getCurrentTokenColumn()+c-1,n.getCurrentTokenRow(),n.getCurrentTokenColumn()+c-1)).start,(t||p.row===i.row&&Math.abs(p.column-i.column)<2)&&(d=this.session.getBracketRange(p)));else if("tag"===o){if(!r||-1===r.type.indexOf("tag-name"))return;var g=r.value;if(0===(d=new f(n.getCurrentTokenRow(),n.getCurrentTokenColumn()-2,n.getCurrentTokenRow(),n.getCurrentTokenColumn()-2)).compare(i.row,i.column)){l=!1;do{r=s,(s=n.stepBackward())&&(-1!==s.type.indexOf("tag-close")&&d.setEnd(n.getCurrentTokenRow(),n.getCurrentTokenColumn()+1),r.value===g&&-1!==r.type.indexOf("tag-name")&&("<"===s.value?h[g]++:"</"===s.value&&h[g]--,0===h[g]&&(l=!0)))}while(s&&!l)}r&&r.type.indexOf("tag-name")&&(p=d.start).row==i.row&&Math.abs(p.column-i.column)<2&&(p=d.end)}(p=d&&d.cursor||p)&&(e?d&&t?this.selection.setRange(d):d&&d.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(p.row,p.column):this.selection.moveTo(p.row,p.column))}}},this.gotoLine=function(e,t,i){this.selection.clearSelection(),this.session.unfold({row:e-1,column:t||0}),this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(e-1,t||0),this.isRowFullyVisible(e-1)||this.scrollToLine(e-1,!0,i)},this.navigateTo=function(e,t){this.selection.moveTo(e,t)},this.navigateUp=function(e){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(-e||-1,0)},this.navigateDown=function(e){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(e||1,0)},this.navigateLeft=function(e){if(this.selection.isEmpty())for(e=e||1;e--;)this.selection.moveCursorLeft();else{var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}this.clearSelection()},this.navigateRight=function(e){if(this.selection.isEmpty())for(e=e||1;e--;)this.selection.moveCursorRight();else{var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(e,t){t&&this.$search.set(t);var i=this.$search.find(this.session),n=0;return i?(this.$tryReplace(i,e)&&(n=1),this.selection.setSelectionRange(i),this.renderer.scrollSelectionIntoView(i.start,i.end),n):n},this.replaceAll=function(e,t){t&&this.$search.set(t);var i=this.$search.findAll(this.session),n=0;if(!i.length)return n;var s=this.getSelectionRange();this.selection.moveTo(0,0);for(var r=i.length-1;r>=0;--r)this.$tryReplace(i[r],e)&&n++;return this.selection.setSelectionRange(s),n},this.$tryReplace=function(e,t){var i=this.session.getTextRange(e);return null!==(t=this.$search.replace(i,t))?(e.end=this.session.replace(e,t),e):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(e,t,i){t||(t={}),"string"==typeof e||e instanceof RegExp?t.needle=e:"object"==typeof e&&n.mixin(t,e);var s=this.selection.getRange();null==t.needle&&((e=this.session.getTextRange(s)||this.$search.$options.needle)||(s=this.session.getWordRange(s.start.row,s.start.column),e=this.session.getTextRange(s)),this.$search.set({needle:e})),this.$search.set(t),t.start||this.$search.set({start:s});var r=this.$search.find(this.session);return t.preventScroll?r:r?(this.revealRange(r,i),r):(t.backwards?s.start=s.end:s.end=s.start,void this.selection.setRange(s))},this.findNext=function(e,t){this.find({skipCurrent:!0,backwards:!1},e,t)},this.findPrevious=function(e,t){this.find(e,{skipCurrent:!0,backwards:!0},t)},this.revealRange=function(e,t){this.session.unfold(e),this.selection.setSelectionRange(e);var i=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5),!1!==t&&this.renderer.animateScrolling(i)},this.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.$toDestroy&&(this.$toDestroy.forEach((function(e){e.destroy()})),this.$toDestroy=null),this.$mouseHandler&&this.$mouseHandler.destroy(),this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy(),this._$emitInputEvent&&this._$emitInputEvent.cancel(),this.removeAllListeners()},this.setAutoScrollEditorIntoView=function(e){if(e){var t,i=this,n=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var s=this.$scrollAnchor;s.style.cssText="position:absolute",this.container.insertBefore(s,this.container.firstChild);var r=this.on("changeSelection",(function(){n=!0})),o=this.renderer.on("beforeRender",(function(){n&&(t=i.renderer.container.getBoundingClientRect())})),a=this.renderer.on("afterRender",(function(){if(n&&t&&(i.isFocused()||i.searchBox&&i.searchBox.isFocused())){var e=i.renderer,r=e.$cursorLayer.$pixelPos,o=e.layerConfig,a=r.top-o.offset;null!=(n=r.top>=0&&a+t.top<0||!(r.top<o.height&&r.top+t.top+o.lineHeight>window.innerHeight)&&null)&&(s.style.top=a+"px",s.style.left=r.left+"px",s.style.height=o.lineHeight+"px",s.scrollIntoView(n)),n=t=null}}));this.setAutoScrollEditorIntoView=function(e){e||(delete this.setAutoScrollEditorIntoView,this.off("changeSelection",r),this.renderer.off("afterRender",a),this.renderer.off("beforeRender",o))}}},this.$resetCursorStyle=function(){var e=this.$cursorStyle||"ace",t=this.renderer.$cursorLayer;t&&(t.setSmoothBlinking(/smooth/.test(e)),t.isBlinking=!this.$readOnly&&"wide"!=e,s.setCssClass(t.element,"ace_slim-cursors",/slim/.test(e)))},this.prompt=function(e,t,i){var n=this;v.loadModule("./ext/prompt",(function(s){s.prompt(n,e,t,i)}))}}.call(b.prototype),v.defineOptions(b.prototype,"editor",{selectionStyle:{set:function(e){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:e})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(e){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(e){this.textInput.setReadOnly(e),this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(e){this.textInput.setCopyWithEmptySelection(e)},initialValue:!1},cursorStyle:{set:function(e){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},enableAutoIndent:{initialValue:!0},autoScrollEditorIntoView:{set:function(e){this.setAutoScrollEditorIntoView(e)}},keyboardHandler:{set:function(e){this.setKeyboardHandler(e)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(e){this.session.setValue(e)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(e){this.setSession(e)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(e){this.renderer.$gutterLayer.setShowLineNumbers(e),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),e&&this.$relativeLineNumbers?_.attach(this):_.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(e){this.$showLineNumbers&&e?_.attach(this):_.detach(this)}},placeholder:{set:function(e){this.$updatePlaceholder||(this.$updatePlaceholder=function(){var e=this.session&&(this.renderer.$composition||this.getValue());if(e&&this.renderer.placeholderNode)this.renderer.off("afterRender",this.$updatePlaceholder),s.removeCssClass(this.container,"ace_hasPlaceholder"),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null;else if(e||this.renderer.placeholderNode)!e&&this.renderer.placeholderNode&&(this.renderer.placeholderNode.textContent=this.$placeholder||"");else{this.renderer.on("afterRender",this.$updatePlaceholder),s.addCssClass(this.container,"ace_hasPlaceholder");var t=s.createElement("div");t.className="ace_placeholder",t.textContent=this.$placeholder||"",this.renderer.placeholderNode=t,this.renderer.content.appendChild(this.renderer.placeholderNode)}}.bind(this),this.on("input",this.$updatePlaceholder)),this.$updatePlaceholder()}},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});var _={getText:function(e,t){return(Math.abs(e.selection.lead.row-t)||t+1+(t<9?"·":""))+""},getWidth:function(e,t,i){return Math.max(t.toString().length,(i.lastRow+1).toString().length,2)*i.characterWidth},update:function(e,t){t.renderer.$loop.schedule(t.renderer.CHANGE_GUTTER)},attach:function(e){e.renderer.$gutterLayer.$renderer=this,e.on("changeSelection",this.update),this.update(null,e)},detach:function(e){e.renderer.$gutterLayer.$renderer==this&&(e.renderer.$gutterLayer.$renderer=null),e.off("changeSelection",this.update),this.update(null,e)}};t.Editor=b})),ace.define("ace/undomanager",["require","exports","module","ace/range"],(function(e,t,i){var n=function(){this.$maxRev=0,this.$fromUndo=!1,this.reset()};(function(){this.addSession=function(e){this.$session=e},this.add=function(e,t,i){this.$fromUndo||e!=this.$lastDelta&&(this.$keepRedoStack||(this.$redoStack.length=0),!1!==t&&this.lastDeltas||(this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),e.id=this.$rev=++this.$maxRev),"remove"!=e.action&&"insert"!=e.action||(this.$lastDelta=e),this.lastDeltas.push(e))},this.addSelection=function(e,t){this.selections.push({value:e,rev:t||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(e,t){null==t&&(t=this.$rev+1);for(var i=this.$undoStack,n=i.length;n--;){var s=i[n][0];if(s.id<=e)break;s.id<t&&(s.ignore=!0)}this.lastDeltas=null},this.getSelection=function(e,t){for(var i=this.selections,n=i.length;n--;){var s=i[n];if(s.rev<e)return t&&(s=i[n+1]),s}},this.getRevision=function(){return this.$rev},this.getDeltas=function(e,t){null==t&&(t=this.$rev+1);for(var i=this.$undoStack,n=null,s=0,r=i.length;r--;){var o=i[r][0];if(o.id<t&&!n&&(n=r+1),o.id<=e){s=r+1;break}}return i.slice(s,n)},this.getChangedRanges=function(e,t){null==t&&(t=this.$rev+1)},this.getChangedLines=function(e,t){null==t&&(t=this.$rev+1)},this.undo=function(e,t){this.lastDeltas=null;var i=this.$undoStack;if(function(e,t){for(var i=t;i--;){var n=e[i];if(n&&!n[0].ignore){for(;i<t-1;){var s=c(e[i],e[i+1]);e[i]=s[0],e[i+1]=s[1],i++}return!0}}}(i,i.length)){e||(e=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0;var n=i.pop(),s=null;return n&&(s=e.undoChanges(n,t),this.$redoStack.push(n),this.$syncRev()),this.$fromUndo=!1,s}},this.redo=function(e,t){if(this.lastDeltas=null,e||(e=this.$session),this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){var i=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);!function(e,t){for(var i=0;i<t.length;i++)for(var n=t[i],s=0;s<n.length;s++)g(e,n[s])}(this.$redoStack,i),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach((function(e){e[0].id=++this.$maxRev}),this)}var n=this.$redoStack.pop(),s=null;return n&&(s=e.redoChanges(n,t),this.$undoStack.push(n),this.$syncRev()),this.$fromUndo=!1,s},this.$syncRev=function(){var e=this.$undoStack,t=e[e.length-1],i=t&&t[0].id||0;this.$redoStackBaseRev=i,this.$rev=i},this.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return this.$undoStack.length>0},this.canRedo=function(){return this.$redoStack.length>0},this.bookmark=function(e){null==e&&(e=this.$rev),this.mark=e},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(e){return e?a(e):a(this.$undoStack)+"\n---\n"+a(this.$redoStack)}}).call(n.prototype);var s=e("./range").Range,r=s.comparePoints;s.comparePoints;function o(e){return{row:e.row,column:e.column}}function a(e){if(e=e||this,Array.isArray(e))return e.map(a).join("\n");var t="";return e.action?(t="insert"==e.action?"+":"-",t+="["+e.lines+"]"):e.value&&(t=Array.isArray(e.value)?e.value.map(l).join("\n"):l(e.value)),e.start&&(t+=l(e)),(e.id||e.rev)&&(t+="\t("+(e.id||e.rev)+")"),t}function l(e){return e.start.row+":"+e.start.column+"=>"+e.end.row+":"+e.end.column}function h(e,t){var i="insert"==e.action,n="insert"==t.action;if(i&&n)if(r(t.start,e.end)>=0)d(t,e,-1);else{if(!(r(t.start,e.start)<=0))return null;d(e,t,1)}else if(i&&!n)if(r(t.start,e.end)>=0)d(t,e,-1);else{if(!(r(t.end,e.start)<=0))return null;d(e,t,-1)}else if(!i&&n)if(r(t.start,e.start)>=0)d(t,e,1);else{if(!(r(t.start,e.start)<=0))return null;d(e,t,1)}else if(!i&&!n)if(r(t.start,e.start)>=0)d(t,e,1);else{if(!(r(t.end,e.start)<=0))return null;d(e,t,-1)}return[t,e]}function c(e,t){for(var i=e.length;i--;)for(var n=0;n<t.length;n++)if(!h(e[i],t[n])){for(;i<e.length;){for(;n--;)h(t[n],e[i]);n=t.length,i++}return[e,t]}return e.selectionBefore=t.selectionBefore=e.selectionAfter=t.selectionAfter=null,[t,e]}function u(e,t){var i="insert"==e.action,n="insert"==t.action;if(i&&n)r(e.start,t.start)<0?d(t,e,1):d(e,t,1);else if(i&&!n)r(e.start,t.end)>=0?d(e,t,-1):(r(e.start,t.start)<=0||d(e,s.fromPoints(t.start,e.start),-1),d(t,e,1));else if(!i&&n)r(t.start,e.end)>=0?d(t,e,-1):(r(t.start,e.start)<=0||d(t,s.fromPoints(e.start,t.start),-1),d(e,t,1));else if(!i&&!n)if(r(t.start,e.end)>=0)d(t,e,-1);else{var o,a;if(!(r(t.end,e.start)<=0))return r(e.start,t.start)<0&&(o=e,e=p(e,t.start)),r(e.end,t.end)>0&&(a=p(e,t.end)),f(t.end,e.start,e.end,-1),a&&!o&&(e.lines=a.lines,e.start=a.start,e.end=a.end,a=e),[t,o,a].filter(Boolean);d(e,t,-1)}return[t,e]}function d(e,t,i){f(e.start,t.start,t.end,i),f(e.end,t.start,t.end,i)}function f(e,t,i,n){e.row==(1==n?t:i).row&&(e.column+=n*(i.column-t.column)),e.row+=n*(i.row-t.row)}function p(e,t){var i=e.lines,n=e.end;e.end=o(t);var s=e.end.row-e.start.row,r=i.splice(s,i.length),a=s?t.column:t.column-e.start.column;return i.push(r[0].substring(0,a)),r[0]=r[0].substr(a),{start:o(t),end:n,lines:r,action:e.action}}function g(e,t){t=function(e){return{start:o(e.start),end:o(e.end),action:e.action,lines:e.lines.slice()}}(t);for(var i=e.length;i--;){for(var n=e[i],s=0;s<n.length;s++){var r=u(n[s],t);t=r[0],2!=r.length&&(r[2]?(n.splice(s+1,1,r[1],r[2]),s++):r[1]||(n.splice(s,1),s--))}n.length||e.splice(i,1)}return e}t.UndoManager=n})),ace.define("ace/layer/lines",["require","exports","module","ace/lib/dom"],(function(e,t,i){var n=e("../lib/dom"),s=function(e,t){this.element=e,this.canvasHeight=t||5e5,this.element.style.height=2*this.canvasHeight+"px",this.cells=[],this.cellCache=[],this.$offsetCoefficient=0};(function(){this.moveContainer=function(e){n.translate(this.element,0,-e.firstRowScreen*e.lineHeight%this.canvasHeight-e.offset*this.$offsetCoefficient)},this.pageChanged=function(e,t){return Math.floor(e.firstRowScreen*e.lineHeight/this.canvasHeight)!==Math.floor(t.firstRowScreen*t.lineHeight/this.canvasHeight)},this.computeLineTop=function(e,t,i){var n=t.firstRowScreen*t.lineHeight,s=Math.floor(n/this.canvasHeight);return i.documentToScreenRow(e,0)*t.lineHeight-s*this.canvasHeight},this.computeLineHeight=function(e,t,i){return t.lineHeight*i.getRowLineCount(e)},this.getLength=function(){return this.cells.length},this.get=function(e){return this.cells[e]},this.shift=function(){this.$cacheCell(this.cells.shift())},this.pop=function(){this.$cacheCell(this.cells.pop())},this.push=function(e){if(Array.isArray(e)){this.cells.push.apply(this.cells,e);for(var t=n.createFragment(this.element),i=0;i<e.length;i++)t.appendChild(e[i].element);this.element.appendChild(t)}else this.cells.push(e),this.element.appendChild(e.element)},this.unshift=function(e){if(Array.isArray(e)){this.cells.unshift.apply(this.cells,e);for(var t=n.createFragment(this.element),i=0;i<e.length;i++)t.appendChild(e[i].element);this.element.firstChild?this.element.insertBefore(t,this.element.firstChild):this.element.appendChild(t)}else this.cells.unshift(e),this.element.insertAdjacentElement("afterbegin",e.element)},this.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},this.$cacheCell=function(e){e&&(e.element.remove(),this.cellCache.push(e))},this.createCell=function(e,t,i,s){var r=this.cellCache.pop();if(!r){var o=n.createElement("div");s&&s(o),this.element.appendChild(o),r={element:o,text:"",row:e}}return r.row=e,r}}).call(s.prototype),t.Lines=s})),ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/layer/lines"],(function(e,t,i){var n=e("../lib/dom"),s=e("../lib/oop"),r=e("../lib/lang"),o=e("../lib/event_emitter").EventEmitter,a=e("./lines").Lines,l=function(e){this.element=n.createElement("div"),this.element.className="ace_layer ace_gutter-layer",e.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new a(this.element),this.$lines.$offsetCoefficient=1};function h(e){var t=document.createTextNode("");e.appendChild(t);var i=n.createElement("span");return e.appendChild(i),e}(function(){s.implement(this,o),this.setSession=function(e){this.session&&this.session.off("change",this.$updateAnnotations),this.session=e,e&&e.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(e,t)},this.setAnnotations=function(e){this.$annotations=[];for(var t=0;t<e.length;t++){var i=e[t],n=i.row,s=this.$annotations[n];s||(s=this.$annotations[n]={text:[]});var o=i.text;o=o?r.escapeHTML(o):i.html||"",-1===s.text.indexOf(o)&&s.text.push(o);var a=i.type;"error"==a?s.className=" ace_error":"warning"==a&&" ace_error"!=s.className?s.className=" ace_warning":"info"!=a||s.className||(s.className=" ace_info")}},this.$updateAnnotations=function(e){if(this.$annotations.length){var t=e.start.row,i=e.end.row-t;if(0===i);else if("remove"==e.action)this.$annotations.splice(t,i+1,null);else{var n=new Array(i+1);n.unshift(t,1),this.$annotations.splice.apply(this.$annotations,n)}}},this.update=function(e){this.config=e;var t=this.session,i=e.firstRow,n=Math.min(e.lastRow+e.gutterOffset,t.getLength()-1);this.oldLastRow=n,this.config=e,this.$lines.moveContainer(e),this.$updateCursorRow();for(var s=t.getNextFoldLine(i),r=s?s.start.row:1/0,o=null,a=-1,l=i;;){if(l>r&&(l=s.end.row+1,r=(s=t.getNextFoldLine(l,s))?s.start.row:1/0),l>n){for(;this.$lines.getLength()>a+1;)this.$lines.pop();break}(o=this.$lines.get(++a))?o.row=l:(o=this.$lines.createCell(l,e,this.session,h),this.$lines.push(o)),this.$renderCell(o,e,s,l),l++}this._signal("afterRender"),this.$updateGutterWidth(e)},this.$updateGutterWidth=function(e){var t=this.session,i=t.gutterRenderer||this.$renderer,n=t.$firstLineNumber,s=this.$lines.last()?this.$lines.last().text:"";(this.$fixedWidth||t.$useWrapMode)&&(s=t.getLength()+n-1);var r=i?i.getWidth(t,s,e):s.toString().length*e.characterWidth,o=this.$padding||this.$computePadding();(r+=o.left+o.right)===this.gutterWidth||isNaN(r)||(this.gutterWidth=r,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",r))},this.$updateCursorRow=function(){if(this.$highlightGutterLine){var e=this.session.selection.getCursor();this.$cursorRow!==e.row&&(this.$cursorRow=e.row)}},this.updateLineHighlight=function(){if(this.$highlightGutterLine){var e=this.session.selection.cursor.row;if(this.$cursorRow=e,!this.$cursorCell||this.$cursorCell.row!=e){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var t=this.$lines.cells;this.$cursorCell=null;for(var i=0;i<t.length;i++){var n=t[i];if(n.row>=this.$cursorRow){if(n.row>this.$cursorRow){var s=this.session.getFoldLine(this.$cursorRow);if(!(i>0&&s&&s.start.row==t[i-1].row))break;n=t[i-1]}n.element.className="ace_gutter-active-line "+n.element.className,this.$cursorCell=n;break}}}}},this.scrollLines=function(e){var t=this.config;if(this.config=e,this.$updateCursorRow(),this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var i=Math.min(e.lastRow+e.gutterOffset,this.session.getLength()-1),n=this.oldLastRow;if(this.oldLastRow=i,!t||n<e.firstRow)return this.update(e);if(i<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var s=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);s>0;s--)this.$lines.shift();if(n>i)for(s=this.session.getFoldedRowCount(i+1,n);s>0;s--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLines(e,e.firstRow,t.firstRow-1)),i>n&&this.$lines.push(this.$renderLines(e,n+1,i)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(e)},this.$renderLines=function(e,t,i){for(var n=[],s=t,r=this.session.getNextFoldLine(s),o=r?r.start.row:1/0;s>o&&(s=r.end.row+1,o=(r=this.session.getNextFoldLine(s,r))?r.start.row:1/0),!(s>i);){var a=this.$lines.createCell(s,e,this.session,h);this.$renderCell(a,e,r,s),n.push(a),s++}return n},this.$renderCell=function(e,t,i,s){var r=e.element,o=this.session,a=r.childNodes[0],l=r.childNodes[1],h=o.$firstLineNumber,c=o.$breakpoints,u=o.$decorations,d=o.gutterRenderer||this.$renderer,f=this.$showFoldWidgets&&o.foldWidgets,p=i?i.start.row:Number.MAX_VALUE,g="ace_gutter-cell ";if(this.$highlightGutterLine&&(s==this.$cursorRow||i&&s<this.$cursorRow&&s>=p&&this.$cursorRow<=i.end.row)&&(g+="ace_gutter-active-line ",this.$cursorCell!=e&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=e)),c[s]&&(g+=c[s]),u[s]&&(g+=u[s]),this.$annotations[s]&&(g+=this.$annotations[s].className),r.className!=g&&(r.className=g),f){var m=f[s];null==m&&(m=f[s]=o.getFoldWidget(s))}if(m){g="ace_fold-widget ace_"+m;"start"==m&&s==p&&s<i.end.row?g+=" ace_closed":g+=" ace_open",l.className!=g&&(l.className=g);var v=t.lineHeight+"px";n.setStyle(l.style,"height",v),n.setStyle(l.style,"display","inline-block")}else l&&n.setStyle(l.style,"display","none");var w=(d?d.getText(o,s):s+h).toString();return w!==a.data&&(a.data=w),n.setStyle(e.element.style,"height",this.$lines.computeLineHeight(s,t,o)+"px"),n.setStyle(e.element.style,"top",this.$lines.computeLineTop(s,t,o)+"px"),e.text=w,e},this.$fixedWidth=!1,this.$highlightGutterLine=!0,this.$renderer="",this.setHighlightGutterLine=function(e){this.$highlightGutterLine=e},this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(e){this.$renderer=!e&&{getWidth:function(){return 0},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(e){e?n.addCssClass(this.element,"ace_folding-enabled"):n.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=e,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var e=n.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(e.borderLeftWidth)||0)+(parseInt(e.paddingLeft)||0)+1,this.$padding.right=(parseInt(e.borderRightWidth)||0)+(parseInt(e.paddingRight)||0),this.$padding},this.getRegion=function(e){var t=this.$padding||this.$computePadding(),i=this.element.getBoundingClientRect();return e.x<t.left+i.left?"markers":this.$showFoldWidgets&&e.x>i.right-t.right?"foldWidgets":void 0}}).call(l.prototype),t.Gutter=l})),ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],(function(e,t,i){var n=e("../range").Range,s=e("../lib/dom"),r=function(e){this.element=s.createElement("div"),this.element.className="ace_layer ace_marker-layer",e.appendChild(this.element)};(function(){this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setMarkers=function(e){this.markers=e},this.elt=function(e,t){var i=-1!=this.i&&this.element.childNodes[this.i];i?this.i++:(i=document.createElement("div"),this.element.appendChild(i),this.i=-1),i.style.cssText=t,i.className=e},this.update=function(e){if(e){var t;for(var i in this.config=e,this.i=0,this.markers){var n=this.markers[i];if(n.range){var s=n.range.clipRows(e.firstRow,e.lastRow);if(!s.isEmpty())if(s=s.toScreenRange(this.session),n.renderer){var r=this.$getTop(s.start.row,e),o=this.$padding+s.start.column*e.characterWidth;n.renderer(t,s,o,r,e)}else"fullLine"==n.type?this.drawFullLineMarker(t,s,n.clazz,e):"screenLine"==n.type?this.drawScreenLineMarker(t,s,n.clazz,e):s.isMultiLine()?"text"==n.type?this.drawTextMarker(t,s,n.clazz,e):this.drawMultiLineMarker(t,s,n.clazz,e):this.drawSingleLineMarker(t,s,n.clazz+" ace_start ace_br15",e)}else n.update(t,this,this.session,e)}if(-1!=this.i)for(;this.i<this.element.childElementCount;)this.element.removeChild(this.element.lastChild)}},this.$getTop=function(e,t){return(e-t.firstRowScreen)*t.lineHeight},this.drawTextMarker=function(e,t,i,s,r){for(var o=this.session,a=t.start.row,l=t.end.row,h=a,c=0,u=0,d=o.getScreenLastRowColumn(h),f=new n(h,t.start.column,h,u);h<=l;h++)f.start.row=f.end.row=h,f.start.column=h==a?t.start.column:o.getRowWrapIndent(h),f.end.column=d,c=u,u=d,d=h+1<l?o.getScreenLastRowColumn(h+1):h==l?0:t.end.column,this.drawSingleLineMarker(e,f,i+(h==a?" ace_start":"")+" ace_br"+((h==a||h==a+1&&t.start.column?1:0)|(c<u?2:0)|(u>d?4:0)|(h==l?8:0)),s,h==l?0:1,r)},this.drawMultiLineMarker=function(e,t,i,n,s){var r=this.$padding,o=n.lineHeight,a=this.$getTop(t.start.row,n),l=r+t.start.column*n.characterWidth;(s=s||"",this.session.$bidiHandler.isBidiRow(t.start.row))?((h=t.clone()).end.row=h.start.row,h.end.column=this.session.getLine(h.start.row).length,this.drawBidiSingleLineMarker(e,h,i+" ace_br1 ace_start",n,null,s)):this.elt(i+" ace_br1 ace_start","height:"+o+"px;right:0;top:"+a+"px;left:"+l+"px;"+(s||""));if(this.session.$bidiHandler.isBidiRow(t.end.row)){var h;(h=t.clone()).start.row=h.end.row,h.start.column=0,this.drawBidiSingleLineMarker(e,h,i+" ace_br12",n,null,s)}else{a=this.$getTop(t.end.row,n);var c=t.end.column*n.characterWidth;this.elt(i+" ace_br12","height:"+o+"px;width:"+c+"px;top:"+a+"px;left:"+r+"px;"+(s||""))}if(!((o=(t.end.row-t.start.row-1)*n.lineHeight)<=0)){a=this.$getTop(t.start.row+1,n);var u=(t.start.column?1:0)|(t.end.column?0:8);this.elt(i+(u?" ace_br"+u:""),"height:"+o+"px;right:0;top:"+a+"px;left:"+r+"px;"+(s||""))}},this.drawSingleLineMarker=function(e,t,i,n,s,r){if(this.session.$bidiHandler.isBidiRow(t.start.row))return this.drawBidiSingleLineMarker(e,t,i,n,s,r);var o=n.lineHeight,a=(t.end.column+(s||0)-t.start.column)*n.characterWidth,l=this.$getTop(t.start.row,n),h=this.$padding+t.start.column*n.characterWidth;this.elt(i,"height:"+o+"px;width:"+a+"px;top:"+l+"px;left:"+h+"px;"+(r||""))},this.drawBidiSingleLineMarker=function(e,t,i,n,s,r){var o=n.lineHeight,a=this.$getTop(t.start.row,n),l=this.$padding;this.session.$bidiHandler.getSelections(t.start.column,t.end.column).forEach((function(e){this.elt(i,"height:"+o+"px;width:"+e.width+(s||0)+"px;top:"+a+"px;left:"+(l+e.left)+"px;"+(r||""))}),this)},this.drawFullLineMarker=function(e,t,i,n,s){var r=this.$getTop(t.start.row,n),o=n.lineHeight;t.start.row!=t.end.row&&(o+=this.$getTop(t.end.row,n)-r),this.elt(i,"height:"+o+"px;top:"+r+"px;left:0;right:0;"+(s||""))},this.drawScreenLineMarker=function(e,t,i,n,s){var r=this.$getTop(t.start.row,n),o=n.lineHeight;this.elt(i,"height:"+o+"px;top:"+r+"px;left:0;right:0;"+(s||""))}}).call(r.prototype),t.Marker=r})),ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/layer/lines","ace/lib/event_emitter"],(function(e,t,i){var n=e("../lib/oop"),s=e("../lib/dom"),r=e("../lib/lang"),o=e("./lines").Lines,a=e("../lib/event_emitter").EventEmitter,l=function(e){this.dom=s,this.element=this.dom.createElement("div"),this.element.className="ace_layer ace_text-layer",e.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new o(this.element)};(function(){n.implement(this,a),this.EOF_CHAR="¶",this.EOL_CHAR_LF="¬",this.EOL_CHAR_CRLF="¤",this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR="—",this.SPACE_CHAR="·",this.$padding=0,this.MAX_LINE_LENGTH=1e4,this.$updateEolChar=function(){var e=this.session.doc,t="\n"==e.getNewLineCharacter()&&"windows"!=e.getNewLineMode()?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=t)return this.EOL_CHAR=t,!0},this.setPadding=function(e){this.$padding=e,this.element.style.margin="0 "+e+"px"},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(e){this.$fontMetrics=e,this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(e){this.session=e,e&&this.$computeTabString()},this.showInvisibles=!1,this.showSpaces=!1,this.showTabs=!1,this.showEOL=!1,this.setShowInvisibles=function(e){return this.showInvisibles!=e&&(this.showInvisibles=e,"string"==typeof e?(this.showSpaces=/tab/i.test(e),this.showTabs=/space/i.test(e),this.showEOL=/eol/i.test(e)):this.showSpaces=this.showTabs=this.showEOL=e,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(e){return this.displayIndentGuides!=e&&(this.displayIndentGuides=e,this.$computeTabString(),!0)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){var e=this.session.getTabSize();this.tabSize=e;for(var t=this.$tabStrings=[0],i=1;i<e+1;i++)if(this.showTabs){(n=this.dom.createElement("span")).className="ace_invisible ace_invisible_tab",n.textContent=r.stringRepeat(this.TAB_CHAR,i),t.push(n)}else t.push(this.dom.createTextNode(r.stringRepeat(" ",i),this.element));if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var n,s="ace_indent-guide",o=this.showSpaces?" ace_invisible ace_invisible_space":"",a=this.showSpaces?r.stringRepeat(this.SPACE_CHAR,this.tabSize):r.stringRepeat(" ",this.tabSize),l=this.showTabs?" ace_invisible ace_invisible_tab":"",h=this.showTabs?r.stringRepeat(this.TAB_CHAR,this.tabSize):a;(n=this.dom.createElement("span")).className=s+o,n.textContent=a,this.$tabStrings[" "]=n,(n=this.dom.createElement("span")).className=s+l,n.textContent=h,this.$tabStrings["\t"]=n}},this.updateLines=function(e,t,i){if(this.config.lastRow!=e.lastRow||this.config.firstRow!=e.firstRow)return this.update(e);this.config=e;for(var n=Math.max(t,e.firstRow),s=Math.min(i,e.lastRow),r=this.element.childNodes,o=0,a=e.firstRow;a<n;a++){if(l=this.session.getFoldLine(a)){if(l.containsRow(n)){n=l.start.row;break}a=l.end.row}o++}for(var l,h=!1,c=(a=n,(l=this.session.getNextFoldLine(a))?l.start.row:1/0);a>c&&(a=l.end.row+1,c=(l=this.session.getNextFoldLine(a,l))?l.start.row:1/0),!(a>s);){var u=r[o++];if(u){this.dom.removeChildren(u),this.$renderLine(u,a,a==c&&l),h&&(u.style.top=this.$lines.computeLineTop(a,e,this.session)+"px");var d=e.lineHeight*this.session.getRowLength(a)+"px";u.style.height!=d&&(h=!0,u.style.height=d)}a++}if(h)for(;o<this.$lines.cells.length;){var f=this.$lines.cells[o++];f.element.style.top=this.$lines.computeLineTop(f.row,e,this.session)+"px"}},this.scrollLines=function(e){var t=this.config;if(this.config=e,this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var i=e.lastRow,n=t?t.lastRow:-1;if(!t||n<e.firstRow)return this.update(e);if(i<t.firstRow)return this.update(e);if(!t||t.lastRow<e.firstRow)return this.update(e);if(e.lastRow<t.firstRow)return this.update(e);if(t.firstRow<e.firstRow)for(var s=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);s>0;s--)this.$lines.shift();if(t.lastRow>e.lastRow)for(s=this.session.getFoldedRowCount(e.lastRow+1,t.lastRow);s>0;s--)this.$lines.pop();e.firstRow<t.firstRow&&this.$lines.unshift(this.$renderLinesFragment(e,e.firstRow,t.firstRow-1)),e.lastRow>t.lastRow&&this.$lines.push(this.$renderLinesFragment(e,t.lastRow+1,e.lastRow))},this.$renderLinesFragment=function(e,t,i){for(var n=[],r=t,o=this.session.getNextFoldLine(r),a=o?o.start.row:1/0;r>a&&(r=o.end.row+1,a=(o=this.session.getNextFoldLine(r,o))?o.start.row:1/0),!(r>i);){var l=this.$lines.createCell(r,e,this.session),h=l.element;this.dom.removeChildren(h),s.setStyle(h.style,"height",this.$lines.computeLineHeight(r,e,this.session)+"px"),s.setStyle(h.style,"top",this.$lines.computeLineTop(r,e,this.session)+"px"),this.$renderLine(h,r,r==a&&o),this.$useLineGroups()?h.className="ace_line_group":h.className="ace_line",n.push(l),r++}return n},this.update=function(e){this.$lines.moveContainer(e),this.config=e;for(var t=e.firstRow,i=e.lastRow,n=this.$lines;n.getLength();)n.pop();n.push(this.$renderLinesFragment(e,t,i))},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(e,t,i,n){for(var s,o=this,a=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC\u2066\u2067\u2068\u202A\u202B\u202D\u202E\u202C\u2069]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,l=this.dom.createFragment(this.element),h=0;s=a.exec(n);){var c=s[1],u=s[2],d=s[3],f=s[4],p=s[5];if(o.showSpaces||!u){var g=h!=s.index?n.slice(h,s.index):"";if(h=s.index+s[0].length,g&&l.appendChild(this.dom.createTextNode(g,this.element)),c){var m=o.session.getScreenTabSize(t+s.index);l.appendChild(o.$tabStrings[m].cloneNode(!0)),t+=m-1}else if(u){if(o.showSpaces)(w=this.dom.createElement("span")).className="ace_invisible ace_invisible_space",w.textContent=r.stringRepeat(o.SPACE_CHAR,u.length),l.appendChild(w);else l.appendChild(this.com.createTextNode(u,this.element))}else if(d){(w=this.dom.createElement("span")).className="ace_invisible ace_invisible_space ace_invalid",w.textContent=r.stringRepeat(o.SPACE_CHAR,d.length),l.appendChild(w)}else if(f){t+=1,(w=this.dom.createElement("span")).style.width=2*o.config.characterWidth+"px",w.className=o.showSpaces?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",w.textContent=o.showSpaces?o.SPACE_CHAR:f,l.appendChild(w)}else if(p){t+=1,(w=this.dom.createElement("span")).style.width=2*o.config.characterWidth+"px",w.className="ace_cjk",w.textContent=p,l.appendChild(w)}}}if(l.appendChild(this.dom.createTextNode(h?n.slice(h):n,this.element)),this.$textToken[i.type])e.appendChild(l);else{var v="ace_"+i.type.replace(/\./g," ace_"),w=this.dom.createElement("span");"fold"==i.type&&(w.style.width=i.value.length*this.config.characterWidth+"px"),w.className=v,w.appendChild(l),e.appendChild(w)}return t+n.length},this.renderIndentGuide=function(e,t,i){var n=t.search(this.$indentGuideRe);if(n<=0||n>=i)return t;if(" "==t[0]){for(var s=(n-=n%this.tabSize)/this.tabSize,r=0;r<s;r++)e.appendChild(this.$tabStrings[" "].cloneNode(!0));return t.substr(n)}if("\t"==t[0]){for(r=0;r<n;r++)e.appendChild(this.$tabStrings["\t"].cloneNode(!0));return t.substr(n)}return t},this.$createLineElement=function(e){var t=this.dom.createElement("div");return t.className="ace_line",t.style.height=this.config.lineHeight+"px",t},this.$renderWrappedLine=function(e,t,i){var n=0,s=0,o=i[0],a=0,l=this.$createLineElement();e.appendChild(l);for(var h=0;h<t.length;h++){var c=t[h],u=c.value;if(0==h&&this.displayIndentGuides){if(n=u.length,!(u=this.renderIndentGuide(l,u,o)))continue;n-=u.length}if(n+u.length<o)a=this.$renderToken(l,a,c,u),n+=u.length;else{for(;n+u.length>=o;)a=this.$renderToken(l,a,c,u.substring(0,o-n)),u=u.substring(o-n),n=o,l=this.$createLineElement(),e.appendChild(l),l.appendChild(this.dom.createTextNode(r.stringRepeat(" ",i.indent),this.element)),a=0,o=i[++s]||Number.MAX_VALUE;0!=u.length&&(n+=u.length,a=this.$renderToken(l,a,c,u))}}i[i.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(l,a,null,"",!0)},this.$renderSimpleLine=function(e,t){for(var i=0,n=0;n<t.length;n++){var s=t[n],r=s.value;if(0!=n||!this.displayIndentGuides||(r=this.renderIndentGuide(e,r))){if(i+r.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(e,i,s,r);i=this.$renderToken(e,i,s,r)}}},this.$renderOverflowMessage=function(e,t,i,n,s){i&&this.$renderToken(e,t,i,n.slice(0,this.MAX_LINE_LENGTH-t));var r=this.dom.createElement("span");r.className="ace_inline_button ace_keyword ace_toggle_wrap",r.textContent=s?"<hide>":"<click to see more...>",e.appendChild(r)},this.$renderLine=function(e,t,i){if(i||0==i||(i=this.session.getFoldLine(t)),i)var n=this.$getFoldLineTokens(t,i);else n=this.session.getTokens(t);var s=e;if(n.length){var r=this.session.getRowSplitData(t);if(r&&r.length){this.$renderWrappedLine(e,n,r);s=e.lastChild}else{s=e;this.$useLineGroups()&&(s=this.$createLineElement(),e.appendChild(s)),this.$renderSimpleLine(s,n)}}else this.$useLineGroups()&&(s=this.$createLineElement(),e.appendChild(s));if(this.showEOL&&s){i&&(t=i.end.row);var o=this.dom.createElement("span");o.className="ace_invisible ace_invisible_eol",o.textContent=t==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,s.appendChild(o)}},this.$getFoldLineTokens=function(e,t){var i=this.session,n=[];var s=i.getTokens(e);return t.walk((function(e,t,r,o,a){null!=e?n.push({type:"fold",value:e}):(a&&(s=i.getTokens(t)),s.length&&function(e,t,i){for(var s=0,r=0;r+e[s].value.length<t;)if(r+=e[s].value.length,++s==e.length)return;for(r!=t&&((o=e[s].value.substring(t-r)).length>i-t&&(o=o.substring(0,i-t)),n.push({type:e[s].type,value:o}),r=t+o.length,s+=1);r<i&&s<e.length;){var o;(o=e[s].value).length+r>i?n.push({type:e[s].type,value:o.substring(0,i-r)}):n.push(e[s]),r+=o.length,s+=1}}(s,o,r))}),t.end.row,this.session.getLine(t.end.row).length),n},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){}}).call(l.prototype),t.Text=l})),ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],(function(e,t,i){var n=e("../lib/dom"),s=function(e){this.element=n.createElement("div"),this.element.className="ace_layer ace_cursor-layer",e.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),n.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)};(function(){this.$updateOpacity=function(e){for(var t=this.cursors,i=t.length;i--;)n.setStyle(t[i].style,"opacity",e?"":"0")},this.$startCssAnimation=function(){for(var e=this.cursors,t=e.length;t--;)e[t].style.animationDuration=this.blinkInterval+"ms";this.$isAnimating=!0,setTimeout(function(){this.$isAnimating&&n.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},this.$stopCssAnimation=function(){this.$isAnimating=!1,n.removeCssClass(this.element,"ace_animate-blinking")},this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setBlinking=function(e){e!=this.isBlinking&&(this.isBlinking=e,this.restartTimer())},this.setBlinkInterval=function(e){e!=this.blinkInterval&&(this.blinkInterval=e,this.restartTimer())},this.setSmoothBlinking=function(e){e!=this.smoothBlinking&&(this.smoothBlinking=e,n.setCssClass(this.element,"ace_smooth-blinking",e),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var e=n.createElement("div");return e.className="ace_cursor",this.element.appendChild(e),this.cursors.push(e),e},this.removeCursor=function(){if(this.cursors.length>1){var e=this.cursors.pop();return e.parentNode.removeChild(e),e}},this.hideCursor=function(){this.isVisible=!1,n.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,n.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var e=this.$updateCursors;if(clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&(this.$isSmoothBlinking=!1,n.removeCssClass(this.element,"ace_smooth-blinking")),e(!0),this.isBlinking&&this.blinkInterval&&this.isVisible)if(this.smoothBlinking&&(this.$isSmoothBlinking=!0,setTimeout(function(){this.$isSmoothBlinking&&n.addCssClass(this.element,"ace_smooth-blinking")}.bind(this))),n.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var t=function(){this.timeoutId=setTimeout((function(){e(!1)}),.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval((function(){e(!0),t()}),this.blinkInterval),t()}else this.$stopCssAnimation()},this.getPixelPosition=function(e,t){if(!this.config||!this.session)return{left:0,top:0};e||(e=this.session.selection.getCursor());var i=this.session.documentToScreenPosition(e);return{left:this.$padding+(this.session.$bidiHandler.isBidiRow(i.row,e.row)?this.session.$bidiHandler.getPosLeft(i.column):i.column*this.config.characterWidth),top:(i.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight}},this.isCursorInView=function(e,t){return e.top>=0&&e.top<t.maxHeight},this.update=function(e){this.config=e;var t=this.session.$selectionMarkers,i=0,s=0;void 0!==t&&0!==t.length||(t=[{cursor:null}]);i=0;for(var r=t.length;i<r;i++){var o=this.getPixelPosition(t[i].cursor,!0);if(!((o.top>e.height+e.offset||o.top<0)&&i>1)){var a=this.cursors[s++]||this.addCursor(),l=a.style;this.drawCursor?this.drawCursor(a,o,e,t[i],this.session):this.isCursorInView(o,e)?(n.setStyle(l,"display","block"),n.translate(a,o.left,o.top),n.setStyle(l,"width",Math.round(e.characterWidth)+"px"),n.setStyle(l,"height",e.lineHeight+"px")):n.setStyle(l,"display","none")}}for(;this.cursors.length>s;)this.removeCursor();var h=this.session.getOverwrite();this.$setOverwrite(h),this.$pixelPos=o,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(e){e!=this.overwrite&&(this.overwrite=e,e?n.addCssClass(this.element,"ace_overwrite-cursors"):n.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(s.prototype),t.Cursor=s})),ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],(function(e,t,i){var n=e("./lib/oop"),s=e("./lib/dom"),r=e("./lib/event"),o=e("./lib/event_emitter").EventEmitter,a=32768,l=function(e){this.element=s.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix,this.inner=s.createElement("div"),this.inner.className="ace_scrollbar-inner",this.inner.textContent=" ",this.element.appendChild(this.inner),e.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,r.addListener(this.element,"scroll",this.onScroll.bind(this)),r.addListener(this.element,"mousedown",r.preventDefault)};(function(){n.implement(this,o),this.setVisible=function(e){this.element.style.display=e?"":"none",this.isVisible=e,this.coeff=1}}).call(l.prototype);var h=function(e,t){l.call(this,e),this.scrollTop=0,this.scrollHeight=0,t.$scrollbarWidth=this.width=s.scrollbarWidth(e.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+"px",this.$minWidth=0};n.inherits(h,l),function(){this.classSuffix="-v",this.onScroll=function(){if(!this.skipEvent){if(this.scrollTop=this.element.scrollTop,1!=this.coeff){var e=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-e)/(this.coeff-e)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=!1},this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},this.setHeight=function(e){this.element.style.height=e+"px"},this.setInnerHeight=this.setScrollHeight=function(e){this.scrollHeight=e,e>a?(this.coeff=a/e,e=a):1!=this.coeff&&(this.coeff=1),this.inner.style.height=e+"px"},this.setScrollTop=function(e){this.scrollTop!=e&&(this.skipEvent=!0,this.scrollTop=e,this.element.scrollTop=e*this.coeff)}}.call(h.prototype);var c=function(e,t){l.call(this,e),this.scrollLeft=0,this.height=t.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"};n.inherits(c,l),function(){this.classSuffix="-h",this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(e){this.element.style.width=e+"px"},this.setInnerWidth=function(e){this.inner.style.width=e+"px"},this.setScrollWidth=function(e){this.inner.style.width=e+"px"},this.setScrollLeft=function(e){this.scrollLeft!=e&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=e)}}.call(c.prototype),t.ScrollBar=h,t.ScrollBarV=h,t.ScrollBarH=c,t.VScrollBar=h,t.HScrollBar=c})),ace.define("ace/renderloop",["require","exports","module","ace/lib/event"],(function(e,t,i){var n=e("./lib/event"),s=function(e,t){this.onRender=e,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=t||window;var i=this;this._flush=function(e){i.pending=!1;var t=i.changes;if(t&&(n.blockIdle(100),i.changes=0,i.onRender(t)),i.changes){if(i.$recursionLimit--<0)return;i.schedule()}else i.$recursionLimit=2}};(function(){this.schedule=function(e){this.changes=this.changes|e,this.changes&&!this.pending&&(n.nextFrame(this._flush),this.pending=!0)},this.clear=function(e){var t=this.changes;return this.changes=0,t}}).call(s.prototype),t.RenderLoop=s})),ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/lib/useragent","ace/lib/event_emitter"],(function(e,t,i){var n=e("../lib/oop"),s=e("../lib/dom"),r=e("../lib/lang"),o=e("../lib/event"),a=e("../lib/useragent"),l=e("../lib/event_emitter").EventEmitter,h=256,c="function"==typeof ResizeObserver,u=200,d=t.FontMetrics=function(e){this.el=s.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=s.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=s.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),e.appendChild(this.el),this.$measureNode.textContent=r.stringRepeat("X",h),this.$characterSize={width:0,height:0},c?this.$addObserver():this.checkForSizeChanges()};(function(){n.implement(this,l),this.$characterSize={width:0,height:0},this.$setMeasureNodeStyles=function(e,t){e.width=e.height="auto",e.left=e.top="0px",e.visibility="hidden",e.position="absolute",e.whiteSpace="pre",a.isIE<8?e["font-family"]="inherit":e.font="inherit",e.overflow=t?"hidden":"visible"},this.checkForSizeChanges=function(e){if(void 0===e&&(e=this.$measureSizes()),e&&(this.$characterSize.width!==e.width||this.$characterSize.height!==e.height)){this.$measureNode.style.fontWeight="bold";var t=this.$measureSizes();this.$measureNode.style.fontWeight="",this.$characterSize=e,this.charSizes=Object.create(null),this.allowBoldFonts=t&&t.width===e.width&&t.height===e.height,this._emit("changeCharacterSize",{data:e})}},this.$addObserver=function(){var e=this;this.$observer=new window.ResizeObserver((function(t){e.checkForSizeChanges()})),this.$observer.observe(this.$measureNode)},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var e=this;return this.$pollSizeChangesTimer=o.onIdle((function t(){e.checkForSizeChanges(),o.onIdle(t,500)}),500)},this.setPolling=function(e){e?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},this.$measureSizes=function(e){var t={height:(e||this.$measureNode).clientHeight,width:(e||this.$measureNode).clientWidth/h};return 0===t.width||0===t.height?null:t},this.$measureCharWidth=function(e){return this.$main.textContent=r.stringRepeat(e,h),this.$main.getBoundingClientRect().width/h},this.getCharacterWidth=function(e){var t=this.charSizes[e];return void 0===t&&(t=this.charSizes[e]=this.$measureCharWidth(e)/this.$characterSize.width),t},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&&this.$observer.disconnect(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},this.$getZoom=function e(t){return t&&t.parentElement?(window.getComputedStyle(t).zoom||1)*e(t.parentElement):1},this.$initTransformMeasureNodes=function(){var e=function(e,t){return["div",{style:"position: absolute;top:"+e+"px;left:"+t+"px;"}]};this.els=s.buildDom([e(0,0),e(u,0),e(0,u),e(u,u)],this.el)},this.transformCoordinates=function(e,t){e&&(e=r(1/this.$getZoom(this.el),e));function i(e,t,i){var n=e[1]*t[0]-e[0]*t[1];return[(-t[1]*i[0]+t[0]*i[1])/n,(+e[1]*i[0]-e[0]*i[1])/n]}function n(e,t){return[e[0]-t[0],e[1]-t[1]]}function s(e,t){return[e[0]+t[0],e[1]+t[1]]}function r(e,t){return[e*t[0],e*t[1]]}function o(e){var t=e.getBoundingClientRect();return[t.left,t.top]}this.els||this.$initTransformMeasureNodes();var a=o(this.els[0]),l=o(this.els[1]),h=o(this.els[2]),c=o(this.els[3]),d=i(n(c,l),n(c,h),n(s(l,h),s(c,a))),f=r(1+d[0],n(l,a)),p=r(1+d[1],n(h,a));if(t){var g=t,m=d[0]*g[0]/u+d[1]*g[1]/u+1,v=s(r(g[0],f),r(g[1],p));return s(r(1/m/u,v),a)}var w=n(e,a),y=i(n(f,r(d[0],w)),n(p,r(d[1],w)),w);return r(u,y)}}).call(d.prototype)})),ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter","ace/lib/useragent"],(function(e,t,i){var n=e("./lib/oop"),s=e("./lib/dom"),r=e("./config"),o=e("./layer/gutter").Gutter,a=e("./layer/marker").Marker,l=e("./layer/text").Text,h=e("./layer/cursor").Cursor,c=e("./scrollbar").HScrollBar,u=e("./scrollbar").VScrollBar,d=e("./renderloop").RenderLoop,f=e("./layer/font_metrics").FontMetrics,p=e("./lib/event_emitter").EventEmitter,g='.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;padding: 0;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark > .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}',m=e("./lib/useragent"),v=m.isIE;s.importCssString(g,"ace_editor.css",!1);var w=function(e,t){var i=this;this.container=e||s.createElement("div"),s.addCssClass(this.container,"ace_editor"),s.HI_DPI&&s.addCssClass(this.container,"ace_hidpi"),this.setTheme(t),null==r.get("useStrictCSP")&&r.set("useStrictCSP",!1),this.$gutter=s.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden",!0),this.scroller=s.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=s.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new o(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new a(this.content);var n=this.$textLayer=new l(this.content);this.canvas=n.element,this.$markerFront=new a(this.content),this.$cursorLayer=new h(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new u(this.container,this),this.scrollBarH=new c(this.container,this),this.scrollBarV.on("scroll",(function(e){i.$scrollAnimation||i.session.setScrollTop(e.data-i.scrollMargin.top)})),this.scrollBarH.on("scroll",(function(e){i.$scrollAnimation||i.session.setScrollLeft(e.data-i.scrollMargin.left)})),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new f(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.on("changeCharacterSize",(function(e){i.updateCharacterSize(),i.onResize(!0,i.gutterWidth,i.$size.width,i.$size.height),i._signal("changeCharacterSize",e)})),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!m.isIOS,this.$loop=new d(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),r.resetOptions(this),r._signal("renderer",this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,n.implement(this,p),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin(),s.setStyle(this.scroller.style,"line-height",this.lineHeight+"px")},this.setSession=function(e){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=e,e&&this.scrollMargin.top&&e.getScrollTop()<=0&&e.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(e),this.$markerBack.setSession(e),this.$markerFront.setSession(e),this.$gutterLayer.setSession(e),this.$textLayer.setSession(e),e&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},this.updateLines=function(e,t,i){if(void 0===t&&(t=1/0),this.$changedLines?(this.$changedLines.firstRow>e&&(this.$changedLines.firstRow=e),this.$changedLines.lastRow<t&&(this.$changedLines.lastRow=t)):this.$changedLines={firstRow:e,lastRow:t},this.$changedLines.lastRow<this.layerConfig.firstRow){if(!i)return;this.$changedLines.lastRow=this.layerConfig.lastRow}this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(e){e?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(e,t,i,n){if(!(this.resizing>2)){this.resizing>0?this.resizing++:this.resizing=e?1:0;var s=this.container;n||(n=s.clientHeight||s.scrollHeight),i||(i=s.clientWidth||s.scrollWidth);var r=this.$updateCachedSize(e,t,i,n);if(!this.$size.scrollerHeight||!i&&!n)return this.resizing=0;e&&(this.$gutterLayer.$padding=null),e?this.$renderChanges(r|this.$changes,!0):this.$loop.schedule(r|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null}},this.$updateCachedSize=function(e,t,i,n){n-=this.$extraHeight||0;var r=0,o=this.$size,a={width:o.width,height:o.height,scrollerHeight:o.scrollerHeight,scrollerWidth:o.scrollerWidth};if(n&&(e||o.height!=n)&&(o.height=n,r|=this.CHANGE_SIZE,o.scrollerHeight=o.height,this.$horizScroll&&(o.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",r|=this.CHANGE_SCROLL),i&&(e||o.width!=i)){r|=this.CHANGE_SIZE,o.width=i,null==t&&(t=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=t,s.setStyle(this.scrollBarH.element.style,"left",t+"px"),s.setStyle(this.scroller.style,"left",t+this.margin.left+"px"),o.scrollerWidth=Math.max(0,i-t-this.scrollBarV.getWidth()-this.margin.h),s.setStyle(this.$gutter.style,"left",this.margin.left+"px");var l=this.scrollBarV.getWidth()+"px";s.setStyle(this.scrollBarH.element.style,"right",l),s.setStyle(this.scroller.style,"right",l),s.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||e)&&(r|=this.CHANGE_FULL)}return o.$dirty=!i||!n,r&&this._signal("resize",a),r},this.onGutterResize=function(e){var t=this.$showGutter?e:0;t!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,t,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()||this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},this.adjustWrapLimit=function(){var e=this.$size.scrollerWidth-2*this.$padding,t=Math.floor(e/this.characterWidth);return this.session.adjustWrapLimit(t,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(e){this.setOption("animatedScroll",e)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(e){this.setOption("showInvisibles",e),this.session.$bidiHandler.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(e){this.setOption("displayIndentGuides",e)},this.setShowPrintMargin=function(e){this.setOption("showPrintMargin",e)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(e){this.setOption("printMarginColumn",e)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(e){return this.setOption("showGutter",e)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(e){this.setOption("fadeFoldWidgets",e)},this.setHighlightGutterLine=function(e){this.setOption("highlightGutterLine",e)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updatePrintMargin=function(){if(this.$showPrintMargin||this.$printMarginEl){if(!this.$printMarginEl){var e=s.createElement("div");e.className="ace_layer ace_print-margin-layer",this.$printMarginEl=s.createElement("div"),this.$printMarginEl.className="ace_print-margin",e.appendChild(this.$printMarginEl),this.content.insertBefore(e,this.content.firstChild)}var t=this.$printMarginEl.style;t.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",t.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&-1==this.session.$wrap&&this.adjustWrapLimit()}},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){if(!this.$isMousePressed){var e=this.textarea.style,t=this.$composition;if(this.$keepTextAreaAtCursor||t){var i=this.$cursorLayer.$pixelPos;if(i){t&&t.markerRange&&(i=this.$cursorLayer.getPixelPosition(t.markerRange.start,!0));var n=this.layerConfig,r=i.top,o=i.left;r-=n.offset;var a=t&&t.useTextareaForIME?this.lineHeight:v?0:1;if(r<0||r>n.height-a)s.translate(this.textarea,0,0);else{var l=1,h=this.$size.height-a;if(t)if(t.useTextareaForIME){var c=this.textarea.value;l=this.characterWidth*this.session.$getStringScreenWidth(c)[0]}else r+=this.lineHeight+2;else r+=this.lineHeight;(o-=this.scrollLeft)>this.$size.scrollerWidth-l&&(o=this.$size.scrollerWidth-l),o+=this.gutterWidth+this.margin.left,s.setStyle(e,"height",a+"px"),s.setStyle(e,"width",l+"px"),s.translate(this.textarea,Math.min(o,this.$size.scrollerWidth-l),Math.min(r,h))}}}else s.translate(this.textarea,-100,0)}},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(0===this.layerConfig.offset?0:1)},this.getLastFullyVisibleRow=function(){var e=this.layerConfig,t=e.lastRow;return this.session.documentToScreenRow(t,0)*e.lineHeight-this.session.getScrollTop()>e.height-e.lineHeight?t-1:t},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(e){this.$padding=e,this.$textLayer.setPadding(e),this.$cursorLayer.setPadding(e),this.$markerFront.setPadding(e),this.$markerBack.setPadding(e),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(e,t,i,n){var s=this.scrollMargin;s.top=0|e,s.bottom=0|t,s.right=0|n,s.left=0|i,s.v=s.top+s.bottom,s.h=s.left+s.right,s.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-s.top),this.updateFull()},this.setMargin=function(e,t,i,n){var s=this.margin;s.top=0|e,s.bottom=0|t,s.right=0|n,s.left=0|i,s.v=s.top+s.bottom,s.h=s.left+s.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(e){this.setOption("hScrollBarAlwaysVisible",e)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(e){this.setOption("vScrollBarAlwaysVisible",e)},this.$updateScrollBarV=function(){var e=this.layerConfig.maxHeight,t=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(e-=(t-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>e-t&&(e=this.scrollTop+t,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(e+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(e,t){if(this.$changes&&(e|=this.$changes,this.$changes=0),this.session&&this.container.offsetWidth&&!this.$frozen&&(e||t)){if(this.$size.$dirty)return this.$changes|=e,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender",e),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var i=this.layerConfig;if(e&this.CHANGE_FULL||e&this.CHANGE_SIZE||e&this.CHANGE_TEXT||e&this.CHANGE_LINES||e&this.CHANGE_SCROLL||e&this.CHANGE_H_SCROLL){if(e|=this.$computeLayerConfig()|this.$loop.clear(),i.firstRow!=this.layerConfig.firstRow&&i.firstRowScreen==this.layerConfig.firstRowScreen){var n=this.scrollTop+(i.firstRow-this.layerConfig.firstRow)*this.lineHeight;n>0&&(this.scrollTop=n,e|=this.CHANGE_SCROLL,e|=this.$computeLayerConfig()|this.$loop.clear())}i=this.layerConfig,this.$updateScrollBarV(),e&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),s.translate(this.content,-this.scrollLeft,-i.offset);var r=i.width+2*this.$padding+"px",o=i.minHeight+"px";s.setStyle(this.content.style,"width",r),s.setStyle(this.content.style,"height",o)}if(e&this.CHANGE_H_SCROLL&&(s.translate(this.content,-this.scrollLeft,-i.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"),e&this.CHANGE_FULL)return this.$changedLines=null,this.$textLayer.update(i),this.$showGutter&&this.$gutterLayer.update(i),this.$markerBack.update(i),this.$markerFront.update(i),this.$cursorLayer.update(i),this.$moveTextAreaToCursor(),void this._signal("afterRender",e);if(e&this.CHANGE_SCROLL)return this.$changedLines=null,e&this.CHANGE_TEXT||e&this.CHANGE_LINES?this.$textLayer.update(i):this.$textLayer.scrollLines(i),this.$showGutter&&(e&this.CHANGE_GUTTER||e&this.CHANGE_LINES?this.$gutterLayer.update(i):this.$gutterLayer.scrollLines(i)),this.$markerBack.update(i),this.$markerFront.update(i),this.$cursorLayer.update(i),this.$moveTextAreaToCursor(),void this._signal("afterRender",e);e&this.CHANGE_TEXT?(this.$changedLines=null,this.$textLayer.update(i),this.$showGutter&&this.$gutterLayer.update(i)):e&this.CHANGE_LINES?(this.$updateLines()||e&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(i):e&this.CHANGE_TEXT||e&this.CHANGE_GUTTER?this.$showGutter&&this.$gutterLayer.update(i):e&this.CHANGE_CURSOR&&this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(i),e&this.CHANGE_CURSOR&&(this.$cursorLayer.update(i),this.$moveTextAreaToCursor()),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(i),e&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(i),this._signal("afterRender",e)}else this.$changes|=e},this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight,t=this.$maxLines*this.lineHeight,i=Math.min(t,Math.max((this.$minLines||1)*this.lineHeight,e))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(i+=this.scrollBarH.getHeight()),this.$maxPixelHeight&&i>this.$maxPixelHeight&&(i=this.$maxPixelHeight);var n=!(i<=2*this.lineHeight)&&e>t;if(i!=this.desiredHeight||this.$size.height!=this.desiredHeight||n!=this.$vScroll){n!=this.$vScroll&&(this.$vScroll=n,this.scrollBarV.setVisible(n));var s=this.container.clientWidth;this.container.style.height=i+"px",this.$updateCachedSize(!0,this.$gutterWidth,s,i),this.desiredHeight=i,this._signal("autosize")}},this.$computeLayerConfig=function(){var e=this.session,t=this.$size,i=t.height<=2*this.lineHeight,n=this.session.getScreenLength()*this.lineHeight,s=this.$getLongestLine(),r=!i&&(this.$hScrollBarAlwaysVisible||t.scrollerWidth-s-2*this.$padding<0),o=this.$horizScroll!==r;o&&(this.$horizScroll=r,this.scrollBarH.setVisible(r));var a=this.$vScroll;this.$maxLines&&this.lineHeight>1&&this.$autosize();var l=t.scrollerHeight+this.lineHeight,h=!this.$maxLines&&this.$scrollPastEnd?(t.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;n+=h;var c=this.scrollMargin;this.session.setScrollTop(Math.max(-c.top,Math.min(this.scrollTop,n-t.scrollerHeight+c.bottom))),this.session.setScrollLeft(Math.max(-c.left,Math.min(this.scrollLeft,s+2*this.$padding-t.scrollerWidth+c.right)));var u=!i&&(this.$vScrollBarAlwaysVisible||t.scrollerHeight-n+h<0||this.scrollTop>c.top),d=a!==u;d&&(this.$vScroll=u,this.scrollBarV.setVisible(u));var f,p,g=this.scrollTop%this.lineHeight,m=Math.ceil(l/this.lineHeight)-1,v=Math.max(0,Math.round((this.scrollTop-g)/this.lineHeight)),w=v+m,y=this.lineHeight;v=e.screenToDocumentRow(v,0);var b=e.getFoldLine(v);b&&(v=b.start.row),f=e.documentToScreenRow(v,0),p=e.getRowLength(v)*y,w=Math.min(e.screenToDocumentRow(w,0),e.getLength()-1),l=t.scrollerHeight+e.getRowLength(w)*y+p,g=this.scrollTop-f*y;var _=0;return(this.layerConfig.width!=s||o)&&(_=this.CHANGE_H_SCROLL),(o||d)&&(_|=this.$updateCachedSize(!0,this.gutterWidth,t.width,t.height),this._signal("scrollbarVisibilityChanged"),d&&(s=this.$getLongestLine())),this.layerConfig={width:s,padding:this.$padding,firstRow:v,firstRowScreen:f,lastRow:w,lineHeight:y,characterWidth:this.characterWidth,minHeight:l,maxHeight:n,offset:g,gutterOffset:y?Math.max(0,Math.ceil((g+t.height-t.scrollerHeight)/y)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(s-this.$padding),_},this.$updateLines=function(){if(this.$changedLines){var e=this.$changedLines.firstRow,t=this.$changedLines.lastRow;this.$changedLines=null;var i=this.layerConfig;if(!(e>i.lastRow+1||t<i.firstRow))return t===1/0?(this.$showGutter&&this.$gutterLayer.update(i),void this.$textLayer.update(i)):(this.$textLayer.updateLines(i,e,t),!0)}},this.$getLongestLine=function(){var e=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(e+=1),this.$textLayer&&e>this.$textLayer.MAX_LINE_LENGTH&&(e=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(e*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(e,t){this.$gutterLayer.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){this.$gutterLayer.removeGutterDecoration(e,t)},this.updateBreakpoints=function(e){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(e){this.$gutterLayer.setAnnotations(e),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(e,t,i){this.scrollCursorIntoView(e,i),this.scrollCursorIntoView(t,i)},this.scrollCursorIntoView=function(e,t,i){if(0!==this.$size.scrollerHeight){var n=this.$cursorLayer.getPixelPosition(e),s=n.left,r=n.top,o=i&&i.top||0,a=i&&i.bottom||0,l=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;l+o>r?(t&&l+o>r+this.lineHeight&&(r-=t*this.$size.scrollerHeight),0===r&&(r=-this.scrollMargin.top),this.session.setScrollTop(r)):l+this.$size.scrollerHeight-a<r+this.lineHeight&&(t&&l+this.$size.scrollerHeight-a<r-this.lineHeight&&(r+=t*this.$size.scrollerHeight),this.session.setScrollTop(r+this.lineHeight+a-this.$size.scrollerHeight));var h=this.scrollLeft;h>s?(s<this.$padding+2*this.layerConfig.characterWidth&&(s=-this.scrollMargin.left),this.session.setScrollLeft(s)):h+this.$size.scrollerWidth<s+this.characterWidth?this.session.setScrollLeft(Math.round(s+this.characterWidth-this.$size.scrollerWidth)):h<=this.$padding&&s-h<this.characterWidth&&this.session.setScrollLeft(0)}},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(e){this.session.setScrollTop(e*this.lineHeight)},this.alignCursor=function(e,t){"number"==typeof e&&(e={row:e,column:0});var i=this.$cursorLayer.getPixelPosition(e),n=this.$size.scrollerHeight-this.lineHeight,s=i.top-n*(t||0);return this.session.setScrollTop(s),s},this.STEPS=8,this.$calcSteps=function(e,t){var i,n,s=0,r=this.STEPS,o=[];for(s=0;s<r;++s)o.push((i=s/this.STEPS,n=e,(t-e)*(Math.pow(i-1,3)+1)+n));return o},this.scrollToLine=function(e,t,i,n){var s=this.$cursorLayer.getPixelPosition({row:e,column:0}).top;t&&(s-=this.$size.scrollerHeight/2);var r=this.scrollTop;this.session.setScrollTop(s),!1!==i&&this.animateScrolling(r,n)},this.animateScrolling=function(e,t){var i=this.scrollTop;if(this.$animatedScroll){var n=this;if(e!=i){if(this.$scrollAnimation){var s=this.$scrollAnimation.steps;if(s.length&&(e=s[0])==i)return}var r=n.$calcSteps(e,i);this.$scrollAnimation={from:e,to:i,steps:r},clearInterval(this.$timer),n.session.setScrollTop(r.shift()),n.session.$scrollTop=i,this.$timer=setInterval((function(){if(!n.session)return clearInterval(n.$timer);r.length?(n.session.setScrollTop(r.shift()),n.session.$scrollTop=i):null!=i?(n.session.$scrollTop=-1,n.session.setScrollTop(i),i=null):(n.$timer=clearInterval(n.$timer),n.$scrollAnimation=null,t&&t())}),10)}}},this.scrollToY=function(e){this.scrollTop!==e&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=e)},this.scrollToX=function(e){this.scrollLeft!==e&&(this.scrollLeft=e),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(e,t){this.session.setScrollTop(t),this.session.setScrollLeft(e)},this.scrollBy=function(e,t){t&&this.session.setScrollTop(this.session.getScrollTop()+t),e&&this.session.setScrollLeft(this.session.getScrollLeft()+e)},this.isScrollableBy=function(e,t){return t<0&&this.session.getScrollTop()>=1-this.scrollMargin.top||(t>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom||(e<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left||(e>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right||void 0)))},this.pixelToScreenCoordinates=function(e,t){var i;if(this.$hasCssTransforms){i={top:0,left:0};var n=this.$fontMetrics.transformCoordinates([e,t]);e=n[1]-this.gutterWidth-this.margin.left,t=n[0]}else i=this.scroller.getBoundingClientRect();var s=e+this.scrollLeft-i.left-this.$padding,r=s/this.characterWidth,o=Math.floor((t+this.scrollTop-i.top)/this.lineHeight),a=this.$blockCursor?Math.floor(r):Math.round(r);return{row:o,column:a,side:r-a>0?1:-1,offsetX:s}},this.screenToTextCoordinates=function(e,t){var i;if(this.$hasCssTransforms){i={top:0,left:0};var n=this.$fontMetrics.transformCoordinates([e,t]);e=n[1]-this.gutterWidth-this.margin.left,t=n[0]}else i=this.scroller.getBoundingClientRect();var s=e+this.scrollLeft-i.left-this.$padding,r=s/this.characterWidth,o=this.$blockCursor?Math.floor(r):Math.round(r),a=Math.floor((t+this.scrollTop-i.top)/this.lineHeight);return this.session.screenToDocumentPosition(a,Math.max(o,0),s)},this.textToScreenCoordinates=function(e,t){var i=this.scroller.getBoundingClientRect(),n=this.session.documentToScreenPosition(e,t),s=this.$padding+(this.session.$bidiHandler.isBidiRow(n.row,e)?this.session.$bidiHandler.getPosLeft(n.column):Math.round(n.column*this.characterWidth)),r=n.row*this.lineHeight;return{pageX:i.left+s-this.scrollLeft,pageY:i.top+r-this.scrollTop}},this.visualizeFocus=function(){s.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){s.removeCssClass(this.container,"ace_focus")},this.showComposition=function(e){this.$composition=e,e.cssText||(e.cssText=this.textarea.style.cssText),null==e.useTextareaForIME&&(e.useTextareaForIME=this.$useTextareaForIME),this.$useTextareaForIME?(s.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):e.markerId=this.session.addMarker(e.markerRange,"ace_composition_marker","text")},this.setCompositionText=function(e){var t=this.session.selection.cursor;this.addToken(e,"composition_placeholder",t.row,t.column),this.$moveTextAreaToCursor()},this.hideComposition=function(){if(this.$composition){this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),s.removeCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText=this.$composition.cssText;var e=this.session.selection.cursor;this.removeExtraToken(e.row,e.column),this.$composition=null,this.$cursorLayer.element.style.display=""}},this.addToken=function(e,t,i,n){var s=this.session;s.bgTokenizer.lines[i]=null;var r={type:t,value:e},o=s.getTokens(i);if(null==n)o.push(r);else for(var a=0,l=0;l<o.length;l++){var h=o[l];if(n<=(a+=h.value.length)){var c=h.value.length-(a-n),u=h.value.slice(0,c),d=h.value.slice(c);o.splice(l,1,{type:h.type,value:u},r,{type:h.type,value:d});break}}this.updateLines(i,i)},this.removeExtraToken=function(e,t){this.updateLines(e,e)},this.setTheme=function(e,t){var i=this;if(this.$themeId=e,i._dispatchEvent("themeChange",{theme:e}),e&&"string"!=typeof e)o(e);else{var n=e||this.$options.theme.initialValue;r.loadModule(["theme",n],o)}function o(n){if(i.$themeId!=e)return t&&t();if(!n||!n.cssClass)throw new Error("couldn't load module "+e+" or it didn't call define");n.$id&&(i.$themeId=n.$id),s.importCssString(n.cssText,n.cssClass,i.container),i.theme&&s.removeCssClass(i.container,i.theme.cssClass);var r="padding"in n?n.padding:"padding"in(i.theme||{})?4:i.$padding;i.$padding&&r!=i.$padding&&i.setPadding(r),i.$theme=n.cssClass,i.theme=n,s.addCssClass(i.container,n.cssClass),s.setCssClass(i.container,"ace_dark",n.isDark),i.$size&&(i.$size.width=0,i.$updateSizeAsync()),i._dispatchEvent("themeLoaded",{theme:n}),t&&t()}},this.getTheme=function(){return this.$themeId},this.setStyle=function(e,t){s.setCssClass(this.container,e,!1!==t)},this.unsetStyle=function(e){s.removeCssClass(this.container,e)},this.setCursorStyle=function(e){s.setStyle(this.scroller.style,"cursor",e)},this.setMouseCursor=function(e){s.setStyle(this.scroller.style,"cursor",e)},this.attachToShadowRoot=function(){s.importCssString(g,"ace_editor.css",this.container)},this.destroy=function(){this.freeze(),this.$fontMetrics.destroy(),this.$cursorLayer.destroy(),this.removeAllListeners(),this.container.textContent=""}}).call(w.prototype),r.defineOptions(w.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(e){this.$textLayer.setShowInvisibles(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(e){"number"==typeof e&&(this.$printMarginColumn=e),this.$showPrintMargin=!!e,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(e){this.$gutter.style.display=e?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(e){s.setCssClass(this.$gutter,"ace_fade-fold-widgets",e)},initialValue:!1},showFoldWidgets:{set:function(e){this.$gutterLayer.setShowFoldWidgets(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(e){this.$textLayer.setDisplayIndentGuides(e)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(e){this.$gutterLayer.setHighlightGutterLine(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(e){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(e){this.$vScrollBarAlwaysVisible&&this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(e){"number"==typeof e&&(e+="px"),this.container.style.fontSize=e,this.updateFontSize()},initialValue:12},fontFamily:{set:function(e){this.container.style.fontFamily=e,this.updateFontSize()}},maxLines:{set:function(e){this.updateFull()}},minLines:{set:function(e){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(e){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(e){e=+e||0,this.$scrollPastEnd!=e&&(this.$scrollPastEnd=e,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(e){this.$gutterLayer.$fixedWidth=!!e,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(e){this.setTheme(e)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!m.isMobile&&!m.isIE}}),t.VirtualRenderer=w})),ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],(function(e,t,i){var n=e("../lib/oop"),s=e("../lib/net"),r=e("../lib/event_emitter").EventEmitter,o=e("../config");function a(e){if("undefined"==typeof Worker)return{postMessage:function(){},terminate:function(){}};if(o.get("loadWorkerFromBlob")){var t=function(e){var t="importScripts('"+s.qualifyURL(e)+"');";try{return new Blob([t],{type:"application/javascript"})}catch(e){var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);return i.append(t),i.getBlob("application/javascript")}}(e),i=(window.URL||window.webkitURL).createObjectURL(t);return new Worker(i)}return new Worker(e)}var l=function(e){e.postMessage||(e=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=e,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){n.implement(this,r),this.$createWorkerFromOldConfig=function(t,i,n,s,r){if(e.nameToUrl&&!e.toUrl&&(e.toUrl=e.nameToUrl),o.get("packaged")||!e.toUrl)s=s||o.moduleUrl(i,"worker");else{var l=this.$normalizePath;s=s||l(e.toUrl("ace/worker/worker.js",null,"_"));var h={};t.forEach((function(t){h[t]=l(e.toUrl(t,null,"_").replace(/(\.js)?(\?.*)?$/,""))}))}return this.$worker=a(s),r&&this.send("importScripts",r),this.$worker.postMessage({init:!0,tlns:h,module:i,classname:n}),this.$worker},this.onMessage=function(e){var t=e.data;switch(t.type){case"event":this._signal(t.name,{data:t.data});break;case"call":var i=this.callbacks[t.id];i&&(i(t.data),delete this.callbacks[t.id]);break;case"error":this.reportError(t.data);break;case"log":window.console&&console.log&&console.log.apply(console,t.data)}},this.reportError=function(e){window.console&&console.error&&console.error(e)},this.$normalizePath=function(e){return s.qualifyURL(e)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(e,t){this.$worker.postMessage({command:e,args:t})},this.call=function(e,t,i){if(i){var n=this.callbackId++;this.callbacks[n]=i,t.push(n)}this.send(e,t)},this.emit=function(e,t){try{t.data&&t.data.err&&(t.data.err={message:t.data.err.message,stack:t.data.err.stack,code:t.data.err.code}),this.$worker&&this.$worker.postMessage({event:e,data:{data:t.data}})}catch(e){console.error(e.stack)}},this.attachToDocument=function(e){this.$doc&&this.terminate(),this.$doc=e,this.call("setValue",[e.getValue()]),e.on("change",this.changeListener)},this.changeListener=function(e){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),"insert"==e.action?this.deltaQueue.push(e.start,e.lines):this.deltaQueue.push(e.start,e.end)},this.$sendDeltaQueue=function(){var e=this.deltaQueue;e&&(this.deltaQueue=null,e.length>50&&e.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:e}))}}).call(l.prototype);t.UIWorkerClient=function(e,t,i){var n=null,s=!1,a=Object.create(r),h=[],c=new l({messageBuffer:h,terminate:function(){},postMessage:function(e){h.push(e),n&&(s?setTimeout(u):u())}});c.setEmitSync=function(e){s=e};var u=function(){var e=h.shift();e.command?n[e.command].apply(n,e.args):e.event&&a._signal(e.event,e.data)};return a.postMessage=function(e){c.onMessage({data:e})},a.callback=function(e,t){this.postMessage({type:"call",id:t,data:e})},a.emit=function(e,t){this.postMessage({type:"event",name:e,data:t})},o.loadModule(["worker",t],(function(e){for(n=new e[i](a);h.length;)u()})),c},t.WorkerClient=l,t.createWorker=a})),ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],(function(e,t,i){var n=e("./range").Range,s=e("./lib/event_emitter").EventEmitter,r=e("./lib/oop"),o=function(e,t,i,n,s,r){var o=this;this.length=t,this.session=e,this.doc=e.getDocument(),this.mainClass=s,this.othersClass=r,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=n,this.$onCursorChange=function(){setTimeout((function(){o.onCursorChange()}))},this.$pos=i;var a=e.getUndoManager().$undoStack||e.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=a.length,this.setup(),e.selection.on("changeCursor",this.$onCursorChange)};(function(){r.implement(this,s),this.setup=function(){var e=this,t=this.doc,i=this.session;this.selectionBefore=i.selection.toJSON(),i.selection.inMultiSelectMode&&i.selection.toSingleRange(),this.pos=t.createAnchor(this.$pos.row,this.$pos.column);var s=this.pos;s.$insertRight=!0,s.detach(),s.markerId=i.addMarker(new n(s.row,s.column,s.row,s.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach((function(i){var n=t.createAnchor(i.row,i.column);n.$insertRight=!0,n.detach(),e.others.push(n)})),i.setUndoSelect(!1)},this.showOtherMarkers=function(){if(!this.othersActive){var e=this.session,t=this;this.othersActive=!0,this.others.forEach((function(i){i.markerId=e.addMarker(new n(i.row,i.column,i.row,i.column+t.length),t.othersClass,null,!1)}))}},this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var e=0;e<this.others.length;e++)this.session.removeMarker(this.others[e].markerId)}},this.onUpdate=function(e){if(this.$updating)return this.updateAnchors(e);var t=e;if(t.start.row===t.end.row&&t.start.row===this.pos.row){this.$updating=!0;var i="insert"===e.action?t.end.column-t.start.column:t.start.column-t.end.column,s=t.start.column>=this.pos.column&&t.start.column<=this.pos.column+this.length+1,r=t.start.column-this.pos.column;if(this.updateAnchors(e),s&&(this.length+=i),s&&!this.session.$fromUndo)if("insert"===e.action)for(var o=this.others.length-1;o>=0;o--){var a={row:(l=this.others[o]).row,column:l.column+r};this.doc.insertMergedLines(a,e.lines)}else if("remove"===e.action)for(o=this.others.length-1;o>=0;o--){var l;a={row:(l=this.others[o]).row,column:l.column+r};this.doc.remove(new n(a.row,a.column,a.row,a.column-i))}this.$updating=!1,this.updateMarkers()}},this.updateAnchors=function(e){this.pos.onChange(e);for(var t=this.others.length;t--;)this.others[t].onChange(e);this.updateMarkers()},this.updateMarkers=function(){if(!this.$updating){var e=this,t=this.session,i=function(i,s){t.removeMarker(i.markerId),i.markerId=t.addMarker(new n(i.row,i.column,i.row,i.column+e.length),s,null,!1)};i(this.pos,this.mainClass);for(var s=this.others.length;s--;)i(this.others[s],this.othersClass)}},this.onCursorChange=function(e){if(!this.$updating&&this.session){var t=this.session.selection.getCursor();t.row===this.pos.row&&t.column>=this.pos.column&&t.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",e)):(this.hideOtherMarkers(),this._emit("cursorLeave",e))}},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.off("change",this.$onUpdate),this.session.selection.off("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(-1!==this.$undoStackDepth){for(var e=this.session.getUndoManager(),t=(e.$undoStack||e.$undostack).length-this.$undoStackDepth,i=0;i<t;i++)e.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(o.prototype),t.PlaceHolder=o})),ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],(function(e,t,i){var n=e("../lib/event"),s=e("../lib/useragent");function r(e,t){return e.row==t.row&&e.column==t.column}t.onMouseDown=function(e){var t=e.domEvent,i=t.altKey,o=t.shiftKey,a=t.ctrlKey,l=e.getAccelKey(),h=e.getButton();if(a&&s.isMac&&(h=t.button),e.editor.inMultiSelectMode&&2==h)e.editor.textInput.onContextMenu(e.domEvent);else if(a||i||l){if(0===h){var c,u=e.editor,d=u.selection,f=u.inMultiSelectMode,p=e.getDocumentPosition(),g=d.getCursor(),m=e.inSelection()||d.isEmpty()&&r(p,g),v=e.x,w=e.y,y=u.session,b=u.renderer.pixelToScreenCoordinates(v,w),_=b;if(u.$mouseHandler.$enableJumpToDef)a&&i||l&&i?c=o?"block":"add":i&&u.$blockSelectEnabled&&(c="block");else if(l&&!i){if(c="add",!f&&o)return}else i&&u.$blockSelectEnabled&&(c="block");if(c&&s.isMac&&t.ctrlKey&&u.$mouseHandler.cancelContextMenu(),"add"==c){if(!f&&m)return;if(!f){var C=d.toOrientedRange();u.addSelectionMarker(C)}var S=d.rangeList.rangeAtPoint(p);u.inVirtualSelectionMode=!0,o&&(S=null,C=d.ranges[0]||C,u.removeSelectionMarker(C)),u.once("mouseup",(function(){var e=d.toOrientedRange();S&&e.isEmpty()&&r(S.cursor,e.cursor)?d.substractPoint(e.cursor):(o?d.substractPoint(C.cursor):C&&(u.removeSelectionMarker(C),d.addRange(C)),d.addRange(e)),u.inVirtualSelectionMode=!1}))}else if("block"==c){var x;e.stop(),u.inVirtualSelectionMode=!0;var k=[],A=function(){var e=u.renderer.pixelToScreenCoordinates(v,w),t=y.screenToDocumentPosition(e.row,e.column,e.offsetX);r(_,e)&&r(t,d.lead)||(_=e,u.selection.moveToPosition(t),u.renderer.scrollCursorIntoView(),u.removeSelectionMarkers(k),k=d.rectangularRangeBlock(_,b),u.$mouseHandler.$clickSelection&&1==k.length&&k[0].isEmpty()&&(k[0]=u.$mouseHandler.$clickSelection.clone()),k.forEach(u.addSelectionMarker,u),u.updateSelectionMarkers())};f&&!l?d.toSingleRange():!f&&l&&(x=d.toOrientedRange(),u.addSelectionMarker(x)),o?b=y.documentToScreenPosition(d.lead):d.moveToPosition(p),_={row:-1,column:-1};var E=A;n.capture(u.container,(function(e){v=e.clientX,w=e.clientY}),(function(e){A(),clearInterval(T),u.removeSelectionMarkers(k),k.length||(k=[d.toOrientedRange()]),x&&(u.removeSelectionMarker(x),d.toSingleRange(x));for(var t=0;t<k.length;t++)d.addRange(k[t]);u.inVirtualSelectionMode=!1,u.$mouseHandler.$clickSelection=null}));var T=setInterval((function(){E()}),20);return e.preventDefault()}}}else 0===h&&e.editor.inMultiSelectMode&&e.editor.exitMultiSelectMode()}})),ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],(function(e,t,i){t.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(e){e.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(e){e.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",description:"Add cursor above (skip current)",exec:function(e){e.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(e){e.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(e){e.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(e){e.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(e){e.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(e){e.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"toggleSplitSelectionIntoLines",description:"Split into lines",exec:function(e){e.multiSelect.rangeCount>1?e.multiSelect.joinSelections():e.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"splitSelectionIntoLines",description:"Split into lines",exec:function(e){e.multiSelect.splitIntoLines()},readOnly:!0},{name:"alignCursors",description:"Align cursors",exec:function(e){e.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(e){e.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],t.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(e){e.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(e){return e&&e.inMultiSelectMode}}];var n=e("../keyboard/hash_handler").HashHandler;t.keyboardHandler=new n(t.multiSelectCommands)})),ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],(function(e,t,i){var n=e("./range_list").RangeList,s=e("./range").Range,r=e("./selection").Selection,o=e("./mouse/multi_select_handler").onMouseDown,a=e("./lib/event"),l=e("./lib/lang"),h=e("./commands/multi_select_commands");t.commands=h.defaultCommands.concat(h.multiSelectCommands);var c=new(0,e("./search").Search);var u=e("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(u.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(e,t){if(e){if(!this.inMultiSelectMode&&0===this.rangeCount){var i=this.toOrientedRange();if(this.rangeList.add(i),this.rangeList.add(e),2!=this.rangeList.ranges.length)return this.rangeList.removeAll(),t||this.fromOrientedRange(e);this.rangeList.removeAll(),this.rangeList.add(i),this.$onAddRange(i)}e.cursor||(e.cursor=e.end);var n=this.rangeList.add(e);return this.$onAddRange(e),n.length&&this.$onRemoveRange(n),this.rangeCount>1&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),t||this.fromOrientedRange(e)}},this.toSingleRange=function(e){e=e||this.ranges[0];var t=this.rangeList.removeAll();t.length&&this.$onRemoveRange(t),e&&this.fromOrientedRange(e)},this.substractPoint=function(e){var t=this.rangeList.substractPoint(e);if(t)return this.$onRemoveRange(t),t[0]},this.mergeOverlappingRanges=function(){var e=this.rangeList.merge();e.length&&this.$onRemoveRange(e)},this.$onAddRange=function(e){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(e),this._signal("addRange",{range:e})},this.$onRemoveRange=function(e){if(this.rangeCount=this.rangeList.ranges.length,1==this.rangeCount&&this.inMultiSelectMode){var t=this.rangeList.ranges.pop();e.push(t),this.rangeCount=0}for(var i=e.length;i--;){var n=this.ranges.indexOf(e[i]);this.ranges.splice(n,1)}this._signal("removeRange",{ranges:e}),0===this.rangeCount&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),(t=t||this.ranges[0])&&!t.isEqual(this.getRange())&&this.fromOrientedRange(t)},this.$initRangeList=function(){this.rangeList||(this.rangeList=new n,this.ranges=[],this.rangeCount=0)},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){for(var e=this.ranges.length?this.ranges:[this.getRange()],t=[],i=0;i<e.length;i++){var n=e[i],r=n.start.row,o=n.end.row;if(r===o)t.push(n.clone());else{for(t.push(new s(r,n.start.column,r,this.session.getLine(r).length));++r<o;)t.push(this.getLineRange(r,!0));t.push(new s(o,0,o,n.end.column))}0!=i||this.isBackwards()||(t=t.reverse())}this.toSingleRange();for(i=t.length;i--;)this.addRange(t[i])},this.joinSelections=function(){var e=this.rangeList.ranges,t=e[e.length-1],i=s.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(i,t.cursor==t.start)},this.toggleBlockSelection=function(){if(this.rangeCount>1){var e=this.rangeList.ranges,t=e[e.length-1],i=s.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(i,t.cursor==t.start)}else{var n=this.session.documentToScreenPosition(this.cursor),r=this.session.documentToScreenPosition(this.anchor);this.rectangularRangeBlock(n,r).forEach(this.addRange,this)}},this.rectangularRangeBlock=function(e,t,i){var n=[],r=e.column<t.column;if(r)var o=e.column,a=t.column,l=e.offsetX,h=t.offsetX;else o=t.column,a=e.column,l=t.offsetX,h=e.offsetX;var c,u,d,f=e.row<t.row;if(f)var p=e.row,g=t.row;else p=t.row,g=e.row;o<0&&(o=0),p<0&&(p=0),p==g&&(i=!0);for(var m=p;m<=g;m++){var v=s.fromPoints(this.session.screenToDocumentPosition(m,o,l),this.session.screenToDocumentPosition(m,a,h));if(v.isEmpty()){if(c&&(u=v.end,d=c,u.row==d.row&&u.column==d.column))break;c=v.end}v.cursor=r?v.start:v.end,n.push(v)}if(f&&n.reverse(),!i){for(var w=n.length-1;n[w].isEmpty()&&w>0;)w--;if(w>0)for(var y=0;n[y].isEmpty();)y++;for(var b=w;b>=y;b--)n[b].isEmpty()&&n.splice(b,1)}return n}}.call(r.prototype);var d=e("./editor").Editor;function f(e){e.$multiselectOnSessionChange||(e.$onAddRange=e.$onAddRange.bind(e),e.$onRemoveRange=e.$onRemoveRange.bind(e),e.$onMultiSelect=e.$onMultiSelect.bind(e),e.$onSingleSelect=e.$onSingleSelect.bind(e),e.$multiselectOnSessionChange=t.onSessionChange.bind(e),e.$checkMultiselectChange=e.$checkMultiselectChange.bind(e),e.$multiselectOnSessionChange(e),e.on("changeSession",e.$multiselectOnSessionChange),e.on("mousedown",o),e.commands.addCommands(h.defaultCommands),function(e){if(!e.textInput)return;var t=e.textInput.getElement(),i=!1;function n(t){i&&(e.renderer.setMouseCursor(""),i=!1)}a.addListener(t,"keydown",(function(t){var s=18==t.keyCode&&!(t.ctrlKey||t.shiftKey||t.metaKey);e.$blockSelectEnabled&&s?i||(e.renderer.setMouseCursor("crosshair"),i=!0):i&&n()}),e),a.addListener(t,"keyup",n,e),a.addListener(t,"blur",n,e)}(e))}(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(e){e.cursor||(e.cursor=e.end);var t=this.getSelectionStyle();return e.marker=this.session.addMarker(e,"ace_selection",t),this.session.$selectionMarkers.push(e),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,e},this.removeSelectionMarker=function(e){if(e.marker){this.session.removeMarker(e.marker);var t=this.session.$selectionMarkers.indexOf(e);-1!=t&&this.session.$selectionMarkers.splice(t,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length}},this.removeSelectionMarkers=function(e){for(var t=this.session.$selectionMarkers,i=e.length;i--;){var n=e[i];if(n.marker){this.session.removeMarker(n.marker);var s=t.indexOf(n);-1!=s&&t.splice(s,1)}}this.session.selectionMarkerCount=t.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(h.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())},this.$onSingleSelect=function(e){this.session.multiSelect.inVirtualMode||(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(h.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))},this.$onMultiSelectExec=function(e){var t=e.command,i=e.editor;if(i.multiSelect){if(t.multiSelectAction)"forEach"==t.multiSelectAction?n=i.forEachSelection(t,e.args):"forEachLine"==t.multiSelectAction?n=i.forEachSelection(t,e.args,!0):"single"==t.multiSelectAction?(i.exitMultiSelectMode(),n=t.exec(i,e.args||{})):n=t.multiSelectAction(i,e.args||{});else{var n=t.exec(i,e.args||{});i.multiSelect.addRange(i.multiSelect.toOrientedRange()),i.multiSelect.mergeOverlappingRanges()}return n}},this.forEachSelection=function(e,t,i){if(!this.inVirtualSelectionMode){var n,s=i&&i.keepOrder,o=1==i||i&&i.$byLines,a=this.session,l=this.selection,h=l.rangeList,c=(s?l:h).ranges;if(!c.length)return e.exec?e.exec(this,t||{}):e(this,t||{});var u=l._eventRegistry;l._eventRegistry={};var d=new r(a);this.inVirtualSelectionMode=!0;for(var f=c.length;f--;){if(o)for(;f>0&&c[f].start.row==c[f-1].end.row;)f--;d.fromOrientedRange(c[f]),d.index=f,this.selection=a.selection=d;var p=e.exec?e.exec(this,t||{}):e(this,t||{});n||void 0===p||(n=p),d.toOrientedRange(c[f])}d.detach(),this.selection=a.selection=l,this.inVirtualSelectionMode=!1,l._eventRegistry=u,l.mergeOverlappingRanges(),l.ranges[0]&&l.fromOrientedRange(l.ranges[0]);var g=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),g&&g.from==g.to&&this.renderer.animateScrolling(g.from),n}},this.exitMultiSelectMode=function(){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&this.multiSelect.toSingleRange()},this.getSelectedText=function(){var e="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){for(var t=this.multiSelect.rangeList.ranges,i=[],n=0;n<t.length;n++)i.push(this.session.getTextRange(t[n]));var s=this.session.getDocument().getNewLineCharacter();(e=i.join(s)).length==(i.length-1)*s.length&&(e="")}else this.selection.isEmpty()||(e=this.session.getTextRange(this.getSelectionRange()));return e},this.$checkMultiselectChange=function(e,t){if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var i=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&&t==this.multiSelect.anchor)return;var n=t==this.multiSelect.anchor?i.cursor==i.start?i.end:i.start:i.cursor;n.row!=t.row||this.session.$clipPositionToDocument(n.row,n.column).column!=t.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()}},this.findAll=function(e,t,i){if((t=t||{}).needle=e||t.needle,null==t.needle){var n=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();t.needle=this.session.getTextRange(n)}this.$search.set(t);var s=this.$search.findAll(this.session);if(!s.length)return 0;var r=this.multiSelect;i||r.toSingleRange(s[0]);for(var o=s.length;o--;)r.addRange(s[o],!0);return n&&r.rangeList.rangeAtPoint(n.start)&&r.addRange(n,!0),s.length},this.selectMoreLines=function(e,t){var i=this.selection.toOrientedRange(),n=i.cursor==i.end,r=this.session.documentToScreenPosition(i.cursor);this.selection.$desiredColumn&&(r.column=this.selection.$desiredColumn);var o,a=this.session.screenToDocumentPosition(r.row+e,r.column);if(i.isEmpty())h=a;else var l=this.session.documentToScreenPosition(n?i.end:i.start),h=this.session.screenToDocumentPosition(l.row+e,l.column);n?(o=s.fromPoints(a,h)).cursor=o.start:(o=s.fromPoints(h,a)).cursor=o.end;if(o.desiredColumn=r.column,this.selection.inMultiSelectMode){if(t)var c=i.cursor}else this.selection.addRange(i);this.selection.addRange(o),c&&this.selection.substractPoint(c)},this.transposeSelections=function(e){for(var t=this.session,i=t.multiSelect,n=i.ranges,s=n.length;s--;){if((a=n[s]).isEmpty()){var r=t.getWordRange(a.start.row,a.start.column);a.start.row=r.start.row,a.start.column=r.start.column,a.end.row=r.end.row,a.end.column=r.end.column}}i.mergeOverlappingRanges();var o=[];for(s=n.length;s--;){var a=n[s];o.unshift(t.getTextRange(a))}e<0?o.unshift(o.pop()):o.push(o.shift());for(s=n.length;s--;){r=(a=n[s]).clone();t.replace(a,o[s]),a.start.row=r.start.row,a.start.column=r.start.column}i.fromOrientedRange(i.ranges[0])},this.selectMore=function(e,t,i){var n=this.session,s=n.multiSelect.toOrientedRange();if(!s.isEmpty()||((s=n.getWordRange(s.start.row,s.start.column)).cursor=-1==e?s.start:s.end,this.multiSelect.addRange(s),!i)){var r=n.getTextRange(s),o=function(e,t,i){return c.$options.wrap=!0,c.$options.needle=t,c.$options.backwards=-1==i,c.find(e)}(n,r,e);o&&(o.cursor=-1==e?o.start:o.end,this.session.unfold(o),this.multiSelect.addRange(o),this.renderer.scrollCursorIntoView(null,.5)),t&&this.multiSelect.substractPoint(s.cursor)}},this.alignCursors=function(){var e=this.session,t=e.multiSelect,i=t.ranges,n=-1,r=i.filter((function(e){if(e.cursor.row==n)return!0;n=e.cursor.row}));if(i.length&&r.length!=i.length-1){r.forEach((function(e){t.substractPoint(e.cursor)}));var o=0,a=1/0,h=i.map((function(t){var i=t.cursor,n=e.getLine(i.row).substr(i.column).search(/\S/g);return-1==n&&(n=0),i.column>o&&(o=i.column),n<a&&(a=n),n}));i.forEach((function(t,i){var n=t.cursor,r=o-n.column,c=h[i]-a;r>c?e.insert(n,l.stringRepeat(" ",r-c)):e.remove(new s(n.row,n.column,n.row,n.column-r+c)),t.start.column=t.end.column=o,t.start.row=t.end.row=n.row,t.cursor=t.end})),t.fromOrientedRange(i[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}else{var c=this.selection.getRange(),u=c.start.row,d=c.end.row,f=u==d;if(f){var p,g=this.session.getLength();do{p=this.session.getLine(d)}while(/[=:]/.test(p)&&++d<g);do{p=this.session.getLine(u)}while(/[=:]/.test(p)&&--u>0);u<0&&(u=0),d>=g&&(d=g-1)}var m=this.session.removeFullLines(u,d);m=this.$reAlignText(m,f),this.session.insert({row:u,column:0},m.join("\n")+"\n"),f||(c.start.column=0,c.end.column=m[m.length-1].length),this.selection.setRange(c)}},this.$reAlignText=function(e,t){var i,n,s,r=!0,o=!0;return e.map((function(e){var t=e.match(/(\s*)(.*?)(\s*)([=:].*)/);return t?null==i?(i=t[1].length,n=t[2].length,s=t[3].length,t):(i+n+s!=t[1].length+t[2].length+t[3].length&&(o=!1),i!=t[1].length&&(r=!1),i>t[1].length&&(i=t[1].length),n<t[2].length&&(n=t[2].length),s>t[3].length&&(s=t[3].length),t):[e]})).map(t?h:r?o?function(e){return e[2]?a(i+n-e[2].length)+e[2]+a(s)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}:h:function(e){return e[2]?a(i)+e[2]+a(s)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]});function a(e){return l.stringRepeat(" ",e)}function h(e){return e[2]?a(i)+e[2]+a(n-e[2].length+s)+e[4].replace(/^([=:])\s+/,"$1 "):e[0]}}}).call(d.prototype),t.onSessionChange=function(e){var t=e.session;t&&!t.multiSelect&&(t.$selectionMarkers=[],t.selection.$initRangeList(),t.multiSelect=t.selection),this.multiSelect=t&&t.multiSelect;var i=e.oldSession;i&&(i.multiSelect.off("addRange",this.$onAddRange),i.multiSelect.off("removeRange",this.$onRemoveRange),i.multiSelect.off("multiSelect",this.$onMultiSelect),i.multiSelect.off("singleSelect",this.$onSingleSelect),i.multiSelect.lead.off("change",this.$checkMultiselectChange),i.multiSelect.anchor.off("change",this.$checkMultiselectChange)),t&&(t.multiSelect.on("addRange",this.$onAddRange),t.multiSelect.on("removeRange",this.$onRemoveRange),t.multiSelect.on("multiSelect",this.$onMultiSelect),t.multiSelect.on("singleSelect",this.$onSingleSelect),t.multiSelect.lead.on("change",this.$checkMultiselectChange),t.multiSelect.anchor.on("change",this.$checkMultiselectChange)),t&&this.inMultiSelectMode!=t.selection.inMultiSelectMode&&(t.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},t.MultiSelect=f,e("./config").defineOptions(d.prototype,"editor",{enableMultiselect:{set:function(e){f(this),e?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",o)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",o))},value:!0},enableBlockSelect:{set:function(e){this.$blockSelectEnabled=e},value:!0}})})),ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],(function(e,t,i){var n=e("../../range").Range,s=t.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(e,t,i){var n=e.getLine(i);return this.foldingStartMarker.test(n)?"start":"markbeginend"==t&&this.foldingStopMarker&&this.foldingStopMarker.test(n)?"end":""},this.getFoldWidgetRange=function(e,t,i){return null},this.indentationBlock=function(e,t,i){var s=/\S/,r=e.getLine(t),o=r.search(s);if(-1!=o){for(var a=i||r.length,l=e.getLength(),h=t,c=t;++t<l;){var u=e.getLine(t).search(s);if(-1!=u){if(u<=o){var d=e.getTokenAt(t,0);if(!d||"string"!==d.type)break}c=t}}if(c>h){var f=e.getLine(c).length;return new n(h,a,c,f)}}},this.openingBracketBlock=function(e,t,i,s,r){var o={row:i,column:s+1},a=e.$findClosingBracket(t,o,r);if(a){var l=e.foldWidgets[a.row];return null==l&&(l=e.getFoldWidget(a.row)),"start"==l&&a.row>o.row&&(a.row--,a.column=e.getLine(a.row).length),n.fromPoints(o,a)}},this.closingBracketBlock=function(e,t,i,s,r){var o={row:i,column:s},a=e.$findOpeningBracket(t,o);if(a)return a.column++,o.column--,n.fromPoints(a,o)}}).call(s.prototype)})),ace.define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],(function(e,t,i){t.isDark=!1,t.cssClass="ace-tm",t.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}',t.$id="ace/theme/textmate",e("../lib/dom").importCssString(t.cssText,t.cssClass,!1)})),ace.define("ace/line_widgets",["require","exports","module","ace/lib/dom"],(function(e,t,i){var n=e("./lib/dom");function s(e){this.session=e,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}(function(){this.getRowLength=function(e){var t;return t=this.lineWidgets&&this.lineWidgets[e]&&this.lineWidgets[e].rowCount||0,this.$useWrapMode&&this.$wrapData[e]?this.$wrapData[e].length+1+t:1+t},this.$getWidgetScreenLength=function(){var e=0;return this.lineWidgets.forEach((function(t){t&&t.rowCount&&!t.hidden&&(e+=t.rowCount)})),e},this.$onChangeEditor=function(e){this.attach(e.editor)},this.attach=function(e){e&&e.widgetManager&&e.widgetManager!=this&&e.widgetManager.detach(),this.editor!=e&&(this.detach(),this.editor=e,e&&(e.widgetManager=this,e.renderer.on("beforeRender",this.measureWidgets),e.renderer.on("afterRender",this.renderWidgets)))},this.detach=function(e){var t=this.editor;if(t){this.editor=null,t.widgetManager=null,t.renderer.off("beforeRender",this.measureWidgets),t.renderer.off("afterRender",this.renderWidgets);var i=this.session.lineWidgets;i&&i.forEach((function(e){e&&e.el&&e.el.parentNode&&(e._inDocument=!1,e.el.parentNode.removeChild(e.el))}))}},this.updateOnFold=function(e,t){var i=t.lineWidgets;if(i&&e.action){for(var n=e.data,s=n.start.row,r=n.end.row,o="add"==e.action,a=s+1;a<r;a++)i[a]&&(i[a].hidden=o);i[r]&&(o?i[s]?i[r].hidden=o:i[s]=i[r]:(i[s]==i[r]&&(i[s]=void 0),i[r].hidden=o))}},this.updateOnChange=function(e){var t=this.session.lineWidgets;if(t){var i=e.start.row,n=e.end.row-i;if(0===n);else if("remove"==e.action){var s=t.splice(i+1,n);!t[i]&&s[s.length-1]&&(t[i]=s.pop()),s.forEach((function(e){e&&this.removeLineWidget(e)}),this),this.$updateRows()}else{var r=new Array(n);t[i]&&null!=t[i].column&&e.start.column>t[i].column&&i++,r.unshift(i,0),t.splice.apply(t,r),this.$updateRows()}}},this.$updateRows=function(){var e=this.session.lineWidgets;if(e){var t=!0;e.forEach((function(e,i){if(e)for(t=!1,e.row=i;e.$oldWidget;)e.$oldWidget.row=i,e=e.$oldWidget})),t&&(this.session.lineWidgets=null)}},this.$registerLineWidget=function(e){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var t=this.session.lineWidgets[e.row];return t&&(e.$oldWidget=t,t.el&&t.el.parentNode&&(t.el.parentNode.removeChild(t.el),t._inDocument=!1)),this.session.lineWidgets[e.row]=e,e},this.addLineWidget=function(e){if(this.$registerLineWidget(e),e.session=this.session,!this.editor)return e;var t=this.editor.renderer;e.html&&!e.el&&(e.el=n.createElement("div"),e.el.innerHTML=e.html),e.el&&(n.addCssClass(e.el,"ace_lineWidgetContainer"),e.el.style.position="absolute",e.el.style.zIndex=5,t.container.appendChild(e.el),e._inDocument=!0,e.coverGutter||(e.el.style.zIndex=3),null==e.pixelHeight&&(e.pixelHeight=e.el.offsetHeight)),null==e.rowCount&&(e.rowCount=e.pixelHeight/t.layerConfig.lineHeight);var i=this.session.getFoldAt(e.row,0);if(e.$fold=i,i){var s=this.session.lineWidgets;e.row!=i.end.row||s[i.start.row]?e.hidden=!0:s[i.start.row]=e}return this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows(),this.renderWidgets(null,t),this.onWidgetChanged(e),e},this.removeLineWidget=function(e){if(e._inDocument=!1,e.session=null,e.el&&e.el.parentNode&&e.el.parentNode.removeChild(e.el),e.editor&&e.editor.destroy)try{e.editor.destroy()}catch(e){}if(this.session.lineWidgets){var t=this.session.lineWidgets[e.row];if(t==e)this.session.lineWidgets[e.row]=e.$oldWidget,e.$oldWidget&&this.onWidgetChanged(e.$oldWidget);else for(;t;){if(t.$oldWidget==e){t.$oldWidget=e.$oldWidget;break}t=t.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:e.row}}}),this.$updateRows()},this.getWidgetsAtRow=function(e){for(var t=this.session.lineWidgets,i=t&&t[e],n=[];i;)n.push(i),i=i.$oldWidget;return n},this.onWidgetChanged=function(e){this.session._changedWidgets.push(e),this.editor&&this.editor.renderer.updateFull()},this.measureWidgets=function(e,t){var i=this.session._changedWidgets,n=t.layerConfig;if(i&&i.length){for(var s=1/0,r=0;r<i.length;r++){var o=i[r];if(o&&o.el&&o.session==this.session){if(!o._inDocument){if(this.session.lineWidgets[o.row]!=o)continue;o._inDocument=!0,t.container.appendChild(o.el)}o.h=o.el.offsetHeight,o.fixedWidth||(o.w=o.el.offsetWidth,o.screenWidth=Math.ceil(o.w/n.characterWidth));var a=o.h/n.lineHeight;o.coverLine&&(a-=this.session.getRowLineCount(o.row))<0&&(a=0),o.rowCount!=a&&(o.rowCount=a,o.row<s&&(s=o.row))}}s!=1/0&&(this.session._emit("changeFold",{data:{start:{row:s}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]}},this.renderWidgets=function(e,t){var i=t.layerConfig,n=this.session.lineWidgets;if(n){for(var s=Math.min(this.firstRow,i.firstRow),r=Math.max(this.lastRow,i.lastRow,n.length);s>0&&!n[s];)s--;this.firstRow=i.firstRow,this.lastRow=i.lastRow,t.$cursorLayer.config=i;for(var o=s;o<=r;o++){var a=n[o];if(a&&a.el)if(a.hidden)a.el.style.top=-100-(a.pixelHeight||0)+"px";else{a._inDocument||(a._inDocument=!0,t.container.appendChild(a.el));var l=t.$cursorLayer.getPixelPosition({row:o,column:0},!0).top;a.coverLine||(l+=i.lineHeight*this.session.getRowLineCount(a.row)),a.el.style.top=l-i.offset+"px";var h=a.coverGutter?0:t.gutterWidth;a.fixedWidth||(h-=t.scrollLeft),a.el.style.left=h+"px",a.fullWidth&&a.screenWidth&&(a.el.style.minWidth=i.width+2*i.padding+"px"),a.fixedWidth?a.el.style.right=t.scrollBar.getWidth()+"px":a.el.style.right=""}}}}}).call(s.prototype),t.LineWidgets=s})),ace.define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],(function(e,t,i){var n=e("../line_widgets").LineWidgets,s=e("../lib/dom"),r=e("../range").Range;t.showErrorMarker=function(e,t){var i=e.session;i.widgetManager||(i.widgetManager=new n(i),i.widgetManager.attach(e));var o=e.getCursorPosition(),a=o.row,l=i.widgetManager.getWidgetsAtRow(a).filter((function(e){return"errorMarker"==e.type}))[0];l?l.destroy():a-=t;var h,c=function(e,t,i){var n=e.getAnnotations().sort(r.comparePoints);if(n.length){var s=function(e,t,i){for(var n=0,s=e.length-1;n<=s;){var r=n+s>>1,o=i(t,e[r]);if(o>0)n=r+1;else{if(!(o<0))return r;s=r-1}}return-(n+1)}(n,{row:t,column:-1},r.comparePoints);s<0&&(s=-s-1),s>=n.length?s=i>0?0:n.length-1:0===s&&i<0&&(s=n.length-1);var o=n[s];if(o&&i){if(o.row===t){do{o=n[s+=i]}while(o&&o.row===t);if(!o)return n.slice()}var a=[];t=o.row;do{a[i<0?"unshift":"push"](o),o=n[s+=i]}while(o&&o.row==t);return a.length&&a}}}(i,a,t);if(c){var u=c[0];o.column=(u.pos&&"number"!=typeof u.column?u.pos.sc:u.column)||0,o.row=u.row,h=e.renderer.$gutterLayer.$annotations[o.row]}else{if(l)return;h={text:["Looks good!"],className:"ace_ok"}}e.session.unfold(o.row),e.selection.moveToPosition(o);var d={row:o.row,fixedWidth:!0,coverGutter:!0,el:s.createElement("div"),type:"errorMarker"},f=d.el.appendChild(s.createElement("div")),p=d.el.appendChild(s.createElement("div"));p.className="error_widget_arrow "+h.className;var g=e.renderer.$cursorLayer.getPixelPosition(o).left;p.style.left=g+e.renderer.gutterWidth-5+"px",d.el.className="error_widget_wrapper",f.className="error_widget "+h.className,f.innerHTML=h.text.join("<br>"),f.appendChild(s.createElement("div"));var m=function(e,t,i){if(0===t&&("esc"===i||"return"===i))return d.destroy(),{command:"null"}};d.destroy=function(){e.$mouseHandler.isMousePressed||(e.keyBinding.removeKeyboardHandler(m),i.widgetManager.removeLineWidget(d),e.off("changeSelection",d.destroy),e.off("changeSession",d.destroy),e.off("mouseup",d.destroy),e.off("change",d.destroy))},e.keyBinding.addKeyboardHandler(m),e.on("changeSelection",d.destroy),e.on("changeSession",d.destroy),e.on("mouseup",d.destroy),e.on("change",d.destroy),e.session.widgetManager.addLineWidget(d),d.el.onmousedown=e.focus.bind(e),e.renderer.scrollCursorIntoView(null,.5,{bottom:d.el.offsetHeight})},s.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","error_marker.css",!1)})),ace.define("ace/ace",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/dom","ace/lib/event","ace/range","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config"],(function(e,t,i){e("./lib/fixoldbrowsers");var n=e("./lib/dom"),s=e("./lib/event"),r=e("./range").Range,o=e("./editor").Editor,a=e("./edit_session").EditSession,l=e("./undomanager").UndoManager,h=e("./virtual_renderer").VirtualRenderer;e("./worker/worker_client"),e("./keyboard/hash_handler"),e("./placeholder"),e("./multi_select"),e("./mode/folding/fold_mode"),e("./theme/textmate"),e("./ext/error_marker"),t.config=e("./config"),t.require=e,"function"==typeof define&&(t.define=define),t.edit=function(e,i){if("string"==typeof e){var r=e;if(!(e=document.getElementById(r)))throw new Error("ace.edit can't find div #"+r)}if(e&&e.env&&e.env.editor instanceof o)return e.env.editor;var a="";if(e&&/input|textarea/i.test(e.tagName)){var l=e;a=l.value,e=n.createElement("pre"),l.parentNode.replaceChild(e,l)}else e&&(a=e.textContent,e.innerHTML="");var c=t.createEditSession(a),u=new o(new h(e),c,i),d={document:c,editor:u,onResize:u.resize.bind(u,null)};return l&&(d.textarea=l),s.addListener(window,"resize",d.onResize),u.on("destroy",(function(){s.removeListener(window,"resize",d.onResize),d.editor.container.env=null})),u.container.env=u.env=d,u},t.createEditSession=function(e,t){var i=new a(e,t);return i.setUndoManager(new l),i},t.Range=r,t.Editor=o,t.EditSession=a,t.UndoManager=l,t.VirtualRenderer=h,t.version=t.config.version})),ace.require(["ace/ace"],(function(t){for(var i in t&&(t.config.init(!0),t.define=ace.define),window.ace||(window.ace=t),t)t.hasOwnProperty(i)&&(window.ace[i]=t[i]);window.ace.default=window.ace,e&&(e.exports=window.ace)}))}));class o{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let n=[];return this.decompose(0,e,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(t,this.length,n,1),l.from(n,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),l.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),n=new u(this),s=new u(e);for(let e=t,r=t;;){if(n.next(e),s.next(e),e=0,n.lineBreak!=s.lineBreak||n.done!=s.done||n.value!=s.value)return!1;if(r+=n.value.length,n.done||r>=i)return!0}}iter(e=1){return new u(this,e)}iterRange(e,t=this.length){return new d(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let n=this.line(e).from;i=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new f(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new a(e):l.from(a.split(e,[])):o.empty}}class a extends o{constructor(e,t=function(e){let t=-1;for(let i of e)t+=i.length+1;return t}(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,n){for(let s=0;;s++){let r=this.text[s],o=n+r.length;if((t?i:o)>=e)return new p(n,o,i,r);n=o+1,i++}}decompose(e,t,i,n){let s=e<=0&&t>=this.length?this:new a(c(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&n){let e=i.pop(),t=h(s.text,e.text.slice(),0,s.length);if(t.length<=32)i.push(new a(t,e.length+s.length));else{let e=t.length>>1;i.push(new a(t.slice(0,e)),new a(t.slice(e)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof a))return super.replace(e,t,i);let n=h(this.text,h(i.text,c(this.text,0,e)),t),s=this.length+i.length-(t-e);return n.length<=32?new a(n,s):l.from(a.split(n,[]),s)}sliceString(e,t=this.length,i="\n"){let n="";for(let s=0,r=0;s<=t&&r<this.text.length;r++){let o=this.text[r],a=s+o.length;s>e&&r&&(n+=i),e<a&&t>s&&(n+=o.slice(Math.max(0,e-s),t-s)),s=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],n=-1;for(let s of e)i.push(s),n+=s.length+1,32==i.length&&(t.push(new a(i,n)),i=[],n=-1);return n>-1&&t.push(new a(i,n)),t}}class l extends o{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let t of e)this.lines+=t.lines}lineInner(e,t,i,n){for(let s=0;;s++){let r=this.children[s],o=n+r.length,a=i+r.lines-1;if((t?a:o)>=e)return r.lineInner(e,t,i,n);n=o+1,i=a+1}}decompose(e,t,i,n){for(let s=0,r=0;r<=t&&s<this.children.length;s++){let o=this.children[s],a=r+o.length;if(e<=a&&t>=r){let s=n&((r<=e?1:0)|(a>=t?2:0));r>=e&&a<=t&&!s?i.push(o):o.decompose(e-r,t-r,i,s)}r=a+1}}replace(e,t,i){if(i.lines<this.lines)for(let n=0,s=0;n<this.children.length;n++){let r=this.children[n],o=s+r.length;if(e>=s&&t<=o){let a=r.replace(e-s,t-s,i),h=this.lines-r.lines+a.lines;if(a.lines<h>>4&&a.lines>h>>6){let s=this.children.slice();return s[n]=a,new l(s,this.length-(t-e)+i.length)}return super.replace(s,o,a)}s=o+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i="\n"){let n="";for(let s=0,r=0;s<this.children.length&&r<=t;s++){let o=this.children[s],a=r+o.length;r>e&&s&&(n+=i),e<a&&t>r&&(n+=o.sliceString(e-r,t-r,i)),r=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof l))return 0;let i=0,[n,s,r,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,s+=t){if(n==r||s==o)return i;let a=this.children[n],l=e.children[s];if(a!=l)return i+a.scanIdentical(l,t);i+=a.length+1}}static from(e,t=e.reduce(((e,t)=>e+t.length+1),-1)){let i=0;for(let t of e)i+=t.lines;if(i<32){let i=[];for(let t of e)t.flatten(i);return new a(i,t)}let n=Math.max(32,i>>5),s=n<<1,r=n>>1,o=[],h=0,c=-1,u=[];function d(e){let t;if(e.lines>s&&e instanceof l)for(let t of e.children)d(t);else e.lines>r&&(h>r||!h)?(f(),o.push(e)):e instanceof a&&h&&(t=u[u.length-1])instanceof a&&e.lines+t.lines<=32?(h+=e.lines,c+=e.length+1,u[u.length-1]=new a(t.text.concat(e.text),t.length+1+e.length)):(h+e.lines>n&&f(),h+=e.lines,c+=e.length+1,u.push(e))}function f(){0!=h&&(o.push(1==u.length?u[0]:l.from(u,c)),c=-1,h=u.length=0)}for(let t of e)d(t);return f(),1==o.length?o[0]:new l(o,t)}}function h(e,t,i=0,n=1e9){for(let s=0,r=0,o=!0;r<e.length&&s<=n;r++){let a=e[r],l=s+a.length;l>=i&&(l>n&&(a=a.slice(0,n-s)),s<i&&(a=a.slice(i-s)),o?(t[t.length-1]+=a,o=!1):t.push(a)),s=l+1}return t}function c(e,t,i){return h(e,[""],t,i)}o.empty=new a([""],0);class u{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof a?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],s=this.offsets[i],r=s>>1,o=n instanceof a?n.text.length:n.children.length;if(r==(t>0?o:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&s)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(n instanceof a){let s=n.text[r+(t<0?-1:0)];if(this.offsets[i]+=t,s.length>Math.max(0,e))return this.value=0==e?s:t>0?s.slice(e):s.slice(0,s.length-e),this;e-=s.length}else{let s=n.children[r+(t<0?-1:0)];e>s.length?(e-=s.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(s),this.offsets.push(t>0?1:(s instanceof a?s.text.length:s.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class d{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new u(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=i?n:t<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class f{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:n}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(o.prototype[Symbol.iterator]=function(){return this.iter()},u.prototype[Symbol.iterator]=d.prototype[Symbol.iterator]=f.prototype[Symbol.iterator]=function(){return this});class p{constructor(e,t,i,n){this.from=e,this.to=t,this.number=i,this.text=n}get length(){return this.to-this.from}}let g="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((e=>e?parseInt(e,36):1));for(let e=1;e<g.length;e++)g[e]+=g[e-1];function m(e){for(let t=1;t<g.length;t+=2)if(g[t]>e)return g[t-1]<=e;return!1}function v(e){return e>=127462&&e<=127487}function w(e,t,i=!0,n=!0){return(i?y:b)(e,t,n)}function y(e,t,i){if(t==e.length)return t;t&&_(e.charCodeAt(t))&&C(e.charCodeAt(t-1))&&t--;let n=S(e,t);for(t+=k(n);t<e.length;){let s=S(e,t);if(8205==n||8205==s||i&&m(s))t+=k(s),n=s;else{if(!v(s))break;{let i=0,n=t-2;for(;n>=0&&v(S(e,n));)i++,n-=2;if(i%2==0)break;t+=2}}}return t}function b(e,t,i){for(;t>0;){let n=y(e,t-2,i);if(n<t)return n;t--}return 0}function _(e){return e>=56320&&e<57344}function C(e){return e>=55296&&e<56320}function S(e,t){let i=e.charCodeAt(t);if(!C(i)||t+1==e.length)return i;let n=e.charCodeAt(t+1);return _(n)?n-56320+(i-55296<<10)+65536:i}function x(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function k(e){return e<65536?1:2}const A=/\r\n?|\n/;var E=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(E||(E={}));class T{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,n=0;t<this.sections.length;){let s=this.sections[t++],r=this.sections[t++];r<0?(e(i,n,s),n+=s):n+=r,i+=s}}iterChangedRanges(e,t=!1){$(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];n<0?e.push(i,n):e.push(n,i)}return new T(e)}composeDesc(e){return this.empty?e:e.empty?this:O(this,e)}mapDesc(e,t=!1){return e.empty?this:I(this,e,t)}mapPos(e,t=-1,i=E.Simple){let n=0,s=0;for(let r=0;r<this.sections.length;){let o=this.sections[r++],a=this.sections[r++],l=n+o;if(a<0){if(l>e)return s+(e-n);s+=o}else{if(i!=E.Simple&&l>=e&&(i==E.TrackDel&&n<e&&l>e||i==E.TrackBefore&&n<e||i==E.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!o)return e==n||t<0?s:s+a;s+=a}n=l}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return s}touchesRange(e,t=e){for(let i=0,n=0;i<this.sections.length&&n<=t;){let s=n+this.sections[i++];if(this.sections[i++]>=0&&n<=t&&s>=e)return!(n<e&&s>t)||"cover";n=s}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+i+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some((e=>"number"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new T(e)}static create(e){return new T(e)}}class M extends T{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return $(this,((t,i,n,s,r)=>e=e.replace(n,n+(i-t),r)),!1),e}mapDesc(e,t=!1){return I(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let n=0,s=0;n<t.length;n+=2){let r=t[n],a=t[n+1];if(a>=0){t[n]=a,t[n+1]=r;let l=n>>1;for(;i.length<l;)i.push(o.empty);i.push(r?e.slice(s,s+r):o.empty)}s+=r}return new M(t,i)}compose(e){return this.empty?e:e.empty?this:O(this,e,!0)}map(e,t=!1){return e.empty?this:I(this,e,t,!0)}iterChanges(e,t=!1){$(this,e,t)}get desc(){return T.create(this.sections)}filter(e){let t=[],i=[],n=[],s=new D(this);e:for(let r=0,o=0;;){let a=r==e.length?1e9:e[r++];for(;o<a||o==a&&0==s.len;){if(s.done)break e;let e=Math.min(s.len,a-o);L(n,e,-1);let r=-1==s.ins?-1:0==s.off?s.ins:0;L(t,e,r),r>0&&R(i,t,s.text),s.forward(e),o+=e}let l=e[r++];for(;o<l;){if(s.done)break e;let e=Math.min(s.len,l-o);L(t,e,-1),L(n,e,-1==s.ins?-1:0==s.off?s.ins:0),s.forward(e),o+=e}}return{changes:new M(t,i),filtered:T.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],n=this.sections[t+1];n<0?e.push(i):0==n?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let n=[],s=[],r=0,a=null;function l(e=!1){if(!e&&!n.length)return;r<t&&L(n,t-r,-1);let i=new M(n,s);a=a?a.compose(i.map(a)):i,n=[],s=[],r=0}return function e(h){if(Array.isArray(h))for(let t of h)e(t);else if(h instanceof M){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);l(),a=a?a.compose(h.map(a)):h}else{let{from:e,to:a=e,insert:c}=h;if(e>a||e<0||a>t)throw new RangeError(`Invalid change range ${e} to ${a} (in doc of length ${t})`);let u=c?"string"==typeof c?o.of(c.split(i||A)):c:o.empty,d=u.length;if(e==a&&0==d)return;e<r&&l(),e>r&&L(n,e-r,-1),L(n,a-e,d),R(s,n,u),r=a}}(e),l(!a),a}static empty(e){return new M(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let n=0;n<e.length;n++){let s=e[n];if("number"==typeof s)t.push(s,-1);else{if(!Array.isArray(s)||"number"!=typeof s[0]||s.some(((e,t)=>t&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==s.length)t.push(s[0],0);else{for(;i.length<n;)i.push(o.empty);i[n]=o.of(s.slice(1)),t.push(s[0],i[n].length)}}}return new M(t,i)}static createSet(e,t){return new M(e,t)}}function L(e,t,i,n=!1){if(0==t&&i<=0)return;let s=e.length-2;s>=0&&i<=0&&i==e[s+1]?e[s]+=t:0==t&&0==e[s]?e[s+1]+=i:n?(e[s]+=t,e[s+1]+=i):e.push(t,i)}function R(e,t,i){if(0==i.length)return;let n=t.length-2>>1;if(n<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<n;)e.push(o.empty);e.push(i)}}function $(e,t,i){let n=e.inserted;for(let s=0,r=0,a=0;a<e.sections.length;){let l=e.sections[a++],h=e.sections[a++];if(h<0)s+=l,r+=l;else{let c=s,u=r,d=o.empty;for(;c+=l,u+=h,h&&n&&(d=d.append(n[a-2>>1])),!(i||a==e.sections.length||e.sections[a+1]<0);)l=e.sections[a++],h=e.sections[a++];t(s,c,r,u,d),s=c,r=u}}}function I(e,t,i,n=!1){let s=[],r=n?[]:null,o=new D(e),a=new D(t);for(let e=0,t=0;;)if(-1==o.ins)e+=o.len,o.next();else if(-1==a.ins&&t<e){let i=Math.min(a.len,e-t);a.forward(i),L(s,i,-1),t+=i}else if(a.ins>=0&&(o.done||t<e||t==e&&(a.len<o.len||a.len==o.len&&!i))){for(L(s,a.ins,-1);e>t&&!o.done&&e+o.len<t+a.len;)e+=o.len,o.next();t+=a.len,a.next()}else{if(!(o.ins>=0)){if(o.done&&a.done)return r?M.createSet(s,r):T.create(s);throw new Error("Mismatched change set lengths")}{let i=0,n=e+o.len;for(;;)if(a.ins>=0&&t>e&&t+a.len<n)i+=a.ins,t+=a.len,a.next();else{if(!(-1==a.ins&&t<n))break;{let e=Math.min(a.len,n-t);i+=e,a.forward(e),t+=e}}L(s,i,o.ins),r&&R(r,s,o.text),e=n,o.next()}}}function O(e,t,i=!1){let n=[],s=i?[]:null,r=new D(e),o=new D(t);for(let e=!1;;){if(r.done&&o.done)return s?M.createSet(n,s):T.create(n);if(0==r.ins)L(n,r.len,0,e),r.next();else if(0!=o.len||o.done){if(r.done||o.done)throw new Error("Mismatched change set lengths");{let t=Math.min(r.len2,o.len),i=n.length;if(-1==r.ins){let i=-1==o.ins?-1:o.off?0:o.ins;L(n,t,i,e),s&&i&&R(s,n,o.text)}else-1==o.ins?(L(n,r.off?0:r.len,t,e),s&&R(s,n,r.textBit(t))):(L(n,r.off?0:r.len,o.off?0:o.ins,e),s&&!o.off&&R(s,n,o.text));e=(r.ins>t||o.ins>=0&&o.len>t)&&(e||n.length>i),r.forward2(t),o.forward(t)}}else L(n,0,o.ins,e),s&&R(s,n,o.text),o.next()}}class D{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?o.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?o.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class N{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let e=3&this.flags;return 3==e?null:e}get goalColumn(){let e=this.flags>>5;return 33554431==e?void 0:e}map(e,t=-1){let i,n;return this.empty?i=n=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new N(i,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return P.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return P.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return P.range(e.anchor,e.head)}static create(e,t,i){return new N(e,t,i)}}class P{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:P.create(this.ranges.map((i=>i.map(e,t))),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new P([this.main],0)}addRange(e,t=!0){return P.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,P.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((e=>e.toJSON())),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new P(e.ranges.map((e=>N.fromJSON(e))),e.main)}static single(e,t=e){return new P([P.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<e.length;n++){let s=e[n];if(s.empty?s.from<=i:s.from<i)return P.normalized(e.slice(),t);i=s.to}return new P(e,t)}static cursor(e,t=0,i,n){return N.create(e,e,(0==t?0:t<0?4:8)|(null==i?3:Math.min(2,i))|(null!=n?n:33554431)<<5)}static range(e,t,i){let n=(null!=i?i:33554431)<<5;return t<e?N.create(t,e,24|n):N.create(e,t,n|(t>e?4:0))}static normalized(e,t=0){let i=e[t];e.sort(((e,t)=>e.from-t.from)),t=e.indexOf(i);for(let i=1;i<e.length;i++){let n=e[i],s=e[i-1];if(n.empty?n.from<=s.to:n.from<s.to){let r=s.from,o=Math.max(n.to,s.to);i<=t&&t--,e.splice(--i,2,n.anchor>n.head?P.range(o,r):P.range(r,o))}}return new P(e,t)}}function F(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let B=0;class W{constructor(e,t,i,n,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=n,this.extensions=s,this.id=B++,this.default=e([])}static define(e={}){return new W(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:H),!!e.static,e.enables)}of(e){return new V([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new V(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new V(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],(i=>t(i.field(e))))}}function H(e,t){return e==t||e.length==t.length&&e.every(((e,i)=>e===t[i]))}class V{constructor(e,t,i,n){this.dependencies=e,this.facet=t,this.type=i,this.value=n,this.id=B++}dynamicSlot(e){var t;let i=this.value,n=this.facet.compareInput,s=this.id,r=e[s]>>1,o=2==this.type,a=!1,l=!1,h=[];for(let i of this.dependencies)"doc"==i?a=!0:"selection"==i?l=!0:0==(1&(null!==(t=e[i.id])&&void 0!==t?t:1))&&h.push(e[i.id]);return{create:e=>(e.values[r]=i(e),1),update(e,t){if(a&&t.docChanged||l&&(t.docChanged||t.selection)||U(e,h)){let t=i(e);if(o?!z(t,e.values[r],n):!n(t,e.values[r]))return e.values[r]=t,1}return 0},reconfigure:(e,t)=>{let a=i(e),l=t.config.address[s];if(null!=l){let i=re(t,l);if(this.dependencies.every((i=>i instanceof W?t.facet(i)===e.facet(i):!(i instanceof j)||t.field(i,!1)==e.field(i,!1)))||(o?z(a,i,n):n(a,i)))return e.values[r]=i,0}return e.values[r]=a,1}}}}function z(e,t,i){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1;return!0}function U(e,t){let i=!1;for(let n of t)1&se(e,n)&&(i=!0);return i}function q(e,t,i){let n=i.map((t=>e[t.id])),s=i.map((e=>e.type)),r=n.filter((e=>!(1&e))),o=e[t.id]>>1;function a(e){let i=[];for(let t=0;t<n.length;t++){let r=re(e,n[t]);if(2==s[t])for(let e of r)i.push(e);else i.push(r)}return t.combine(i)}return{create(e){for(let t of n)se(e,t);return e.values[o]=a(e),1},update(e,i){if(!U(e,r))return 0;let n=a(e);return t.compare(n,e.values[o])?0:(e.values[o]=n,1)},reconfigure(e,s){let r=U(e,n),l=s.config.facets[t.id],h=s.facet(t);if(l&&!r&&H(i,l))return e.values[o]=h,0;let c=a(e);return t.compare(c,h)?(e.values[o]=h,0):(e.values[o]=c,1)}}}const K=W.define({static:!0});class j{constructor(e,t,i,n,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=n,this.spec=s,this.provides=void 0}static define(e){let t=new j(B++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(K).find((e=>e.field==this));return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let n=e.values[t],s=this.updateF(n,i);return this.compareF(n,s)?0:(e.values[t]=s,1)},reconfigure:(e,i)=>null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}init(e){return[this,K.of({field:this,create:e})]}get extension(){return this}}const G=4,Y=3,Q=2,J=1;function X(e){return t=>new ee(t,e)}const Z={highest:X(0),high:X(J),default:X(Q),low:X(Y),lowest:X(G)};class ee{constructor(e,t){this.inner=e,this.prec=t}}class te{of(e){return new ie(this,e)}reconfigure(e){return te.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class ie{constructor(e,t){this.compartment=e,this.inner=t}}class ne{constructor(e,t,i,n,s,r){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=n,this.staticValues=s,this.facets=r,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let n=[],s=Object.create(null),r=new Map;for(let i of function(e,t,i){let n=[[],[],[],[],[]],s=new Map;function r(e,o){let a=s.get(e);if(null!=a){if(a<=o)return;let t=n[a].indexOf(e);t>-1&&n[a].splice(t,1),e instanceof ie&&i.delete(e.compartment)}if(s.set(e,o),Array.isArray(e))for(let t of e)r(t,o);else if(e instanceof ie){if(i.has(e.compartment))throw new RangeError("Duplicate use of compartment in extensions");let n=t.get(e.compartment)||e.inner;i.set(e.compartment,n),r(n,o)}else if(e instanceof ee)r(e.inner,e.prec);else if(e instanceof j)n[o].push(e),e.provides&&r(e.provides,o);else if(e instanceof V)n[o].push(e),e.facet.extensions&&r(e.facet.extensions,o);else{let t=e.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${e}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(t,o)}}return r(e,Q),n.reduce(((e,t)=>e.concat(t)))}(e,t,r))i instanceof j?n.push(i):(s[i.facet.id]||(s[i.facet.id]=[])).push(i);let o=Object.create(null),a=[],l=[];for(let e of n)o[e.id]=l.length<<1,l.push((t=>e.slot(t)));let h=null==i?void 0:i.config.facets;for(let e in s){let t=s[e],n=t[0].facet,r=h&&h[e]||[];if(t.every((e=>0==e.type)))if(o[n.id]=a.length<<1|1,H(r,t))a.push(i.facet(n));else{let e=n.combine(t.map((e=>e.value)));a.push(i&&n.compare(e,i.facet(n))?i.facet(n):e)}else{for(let e of t)0==e.type?(o[e.id]=a.length<<1|1,a.push(e.value)):(o[e.id]=l.length<<1,l.push((t=>e.dynamicSlot(t))));o[n.id]=l.length<<1,l.push((e=>q(e,n,t)))}}let c=l.map((e=>e(o)));return new ne(e,r,c,o,a,s)}}function se(e,t){if(1&t)return 2;let i=t>>1,n=e.status[i];if(4==n)throw new Error("Cyclic dependency between fields and/or facets");if(2&n)return n;e.status[i]=4;let s=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|s}function re(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const oe=W.define(),ae=W.define({combine:e=>e.some((e=>e)),static:!0}),le=W.define({combine:e=>e.length?e[0]:void 0,static:!0}),he=W.define(),ce=W.define(),ue=W.define(),de=W.define({combine:e=>!!e.length&&e[0]});class fe{constructor(e,t){this.type=e,this.value=t}static define(){return new pe}}class pe{of(e){return new fe(this,e)}}class ge{constructor(e){this.map=e}of(e){return new me(this,e)}}class me{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new me(this.type,t)}is(e){return this.type==e}static define(e={}){return new ge(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let n of e){let e=n.map(t);e&&i.push(e)}return i}}me.reconfigure=me.define(),me.appendConfig=me.define();class ve{constructor(e,t,i,n,s,r){this.startState=e,this.changes=t,this.selection=i,this.effects=n,this.annotations=s,this.scrollIntoView=r,this._doc=null,this._state=null,i&&F(i,t.newLength),s.some((e=>e.type==ve.time))||(this.annotations=s.concat(ve.time.of(Date.now())))}static create(e,t,i,n,s,r){return new ve(e,t,i,n,s,r)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(ve.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function we(e,t){let i=[];for(let n=0,s=0;;){let r,o;if(n<e.length&&(s==t.length||t[s]>=e[n]))r=e[n++],o=e[n++];else{if(!(s<t.length))return i;r=t[s++],o=t[s++]}!i.length||i[i.length-1]<r?i.push(r,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function ye(e,t,i){var n;let s,r,o;return i?(s=t.changes,r=M.empty(t.changes.length),o=e.changes.compose(t.changes)):(s=t.changes.map(e.changes),r=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(s)),{changes:o,selection:t.selection?t.selection.map(r):null===(n=e.selection)||void 0===n?void 0:n.map(s),effects:me.mapEffects(e.effects,s).concat(me.mapEffects(t.effects,r)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function be(e,t,i){let n=t.selection,s=Se(t.annotations);return t.userEvent&&(s=s.concat(ve.userEvent.of(t.userEvent))),{changes:t.changes instanceof M?t.changes:M.of(t.changes||[],i,e.facet(le)),selection:n&&(n instanceof P?n:P.single(n.anchor,n.head)),effects:Se(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function _e(e,t,i){let n=be(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let s=1;s<t.length;s++){!1===t[s].filter&&(i=!1);let r=!!t[s].sequential;n=ye(n,be(e,t[s],r?n.changes.newLength:e.doc.length),r)}let s=ve.create(e,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return function(e){let t=e.startState,i=t.facet(ue),n=e;for(let s=i.length-1;s>=0;s--){let r=i[s](e);r&&Object.keys(r).length&&(n=ye(e,be(t,r,e.changes.newLength),!0))}return n==e?e:ve.create(t,e.changes,e.selection,n.effects,n.annotations,n.scrollIntoView)}(i?function(e){let t=e.startState,i=!0;for(let n of t.facet(he)){let t=n(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:we(i,t))}if(!0!==i){let n,s;if(!1===i)s=e.changes.invertedDesc,n=M.empty(t.doc.length);else{let t=e.changes.filter(i);n=t.changes,s=t.filtered.invertedDesc}e=ve.create(t,n,e.selection&&e.selection.map(s),me.mapEffects(e.effects,s),e.annotations,e.scrollIntoView)}let n=t.facet(ce);for(let i=n.length-1;i>=0;i--){let s=n[i](e);e=s instanceof ve?s:Array.isArray(s)&&1==s.length&&s[0]instanceof ve?s[0]:_e(t,Se(s),!1)}return e}(s):s)}ve.time=fe.define(),ve.userEvent=fe.define(),ve.addToHistory=fe.define(),ve.remote=fe.define();const Ce=[];function Se(e){return null==e?Ce:Array.isArray(e)?e:[e]}var xe=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(xe||(xe={}));const ke=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Ae;try{Ae=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(e){}function Ee(e){return t=>{if(!/\S/.test(t))return xe.Space;if(function(e){if(Ae)return Ae.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||ke.test(i)))return!0}return!1}(t))return xe.Word;for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return xe.Word;return xe.Other}}class Te{constructor(e,t,i,n,s,r){this.config=e,this.doc=t,this.selection=i,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=s,r&&(r._state=this);for(let e=0;e<this.config.dynamicSlots.length;e++)se(this,e<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return se(this,i),re(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return _e(this,e,!0)}applyTransaction(e){let t,i=this.config,{base:n,compartments:s}=i;for(let t of e.effects)t.is(te.reconfigure)?(i&&(s=new Map,i.compartments.forEach(((e,t)=>s.set(t,e))),i=null),s.set(t.value.compartment,t.value.extension)):t.is(me.reconfigure)?(i=null,n=t.value):t.is(me.appendConfig)&&(i=null,n=Se(n).concat(t.value));if(i)t=e.startState.values.slice();else{i=ne.resolve(n,s,this),t=new Te(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((e,t)=>t.reconfigure(e,this)),null).values}new Te(i,e.newDoc,e.newSelection,t,((t,i)=>i.update(t,e)),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:e},range:P.cursor(t.from+e.length)})))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),n=this.changes(i.changes),s=[i.range],r=Se(i.effects);for(let i=1;i<t.ranges.length;i++){let o=e(t.ranges[i]),a=this.changes(o.changes),l=a.map(n);for(let e=0;e<i;e++)s[e]=s[e].map(l);let h=n.mapDesc(a,!0);s.push(o.range.map(h)),n=n.compose(l),r=me.mapEffects(r,l).concat(me.mapEffects(Se(o.effects),h))}return{changes:n,selection:P.create(s,t.mainIndex),effects:r}}changes(e=[]){return e instanceof M?e:M.of(e,this.doc.length,this.facet(Te.lineSeparator))}toText(e){return o.of(e.split(this.facet(Te.lineSeparator)||A))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(se(this,t),re(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let n=e[i];n instanceof j&&(t[i]=n.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let t in i){let s=i[t],r=e[t];n.push(s.init((e=>s.spec.fromJSON(r,e))))}return Te.create({doc:e.doc,selection:P.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=ne.resolve(e.extensions||[],new Map),i=e.doc instanceof o?e.doc:o.of((e.doc||"").split(t.staticFacet(Te.lineSeparator)||A)),n=e.selection?e.selection instanceof P?e.selection:P.single(e.selection.anchor,e.selection.head):P.single(0);return F(n,i.length),t.staticFacet(ae)||(n=n.asSingle()),new Te(t,i,n,t.dynamicSlots.map((()=>null)),((e,t)=>t.create(e)),null)}get tabSize(){return this.facet(Te.tabSize)}get lineBreak(){return this.facet(Te.lineSeparator)||"\n"}get readOnly(){return this.facet(de)}phrase(e,...t){for(let t of this.facet(Te.phrases))if(Object.prototype.hasOwnProperty.call(t,e)){e=t[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,((e,i)=>{if("$"==i)return"$";let n=+(i||1);return n>t.length?e:t[n-1]}))),e}languageDataAt(e,t,i=-1){let n=[];for(let s of this.facet(oe))for(let r of s(this,t,i))Object.prototype.hasOwnProperty.call(r,e)&&n.push(r[e]);return n}charCategorizer(e){return Ee(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:n}=this.doc.lineAt(e),s=this.charCategorizer(e),r=e-i,o=e-i;for(;r>0;){let e=w(t,r,!1);if(s(t.slice(e,r))!=xe.Word)break;r=e}for(;o<n;){let e=w(t,o);if(s(t.slice(o,e))!=xe.Word)break;o=e}return r==o?null:P.range(r+i,o+i)}}function Me(e,t,i={}){let n={};for(let t of e)for(let e of Object.keys(t)){let s=t[e],r=n[e];if(void 0===r)n[e]=s;else if(r===s||void 0===s);else{if(!Object.hasOwnProperty.call(i,e))throw new Error("Config merge conflict for field "+e);n[e]=i[e](r,s)}}for(let e in t)void 0===n[e]&&(n[e]=t[e]);return n}Te.allowMultipleSelections=ae,Te.tabSize=W.define({combine:e=>e.length?e[0]:4}),Te.lineSeparator=le,Te.readOnly=de,Te.phrases=W.define({compare(e,t){let i=Object.keys(e),n=Object.keys(t);return i.length==n.length&&i.every((i=>e[i]==t[i]))}}),Te.languageData=oe,Te.changeFilter=he,Te.transactionFilter=ce,Te.transactionExtender=ue,te.reconfigure=me.define();class Le{eq(e){return this==e}range(e,t=e){return Re.create(e,t,this)}}Le.prototype.startSide=Le.prototype.endSide=0,Le.prototype.point=!1,Le.prototype.mapMode=E.TrackDel;class Re{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Re(e,t,i)}}function $e(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Ie{constructor(e,t,i,n){this.from=e,this.to=t,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,n=0){let s=i?this.to:this.from;for(let r=n,o=s.length;;){if(r==o)return r;let n=r+o>>1,a=s[n]-e||(i?this.value[n].endSide:this.value[n].startSide)-t;if(n==r)return a>=0?r:o;a>=0?o=n:r=n+1}}between(e,t,i,n){for(let s=this.findIndex(t,-1e9,!0),r=this.findIndex(i,1e9,!1,s);s<r;s++)if(!1===n(this.from[s]+e,this.to[s]+e,this.value[s]))return!1}map(e,t){let i=[],n=[],s=[],r=-1,o=-1;for(let a=0;a<this.value.length;a++){let l,h,c=this.value[a],u=this.from[a]+e,d=this.to[a]+e;if(u==d){let e=t.mapPos(u,c.startSide,c.mapMode);if(null==e)continue;if(l=h=e,c.startSide!=c.endSide&&(h=t.mapPos(u,c.endSide),h<l))continue}else if(l=t.mapPos(u,c.startSide),h=t.mapPos(d,c.endSide),l>h||l==h&&c.startSide>0&&c.endSide<=0)continue;(h-l||c.endSide-c.startSide)<0||(r<0&&(r=l),c.point&&(o=Math.max(o,h-l)),i.push(c),n.push(l-r),s.push(h-r))}return{mapped:i.length?new Ie(n,s,i,o):null,pos:r}}}class Oe{constructor(e,t,i,n){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=n}static create(e,t,i,n){return new Oe(e,t,i,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:n=0,filterTo:s=this.length}=e,r=e.filter;if(0==t.length&&!r)return this;if(i&&(t=t.slice().sort($e)),this.isEmpty)return t.length?Oe.of(t):this;let o=new Pe(this,null,-1).goto(0),a=0,l=[],h=new De;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let e=t[a++];h.addInner(e.from,e.to,e.value)||l.push(e)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!r||n>this.chunkEnd(o.chunkIndex)||s<this.chunkPos[o.chunkIndex])&&h.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!r||n>o.to||s<o.from||r(o.from,o.to,o.value))&&(h.addInner(o.from,o.to,o.value)||l.push(Re.create(o.from,o.to,o.value))),o.next());return h.finishInner(this.nextLayer.isEmpty&&!l.length?Oe.empty:this.nextLayer.update({add:l,filter:r,filterFrom:n,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],n=-1;for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s],a=e.touchesRange(r,r+o.length);if(!1===a)n=Math.max(n,o.maxPoint),t.push(o),i.push(e.mapPos(r));else if(!0===a){let{mapped:s,pos:a}=o.map(r,e);s&&(n=Math.max(n,s.maxPoint),t.push(s),i.push(a))}}let s=this.nextLayer.map(e);return 0==t.length?s:new Oe(i,t,s||Oe.empty,n)}between(e,t,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let s=this.chunkPos[n],r=this.chunk[n];if(t>=s&&e<=s+r.length&&!1===r.between(s,e-s,t-s,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return Fe.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Fe.from(e).goto(t)}static compare(e,t,i,n,s=-1){let r=e.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=s)),o=t.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=s)),a=Ne(r,o,i),l=new We(r,a,s),h=new We(o,a,s);i.iterGaps(((e,t,i)=>He(l,e,h,t,i,n))),i.empty&&0==i.length&&He(l,0,h,0,0,n)}static eq(e,t,i=0,n){null==n&&(n=1e9);let s=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0)),r=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0));if(s.length!=r.length)return!1;if(!s.length)return!0;let o=Ne(s,r),a=new We(s,o,0).goto(i),l=new We(r,o,0).goto(i);for(;;){if(a.to!=l.to||!Ve(a.active,l.active)||a.point&&(!l.point||!a.point.eq(l.point)))return!1;if(a.to>n)return!0;a.next(),l.next()}}static spans(e,t,i,n,s=-1){let r=new We(e,null,s).goto(t),o=t,a=r.openStart;for(;;){let e=Math.min(r.to,i);if(r.point?(n.point(o,e,r.point,r.activeForPoint(r.to),a,r.pointRank),a=r.openEnd(e)+(r.to>e?1:0)):e>o&&(n.span(o,e,r.active,a),a=r.openEnd(e)),r.to>i)break;o=r.to,r.next()}return a}static of(e,t=!1){let i=new De;for(let n of e instanceof Re?[e]:t?function(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let n=e[i];if($e(t,n)>0)return e.slice().sort($e);t=n}return e}(e):e)i.add(n.from,n.to,n.value);return i.finish()}}Oe.empty=new Oe([],[],null,-1),Oe.empty.nextLayer=Oe.empty;class De{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new Ie(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new De)).add(e,t,i)}addInner(e,t,i){let n=e-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(n<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(Oe.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=Oe.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Ne(e,t,i){let n=new Map;for(let t of e)for(let e=0;e<t.chunk.length;e++)t.chunk[e].maxPoint<=0&&n.set(t.chunk[e],t.chunkPos[e]);let s=new Set;for(let e of t)for(let t=0;t<e.chunk.length;t++){let r=n.get(e.chunk[t]);null==r||(i?i.mapPos(r):r)!=e.chunkPos[t]||(null==i?void 0:i.touchesRange(r,r+e.chunk[t].length))||s.add(e.chunk[t])}return s}class Pe{constructor(e,t,i,n=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Fe{constructor(e){this.heap=e}static from(e,t=null,i=-1){let n=[];for(let s=0;s<e.length;s++)for(let r=e[s];!r.isEmpty;r=r.nextLayer)r.maxPoint>=i&&n.push(new Pe(r,t,i,s));return 1==n.length?n[0]:new Fe(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let e=this.heap.length>>1;e>=0;e--)Be(this.heap,e);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let e=this.heap.length>>1;e>=0;e--)Be(this.heap,e);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Be(this.heap,0)}}}function Be(e,t){for(let i=e[t];;){let n=1+(t<<1);if(n>=e.length)break;let s=e[n];if(n+1<e.length&&s.compare(e[n+1])>=0&&(s=e[n+1],n++),i.compare(s)<0)break;e[n]=i,e[t]=s,t=n}}class We{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Fe.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){ze(this.active,e),ze(this.activeTo,e),ze(this.activeRank,e),this.minActive=qe(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:n,rank:s}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=s;)t++;Ue(this.active,t,i),Ue(this.activeTo,t,n),Ue(this.activeRank,t,s),e&&Ue(e,t,this.cursor.from),this.minActive=qe(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&ze(i,s)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let s=this.cursor.value;if(s.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.from<e&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let t=0;for(;t<i.length&&i[t]<e;)t++;this.openStart=t+n}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function He(e,t,i,n,s,r){e.goto(t),i.goto(n);let o=n+s,a=n,l=n-t;for(;;){let t=e.to+l-i.to||e.endSide-i.endSide,n=t<0?e.to+l:i.to,s=Math.min(n,o);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&Ve(e.activeForPoint(e.to+l),i.activeForPoint(i.to))||r.comparePoint(a,s,e.point,i.point):s>a&&!Ve(e.active,i.active)&&r.compareRange(a,s,e.active,i.active),n>o)break;a=n,t<=0&&e.next(),t>=0&&i.next()}}function Ve(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function ze(e,t){for(let i=t,n=e.length-1;i<n;i++)e[i]=e[i+1];e.pop()}function Ue(e,t,i){for(let i=e.length-1;i>=t;i--)e[i+1]=e[i];e[t]=i}function qe(e,t){let i=-1,n=1e9;for(let s=0;s<t.length;s++)(t[s]-n||e[s].endSide-e[i].endSide)<0&&(i=s,n=t[s]);return i}function Ke(e,t,i=e.length){let n=0;for(let s=0;s<i;)9==e.charCodeAt(s)?(n+=t-n%t,s++):(n++,s=w(e,s));return n}function je(e,t,i,n){for(let n=0,s=0;;){if(s>=t)return n;if(n==e.length)break;s+=9==e.charCodeAt(n)?i-s%i:1,n=w(e,n)}return!0===n?-1:e.length}const Ge="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),Ye="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),Qe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class Je{constructor(e,t){this.rules=[];let{finish:i}=t||{};function n(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function s(e,t,r,o){let a=[],l=/^@(\w+)\b/.exec(e[0]),h=l&&"keyframes"==l[1];if(l&&null==t)return r.push(e[0]+";");for(let i in t){let o=t[i];if(/&/.test(i))s(i.split(/,\s*/).map((t=>e.map((e=>t.replace(/&/,e))))).reduce(((e,t)=>e.concat(t))),o,r);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");s(n(i),o,a,h)}else null!=o&&a.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))+": "+o+";")}(a.length||h)&&r.push((!i||l||o?e:e.map(i)).join(", ")+" {"+a.join(" ")+"}")}for(let t in e)s(n(t),e[t],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=Qe[Ge]||1;return Qe[Ge]=e+1,"ͼ"+e.toString(36)}static mount(e,t){(e[Ye]||new Ze(e)).mount(Array.isArray(t)?t:[t])}}let Xe=null;class Ze{constructor(e){if(!e.head&&e.adoptedStyleSheets&&"undefined"!=typeof CSSStyleSheet){if(Xe)return e.adoptedStyleSheets=[Xe.sheet].concat(e.adoptedStyleSheets),e[Ye]=Xe;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),Xe=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[],e[Ye]=this}mount(e){let t=this.sheet,i=0,n=0;for(let s=0;s<e.length;s++){let r=e[s],o=this.modules.indexOf(r);if(o<n&&o>-1&&(this.modules.splice(o,1),n--,o=-1),-1==o){if(this.modules.splice(n++,0,r),t)for(let e=0;e<r.rules.length;e++)t.insertRule(r.rules[e],i++)}else{for(;n<o;)i+=this.modules[n++].rules.length;i+=r.rules.length,n++}}if(!t){let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e}}}for(var et={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},tt={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},it="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),nt="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),st="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),rt="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ot="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),at=it&&(rt||+it[1]<57)||st&&rt,lt=0;lt<10;lt++)et[48+lt]=et[96+lt]=String(lt);for(lt=1;lt<=24;lt++)et[lt+111]="F"+lt;for(lt=65;lt<=90;lt++)et[lt]=String.fromCharCode(lt+32),tt[lt]=String.fromCharCode(lt);for(var ht in et)tt.hasOwnProperty(ht)||(tt[ht]=et[ht]);function ct(e){var t=!(at&&(e.ctrlKey||e.altKey||e.metaKey)||(nt||ot)&&e.shiftKey&&e.key&&1==e.key.length)&&e.key||(e.shiftKey?tt:et)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}function ut(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function dt(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function ft(e,t){if(!t.anchorNode)return!1;try{return dt(e,t.anchorNode)}catch(e){return!1}}function pt(e){return 3==e.nodeType?At(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function gt(e,t,i,n){return!!i&&(vt(e,t,i,n,-1)||vt(e,t,i,n,1))}function mt(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function vt(e,t,i,n,s){for(;;){if(e==i&&t==n)return!0;if(t==(s<0?0:wt(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=mt(e)+(s<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(s<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=s<0?wt(e):0}}}function wt(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}const yt={left:0,right:0,top:0,bottom:0};function bt(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function _t(e){return{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}class Ct{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=n}}let St,xt=null;function kt(e){if(e.setActive)return e.setActive();if(xt)return e.focus(xt);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==xt?{get preventScroll(){return xt={preventScroll:!0},!0}}:void 0),!xt){xt=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],s=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=s&&(i.scrollLeft=s)}}}function At(e,t,i=t){let n=St||(St=document.createRange());return n.setEnd(e,i),n.setStart(e,t),n}function Et(e,t,i){let n={key:t,code:t,keyCode:i,which:i,cancelable:!0},s=new KeyboardEvent("keydown",n);s.synthetic=!0,e.dispatchEvent(s);let r=new KeyboardEvent("keyup",n);return r.synthetic=!0,e.dispatchEvent(r),s.defaultPrevented||r.defaultPrevented}function Tt(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}class Mt{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new Mt(e.parentNode,mt(e),t)}static after(e,t){return new Mt(e.parentNode,mt(e)+1,t)}}const Lt=[];class Rt{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(2&this.dirty){let t,i=this.dom,n=null;for(let s of this.children){if(s.dirty){if(!s.dom&&(t=n?n.nextSibling:i.firstChild)){let e=Rt.get(t);e&&(e.parent||e.constructor!=s.constructor)||s.reuseDOM(t)}s.sync(e),s.dirty=0}if(t=n?n.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&t!=s.dom&&(e.written=!0),s.dom.parentNode==i)for(;t&&t!=s.dom;)t=$t(t);else i.insertBefore(s.dom,t);n=s.dom}for(t=n?n.nextSibling:i.firstChild,t&&e&&e.node==i&&(e.written=!0);t;)t=$t(t)}else if(1&this.dirty)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let n=0==wt(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==n&&t.firstChild!=t.lastChild&&(n=e==t.firstChild?-1:1),e=t}i=n<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Rt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let e=0,t=0;;e++){let n=this.children[e];if(n.dom==i)return t;t+=n.length+n.breakAfter}}domBoundsAround(e,t,i=0){let n=-1,s=-1,r=-1,o=-1;for(let a=0,l=i,h=i;a<this.children.length;a++){let i=this.children[a],c=l+i.length;if(l<e&&c>t)return i.domBoundsAround(e,t,l);if(c>=e&&-1==n&&(n=a,s=l),l>t&&i.dom.parentNode==this.dom){r=a,o=h;break}h=c,l=c+i.breakAfter}return{from:s,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:r<this.children.length&&r>=0?this.children[r].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),1&t.dirty)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=Lt){this.markDirty();for(let i=e;i<t;i++){let e=this.children[i];e.parent==this&&e.destroy()}this.children.splice(e,t-e,...i);for(let e=0;e<i.length;e++)i[e].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new It(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,n,s,r){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}function $t(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}Rt.prototype.breakAfter=0;class It{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Ot(e,t,i,n,s,r,o,a,l){let{children:h}=e,c=h.length?h[t]:null,u=r.length?r[r.length-1]:null,d=u?u.breakAfter:o;if(!(t==n&&c&&!o&&!d&&r.length<2&&c.merge(i,s,r.length?u:null,0==i,a,l))){if(n<h.length){let e=h[n];e&&s<e.length?(t==n&&(e=e.split(s),s=0),!d&&u&&e.merge(0,s,u,!0,0,l)?r[r.length-1]=e:(s&&e.merge(0,s,null,!1,0,l),r.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&r.length&&c.merge(i,c.length,r[0],!1,a,0)?c.breakAfter=r.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,a,0),t++));t<n&&r.length;)if(h[n-1].become(r[r.length-1]))n--,r.pop(),l=r.length?0:a;else{if(!h[t].become(r[0]))break;t++,r.shift(),a=r.length?0:l}!r.length&&t&&n<h.length&&!h[t-1].breakAfter&&h[n].merge(0,0,h[t-1],!1,a,l)&&t--,(t<n||r.length)&&e.replaceChildren(t,n,r)}}function Dt(e,t,i,n,s,r){let o=e.childCursor(),{i:a,off:l}=o.findPos(i,1),{i:h,off:c}=o.findPos(t,-1),u=t-i;for(let e of n)u+=e.length;e.length+=u,Ot(e,h,c,a,l,n,0,s,r)}let Nt="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},Pt="undefined"!=typeof document?document:{documentElement:{style:{}}};const Ft=/Edge\/(\d+)/.exec(Nt.userAgent),Bt=/MSIE \d/.test(Nt.userAgent),Wt=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Nt.userAgent),Ht=!!(Bt||Wt||Ft),Vt=!Ht&&/gecko\/(\d+)/i.test(Nt.userAgent),zt=!Ht&&/Chrome\/(\d+)/.exec(Nt.userAgent),Ut="webkitFontSmoothing"in Pt.documentElement.style,qt=!Ht&&/Apple Computer/.test(Nt.vendor),Kt=qt&&(/Mobile\/\w+/.test(Nt.userAgent)||Nt.maxTouchPoints>2);var jt={mac:Kt||/Mac/.test(Nt.platform),windows:/Win/.test(Nt.platform),linux:/Linux|X11/.test(Nt.platform),ie:Ht,ie_version:Bt?Pt.documentMode||6:Wt?+Wt[1]:Ft?+Ft[1]:0,gecko:Vt,gecko_version:Vt?+(/Firefox\/(\d+)/.exec(Nt.userAgent)||[0,0])[1]:0,chrome:!!zt,chrome_version:zt?+zt[1]:0,ios:Kt,android:/Android\b/.test(Nt.userAgent),webkit:Ut,safari:qt,webkit_version:Ut?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=Pt.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class Gt extends Rt{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,i){return(!i||i instanceof Gt&&!(this.length-(t-e)+i.length>256))&&(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Gt(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new Mt(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Qt(this.dom,e,t)}}class Yt extends Rt{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let e of t)e.setParent(this)}setAttrs(e){if(Tt(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,n,s,r){return(!i||!(!(i instanceof Yt&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&r<=0))&&(Dt(this,e,t,i?i.children:[],s-1,r-1),this.markDirty(),!0)}split(e){let t=[],i=0,n=-1,s=0;for(let r of this.children){let o=i+r.length;o>e&&t.push(i<e?r.split(e-i):r),n<0&&i>=e&&(n=s),i=o,s++}let r=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new Yt(this.mark,t,r)}domAtPos(e){return ii(this.dom,this.children,e)}coordsAt(e,t){return si(this,e,t)}}function Qt(e,t,i){let n=e.nodeValue.length;t>n&&(t=n);let s=t,r=t,o=0;0==t&&i<0||t==n&&i>=0?jt.chrome||jt.gecko||(t?(s--,o=1):r<n&&(r++,o=-1)):i<0?s--:r<n&&r++;let a=At(e,s,r).getClientRects();if(!a.length)return yt;let l=a[(o?o<0:i>=0)?0:a.length-1];return jt.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(a,(e=>e.width))||l),o?bt(l,o<0):l||null}class Jt extends Rt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||Jt)(e,t,i)}split(e){let t=Jt.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,n,s,r){return!(i&&(!(i instanceof Jt&&this.widget.compare(i.widget))||e>0&&s<=0||t<this.length&&r<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof Jt&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return o.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):o.empty}domAtPos(e){return 0==e?Mt.before(this.dom):Mt.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),n=null;if(!i.length)return yt;for(let t=e>0?i.length-1:0;n=i[t],!(e>0?0==t:t==i.length-1||n.top<n.bottom);t+=e>0?-1:1);return 0==e&&t>0||e==this.length&&t<=0?n:bt(n,0==e)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Xt extends Jt{domAtPos(e){let{topView:t,text:i}=this.widget;return t?Zt(e,0,t,i,((e,t)=>e.domAtPos(t)),(e=>new Mt(i,Math.min(e,i.nodeValue.length)))):new Mt(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:n}=this.widget;return i?ei(e,t,i,n):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:n}=this.widget;return i?Zt(e,t,i,n,((e,t,i)=>e.coordsAt(t,i)),((e,t)=>Qt(n,e,t))):Qt(n,e,t)}destroy(){var e;super.destroy(),null===(e=this.widget.topView)||void 0===e||e.destroy()}get isEditable(){return!0}}function Zt(e,t,i,n,s,r){if(i instanceof Yt){for(let o of i.children){let i=dt(o.dom,n),a=i?n.nodeValue.length:o.length;if(e<a||e==a&&o.getSide()<=0)return i?Zt(e,t,o,n,s,r):s(o,e,t);e-=a}return s(i,i.length,-1)}return i.dom==n?r(e,t):s(i,e,t)}function ei(e,t,i,n){if(i instanceof Yt)for(let s of i.children){let i=0,r=dt(s.dom,n);if(dt(s.dom,e))return i+(r?ei(e,t,s,n):s.localPosFromDOM(e,t));i+=r?n.nodeValue.length:s.length}else if(i.dom==n)return Math.min(t,n.nodeValue.length);return i.localPosFromDOM(e,t)}class ti extends Rt{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof ti&&e.side==this.side}split(){return new ti(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return Mt.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=function(e,t){let i=e.parent,n=i?i.children.indexOf(e):-1;for(;i&&n>=0;)if(t<0?n>0:n<i.children.length){let e=i.children[n+t];if(e instanceof Gt){let i=e.coordsAt(t<0?e.length:0,t);if(i)return i}n+=t}else{if(!(i instanceof Yt&&i.parent)){let e=i.dom.lastChild;if(e&&"BR"==e.nodeName)return e.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(t<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return o.empty}}function ii(e,t,i){let n=0;for(let s=0;n<t.length;n++){let r=t[n],o=s+r.length;if(!(o==s&&r.getSide()<=0)){if(i>s&&i<o&&r.dom.parentNode==e)return r.domAtPos(i-s);if(i<=s)break;s=o}}for(;n>0;n--){let i=t[n-1].dom;if(i.parentNode==e)return Mt.after(i)}return new Mt(e,0)}function ni(e,t,i){let n,{children:s}=e;i>0&&t instanceof Yt&&s.length&&(n=s[s.length-1])instanceof Yt&&n.mark.eq(t.mark)?ni(n,t.children[0],i-1):(s.push(t),t.setParent(e)),e.length+=t.length}function si(e,t,i){for(let n=0,s=0;s<e.children.length;s++){let r,o=e.children[s],a=n+o.length;if((i<=0||a==e.length||o.getSide()>0?a>=t:a>t)&&(t<a||s+1==e.children.length||(r=e.children[s+1]).length||r.getSide()>0)){let e=0;if(a==n){if(o.getSide()<=0)continue;e=i=-o.getSide()}let s=o.coordsAt(Math.max(0,t-n),i);return e&&s?bt(s,i<0):s}n=a}let n=e.dom.lastChild;if(!n)return e.dom.getBoundingClientRect();let s=pt(n);return s[s.length-1]||null}function ri(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}function oi(e,t){if(e==t)return!0;if(!e||!t)return!1;let i=Object.keys(e),n=Object.keys(t);if(i.length!=n.length)return!1;for(let s of i)if(-1==n.indexOf(s)||e[s]!==t[s])return!1;return!0}function ai(e,t,i){let n=null;if(t)for(let s in t)i&&s in i||e.removeAttribute(n=s);if(i)for(let s in i)t&&t[s]==i[s]||e.setAttribute(n=s,i[s]);return!!n}Gt.prototype.children=Jt.prototype.children=ti.prototype.children=Lt;class li{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var hi=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(hi||(hi={}));class ci extends Le{constructor(e,t,i,n){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(e){return new ui(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new fi(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,n=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:s,end:r}=pi(e,n);t=(s?n?-3e8:-1:5e8)-1,i=1+(r?n?2e8:1:-6e8)}return new fi(e,t,i,n,e.widget||null,!0)}static line(e){return new di(e)}static set(e,t=!1){return Oe.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}ci.none=Oe.empty;class ui extends ci{constructor(e){let{start:t,end:i}=pi(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof ui&&this.tagName==e.tagName&&this.class==e.class&&oi(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}ui.prototype.point=!1;class di extends ci{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof di&&oi(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}di.prototype.mapMode=E.TrackBefore,di.prototype.point=!0;class fi extends ci{constructor(e,t,i,n,s,r){super(t,i,s,e),this.block=n,this.isReplace=r,this.mapMode=n?t<=0?E.TrackBefore:E.TrackAfter:E.TrackDel}get type(){return this.startSide<this.endSide?hi.WidgetRange:this.startSide<=0?hi.WidgetBefore:hi.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof fi&&(t=this.widget,i=e.widget,t==i||!!(t&&i&&t.compare(i)))&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide;var t,i}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function pi(e,t=!1){let{inclusiveStart:i,inclusiveEnd:n}=e;return null==i&&(i=e.inclusive),null==n&&(n=e.inclusive),{start:null!=i?i:t,end:null!=n?n:t}}function gi(e,t,i,n=0){let s=i.length-1;s>=0&&i[s]+n>=e?i[s]=Math.max(i[s],t):i.push(e,t)}fi.prototype.point=!0;class mi extends Rt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,n,s,r){if(i){if(!(i instanceof mi))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Dt(this,e,t,i?i.children:[],s,r),!0}split(e){let t=new mi;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i:i,off:n}=this.childPos(e);n&&(t.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let e=i;e<this.children.length;e++)t.append(this.children[e],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){oi(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){ni(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=ri(t,this.attrs||{})),i&&(this.attrs=ri({class:i},this.attrs||{}))}domAtPos(e){return ii(this.dom,this.children,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?4&this.dirty&&(Tt(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(ai(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&Rt.get(i)instanceof Yt;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(t=Rt.get(i))||void 0===t?void 0:t.isEditable)||jt.ios&&this.children.some((e=>e instanceof Gt))))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof Gt))return null;let i=pt(t.dom);if(1!=i.length)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return si(this,e,t)}become(e){return!1}get type(){return hi.Text}static find(e,t){for(let i=0,n=0;i<e.children.length;i++){let s=e.children[i],r=n+s.length;if(r>=t){if(s instanceof mi)return s;if(r>t)break}n=r+s.breakAfter}return null}}class vi extends Rt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,n,s,r){return!(i&&(!(i instanceof vi&&this.widget.compare(i.widget))||e>0&&s<=0||t<this.length&&r<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return 0==e?Mt.before(this.dom):Mt.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new vi(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return Lt}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):o.empty}domBoundsAround(){return null}become(e){return e instanceof vi&&e.type==this.type&&e.widget.constructor==this.widget.constructor&&(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class wi{constructor(e,t,i,n){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof vi&&e.type==hi.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new mi),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(yi(new ti(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}this.text=t,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(yi(new Gt(this.text.slice(this.textOff,this.textOff+n)),t),i),this.atCursorPos=!0,this.textOff+=n,e-=n,i=0}}span(e,t,i,n){this.buildText(t-e,i,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,i,n,s,r){if(this.disallowBlockEffectsFor[r]&&i instanceof fi){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof fi)if(i.block){let{type:e}=i;e!=hi.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new vi(i.widget||new bi("div"),o,e))}else{let r=Jt.create(i.widget||new bi("span"),o,i.startSide),a=this.atCursorPos&&!r.isEditable&&s<=n.length&&(e<t||i.startSide>0),l=!r.isEditable&&(e<t||i.startSide<=0),h=this.getLine();2!=this.pendingBuffer||a||(this.pendingBuffer=0),this.flushBuffer(n),a&&(h.append(yi(new ti(1),n),s),s=n.length+Math.max(0,s-n.length)),h.append(yi(r,n),s),this.atCursorPos=l,this.pendingBuffer=l?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,i,n,s){let r=new wi(e,t,i,s);return r.openEnd=Oe.spans(n,t,i,r),r.openStart<0&&(r.openStart=r.openEnd),r.finish(r.openEnd),r}}function yi(e,t){for(let i of t)e=new Yt(i,[e],e.length);return e}class bi extends li{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const _i=W.define(),Ci=W.define(),Si=W.define(),xi=W.define(),ki=W.define(),Ai=W.define(),Ei=W.define({combine:e=>e.some((e=>e))});class Ti{constructor(e,t="nearest",i="nearest",n=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=n,this.xMargin=s}map(e){return e.empty?this:new Ti(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Mi=me.define({map:(e,t)=>e.map(t)});function Li(e,t,i){let n=e.facet(xi);n.length?n[0](t):window.onerror?window.onerror(String(t),i,void 0,void 0,t):i?console.error(i+":",t):console.error(t)}const Ri=W.define({combine:e=>!e.length||e[0]});let $i=0;const Ii=W.define();class Oi{constructor(e,t,i,n){this.id=e,this.create=t,this.domEventHandlers=i,this.extension=n(this)}static define(e,t){const{eventHandlers:i,provide:n,decorations:s}=t||{};return new Oi($i++,e,i,(e=>{let t=[Ii.of(e)];return s&&t.push(Fi.of((t=>{let i=t.plugin(e);return i?s(i):ci.none}))),n&&t.push(n(e)),t}))}static fromClass(e,t){return Oi.define((t=>new e(t)),t)}}class Di{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(Li(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(e){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Li(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(t){Li(e.state,t,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Ni=W.define(),Pi=W.define(),Fi=W.define(),Bi=W.define(),Wi=W.define(),Hi=W.define();class Vi{constructor(e,t,i,n){this.fromA=e,this.toA=t,this.fromB=i,this.toB=n}join(e){return new Vi(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(0==t.length)return e;let i=[];for(let n=0,s=0,r=0,o=0;;n++){let a=n==e.length?null:e[n],l=r-o,h=a?a.fromB:1e9;for(;s<t.length&&t[s]<h;){let e=t[s],n=t[s+1],r=Math.max(o,e),a=Math.min(h,n);if(r<=a&&new Vi(r+l,a+l,r,a).addToSet(i),n>h)break;s+=2}if(!a)return i;new Vi(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),r=a.toA,o=a.toB}}}class zi{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=M.empty(this.startState.doc.length);for(let e of i)this.changes=this.changes.compose(e.changes);let n=[];this.changes.iterChangedRanges(((e,t,i,s)=>n.push(new Vi(e,t,i,s)))),this.changedRanges=n;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}static create(e,t,i){return new zi(e,t,i)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((e=>e.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var Ui=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(Ui||(Ui={}));const qi=Ui.LTR,Ki=Ui.RTL;function ji(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const Gi=ji("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Yi=ji("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Qi=Object.create(null),Ji=[];for(let e of["()","[]","{}"]){let t=e.charCodeAt(0),i=e.charCodeAt(1);Qi[t]=i,Qi[i]=-t}const Xi=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Zi{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?Ki:qi}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,n){let s=-1;for(let r=0;r<e.length;r++){let o=e[r];if(o.from<=t&&o.to>=t){if(o.level==i)return r;(s<0||(0!=n?n<0?o.from<t:o.to>t:e[s].level>o.level))&&(s=r)}}if(s<0)throw new RangeError("Index out of range");return s}}const en=[];function tn(e,t){let i=e.length,n=t==qi?1:2,s=t==qi?2:1;if(!e||1==n&&!Xi.test(e))return nn(i);for(let t=0,s=n,o=n;t<i;t++){let i=(r=e.charCodeAt(t))<=247?Gi[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?Yi[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8203||8204==r?256:1;512==i?i=s:8==i&&4==o&&(i=16),en[t]=4==i?2:i,7&i&&(o=i),s=i}var r;for(let e=0,t=n,s=n;e<i;e++){let n=en[e];if(128==n)e<i-1&&t==en[e+1]&&24&t?n=en[e]=t:en[e]=256;else if(64==n){let n=e+1;for(;n<i&&64==en[n];)n++;let r=e&&8==t||n<i&&8==en[n]?1==s?1:8:256;for(let t=e;t<n;t++)en[t]=r;e=n-1}else 8==n&&1==s&&(en[e]=1);t=n,7&n&&(s=n)}for(let t,r,o,a=0,l=0,h=0;a<i;a++)if(r=Qi[t=e.charCodeAt(a)])if(r<0){for(let e=l-3;e>=0;e-=3)if(Ji[e+1]==-r){let t=Ji[e+2],i=2&t?n:4&t?1&t?s:n:0;i&&(en[a]=en[Ji[e]]=i),l=e;break}}else{if(189==Ji.length)break;Ji[l++]=a,Ji[l++]=t,Ji[l++]=h}else if(2==(o=en[a])||1==o){let e=o==n;h=e?0:1;for(let t=l-3;t>=0;t-=3){let i=Ji[t+2];if(2&i)break;if(e)Ji[t+2]|=2;else{if(4&i)break;Ji[t+2]|=4}}}for(let e=0;e<i;e++)if(256==en[e]){let t=e+1;for(;t<i&&256==en[t];)t++;let s=1==(e?en[e-1]:n),r=s==(1==(t<i?en[t]:n))?s?1:2:n;for(let i=e;i<t;i++)en[i]=r;e=t-1}let o=[];if(1==n)for(let e=0;e<i;){let t=e,n=1!=en[e++];for(;e<i&&n==(1!=en[e]);)e++;if(n)for(let i=e;i>t;){let e=i,n=2!=en[--i];for(;i>t&&n==(2!=en[i-1]);)i--;o.push(new Zi(i,e,n?2:1))}else o.push(new Zi(t,e,0))}else for(let e=0;e<i;){let t=e,n=2==en[e++];for(;e<i&&n==(2==en[e]);)e++;o.push(new Zi(t,e,n?1:2))}return o}function nn(e){return[new Zi(0,e,0)]}let sn="";function rn(e,t,i,n,s){var r;let o=n.head-e.from,a=-1;if(0==o){if(!s||!e.length)return null;t[0].level!=i&&(o=t[0].side(!1,i),a=0)}else if(o==e.length){if(s)return null;let e=t[t.length-1];e.level!=i&&(o=e.side(!0,i),a=t.length-1)}a<0&&(a=Zi.find(t,o,null!==(r=n.bidiLevel)&&void 0!==r?r:-1,n.assoc));let l=t[a];o==l.side(s,i)&&(l=t[a+=s?1:-1],o=l.side(!s,i));let h=s==(l.dir==i),c=w(e.text,o,h);if(sn=e.text.slice(Math.min(o,c),Math.max(o,c)),c!=l.side(s,i))return P.cursor(c+e.from,h?-1:1,l.level);let u=a==(s?t.length-1:0)?null:t[a+(s?1:-1)];return u||l.level==i?u&&u.level<l.level?P.cursor(u.side(!s,i)+e.from,s?1:-1,u.level):P.cursor(c+e.from,s?-1:1,l.level):P.cursor(s?e.to:e.from,s?-1:1,i)}class on{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Te.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+="￿"}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let n=e;;){this.findPointBefore(i,n),this.readNode(n);let e=n.nextSibling;if(e==t)break;let s=Rt.get(n),r=Rt.get(e);(s&&r?s.breakAfter:(s?s.breakAfter:an(n))||an(e)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=e}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let s,r=-1,o=1;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(s=n.exec(t))&&(r=s.index,o=s[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);i=r+o}}readNode(e){if(e.cmIgnore)return;let t=Rt.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function an(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}class ln{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class hn extends Rt{constructor(e){super(),this.view=e,this.compositionDeco=ci.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new mi],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Vi(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every((({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo))?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=ci.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=function(e,t){let i=un(e);if(!i)return ci.none;let{from:n,to:s,node:r,text:o}=i,a=t.mapPos(n,1),l=Math.max(a,t.mapPos(s,-1)),{state:h}=e,c=3==r.nodeType?r.nodeValue:new on([],h).readRange(r.firstChild,null).text;if(l-a<c.length)if(h.doc.sliceString(a,Math.min(h.doc.length,a+c.length),"￿")==c)l=a+c.length;else{if(h.doc.sliceString(Math.max(0,l-c.length),l,"￿")!=c)return ci.none;a=l-c.length}else if(h.doc.sliceString(a,l,"￿")!=c)return ci.none;let u=Rt.get(r);u instanceof Xt?u=u.widget.topView:u&&(u.parent=null);return ci.set(ci.replace({widget:new dn(r,o,u),inclusive:!0}).range(a,l))}(this.view,e.changes)),(jt.ie||jt.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=function(e,t,i){let n=new pn;return Oe.compare(e,t,i,n),n.changes}(this.decorations,this.updateDeco(),e.changes);return t=Vi.extendWithRanges(t,i),(0!=this.dirty||0!=t.length)&&(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=jt.chrome||jt.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(e),this.dirty=0,e&&(e.written||i.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let e of this.children)e instanceof vi&&e.widget instanceof cn&&n.push(e.dom);i.updateGaps(n)}updateChildren(e,t){let i=this.childCursor(t);for(let t=e.length-1;;t--){let n=t>=0?e[t]:null;if(!n)break;let{fromA:s,toA:r,fromB:o,toB:a}=n,{content:l,breakAtStart:h,openStart:c,openEnd:u}=wi.build(this.view.state.doc,o,a,this.decorations,this.dynamicDecorationMap),{i:d,off:f}=i.findPos(r,1),{i:p,off:g}=i.findPos(s,-1);Ot(this,p,g,d,f,l,h,c,u)}}updateSelection(e=!1,t=!1){if(e&&this.view.observer.readSelectionRange(),!t&&!this.mayControlSelection()||jt.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,s=this.domAtPos(n.anchor),r=n.empty?s:this.domAtPos(n.head);if(jt.gecko&&n.empty&&(1==(o=s).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let e=document.createTextNode("");this.view.observer.ignore((()=>s.node.insertBefore(e,s.node.childNodes[s.offset]||null))),s=r=new Mt(e,0),i=!0}var o;let a=this.view.observer.selectionRange;!i&&a.focusNode&&gt(s.node,s.offset,a.anchorNode,a.anchorOffset)&&gt(r.node,r.offset,a.focusNode,a.focusOffset)||(this.view.observer.ignore((()=>{jt.android&&jt.chrome&&this.dom.contains(a.focusNode)&&function(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(a.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=ut(this.root);if(n.empty){if(jt.gecko){let e=(t=s.node,i=s.offset,1!=t.nodeType?0:(i&&"false"==t.childNodes[i-1].contentEditable?1:0)|(i<t.childNodes.length&&"false"==t.childNodes[i].contentEditable?2:0));if(e&&3!=e){let t=fn(s.node,s.offset,1==e?1:-1);t&&(s=new Mt(t,1==e?0:t.nodeValue.length))}}e.collapse(s.node,s.offset),null!=n.bidiLevel&&null!=a.cursorBidiLevel&&(a.cursorBidiLevel=n.bidiLevel)}else if(e.extend)e.collapse(s.node,s.offset),e.extend(r.node,r.offset);else{let t=document.createRange();n.anchor>n.head&&([s,r]=[r,s]),t.setEnd(r.node,r.offset),t.setStart(s.node,s.offset),e.removeAllRanges(),e.addRange(t)}var t,i})),this.view.observer.setSelectionRange(s,r)),this.impreciseAnchor=s.precise?null:new Mt(a.anchorNode,a.anchorOffset),this.impreciseHead=r.precise?null:new Mt(a.focusNode,a.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=ut(this.root);if(!e.empty||!e.assoc||!t.modify)return;let i=mi.find(this,e.head);if(!i)return;let n=i.posAtStart;if(e.head==n||e.head==n+i.length)return;let s=this.coordsAt(e.head,-1),r=this.coordsAt(e.head,1);if(!s||!r||s.bottom>r.top)return;let o=this.domAtPos(e.head+e.assoc);t.collapse(o.node,o.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){return this.view.state.facet(Ri)?this.root.activeElement==this.dom:ft(this.dom,this.view.observer.selectionRange)}nearest(e){for(let t=e;t;){let e=Rt.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof mi)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,n=this.children.length-1;;n--){let s=this.children[n],r=i-s.breakAfter-s.length;if(e>r||e==r&&s.type!=hi.WidgetBefore&&s.type!=hi.WidgetAfter&&(!n||2==t||this.children[n-1].breakAfter||this.children[n-1].type==hi.WidgetBefore&&t>-2))return s.coordsAt(e-r,t);i=r}}measureVisibleLineHeights(e){let t=[],{from:i,to:n}=e,s=this.view.contentDOM.clientWidth,r=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==Ui.LTR;for(let e=0,l=0;l<this.children.length;l++){let h=this.children[l],c=e+h.length;if(c>n)break;if(e>=i){let i=h.dom.getBoundingClientRect();if(t.push(i.height),r){let t=h.dom.lastChild,n=t?pt(t):[];if(n.length){let t=n[n.length-1],r=a?t.right-i.left:i.right-t.left;r>o&&(o=r,this.minWidth=s,this.minWidthFrom=e,this.minWidthTo=c)}}}e=c+h.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?Ui.RTL:Ui.LTR}measureTextSize(){for(let e of this.children)if(e instanceof mi){let t=e.measureTextSize();if(t)return t}let e,t,i=document.createElement("div");return i.className="cm-line",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=pt(i.firstChild)[0];e=i.getBoundingClientRect().height,t=n?n.width/27:7,i.remove()})),{lineHeight:e,charWidth:t}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new It(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,n=0;;n++){let s=n==t.viewports.length?null:t.viewports[n],r=s?s.from-1:this.length;if(r>i){let n=t.lineBlockAt(r).bottom-t.lineBlockAt(i).top;e.push(ci.replace({widget:new cn(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,r))}if(!s)break;i=s.to+1}return ci.set(e)}updateDeco(){let e=this.view.state.facet(Fi).map(((e,t)=>(this.dynamicDecorationMap[t]="function"==typeof e)?e(this.view):e));for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let t,{range:i}=e,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,t.left),top:Math.min(n.top,t.top),right:Math.max(n.right,t.right),bottom:Math.max(n.bottom,t.bottom)});let s=0,r=0,o=0,a=0;for(let e of this.view.state.facet(Wi).map((e=>e(this.view))))if(e){let{left:t,right:i,top:n,bottom:l}=e;null!=t&&(s=Math.max(s,t)),null!=i&&(r=Math.max(r,i)),null!=n&&(o=Math.max(o,n)),null!=l&&(a=Math.max(a,l))}let l={left:n.left-s,top:n.top-o,right:n.right+r,bottom:n.bottom+a};!function(e,t,i,n,s,r,o,a){let l=e.ownerDocument,h=l.defaultView;for(let c=e;c;)if(1==c.nodeType){let e,u=c==l.body;if(u)e=_t(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let t=c.getBoundingClientRect();e={left:t.left,right:t.left+c.clientWidth,top:t.top,bottom:t.top+c.clientHeight}}let d=0,f=0;if("nearest"==s)t.top<e.top?(f=-(e.top-t.top+o),i>0&&t.bottom>e.bottom+f&&(f=t.bottom-e.bottom+f+o)):t.bottom>e.bottom&&(f=t.bottom-e.bottom+o,i<0&&t.top-f<e.top&&(f=-(e.top+f-t.top+o)));else{let n=t.bottom-t.top,r=e.bottom-e.top;f=("center"==s&&n<=r?t.top+n/2-r/2:"start"==s||"center"==s&&i<0?t.top-o:t.bottom-r+o)-e.top}if("nearest"==n?t.left<e.left?(d=-(e.left-t.left+r),i>0&&t.right>e.right+d&&(d=t.right-e.right+d+r)):t.right>e.right&&(d=t.right-e.right+r,i<0&&t.left<e.left+d&&(d=-(e.left+d-t.left+r))):d=("center"==n?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==n==a?t.left-r:t.right-(e.right-e.left)+r)-e.left,d||f)if(u)h.scrollBy(d,f);else{if(f){let e=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-e}if(d){let e=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-e}t={left:t.left-d,top:t.top-f,right:t.right-d,bottom:t.bottom-f}}if(u)break;c=c.assignedSlot||c.parentNode,n=s="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Ui.LTR)}}class cn extends li{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function un(e){let t=e.observer.selectionRange,i=t.focusNode&&fn(t.focusNode,t.focusOffset,0);if(!i)return null;let n=e.docView.nearest(i);if(!n)return null;if(n instanceof mi){let e=i;for(;e.parentNode!=n.dom;)e=e.parentNode;let t=e.previousSibling;for(;t&&!Rt.get(t);)t=t.previousSibling;let s=t?Rt.get(t).posAtEnd:n.posAtStart;return{from:s,to:s,node:e,text:i}}{for(;;){let{parent:e}=n;if(!e)return null;if(e instanceof mi)break;n=e}let e=n.posAtStart;return{from:e,to:e+n.length,node:n.dom,text:i}}}class dn extends li{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Xt}}function fn(e,t,i){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0&&i<=0)t=wt(e=e.childNodes[t-1]);else{if(!(1==e.nodeType&&t<e.childNodes.length&&i>=0))return null;e=e.childNodes[t],t=0}}}class pn{constructor(){this.changes=[]}compareRange(e,t){gi(e,t,this.changes)}comparePoint(e,t){gi(e,t,this.changes)}}function gn(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function mn(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function vn(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function wn(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function yn(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function bn(e,t,i){let n,s,r,o,a,l,h,c;for(let u=e.firstChild;u;u=u.nextSibling){let e=pt(u);for(let d=0;d<e.length;d++){let f=e[d];s&&vn(s,f)&&(f=wn(yn(f,s.bottom),s.top));let p=gn(t,f),g=mn(i,f);if(0==p&&0==g)return 3==u.nodeType?_n(u,t,i):bn(u,t,i);(!n||o>g||o==g&&r>p)&&(n=u,s=f,r=p,o=g),0==p?i>f.bottom&&(!h||h.bottom<f.bottom)?(a=u,h=f):i<f.top&&(!c||c.top>f.top)&&(l=u,c=f):h&&vn(h,f)?h=yn(h,f.bottom):c&&vn(c,f)&&(c=wn(c,f.top))}}if(h&&h.bottom>=i?(n=a,s=h):c&&c.top<=i&&(n=l,s=c),!n)return{node:e,offset:0};let u=Math.max(s.left,Math.min(s.right,t));return 3==n.nodeType?_n(n,u,i):r||"true"!=n.contentEditable?{node:e,offset:Array.prototype.indexOf.call(e.childNodes,n)+(t>=(s.left+s.right)/2?1:0)}:bn(n,u,i)}function _n(e,t,i){let n=e.nodeValue.length,s=-1,r=1e9,o=0;for(let a=0;a<n;a++){let n=At(e,a,a+1).getClientRects();for(let l=0;l<n.length;l++){let h=n[l];if(h.top==h.bottom)continue;o||(o=t-h.left);let c=(h.top>i?h.top-i:i-h.bottom)-1;if(h.left-1<=t&&h.right+1>=t&&c<r){let i=t>=(h.left+h.right)/2,n=i;if(jt.chrome||jt.gecko){At(e,a).getBoundingClientRect().left==h.right&&(n=!i)}if(c<=0)return{node:e,offset:a+(n?1:0)};s=a+(n?1:0),r=c}}}return{node:e,offset:s>-1?s:o>0?e.nodeValue.length:0}}function Cn(e,{x:t,y:i},n,s=-1){var r;let o,a=e.contentDOM.getBoundingClientRect(),l=a.top+e.viewState.paddingTop,{docHeight:h}=e.viewState,c=i-l;if(c<0)return 0;if(c>h)return e.state.doc.length;for(let t=e.defaultLineHeight/2,i=!1;o=e.elementAtHeight(c),o.type!=hi.Text;)for(;c=s>0?o.bottom+t:o.top-t,!(c>=0&&c<=h);){if(i)return n?null:0;i=!0,s=-s}i=l+c;let u=o.from;if(u<e.viewport.from)return 0==e.viewport.from?0:n?null:Sn(e,a,o,t,i);if(u>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:n?null:Sn(e,a,o,t,i);let d=e.dom.ownerDocument,f=e.root.elementFromPoint?e.root:d,p=f.elementFromPoint(t,i);p&&!e.contentDOM.contains(p)&&(p=null),p||(t=Math.max(a.left+1,Math.min(a.right-1,t)),p=f.elementFromPoint(t,i),p&&!e.contentDOM.contains(p)&&(p=null));let g,m=-1;if(p&&0!=(null===(r=e.docView.nearest(p))||void 0===r?void 0:r.isEditable))if(d.caretPositionFromPoint){let e=d.caretPositionFromPoint(t,i);e&&({offsetNode:g,offset:m}=e)}else if(d.caretRangeFromPoint){let e=d.caretRangeFromPoint(t,i);e&&(({startContainer:g,startOffset:m}=e),jt.safari&&function(e,t,i){let n;if(3!=e.nodeType||t!=(n=e.nodeValue.length))return!1;for(let t=e.nextSibling;t;t=t.nextSibling)if(1!=t.nodeType||"BR"!=t.nodeName)return!1;return At(e,n-1,n).getBoundingClientRect().left>i}(g,m,t)&&(g=void 0))}if(!g||!e.docView.dom.contains(g)){let n=mi.find(e.docView,u);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:g,offset:m}=bn(n.dom,t,i))}return e.docView.posFromDOM(g,m)}function Sn(e,t,i,n,s){let r=Math.round((n-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){r+=Math.floor((s-i.top)/e.defaultLineHeight)*e.viewState.heightOracle.lineLength}let o=e.state.sliceDoc(i.from,i.to);return i.from+je(o,r,e.state.tabSize)}function xn(e,t,i,n){let s=e.state.doc.lineAt(t.head),r=e.bidiSpans(s),o=e.textDirectionAt(s.from);for(let a=t,l=null;;){let t=rn(s,r,o,a,i),h=sn;if(!t){if(s.number==(i?e.state.doc.lines:1))return a;h="\n",s=e.state.doc.line(s.number+(i?1:-1)),r=e.bidiSpans(s),t=P.cursor(i?s.from:s.to)}if(l){if(!l(h))return a}else{if(!n)return t;l=n(h)}a=t}}function kn(e,t,i){let n=e.state.facet(Bi).map((t=>t(e)));for(;;){let e=!1;for(let s of n)s.between(i.from-1,i.from+1,((n,s,r)=>{i.from>n&&i.from<s&&(i=t.from>i.from?P.cursor(n,1):P.cursor(s,-1),e=!0)}));if(!e)return i}}class An{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Rn){let i=Rn[t];e.contentDOM.addEventListener(t,(n=>{Ln(e,n)&&!this.ignoreDuringComposition(n)&&("keydown"==t&&this.keydown(e,n)||(this.mustFlushObserver(n)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,n)?n.preventDefault():i(e,n)))})),this.registeredEvents.push(t)}jt.chrome&&jt.chrome_version>=102&&e.scrollDOM.addEventListener("wheel",(()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout((()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""}),100)}),{passive:!0}),this.notifiedFocused=e.hasFocus,jt.safari&&e.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var i;let n;this.customHandlers=[];for(let s of t)if(n=null===(i=s.update(e).spec)||void 0===i?void 0:i.domEventHandlers){this.customHandlers.push({plugin:s.value,handlers:n});for(let t in n)this.registeredEvents.indexOf(t)<0&&"scroll"!=t&&(this.registeredEvents.push(t),e.contentDOM.addEventListener(t,(i=>{Ln(e,i)&&this.runCustomHandlers(t,e,i)&&i.preventDefault()})))}}runCustomHandlers(e,t,i){for(let n of this.customHandlers){let s=n.handlers[e];if(s)try{if(s.call(n.plugin,i,t)||i.defaultPrevented)return!0}catch(e){Li(t.state,e)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,t,e)}catch(t){Li(e.state,t)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),9==t.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(jt.android&&jt.chrome&&!t.synthetic&&(13==t.keyCode||8==t.keyCode))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return!(!jt.ios||!(i=En.find((e=>e.keyCode==t.keyCode)))||t.ctrlKey||t.altKey||t.metaKey||t.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(e)),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&(this.pendingIOSKey=void 0,Et(e.contentDOM,t.key,t.keyCode))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(jt.safari&&Date.now()-this.compositionEndedAt<100)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(e){return"keydown"==e.type&&229!=e.keyCode||"compositionend"==e.type&&!jt.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const En=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Tn=[16,17,18,20,91,92,224,225];class Mn{constructor(e,t,i,n){this.view=e,this.style=i,this.mustSelect=n,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Te.allowMultipleSelections)&&function(e,t){let i=e.state.facet(_i);return i.length?i[0](t):jt.mac?t.metaKey:t.ctrlKey}(e,t),this.dragMove=function(e,t){let i=e.state.facet(Ci);return i.length?i[0](t):jt.mac?!t.altKey:!t.ctrlKey}(e,t),this.dragging=!(!function(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let n=ut(e.root);if(0==n.rangeCount)return!0;let s=n.getRangeAt(0).getClientRects();for(let e=0;e<s.length;e++){let i=s[e];if(i.left<=t.clientX&&i.right>=t.clientX&&i.top<=t.clientY&&i.bottom>=t.clientY)return!0}return!1}(e,t)||1!=Un(t))&&null,!1===this.dragging&&(t.preventDefault(),this.select(t))}move(e){if(0==e.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=e)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);!this.mustSelect&&t.eq(this.view.state.selection)&&t.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function Ln(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,n=t.target;n!=e.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=Rt.get(n))&&i.ignoreEvent(t))return!1;return!0}const Rn=Object.create(null),$n=jt.ie&&jt.ie_version<15||jt.ios&&jt.webkit_version<604;function In(e,t){let i,{state:n}=e,s=1,r=n.toText(t),o=r.lines==n.selection.ranges.length;if(null!=Kn&&n.selection.ranges.every((e=>e.empty))&&Kn==r.toString()){let e=-1;i=n.changeByRange((i=>{let a=n.doc.lineAt(i.from);if(a.from==e)return{range:i};e=a.from;let l=n.toText((o?r.line(s++).text:t)+n.lineBreak);return{changes:{from:a.from,insert:l},range:P.cursor(i.from+l.length)}}))}else i=o?n.changeByRange((e=>{let t=r.line(s++);return{changes:{from:e.from,to:e.to,insert:t.text},range:P.cursor(e.from+t.length)}})):n.replaceSelection(r);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Rn.keydown=(e,t)=>{e.inputState.setSelectionOrigin("select"),27==t.keyCode?e.inputState.lastEscPress=Date.now():Tn.indexOf(t.keyCode)<0&&(e.inputState.lastEscPress=0)};let On=0;function Dn(e,t,i,n){if(1==n)return P.cursor(t,i);if(2==n)return function(e,t,i=1){let n=e.charCategorizer(t),s=e.doc.lineAt(t),r=t-s.from;if(0==s.length)return P.cursor(t);0==r?i=1:r==s.length&&(i=-1);let o=r,a=r;i<0?o=w(s.text,r,!1):a=w(s.text,r);let l=n(s.text.slice(o,a));for(;o>0;){let e=w(s.text,o,!1);if(n(s.text.slice(e,o))!=l)break;o=e}for(;a<s.length;){let e=w(s.text,a);if(n(s.text.slice(a,e))!=l)break;a=e}return P.range(o+s.from,a+s.from)}(e.state,t,i);{let i=mi.find(e.docView,t),n=e.state.doc.lineAt(i?i.posAtEnd:t),s=i?i.posAtStart:n.from,r=i?i.posAtEnd:n.to;return r<e.state.doc.length&&r==n.to&&r++,P.range(s,r)}}Rn.touchstart=(e,t)=>{On=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},Rn.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},Rn.mousedown=(e,t)=>{if(e.observer.flush(),On>Date.now()-2e3&&1==Un(t))return;let i=null;for(let n of e.state.facet(Si))if(i=n(e,t),i)break;if(i||0!=t.button||(i=function(e,t){let i=Bn(e,t),n=Un(t),s=e.state.selection,r=i,o=t;return{update(e){e.docChanged&&(i&&(i.pos=e.changes.mapPos(i.pos)),s=s.map(e.changes),o=null)},get(t,a,l){let h;if(o&&t.clientX==o.clientX&&t.clientY==o.clientY?h=r:(h=r=Bn(e,t),o=t),!h||!i)return s;let c=Dn(e,h.pos,h.bias,n);if(i.pos!=h.pos&&!a){let t=Dn(e,i.pos,i.bias,n),s=Math.min(t.from,c.from),r=Math.max(t.to,c.to);c=s<c.from?P.range(s,r):P.range(r,s)}return a?s.replaceRange(s.main.extend(c.from,c.to)):l?s.addRange(c):P.create([c])}}}(e,t)),i){let n=e.root.activeElement!=e.contentDOM;n&&e.observer.ignore((()=>kt(e.contentDOM))),e.inputState.startMouseSelection(new Mn(e,t,i,n))}};let Nn=(e,t)=>e>=t.top&&e<=t.bottom,Pn=(e,t,i)=>Nn(t,i)&&e>=i.left&&e<=i.right;function Fn(e,t,i,n){let s=mi.find(e.docView,t);if(!s)return 1;let r=t-s.posAtStart;if(0==r)return 1;if(r==s.length)return-1;let o=s.coordsAt(r,-1);if(o&&Pn(i,n,o))return-1;let a=s.coordsAt(r,1);return a&&Pn(i,n,a)?1:o&&Nn(n,o)?-1:1}function Bn(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:Fn(e,i,t.clientX,t.clientY)}}const Wn=jt.ie&&jt.ie_version<=11;let Hn=null,Vn=0,zn=0;function Un(e){if(!Wn)return e.detail;let t=Hn,i=zn;return Hn=e,zn=Date.now(),Vn=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(Vn+1)%3:1}function qn(e,t,i,n){if(!i)return;let s=e.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:r}=e.inputState,o=n&&r&&r.dragging&&r.dragMove?{from:r.dragging.from,to:r.dragging.to}:null,a={from:s,insert:i},l=e.state.changes(o?[o,a]:a);e.focus(),e.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"})}Rn.dragstart=(e,t)=>{let{selection:{main:i}}=e.state,{mouseSelection:n}=e.inputState;n&&(n.dragging=i),t.dataTransfer&&(t.dataTransfer.setData("Text",e.state.sliceDoc(i.from,i.to)),t.dataTransfer.effectAllowed="copyMove")},Rn.drop=(e,t)=>{if(!t.dataTransfer)return;if(e.state.readOnly)return t.preventDefault();let i=t.dataTransfer.files;if(i&&i.length){t.preventDefault();let n=Array(i.length),s=0,r=()=>{++s==i.length&&qn(e,t,n.filter((e=>null!=e)).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=r,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(n[e]=t.result),r()},t.readAsText(i[e])}}else qn(e,t,t.dataTransfer.getData("Text"),!0)},Rn.paste=(e,t)=>{if(e.state.readOnly)return t.preventDefault();e.observer.flush();let i=$n?null:t.clipboardData;i?(In(e,i.getData("text/plain")),t.preventDefault()):function(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{e.focus(),i.remove(),In(e,i.value)}),50)}(e)};let Kn=null;function jn(e){setTimeout((()=>{e.hasFocus!=e.inputState.notifiedFocused&&e.update([])}),10)}function Gn(e,t){if(e.docView.compositionDeco.size){e.inputState.rapidCompositionStart=t;try{e.update([])}finally{e.inputState.rapidCompositionStart=!1}}}Rn.copy=Rn.cut=(e,t)=>{let{text:i,ranges:n,linewise:s}=function(e){let t=[],i=[],n=!1;for(let n of e.selection.ranges)n.empty||(t.push(e.sliceDoc(n.from,n.to)),i.push(n));if(!t.length){let s=-1;for(let{from:n}of e.selection.ranges){let r=e.doc.lineAt(n);r.number>s&&(t.push(r.text),i.push({from:r.from,to:Math.min(e.doc.length,r.to+1)})),s=r.number}n=!0}return{text:t.join(e.lineBreak),ranges:i,linewise:n}}(e.state);if(!i&&!s)return;Kn=s?i:null;let r=$n?null:t.clipboardData;r?(t.preventDefault(),r.clearData(),r.setData("text/plain",i)):function(e,t){let i=e.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=t,n.focus(),n.selectionEnd=t.length,n.selectionStart=0,setTimeout((()=>{n.remove(),e.focus()}),50)}(e,i),"cut"!=t.type||e.state.readOnly||e.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},Rn.focus=jn,Rn.blur=e=>{e.observer.clearSelectionRange(),jn(e)},Rn.compositionstart=Rn.compositionupdate=e=>{null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0,e.docView.compositionDeco.size&&(e.observer.flush(),Gn(e,!0)))},Rn.compositionend=e=>{e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionFirstChange=null,setTimeout((()=>{e.inputState.composing<0&&Gn(e,!1)}),50)},Rn.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},Rn.beforeinput=(e,t)=>{var i;let n;if(jt.chrome&&jt.android&&(n=En.find((e=>e.inputType==t.inputType)))&&(e.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let t=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())}),100)}};const Yn=["pre-wrap","normal","pre-line","break-spaces"];class Qn{constructor(){this.doc=o.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return Yn.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let n=e[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(t=!0,this.heightSamples[Math.floor(10*n)]=!0)}return t}refresh(e,t,i,n,s){let r=Yn.indexOf(e)>-1,o=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=r;if(this.lineWrapping=r,this.lineHeight=t,this.charWidth=i,this.lineLength=n,o){this.heightSamples={};for(let e=0;e<s.length;e++){let t=s[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return o}}class Jn{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Xn{constructor(e,t,i,n,s){this.from=e,this.length=t,this.top=i,this.height=n,this.type=s}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new Xn(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Zn=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(Zn||(Zn={}));class es{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>.001&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return es.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,n){let s=this;for(let r=n.length-1;r>=0;r--){let{fromA:o,toA:a,fromB:l,toB:h}=n[r],c=s.lineAt(o,Zn.ByPosNoHeight,t,0,0),u=c.to>=a?c:s.lineAt(a,Zn.ByPosNoHeight,t,0,0);for(h+=u.to-a,a=u.to;r>0&&c.from<=n[r-1].toA;)o=n[r-1].fromA,l=n[r-1].fromB,r--,o<c.from&&(c=s.lineAt(o,Zn.ByPosNoHeight,t,0,0));l+=c.from-o,o=c.from;let d=os.build(i,e,l,h);s=s.replace(o,a,d)}return s.updateHeight(i,0)}static empty(){return new is(0,0)}static of(e){if(1==e.length)return e[0];let t=0,i=e.length,n=0,s=0;for(;;)if(t==i)if(n>2*s){let s=e[t-1];s.break?e.splice(--t,1,s.left,null,s.right):e.splice(--t,1,s.left,s.right),i+=1+s.break,n-=s.size}else{if(!(s>2*n))break;{let t=e[i];t.break?e.splice(i,1,t.left,null,t.right):e.splice(i,1,t.left,t.right),i+=2+t.break,s-=t.size}}else if(n<s){let i=e[t++];i&&(n+=i.size)}else{let t=e[--i];t&&(s+=t.size)}let r=0;return null==e[t-1]?(r=1,t--):null==e[t]&&(r=1,i++),new ss(es.of(e.slice(0,t)),r,es.of(e.slice(i)))}}es.prototype.size=1;class ts extends es{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,n){return new Xn(n,this.length,i,this.height,this.type)}lineAt(e,t,i,n,s){return this.blockAt(0,i,n,s)}forEachLine(e,t,i,n,s,r){e<=s+this.length&&t>=s&&r(this.blockAt(0,i,n,s))}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class is extends ts{constructor(e,t){super(e,t,hi.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let n=i[0];return 1==i.length&&(n instanceof is||n instanceof ns&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof ns?n=new is(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):es.of(i)}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more?this.setHeight(e,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ns extends es{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,n=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(e,t,i,n){let{firstLine:s,lastLine:r,lineHeight:o}=this.lines(t,n),a=Math.max(0,Math.min(r-s,Math.floor((e-i)/o))),{from:l,length:h}=t.line(s+a);return new Xn(l,h,i+o*a,o,hi.Text)}lineAt(e,t,i,n,s){if(t==Zn.ByHeight)return this.blockAt(e,i,n,s);if(t==Zn.ByPosNoHeight){let{from:t,to:n}=i.lineAt(e);return new Xn(t,n-t,0,0,hi.Text)}let{firstLine:r,lineHeight:o}=this.lines(i,s),{from:a,length:l,number:h}=i.lineAt(e);return new Xn(a,l,n+o*(h-r),o,hi.Text)}forEachLine(e,t,i,n,s,r){let{firstLine:o,lineHeight:a}=this.lines(i,s);for(let l=Math.max(e,s),h=Math.min(s+this.length,t);l<=h;){let t=i.lineAt(l);l==e&&(n+=a*(t.number-o)),r(new Xn(t.from,t.length,n,a,hi.Text)),n+=a,l=t.to+1}}replace(e,t,i){let n=this.length-t;if(n>0){let e=i[i.length-1];e instanceof ns?i[i.length-1]=new ns(e.length+n):i.push(null,new ns(n-1))}if(e>0){let t=i[0];t instanceof ns?i[0]=new ns(e+t.length):i.unshift(new ns(e-1),null)}return es.of(i)}decomposeLeft(e,t){t.push(new ns(e-1),null)}decomposeRight(e,t){t.push(null,new ns(this.length-e-1))}updateHeight(e,t=0,i=!1,n){let s=t+this.length;if(n&&n.from<=t+this.length&&n.more){let i=[],r=Math.max(t,n.from),o=-1,a=e.heightChanged;for(n.from>t&&i.push(new ns(n.from-t-1).updateHeight(e,t));r<=s&&n.more;){let t=e.doc.lineAt(r).length;i.length&&i.push(null);let s=n.heights[n.index++];-1==o?o=s:Math.abs(s-o)>=.001&&(o=-2);let a=new is(t,s);a.outdated=!1,i.push(a),r+=t+1}r<=s&&i.push(null,new ns(s-r).updateHeight(e,r));let l=es.of(i);return e.heightChanged=a||o<0||Math.abs(l.height-this.height)>=.001||Math.abs(o-this.lines(e.doc,t).lineHeight)>=.001,l}return(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class ss extends es{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,n){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,n):this.right.blockAt(e,t,s,n+this.left.length+this.break)}lineAt(e,t,i,n,s){let r=n+this.left.height,o=s+this.left.length+this.break,a=t==Zn.ByHeight?e<r:e<o,l=a?this.left.lineAt(e,t,i,n,s):this.right.lineAt(e,t,i,r,o);if(this.break||(a?l.to<o:l.from>o))return l;let h=t==Zn.ByPosNoHeight?Zn.ByPosNoHeight:Zn.ByPos;return a?l.join(this.right.lineAt(o,h,i,r,o)):this.left.lineAt(o,h,i,n,s).join(l)}forEachLine(e,t,i,n,s,r){let o=n+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,n,s,r),t>=a&&this.right.forEachLine(e,t,i,o,a,r);else{let l=this.lineAt(a,Zn.ByPos,i,n,s);e<l.from&&this.left.forEachLine(e,l.from-1,i,n,s,r),l.to>=e&&l.from<=t&&r(l),t>l.to&&this.right.forEachLine(l.to+1,t,i,o,a,r)}}replace(e,t,i){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,i));let s=[];e>0&&this.decomposeLeft(e,s);let r=s.length;for(let e of i)s.push(e);if(e>0&&rs(s,r-1),t<this.length){let e=s.length;this.decomposeRight(t,s),rs(s,e)}return es.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,n=i+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?es.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,n){let{left:s,right:r}=this,o=t+s.length+this.break,a=null;return n&&n.from<=t+s.length&&n.more?a=s=s.updateHeight(e,t,i,n):s.updateHeight(e,t,i),n&&n.from<=o+r.length&&n.more?a=r=r.updateHeight(e,o,i,n):r.updateHeight(e,o,i),a?this.balanced(s,r):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function rs(e,t){let i,n;null==e[t]&&(i=e[t-1])instanceof ns&&(n=e[t+1])instanceof ns&&e.splice(t-1,3,new ns(i.length+1+n.length))}class os{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof is?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new is(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let s=t-e;i.block?this.addBlock(new ts(s,n,i.type)):(s||n>=5)&&this.addLineDeco(n,s)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new is(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new ns(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof is)return e;let t=new is(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type!=hi.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=hi.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof is||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new is(0,-1));let i=e;for(let e of this.nodes)e instanceof is&&e.updateHeight(this.oracle,i),i+=e?e.length:1;return this.nodes}static build(e,t,i,n){let s=new os(i,e);return Oe.spans(t,i,n,s,0),s.finish(i)}}class as{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,n){(e<t||i&&i.heightRelevant||n&&n.heightRelevant)&&gi(e,t,this.changes,5)}}function ls(e,t){let i=e.getBoundingClientRect(),n=Math.max(0,i.left),s=Math.min(innerWidth,i.right),r=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),a=e.ownerDocument.body;for(let t=e.parentNode;t&&t!=a;)if(1==t.nodeType){let e=t,i=window.getComputedStyle(e);if((e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)&&"visible"!=i.overflow){let t=e.getBoundingClientRect();n=Math.max(n,t.left),s=Math.min(s,t.right),r=Math.max(r,t.top),o=Math.min(o,t.bottom)}t="absolute"==i.position||"fixed"==i.position?e.offsetParent:e.parentNode}else{if(11!=t.nodeType)break;t=t.host}return{left:n-i.left,right:Math.max(n,s)-i.left,top:r-(i.top+t),bottom:Math.max(r,o)-(i.top+t)}}function hs(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}class cs{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],s=t[i];if(n.from!=s.from||n.to!=s.to||n.size!=s.size)return!1}return!0}draw(e){return ci.replace({widget:new us(this.size,e)}).range(this.from,this.to)}}class us extends li{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ds{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Qn,this.scaler=ys,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Ui.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=e.facet(Fi).filter((e=>"function"!=typeof e)),this.heightMap=es.empty().applyChanges(this.stateDeco,o.empty,this.heightOracle.setDoc(e.doc),[new Vi(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ci.set(this.lineGaps.map((e=>e.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let n=i?t.head:t.anchor;if(!e.some((({from:e,to:t})=>n>=e&&n<=t))){let{from:t,to:i}=this.lineBlockAt(n);e.push(new fs(t,i))}}this.viewports=e.sort(((e,t)=>e.from-t.from)),this.scaler=this.heightMap.height<=7e6?ys:new bs(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(e=>{this.viewportLines.push(1==this.scaler.scale?e:_s(e,this.scaler))}))}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Fi).filter((e=>"function"!=typeof e));let n=e.changedRanges,s=Vi.extendWithRanges(n,function(e,t,i){let n=new as;return Oe.compare(e,t,i,n,0),n.changes}(i,this.stateDeco,e?e.changes:M.empty(this.state.doc.length))),r=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),this.heightMap.height!=r&&(e.flags|=2);let o=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<o.from||t.range.head>o.to)||!this.viewportIsAppropriate(o))&&(o=this.getViewport(0,t));let a=!e.changes.empty||2&e.flags||o.from!=this.viewport.from||o.to!=this.viewport.to;this.viewport=o,this.updateForViewport(),a&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),n=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?Ui.RTL:Ui.LTR;let r=this.heightOracle.mustRefreshForWrapping(s),o=r||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight;this.contentDOMHeight=t.clientHeight,this.mustMeasureContent=!1;let a=0,l=0,h=parseInt(i.paddingTop)||0,c=parseInt(i.paddingBottom)||0;this.paddingTop==h&&this.paddingBottom==c||(this.paddingTop=h,this.paddingBottom=c,a|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(o=!0),this.editorWidth=e.scrollDOM.clientWidth,a|=8);let u=(this.printing?hs:ls)(t,this.paddingTop),d=u.top-this.pixelViewport.top,f=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(o=!0)),!this.inView)return 0;let g=t.clientWidth;if(this.contentDOMWidth==g&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=g,this.editorHeight=e.scrollDOM.clientHeight,a|=8),o){let t=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(t)&&(r=!0),r||n.lineWrapping&&Math.abs(g-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:o}=e.docView.measureTextSize();r=n.refresh(s,i,o,g/o,t),r&&(e.docView.minWidth=0,a|=8)}d>0&&f>0?l=Math.max(d,f):d<0&&f<0&&(l=Math.min(d,f)),n.heightChanged=!1;for(let i of this.viewports){let s=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=this.heightMap.updateHeight(n,0,r,new Jn(i.from,s))}n.heightChanged&&(a|=2)}let m=!this.viewportIsAppropriate(this.viewport,l)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return m&&(this.viewport=this.getViewport(l,this.scrollTarget)),this.updateForViewport(),(2&a||m)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(r?[]:this.lineGaps)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,s=this.state.doc,{visibleTop:r,visibleBottom:o}=this,a=new fs(n.lineAt(r-1e3*i,Zn.ByHeight,s,0,0).from,n.lineAt(o+1e3*(1-i),Zn.ByHeight,s,0,0).to);if(t){let{head:e}=t.range;if(e<a.from||e>a.to){let i,r=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(e,Zn.ByPos,s,0,0);i="center"==t.y?(o.top+o.bottom)/2-r/2:"start"==t.y||"nearest"==t.y&&e<a.from?o.top:o.bottom-r,a=new fs(n.lineAt(i-500,Zn.ByHeight,s,0,0).from,n.lineAt(i+r+500,Zn.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new fs(this.heightMap.lineAt(i,Zn.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,Zn.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,Zn.ByPos,this.state.doc,0,0),{bottom:s}=this.heightMap.lineAt(t,Zn.ByPos,this.state.doc,0,0),{visibleTop:r,visibleBottom:o}=this;return(0==e||n<=r-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=o+Math.max(10,Math.min(i,250)))&&n>r-2e3&&s<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let n of e)t.touchesRange(n.from,n.to)||i.push(new cs(t.mapPos(n.from),t.mapPos(n.to),n.size));return i}ensureLineGaps(e){let t=[];if(this.defaultTextDirection!=Ui.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,s,r=ps(i.from,i.to,this.stateDeco);if(r.total<4e3)continue;if(this.heightOracle.lineWrapping){let e=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=gs(r,(this.visibleTop-i.top-e)/i.height),s=gs(r,(this.visibleBottom-i.top+e)/i.height)}else{let e=r.total*this.heightOracle.charWidth,t=2e3*this.heightOracle.charWidth;n=gs(r,(this.pixelViewport.left-t)/e),s=gs(r,(this.pixelViewport.right+t)/e)}let o=[];n>i.from&&o.push({from:i.from,to:n}),s<i.to&&o.push({from:s,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&vs(o,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&vs(o,a.to-10,a.to+10);for(let{from:n,to:s}of o)s-n>1e3&&t.push(ws(e,(e=>e.from>=i.from&&e.to<=i.to&&Math.abs(e.from-n)<1e3&&Math.abs(e.to-s)<1e3))||new cs(n,s,this.gapSize(i,n,s,r)))}return t}gapSize(e,t,i,n){let s=ms(n,i)-ms(n,t);return this.heightOracle.lineWrapping?e.height*s:n.total*this.heightOracle.charWidth*s}updateLineGaps(e){cs.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ci.set(e.map((e=>e.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];Oe.spans(e,this.viewport.from,this.viewport.to,{span(e,i){t.push({from:e,to:i})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some(((e,i)=>e.from!=t[i].from||e.to!=t[i].to));return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find((t=>t.from<=e&&t.to>=e))||_s(this.heightMap.lineAt(e,Zn.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return _s(this.heightMap.lineAt(this.scaler.fromDOM(e),Zn.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return _s(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class fs{constructor(e,t){this.from=e,this.to=t}}function ps(e,t,i){let n=[],s=e,r=0;return Oe.spans(i,e,t,{span(){},point(e,t){e>s&&(n.push({from:s,to:e}),r+=e-s),s=t}},20),s<t&&(n.push({from:s,to:t}),r+=t-s),{total:r,ranges:n}}function gs({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let n=Math.floor(e*i);for(let e=0;;e++){let{from:i,to:s}=t[e],r=s-i;if(n<=r)return i+n;n-=r}}function ms(e,t){let i=0;for(let{from:n,to:s}of e.ranges){if(t<=s){i+=t-n;break}i+=s-n}return i/e.total}function vs(e,t,i){for(let n=0;n<e.length;n++){let s=e[n];if(s.from<i&&s.to>t){let r=[];s.from<t&&r.push({from:s.from,to:t}),s.to>i&&r.push({from:i,to:s.to}),e.splice(n,1,...r),n+=r.length-1}}}function ws(e,t){for(let i of e)if(t(i))return i}const ys={toDOM:e=>e,fromDOM:e=>e,scale:1};class bs{constructor(e,t,i){let n=0,s=0,r=0;this.viewports=i.map((({from:i,to:s})=>{let r=t.lineAt(i,Zn.ByPos,e,0,0).top,o=t.lineAt(s,Zn.ByPos,e,0,0).bottom;return n+=o-r,{from:i,to:s,top:r,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(t.height-n);for(let e of this.viewports)e.domTop=r+(e.top-s)*this.scale,r=e.domBottom=e.domTop+(e.bottom-e.top),s=e.bottom}toDOM(e){for(let t=0,i=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return n+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,n=s.domBottom}}fromDOM(e){for(let t=0,i=0,n=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-n)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,n=s.domBottom}}}function _s(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),n=t.toDOM(e.bottom);return new Xn(e.from,e.length,i,n-i,Array.isArray(e.type)?e.type.map((e=>_s(e,t))):e.type)}const Cs=W.define({combine:e=>e.join(" ")}),Ss=W.define({combine:e=>e.indexOf(!0)>-1}),xs=Je.newName(),ks=Je.newName(),As=Je.newName(),Es={"&light":"."+ks,"&dark":"."+As};function Ts(e,t,i){return new Je(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,(t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]})):e+" "+t})}const Ms=Ts("."+xs,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Es),Ls={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Rs=jt.ie&&jt.ie_version<=11;class $s{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new Ct,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver((t=>{for(let e of t)this.queue.push(e);(jt.ie&&jt.ie_version<=11||jt.ios&&e.composing)&&t.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Rs&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some(((t,i)=>t!=e[i])))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(Ri)?t.root.activeElement!=this.dom:!ft(t.dom,i))return;let n=i.anchorNode&&t.docView.nearest(i.anchorNode);n&&n.ignoreEvent(e)||((jt.ie&&jt.ie_version<=11||jt.android&&jt.chrome)&&!t.state.selection.main.empty&&i.focusNode&&gt(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=ut(e),i=jt.safari&&11==e.nodeType&&function(){let e=document.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}()==this.view.contentDOM&&function(e){let t=null;function i(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}if(e.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",i,!0),!t)return null;let n=t.startContainer,s=t.startOffset,r=t.endContainer,o=t.endOffset,a=e.docView.domAtPos(e.state.selection.main.anchor);gt(a.node,a.offset,r,o)&&([n,s,r,o]=[r,o,n,s]);return{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}}(this.view)||t;return!this.selectionRange.eq(i)&&(this.selectionRange.setRange(i),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ls),Rs&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Rs&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame((()=>{let e=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||Et(this.view.contentDOM,e.key,e.keyCode)})),this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let t of this.observer.takeRecords())e.push(t);e.length&&(this.queue=[]);let t=-1,i=-1,n=!1;for(let s of e){let e=this.readMutation(s);e&&(e.typeOver&&(n=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:n}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:n}=this.processRecords(),s=this.selectionChanged&&ft(this.dom,this.selectionRange);if(t<0&&!s)return;this.selectionChanged=!1;let r=this.view.state,o=this.onChange(t,i,n);return this.view.state==r&&this.view.update([]),o}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.dirty|=4),"childList"==e.type){let i=Is(t,e.previousSibling||e.target.previousSibling,-1),n=Is(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Is(e,t,i){for(;t;){let n=Rt.get(t);if(n&&n.parent==e)return n;let s=t.parentNode;t=s!=e.dom?s:i>0?t.nextSibling:t.previousSibling}return null}function Os(e,t,i,n){let s,r,a=e.state.selection.main;if(t>-1){let n=e.docView.domBoundsAround(t,i,0);if(!n||e.state.readOnly)return!1;let{from:l,to:h}=n,c=e.docView.impreciseHead||e.docView.impreciseAnchor?[]:function(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:n,focusNode:s,focusOffset:r}=e.observer.selectionRange;i&&(t.push(new ln(i,n)),s==i&&r==n||t.push(new ln(s,r)));return t}(e),u=new on(c,e.state);u.readRange(n.startDOM,n.endDOM);let d=a.from,f=null;(8===e.inputState.lastKeyCode&&e.inputState.lastKeyTime>Date.now()-100||jt.android&&u.text.length<h-l)&&(d=a.to,f="end");let p=function(e,t,i,n){let s=Math.min(e.length,t.length),r=0;for(;r<s&&e.charCodeAt(r)==t.charCodeAt(r);)r++;if(r==s&&e.length==t.length)return null;let o=e.length,a=t.length;for(;o>0&&a>0&&e.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;if("end"==n){i-=o+Math.max(0,r-Math.min(o,a))-r}if(o<r&&e.length<t.length){r-=i<=r&&i>=o?r-i:0,a=r+(a-o),o=r}else if(a<r){r-=i<=r&&i>=a?r-i:0,o=r+(o-a),a=r}return{from:r,toA:o,toB:a}}(e.state.doc.sliceString(l,h,"￿"),u.text,d-l,f);p&&(jt.chrome&&13==e.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==u.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:o.of(u.text.slice(p.from,p.toB).split("￿"))}),r=function(e,t){if(0==e.length)return null;let i=e[0].pos,n=2==e.length?e[1].pos:i;return i>-1&&n>-1?P.single(i+t,n+t):null}(c,l)}else if(e.hasFocus||!e.state.facet(Ri)){let t=e.observer.selectionRange,{impreciseHead:i,impreciseAnchor:n}=e.docView,s=i&&i.node==t.focusNode&&i.offset==t.focusOffset||!dt(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),o=n&&n.node==t.anchorNode&&n.offset==t.anchorOffset||!dt(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset);s==a.head&&o==a.anchor||(r=P.single(o,s))}if(!s&&!r)return!1;if(!s&&n&&!a.empty&&r&&r.main.empty?s={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,a.to)}:s&&s.from>=a.from&&s.to<=a.to&&(s.from!=a.from||s.to!=a.to)&&a.to-a.from-(s.to-s.from)<=4?s={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,s.from).append(s.insert).append(e.state.doc.slice(s.to,a.to))}:(jt.mac||jt.android)&&s&&s.from==s.to&&s.from==a.head-1&&"."==s.insert.toString()&&(s={from:a.from,to:a.to,insert:o.of([" "])}),s){let t=e.state;if(jt.ios&&e.inputState.flushIOSKey(e))return!0;if(jt.android&&(s.from==a.from&&s.to==a.to&&1==s.insert.length&&2==s.insert.lines&&Et(e.contentDOM,"Enter",13)||s.from==a.from-1&&s.to==a.to&&0==s.insert.length&&Et(e.contentDOM,"Backspace",8)||s.from==a.from&&s.to==a.to+1&&0==s.insert.length&&Et(e.contentDOM,"Delete",46)))return!0;let i,n=s.insert.toString();if(e.state.facet(Ai).some((t=>t(e,s.from,s.to,n))))return!0;if(e.inputState.composing>=0&&e.inputState.composing++,s.from>=a.from&&s.to<=a.to&&s.to-s.from>=(a.to-a.from)/3&&(!r||r.main.empty&&r.main.from==s.from+s.insert.length)&&e.inputState.composing<0){let n=a.from<s.from?t.sliceDoc(a.from,s.from):"",r=a.to>s.to?t.sliceDoc(s.to,a.to):"";i=t.replaceSelection(e.state.toText(n+s.insert.sliceString(0,void 0,e.state.lineBreak)+r))}else{let n=t.changes(s),o=r&&!t.selection.main.eq(r.main)&&r.main.to<=n.newLength?r.main:void 0;if(t.selection.ranges.length>1&&e.inputState.composing>=0&&s.to<=a.to&&s.to>=a.to-10){let r=e.state.sliceDoc(s.from,s.to),l=un(e)||e.state.doc.lineAt(a.head),h=a.to-s.to,c=a.to-a.from;i=t.changeByRange((i=>{if(i.from==a.from&&i.to==a.to)return{changes:n,range:o||i.map(n)};let u=i.to-h,d=u-r.length;if(i.to-i.from!=c||e.state.sliceDoc(d,u)!=r||l&&i.to>=l.from&&i.from<=l.to)return{range:i};let f=t.changes({from:d,to:u,insert:s.insert}),p=i.to-a.to;return{changes:f,range:o?P.range(Math.max(0,o.anchor+p),Math.max(0,o.head+p)):i.map(f)}}))}else i={changes:n,selection:o&&t.selection.replaceRange(o)}}let o="input.type";return e.composing&&(o+=".compose",e.inputState.compositionFirstChange&&(o+=".start",e.inputState.compositionFirstChange=!1)),e.dispatch(i,{scrollIntoView:!0,userEvent:o}),!0}if(r&&!r.main.eq(a)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin),e.dispatch({selection:r,scrollIntoView:t,userEvent:i}),!0}return!1}class Ds{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=e.root||function(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}(e.parent)||document,this.viewState=new ds(e.state||Te.create(e)),this.plugins=this.state.facet(Ii).map((e=>new Di(e)));for(let e of this.plugins)e.update(this);this.observer=new $s(this,((e,t,i)=>Os(this,e,t,i)),(e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()})),this.inputState=new An(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new hn(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(1==e.length&&e[0]instanceof ve?e[0]:this.state.update(...e))}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,n=!1,s=this.state;for(let t of e){if(t.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=t.state}if(this.destroyed)return void(this.viewState.state=s);if(this.observer.clear(),s.facet(Te.phrases)!=this.state.facet(Te.phrases))return this.setState(s);t=zi.create(this,s,e);let r=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(r&&(r=r.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;r=new Ti(e.empty?e:P.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(Mi)&&(r=e.value)}this.viewState.update(t,r),this.bidiCache=Fs.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(Hi)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some((e=>e.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(t.startState.facet(Cs)!=t.state.facet(Cs)&&(this.viewState.mustMeasureContent=!0),(i||n||r||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!t.empty)for(let e of this.state.facet(ki))e(t)}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new ds(e),this.plugins=e.facet(Ii).map((e=>new Di(e))),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView=new hn(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Ii),i=e.state.facet(Ii);if(t!=i){let n=[];for(let s of i){let i=t.indexOf(s);if(i<0)n.push(new Di(s));else{let t=this.plugins[i];t.mustUpdate=e,n.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let t of this.plugins)t.mustUpdate=e;for(let e=0;e<this.plugins.length;e++)this.plugins[e].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let e=0;;e++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let s=[];4&n||([this.measureRequests,s]=[s,this.measureRequests]);let r=s.map((e=>{try{return e.read(this)}catch(e){return Li(this.state,e),Ps}})),o=zi.create(this,this.state,[]),a=!1,l=!1;o.flags|=n,t?t.flags|=n:t=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),a=this.docView.update(o));for(let e=0;e<s.length;e++)if(r[e]!=Ps)try{let t=s[e];t.write&&t.write(r[e],this)}catch(e){Li(this.state,e)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),a&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let e of this.state.facet(ki))e(t)}get themeClasses(){return xs+" "+(this.state.facet(Ss)?As:ks)+" "+this.state.facet(Cs)}updateAttrs(){let e=Bs(this,Ni,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ri)?"true":"false",class:"cm-content",style:`${jt.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Bs(this,Pi,t);let i=this.observer.ignore((()=>{let i=ai(this.contentDOM,this.contentAttrs,t),n=ai(this.dom,this.editorAttrs,e);return i||n}));return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let e of i.effects)if(e.is(Ds.announce)){t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value}}mountStyles(){this.styleModules=this.state.facet(Hi),Je.mount(this.root,this.styleModules.concat(Ms).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),e){if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find((t=>t.spec==e))||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return kn(this,e,xn(this,e,t,i))}moveByGroup(e,t){return kn(this,e,xn(this,e,t,(t=>function(e,t,i){let n=e.state.charCategorizer(t),s=n(i);return e=>{let t=n(e);return s==xe.Space&&(s=t),s==t}}(this,e.head,t))))}moveToLineBoundary(e,t,i=!0){return function(e,t,i,n){let s=e.state.doc.lineAt(t.head),r=n&&e.lineWrapping?e.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head):null;if(r){let t=e.dom.getBoundingClientRect(),n=e.textDirectionAt(s.from),o=e.posAtCoords({x:i==(n==Ui.LTR)?t.right-1:t.left+1,y:(r.top+r.bottom)/2});if(null!=o)return P.cursor(o,i?-1:1)}let o=mi.find(e.docView,t.head),a=o?i?o.posAtEnd:o.posAtStart:i?s.to:s.from;return P.cursor(a,i?-1:1)}(this,e,t,i)}moveVertically(e,t,i){return kn(this,e,function(e,t,i,n){let s=t.head,r=i?1:-1;if(s==(i?e.state.doc.length:0))return P.cursor(s,t.assoc);let o,a=t.goalColumn,l=e.contentDOM.getBoundingClientRect(),h=e.coordsAtPos(s),c=e.documentTop;if(h)null==a&&(a=h.left-l.left),o=r<0?h.top:h.bottom;else{let t=e.viewState.lineBlockAt(s);null==a&&(a=Math.min(l.right-l.left,e.defaultCharacterWidth*(s-t.from))),o=(r<0?t.top:t.bottom)+c}let u=l.left+a,d=null!=n?n:e.defaultLineHeight>>1;for(let i=0;;i+=10){let n=o+(d+i)*r,h=Cn(e,{x:u,y:n},!1,r);if(n<l.top||n>l.bottom||(r<0?h<s:h>s))return P.cursor(h,t.assoc,void 0,a)}}(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),Cn(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(e),s=this.bidiSpans(n);return bt(i,s[Zi.find(s,e-n.from,-1,t)].dir==Ui.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Ei)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Ns)return nn(e.length);let t=this.textDirectionAt(e.from);for(let i of this.bidiCache)if(i.from==e.from&&i.dir==t)return i.order;let i=tn(e.text,t);return this.bidiCache.push(new Fs(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||jt.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{kt(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Mi.of(new Ti("number"==typeof e?P.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Oi.define((()=>({})),{eventHandlers:e})}static theme(e,t){let i=Je.newName(),n=[Cs.of(i),Hi.of(Ts(`.${i}`,e))];return t&&t.dark&&n.push(Ss.of(!0)),n}static baseTheme(e){return Z.lowest(Hi.of(Ts("."+xs,e,Es)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),n=i&&Rt.get(i)||Rt.get(e);return(null===(t=null==n?void 0:n.rootView)||void 0===t?void 0:t.view)||null}}Ds.styleModule=Hi,Ds.inputHandler=Ai,Ds.perLineTextDirection=Ei,Ds.exceptionSink=xi,Ds.updateListener=ki,Ds.editable=Ri,Ds.mouseSelectionStyle=Si,Ds.dragMovesSelection=Ci,Ds.clickAddsSelectionRange=_i,Ds.decorations=Fi,Ds.atomicRanges=Bi,Ds.scrollMargins=Wi,Ds.darkTheme=Ss,Ds.contentAttributes=Pi,Ds.editorAttributes=Ni,Ds.lineWrapping=Ds.contentAttributes.of({class:"cm-lineWrapping"}),Ds.announce=me.define();const Ns=4096,Ps={};class Fs{constructor(e,t,i,n){this.from=e,this.to=t,this.dir=i,this.order=n}static update(e,t){if(t.empty)return e;let i=[],n=e.length?e[e.length-1].dir:Ui.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let r=e[s];r.dir!=n||t.touchesRange(r.from,r.to)||i.push(new Fs(t.mapPos(r.from,1),t.mapPos(r.to,-1),r.dir,r.order))}return i}}function Bs(e,t,i){for(let n=e.state.facet(t),s=n.length-1;s>=0;s--){let t=n[s],r="function"==typeof t?t(e):t;r&&ri(r,i)}return i}const Ws=jt.mac?"mac":jt.windows?"win":jt.linux?"linux":"key";function Hs(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const Vs=W.define({enables:Ds.domEventHandlers({keydown:(e,t)=>Ks(Us(t.state),e,t,"editor")})}),zs=new WeakMap;function Us(e){let t=e.facet(Vs),i=zs.get(t);return i||zs.set(t,i=function(e,t=Ws){let i=Object.create(null),n=Object.create(null),s=(e,t)=>{let i=n[e];if(null==i)n[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},r=(e,n,r,o)=>{let a=i[e]||(i[e]=Object.create(null)),l=n.split(/ (?!$)/).map((e=>function(e,t){const i=e.split(/-(?!$)/);let n,s,r,o,a=i[i.length-1];"Space"==a&&(a=" ");for(let e=0;e<i.length-1;++e){const a=i[e];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))r=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);"mac"==t?o=!0:s=!0}}return n&&(a="Alt-"+a),s&&(a="Ctrl-"+a),o&&(a="Meta-"+a),r&&(a="Shift-"+a),a}(e,t)));for(let t=1;t<l.length;t++){let i=l.slice(0,t).join(" ");s(i,!0),a[i]||(a[i]={preventDefault:!0,commands:[t=>{let n=qs={view:t,prefix:i,scope:e};return setTimeout((()=>{qs==n&&(qs=null)}),4e3),!0}]})}let h=l.join(" ");s(h,!1);let c=a[h]||(a[h]={preventDefault:!1,commands:[]});c.commands.push(r),o&&(c.preventDefault=!0)};for(let i of e){let e=i[t]||i.key;if(e)for(let t of i.scope?i.scope.split(" "):["editor"])r(t,e,i.run,i.preventDefault),i.shift&&r(t,"Shift-"+e,i.shift,i.preventDefault)}return i}(t.reduce(((e,t)=>e.concat(t)),[]))),i}let qs=null;function Ks(e,t,i,n){let s=ct(t),r=1==s.length&&" "!=s,o="",a=!1;qs&&qs.view==i&&qs.scope==n&&(o=qs.prefix+" ",(a=Tn.indexOf(t.keyCode)<0)&&(qs=null));let l,h=e=>{if(e){for(let t of e.commands)if(t(i))return!0;e.preventDefault&&(a=!0)}return!1},c=e[n];if(c){if(h(c[o+Hs(s,t,!r)]))return!0;if(r&&(t.shiftKey||t.altKey||t.metaKey)&&(l=et[t.keyCode])&&l!=s){if(h(c[o+Hs(l,t,!0)]))return!0}else if(r&&t.shiftKey&&h(c[o+Hs(s,t,!0)]))return!0}return a}const js=!jt.ios,Gs=W.define({combine:e=>Me(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function Ys(e={}){return[Gs.of(e),Js,Zs]}class Qs{constructor(e,t,i,n,s){this.left=e,this.top=t,this.width=i,this.height=n,this.className=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const Js=Oi.fromClass(class{constructor(e){this.view=e,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=e.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),e.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(Gs).cursorBlinkRate+"ms"}update(e){let t=e.startState.facet(Gs)!=e.state.facet(Gs);(t||e.selectionSet||e.geometryChanged||e.viewportChanged)&&this.view.requestMeasure(this.measureReq),e.transactions.some((e=>e.scrollIntoView))&&(this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink"),t&&this.setBlinkRate()}readPos(){let{state:e}=this.view,t=e.facet(Gs),i=e.selection.ranges.map((e=>e.empty?[]:function(e,t){if(t.to<=e.viewport.from||t.from>=e.viewport.to)return[];let i=Math.max(t.from,e.viewport.from),n=Math.min(t.to,e.viewport.to),s=e.textDirection==Ui.LTR,r=e.contentDOM,o=r.getBoundingClientRect(),a=er(e),l=window.getComputedStyle(r.firstChild),h=o.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent)),c=o.right-parseInt(l.paddingRight),u=ir(e,i),d=ir(e,n),f=u.type==hi.Text?u:null,p=d.type==hi.Text?d:null;e.lineWrapping&&(f&&(f=tr(e,i,f)),p&&(p=tr(e,n,p)));if(f&&p&&f.from==p.from)return m(v(t.from,t.to,f));{let i=f?v(t.from,null,f):w(u,!1),n=p?v(null,t.to,p):w(d,!0),s=[];return(f||u).to<(p||d).from-1?s.push(g(h,i.bottom,c,n.top)):i.bottom<n.top&&e.elementAtHeight((i.bottom+n.top)/2).type==hi.Text&&(i.bottom=n.top=(i.bottom+n.top)/2),m(i).concat(s).concat(m(n))}function g(e,t,i,n){return new Qs(e-a.left,t-a.top-.01,i-e,n-t+.01,"cm-selectionBackground")}function m({top:e,bottom:t,horizontal:i}){let n=[];for(let s=0;s<i.length;s+=2)n.push(g(i[s],e,i[s+1],t));return n}function v(t,i,n){let r=1e9,o=-1e9,a=[];function l(t,i,l,u,d){let f=e.coordsAtPos(t,t==n.to?-2:2),p=e.coordsAtPos(l,l==n.from?2:-2);r=Math.min(f.top,p.top,r),o=Math.max(f.bottom,p.bottom,o),d==Ui.LTR?a.push(s&&i?h:f.left,s&&u?c:p.right):a.push(!s&&u?h:p.left,!s&&i?c:f.right)}let u=null!=t?t:n.from,d=null!=i?i:n.to;for(let n of e.visibleRanges)if(n.to>u&&n.from<d)for(let s=Math.max(n.from,u),r=Math.min(n.to,d);;){let n=e.state.doc.lineAt(s);for(let o of e.bidiSpans(n)){let e=o.from+n.from,a=o.to+n.from;if(e>=r)break;a>s&&l(Math.max(e,s),null==t&&e<=u,Math.min(a,r),null==i&&a>=d,o.dir)}if(s=n.to+1,s>=r)break}return 0==a.length&&l(u,null==t,d,null==i,e.textDirection),{top:r,bottom:o,horizontal:a}}function w(e,t){let i=o.top+(t?e.top:e.bottom);return{top:i,bottom:i,horizontal:[]}}}(this.view,e))).reduce(((e,t)=>e.concat(t))),n=[];for(let i of e.selection.ranges){let s=i==e.selection.main;if(i.empty?!s||js:t.drawRangeCursor){let e=nr(this.view,i,s);e&&n.push(e)}}return{rangePieces:i,cursors:n}}drawSel({rangePieces:e,cursors:t}){if(e.length!=this.rangePieces.length||e.some(((e,t)=>!e.eq(this.rangePieces[t])))){this.selectionLayer.textContent="";for(let t of e)this.selectionLayer.appendChild(t.draw());this.rangePieces=e}if(t.length!=this.cursors.length||t.some(((e,t)=>!e.eq(this.cursors[t])))){let e=this.cursorLayer.children;if(e.length!==t.length){this.cursorLayer.textContent="";for(const e of t)this.cursorLayer.appendChild(e.draw())}else t.forEach(((t,i)=>t.adjust(e[i])));this.cursors=t}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),Xs={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};js&&(Xs[".cm-line"].caretColor="transparent !important");const Zs=Z.highest(Ds.theme(Xs));function er(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==Ui.LTR?t.left:t.right-e.scrollDOM.clientWidth)-e.scrollDOM.scrollLeft,top:t.top-e.scrollDOM.scrollTop}}function tr(e,t,i){let n=P.cursor(t);return{from:Math.max(i.from,e.moveToLineBoundary(n,!1,!0).from),to:Math.min(i.to,e.moveToLineBoundary(n,!0,!0).from),type:hi.Text}}function ir(e,t){let i=e.lineBlockAt(t);if(Array.isArray(i.type))for(let e of i.type)if(e.to>t||e.to==t&&(e.to==i.to||e.type==hi.Text))return e;return i}function nr(e,t,i){let n=e.coordsAtPos(t.head,t.assoc||1);if(!n)return null;let s=er(e);return new Qs(n.left-s.left,n.top-s.top,-1,n.bottom-n.top,i?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const sr=me.define({map:(e,t)=>null==e?null:t.mapPos(e)}),rr=j.define({create:()=>null,update:(e,t)=>(null!=e&&(e=t.changes.mapPos(e)),t.effects.reduce(((e,t)=>t.is(sr)?t.value:e),e))}),or=Oi.fromClass(class{constructor(e){this.view=e,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(e){var t;let i=e.state.field(rr);null==i?null!=this.cursor&&(null===(t=this.cursor)||void 0===t||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(e.startState.field(rr)!=i||e.docChanged||e.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let e=this.view.state.field(rr),t=null!=e&&this.view.coordsAtPos(e);if(!t)return null;let i=this.view.scrollDOM.getBoundingClientRect();return{left:t.left-i.left+this.view.scrollDOM.scrollLeft,top:t.top-i.top+this.view.scrollDOM.scrollTop,height:t.bottom-t.top}}drawCursor(e){this.cursor&&(e?(this.cursor.style.left=e.left+"px",this.cursor.style.top=e.top+"px",this.cursor.style.height=e.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(e){this.view.state.field(rr)!=e&&this.view.dispatch({effects:sr.of(e)})}},{eventHandlers:{dragover(e){this.setDropPos(this.view.posAtCoords({x:e.clientX,y:e.clientY}))},dragleave(e){e.target!=this.view.contentDOM&&this.view.contentDOM.contains(e.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function ar(e,t,i,n,s){t.lastIndex=0;for(let r,o=e.iterRange(i,n),a=i;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;r=t.exec(o.value);)s(a+r.index,a+r.index+r[0].length,r)}class lr{constructor(e){let{regexp:t,decoration:i,boundary:n,maxLength:s=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco="function"==typeof i?i:()=>i,this.boundary=n,this.maxLength=s}createDeco(e){let t=new De;for(let{from:i,to:n}of function(e,t){let i=e.visibleRanges;if(1==i.length&&i[0].from==e.viewport.from&&i[0].to==e.viewport.to)return i;let n=[];for(let{from:s,to:r}of i)s=Math.max(e.state.doc.lineAt(s).from,s-t),r=Math.min(e.state.doc.lineAt(r).to,r+t),n.length&&n[n.length-1].to>=s?n[n.length-1].to=r:n.push({from:s,to:r});return n}(e,this.maxLength))ar(e.state.doc,this.regexp,i,n,((i,n,s)=>t.add(i,n,this.getDeco(s,e,i))));return t.finish()}updateDeco(e,t){let i=1e9,n=-1;return e.docChanged&&e.changes.iterChanges(((t,s,r,o)=>{o>e.view.viewport.from&&r<e.view.viewport.to&&(i=Math.min(r,i),n=Math.max(o,n))})),e.viewportChanged||n-i>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),i,n):t}updateRange(e,t,i,n){for(let s of e.visibleRanges){let r=Math.max(s.from,i),o=Math.min(s.to,n);if(o>r){let i=e.state.doc.lineAt(r),n=i.to<o?e.state.doc.lineAt(o):i,a=Math.max(s.from,i.from),l=Math.min(s.to,n.to);if(this.boundary){for(;r>i.from;r--)if(this.boundary.test(i.text[r-1-i.from])){a=r;break}for(;o<n.to;o++)if(this.boundary.test(n.text[o-n.from])){l=o;break}}let h,c=[];if(i==n)for(this.regexp.lastIndex=a-i.from;(h=this.regexp.exec(i.text))&&h.index<l-i.from;){let t=h.index+i.from;c.push(this.getDeco(h,e,t).range(t,t+h[0].length))}else ar(e.state.doc,this.regexp,a,l,((t,i,n)=>c.push(this.getDeco(n,e,t).range(t,i))));t=t.update({filterFrom:a,filterTo:l,filter:(e,t)=>e<a||t>l,add:c})}}return t}}const hr=null!=/x/.unicode?"gu":"g",cr=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮\ufeff￹-￼]",hr),ur={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let dr=null;const fr=W.define({combine(e){let t=Me(e,{render:null,specialChars:cr,addSpecialChars:null});return(t.replaceTabs=!function(){var e;if(null==dr&&"undefined"!=typeof document&&document.body){let t=document.body.style;dr=null!=(null!==(e=t.tabSize)&&void 0!==e?e:t.MozTabSize)}return dr||!1}())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,hr)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,hr)),t}});function pr(e={}){return[fr.of(e),gr||(gr=Oi.fromClass(class{constructor(e){this.view=e,this.decorations=ci.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(e.state.facet(fr)),this.decorations=this.decorator.createDeco(e)}makeDecorator(e){return new lr({regexp:e.specialChars,decoration:(t,i,n)=>{let{doc:s}=i.state,r=S(t[0],0);if(9==r){let e=s.lineAt(n),t=i.state.tabSize,r=Ke(e.text,t,n-e.from);return ci.replace({widget:new vr((t-r%t)*this.view.defaultCharacterWidth)})}return this.decorationCache[r]||(this.decorationCache[r]=ci.replace({widget:new mr(e,r)}))},boundary:e.replaceTabs?void 0:/[^]/})}update(e){let t=e.state.facet(fr);e.startState.facet(fr)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(e.view)):this.decorations=this.decorator.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations}))]}let gr=null;class mr extends li{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=(i=this.code)>=32?"•":10==i?"␤":String.fromCharCode(9216+i);var i;let n=e.state.phrase("Control character")+" "+(ur[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,n,t);if(s)return s;let r=document.createElement("span");return r.textContent=t,r.title=n,r.setAttribute("aria-label",n),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class vr extends li{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="\t",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}const wr=ci.line({class:"cm-activeLine"}),yr=Oi.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,i=[];for(let n of e.state.selection.ranges){if(!n.empty)return ci.none;let s=e.lineBlockAt(n.head);s.from>t&&(i.push(wr.range(s.from)),t=s.from)}return ci.set(i)}},{decorations:e=>e.decorations});function br(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1),n=e.state.doc.lineAt(i),s=i-n.from,r=s>2e3?-1:s==n.length?function(e,t){let i=e.coordsAtPos(e.viewport.from);return i?Math.round(Math.abs((i.left-t)/e.defaultCharacterWidth)):-1}(e,t.clientX):Ke(n.text,e.state.tabSize,i-n.from);return{line:n.number,col:r,off:s}}function _r(e,t){let i=br(e,t),n=e.state.selection;return i?{update(e){if(e.docChanged){let t=e.changes.mapPos(e.startState.doc.line(i.line).from),s=e.state.doc.lineAt(t);i={line:s.number,col:i.col,off:Math.min(i.off,s.length)},n=n.map(e.changes)}},get(t,s,r){let o=br(e,t);if(!o)return n;let a=function(e,t,i){let n=Math.min(t.line,i.line),s=Math.max(t.line,i.line),r=[];if(t.off>2e3||i.off>2e3||t.col<0||i.col<0){let o=Math.min(t.off,i.off),a=Math.max(t.off,i.off);for(let t=n;t<=s;t++){let i=e.doc.line(t);i.length<=a&&r.push(P.range(i.from+o,i.to+a))}}else{let o=Math.min(t.col,i.col),a=Math.max(t.col,i.col);for(let t=n;t<=s;t++){let i=e.doc.line(t),n=je(i.text,o,e.tabSize,!0);if(n>-1){let t=je(i.text,a,e.tabSize);r.push(P.range(i.from+n,i.from+t))}}}return r}(e.state,i,o);return a.length?r?P.create(a.concat(n.ranges)):P.create(a):n}}:null}const Cr={Alt:[18,e=>e.altKey],Control:[17,e=>e.ctrlKey],Shift:[16,e=>e.shiftKey],Meta:[91,e=>e.metaKey]},Sr={style:"cursor: crosshair"};class xr{constructor(e,t,i){this.facet=t,this.createTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter((e=>e)),this.tooltipViews=this.tooltips.map(i)}update(e){let t=e.state.facet(this.facet),i=t.filter((e=>e));if(t===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let n=[];for(let t=0;t<i.length;t++){let s=i[t],r=-1;if(s){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==s.create&&(r=e)}if(r<0)n[t]=this.createTooltipView(s);else{let i=n[t]=this.tooltipViews[r];i.update&&i.update(e)}}}for(let e of this.tooltipViews)n.indexOf(e)<0&&e.dom.remove();return this.input=t,this.tooltips=i,this.tooltipViews=n,!0}}function kr(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const Ar=W.define({combine:e=>{var t,i,n;return{position:jt.ios?"absolute":(null===(t=e.find((e=>e.position)))||void 0===t?void 0:t.position)||"fixed",parent:(null===(i=e.find((e=>e.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(n=e.find((e=>e.tooltipSpace)))||void 0===n?void 0:n.tooltipSpace)||kr}}}),Er=Oi.fromClass(class{constructor(e){var t;this.view=e,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let i=e.state.facet(Ar);this.position=i.position,this.parent=i.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new xr(e,Mr,(e=>this.createTooltip(e))),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),null===(t=e.dom.ownerDocument.defaultView)||void 0===t||t.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e);t&&this.observeIntersection();let i=t||e.geometryChanged,n=e.state.facet(Ar);if(n.position!=this.position){this.position=n.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;i=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(e){let t=e.create(this.view);if(t.dom.classList.add("cm-tooltip"),e.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",t.dom.appendChild(e)}return t.dom.style.position=this.position,t.dom.style.top="-10000px",this.container.appendChild(t.dom),t.mount&&t.mount(this.view),t}destroy(){var e,t;null===(e=this.view.dom.ownerDocument.defaultView)||void 0===e||e.removeEventListener("resize",this.measureSoon);for(let{dom:e}of this.manager.tooltipViews)e.remove();null===(t=this.intersectionObserver)||void 0===t||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=this.view.dom.getBoundingClientRect();return{editor:e,parent:this.parent?this.container.getBoundingClientRect():e,pos:this.manager.tooltips.map(((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)})),size:this.manager.tooltipViews.map((({dom:e})=>e.getBoundingClientRect())),space:this.view.state.facet(Ar).tooltipSpace(this.view)}}writeMeasure(e){let{editor:t,space:i}=e,n=[];for(let s=0;s<this.manager.tooltips.length;s++){let r=this.manager.tooltips[s],o=this.manager.tooltipViews[s],{dom:a}=o,l=e.pos[s],h=e.size[s];if(!l||l.bottom<=Math.max(t.top,i.top)||l.top>=Math.min(t.bottom,i.bottom)||l.right<Math.max(t.left,i.left)-.1||l.left>Math.min(t.right,i.right)+.1){a.style.top="-10000px";continue}let c=r.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,u=c?7:0,d=h.right-h.left,f=h.bottom-h.top,p=o.offset||Tr,g=this.view.textDirection==Ui.LTR,m=h.width>i.right-i.left?g?i.left:i.right-h.width:g?Math.min(l.left-(c?14:0)+p.x,i.right-d):Math.max(i.left,l.left-d+(c?14:0)-p.x),v=!!r.above;!r.strictSide&&(v?l.top-(h.bottom-h.top)-p.y<i.top:l.bottom+(h.bottom-h.top)+p.y>i.bottom)&&v==i.bottom-l.bottom>l.top-i.top&&(v=!v);let w=v?l.top-f-u-p.y:l.bottom+u+p.y,y=m+d;if(!0!==o.overlap)for(let e of n)e.left<y&&e.right>m&&e.top<w+f&&e.bottom>w&&(w=v?e.top-f-2-u:e.bottom+u+2);"absolute"==this.position?(a.style.top=w-e.parent.top+"px",a.style.left=m-e.parent.left+"px"):(a.style.top=w+"px",a.style.left=m+"px"),c&&(c.style.left=l.left+(g?p.x:-p.x)-(m+14-7)+"px"),!0!==o.overlap&&n.push({left:m,top:w,right:y,bottom:w+f}),a.classList.toggle("cm-tooltip-above",v),a.classList.toggle("cm-tooltip-below",!v),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top="-10000px"}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),Tr={x:0,y:0},Mr=W.define({enables:[Er,Ds.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}})]}),Lr=W.define();class Rr{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new xr(e,Lr,(e=>this.createHostedView(e)))}static create(e){return new Rr(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}}const $r=Mr.compute([Lr],(e=>{let t=e.facet(Lr).filter((e=>e));return 0===t.length?null:{pos:Math.min(...t.map((e=>e.pos))),end:Math.max(...t.filter((e=>null!=e.end)).map((e=>e.end))),create:Rr.create,above:t[0].above,arrow:t.some((e=>e.arrow))}}));class Ir{constructor(e,t,i,n,s){this.view=e,this.source=t,this.field=i,this.setHover=n,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,t=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(null==t)return;let i=this.view.coordsAtPos(t);if(null==i||e.y<i.top||e.y>i.bottom||e.x<i.left-this.view.defaultCharacterWidth||e.x>i.right+this.view.defaultCharacterWidth)return;let n=this.view.bidiSpans(this.view.state.doc.lineAt(t)).find((e=>e.from<=t&&e.to>=t)),s=n&&n.dir==Ui.RTL?-1:1,r=this.source(this.view,t,e.x<i.left?-s:s);if(null==r?void 0:r.then){let e=this.pending={pos:t};r.then((t=>{this.pending==e&&(this.pending=null,t&&this.view.dispatch({effects:this.setHover.of(t)}))}),(e=>Li(this.view.state,e,"hover tooltip")))}else r&&this.view.dispatch({effects:this.setHover.of(r)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!function(e){for(let t=e;t;t=t.parentNode)if(1==t.nodeType&&t.classList.contains("cm-tooltip"))return!0;return!1}(this.lastMove.target)||this.pending){let{pos:n}=i||this.pending,s=null!==(t=null==i?void 0:i.end)&&void 0!==t?t:n;(n==s?this.view.posAtCoords(this.lastMove)==n:function(e,t,i,n,s,r){let o=document.createRange(),a=e.domAtPos(t),l=e.domAtPos(i);o.setEnd(l.node,l.offset),o.setStart(a.node,a.offset);let h=o.getClientRects();o.detach();for(let e=0;e<h.length;e++){let t=h[e];if(Math.max(t.top-s,s-t.bottom,t.left-n,n-t.right)<=r)return!0}return!1}(this.view,n,s,e.clientX,e.clientY,6))||(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function Or(e,t={}){let i=me.define(),n=j.define({create:()=>null,update(e,n){if(e&&(t.hideOnChange&&(n.docChanged||n.selection)||t.hideOn&&t.hideOn(n,e)))return null;if(e&&n.docChanged){let t=n.changes.mapPos(e.pos,-1,E.TrackDel);if(null==t)return null;let i=Object.assign(Object.create(null),e);i.pos=t,null!=e.end&&(i.end=n.changes.mapPos(e.end)),e=i}for(let t of n.effects)t.is(i)&&(e=t.value),t.is(Nr)&&(e=null);return e},provide:e=>Lr.from(e)});return[n,Oi.define((s=>new Ir(s,e,n,i,t.hoverTime||300))),$r]}function Dr(e,t){let i=e.plugin(Er);if(!i)return null;let n=i.manager.tooltips.indexOf(t);return n<0?null:i.manager.tooltipViews[n]}const Nr=me.define();const Pr=W.define({combine(e){let t,i;for(let n of e)t=t||n.topContainer,i=i||n.bottomContainer;return{topContainer:t,bottomContainer:i}}});function Fr(e,t){let i=e.plugin(Br),n=i?i.specs.indexOf(t):-1;return n>-1?i.panels[n]:null}const Br=Oi.fromClass(class{constructor(e){this.input=e.state.facet(Vr),this.specs=this.input.filter((e=>e)),this.panels=this.specs.map((t=>t(e)));let t=e.state.facet(Pr);this.top=new Wr(e,!0,t.topContainer),this.bottom=new Wr(e,!1,t.bottomContainer),this.top.sync(this.panels.filter((e=>e.top))),this.bottom.sync(this.panels.filter((e=>!e.top)));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(e){let t=e.state.facet(Pr);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new Wr(e.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new Wr(e.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=e.state.facet(Vr);if(i!=this.input){let t=i.filter((e=>e)),n=[],s=[],r=[],o=[];for(let i of t){let t,a=this.specs.indexOf(i);a<0?(t=i(e.view),o.push(t)):(t=this.panels[a],t.update&&t.update(e)),n.push(t),(t.top?s:r).push(t)}this.specs=t,this.panels=n,this.top.sync(s),this.bottom.sync(r);for(let e of o)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(let t of this.panels)t.update&&t.update(e)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>Ds.scrollMargins.of((t=>{let i=t.plugin(e);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}}))});class Wr{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Hr(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Hr(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Hr(e){let t=e.nextSibling;return e.remove(),t}const Vr=W.define({enables:Br});class zr extends Le{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}zr.prototype.elementClass="",zr.prototype.toDOM=void 0,zr.prototype.mapMode=E.TrackBefore,zr.prototype.startSide=zr.prototype.endSide=-1,zr.prototype.point=!0;const Ur=W.define(),qr={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Oe.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Kr=W.define();function jr(e){return[Yr(),Kr.of(Object.assign(Object.assign({},qr),e))]}const Gr=W.define({combine:e=>e.some((e=>e))});function Yr(e){let t=[Qr];return e&&!1===e.fixed&&t.push(Gr.of(!0)),t}const Qr=Oi.fromClass(class{constructor(e){this.view=e,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=e.state.facet(Kr).map((t=>new eo(e,t)));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!e.state.facet(Gr),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}update(e){if(this.updateGutters(e)){let t=this.prevViewport,i=e.view.viewport,n=Math.min(t.to,i.to)-Math.max(t.from,i.from);this.syncGutters(n<.8*(i.to-i.from))}e.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(Gr)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&this.dom.remove();let i=Oe.iter(this.view.state.facet(Ur),this.view.viewport.from),n=[],s=this.gutters.map((e=>new Zr(e,this.view.viewport,-this.view.documentPadding.top)));for(let e of this.view.viewportLineBlocks){let t;if(Array.isArray(e.type)){for(let i of e.type)if(i.type==hi.Text){t=i;break}}else t=e.type==hi.Text?e:void 0;if(t){n.length&&(n=[]),Xr(i,n,e.from);for(let e of s)e.line(this.view,t,n)}}for(let e of s)e.finish();e&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(e){let t=e.startState.facet(Kr),i=e.state.facet(Kr),n=e.docChanged||e.heightChanged||e.viewportChanged||!Oe.eq(e.startState.facet(Ur),e.state.facet(Ur),e.view.viewport.from,e.view.viewport.to);if(t==i)for(let t of this.gutters)t.update(e)&&(n=!0);else{n=!0;let s=[];for(let n of i){let i=t.indexOf(n);i<0?s.push(new eo(this.view,n)):(this.gutters[i].update(e),s.push(this.gutters[i]))}for(let e of this.gutters)e.dom.remove(),s.indexOf(e)<0&&e.destroy();for(let e of s)this.dom.appendChild(e.dom);this.gutters=s}return n}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove()}},{provide:e=>Ds.scrollMargins.of((t=>{let i=t.plugin(e);return i&&0!=i.gutters.length&&i.fixed?t.textDirection==Ui.LTR?{left:i.dom.offsetWidth}:{right:i.dom.offsetWidth}:null}))});function Jr(e){return Array.isArray(e)?e:[e]}function Xr(e,t,i){for(;e.value&&e.from<=i;)e.from==i&&t.push(e.value),e.next()}class Zr{constructor(e,t,i){this.gutter=e,this.height=i,this.localMarkers=[],this.i=0,this.cursor=Oe.iter(e.markers,t.from)}line(e,t,i){this.localMarkers.length&&(this.localMarkers=[]),Xr(this.cursor,this.localMarkers,t.from);let n=i.length?this.localMarkers.concat(i):this.localMarkers,s=this.gutter.config.lineMarker(e,t,n);s&&n.unshift(s);let r=this.gutter;if(0==n.length&&!r.config.renderEmptyElements)return;let o=t.top-this.height;if(this.i==r.elements.length){let i=new to(e,t.height,o,n);r.elements.push(i),r.dom.appendChild(i.dom)}else r.elements[this.i].update(e,t.height,o,n);this.height=t.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class eo{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,(n=>{let s=e.lineBlockAtHeight(n.clientY-e.documentTop);t.domEventHandlers[i](e,s,n)&&n.preventDefault()}));this.markers=Jr(t.markers(e)),t.initialSpacer&&(this.spacer=new to(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Jr(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let i=e.view.viewport;return!Oe.eq(this.markers,t,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class to{constructor(e,t,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,n)}update(e,t,i,n){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].compare(t[i]))return!1;return!0}(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let i="cm-gutterElement",n=this.dom.firstChild;for(let s=0,r=0;;){let o=r,a=s<t.length?t[s++]:null,l=!1;if(a){let e=a.elementClass;e&&(i+=" "+e);for(let e=r;e<this.markers.length;e++)if(this.markers[e].compare(a)){o=e,l=!0;break}}else o=this.markers.length;for(;r<o;){let e=this.markers[r++];if(e.toDOM){e.destroy(n);let t=n.nextSibling;n.remove(),n=t}}if(!a)break;a.toDOM&&(l?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),l&&r++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}const io=W.define(),no=W.define({combine:e=>Me(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let e in t){let n=i[e],s=t[e];i[e]=n?(e,t,i)=>n(e,t,i)||s(e,t,i):s}return i}})});class so extends zr{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function ro(e,t){return e.state.facet(no).formatNumber(t,e.state)}const oo=Kr.compute([no],(e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(io),lineMarker:(e,t,i)=>i.some((e=>e.toDOM))?null:new so(ro(e,e.state.doc.lineAt(t.from).number)),lineMarkerChange:e=>e.startState.facet(no)!=e.state.facet(no),initialSpacer:e=>new so(ro(e,ao(e.state.doc.lines))),updateSpacer(e,t){let i=ro(t.view,ao(t.view.state.doc.lines));return i==e.number?e:new so(i)},domEventHandlers:e.facet(no).domEventHandlers})));function ao(e){let t=9;for(;t<e;)t=10*t+9;return t}const lo=new class extends zr{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},ho=Ur.compute(["selection"],(e=>{let t=[],i=-1;for(let n of e.selection.ranges)if(n.empty){let s=e.doc.lineAt(n.head).from;s>i&&(i=s,t.push(lo.range(s)))}return Oe.of(t)}));const co=1024;let uo=0;class fo{constructor(e,t){this.from=e,this.to=t}}class po{constructor(e={}){this.id=uo++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=mo.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}po.closedBy=new po({deserialize:e=>e.split(" ")}),po.openedBy=new po({deserialize:e=>e.split(" ")}),po.group=new po({deserialize:e=>e.split(" ")}),po.contextHash=new po({perNode:!0}),po.lookAhead=new po({perNode:!0}),po.mounted=new po({perNode:!0});const go=Object.create(null);class mo{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):go,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new mo(e.name||"",t,e.id,i);if(e.props)for(let i of e.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(po.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return e=>{for(let i=e.prop(po.group),n=-1;n<(i?i.length:0);n++){let s=t[n<0?e.name:i[n]];if(s)return s}}}}mo.none=new mo("",Object.create(null),0,8);const vo=new WeakMap,wo=new WeakMap;var yo,bo;(bo=yo||(yo={}))[bo.ExcludeBuffers=1]="ExcludeBuffers",bo[bo.IncludeAnonymous=2]="IncludeAnonymous",bo[bo.IgnoreMounts=4]="IgnoreMounts",bo[bo.IgnoreOverlays=8]="IgnoreOverlays";class _o{constructor(e,t,i,n,s){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[e,t]of s)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=this.prop(po.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let i=e.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new $o(this.topNode,e)}cursorAt(e,t=0,i=0){let n=vo.get(this)||this.topNode,s=new $o(n);return s.moveTo(e,t),vo.set(this,s._tree),s}get topNode(){return new Eo(this,0,0,null)}resolve(e,t=0){let i=Ao(vo.get(this)||this.topNode,e,t,!1);return vo.set(this,i),i}resolveInner(e,t=0){let i=Ao(wo.get(this)||this.topNode,e,t,!0);return wo.set(this,i),i}iterate(e){let{enter:t,leave:i,from:n=0,to:s=this.length}=e;for(let r=this.cursor((e.mode||0)|yo.IncludeAnonymous);;){let e=!1;if(r.from<=s&&r.to>=n&&(r.type.isAnonymous||!1!==t(r))){if(r.firstChild())continue;e=!0}for(;e&&i&&!r.type.isAnonymous&&i(r),!r.nextSibling();){if(!r.parent())return;e=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:No(mo.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,i)=>new _o(this.type,e,t,i,this.propValues)),e.makeTree||((e,t,i)=>new _o(mo.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:n,maxBufferLength:s=co,reused:r=[],minRepeatType:o=n.types.length}=e,a=Array.isArray(i)?new Co(i,i.length):i,l=n.types,h=0,c=0;function u(e,t,i,v,w){let{id:y,start:b,end:_,size:C}=a,S=c;for(;C<0;){if(a.next(),-1==C){let t=r[y];return i.push(t),void v.push(b-e)}if(-3==C)return void(h=y);if(-4==C)return void(c=y);throw new RangeError(`Unrecognized record size: ${C}`)}let x,k,A=l[y],E=b-e;if(_-b<=s&&(k=g(a.pos-t,w))){let t=new Uint16Array(k.size-k.skip),i=a.pos-k.size,s=t.length;for(;a.pos>i;)s=m(k.start,t,s);x=new So(t,_-k.start,n),E=k.start-e}else{let e=a.pos-C;a.next();let t=[],i=[],n=y>=o?y:-1,r=0,l=_;for(;a.pos>e;)n>=0&&a.id==n&&a.size>=0?(a.end<=l-s&&(f(t,i,b,r,a.end,l,n,S),r=t.length,l=a.end),a.next()):u(b,e,t,i,n);if(n>=0&&r>0&&r<t.length&&f(t,i,b,r,b,l,n,S),t.reverse(),i.reverse(),n>-1&&r>0){let e=d(A);x=No(A,t,i,0,t.length,0,_-b,e,e)}else x=p(A,t,i,_-b,S-_)}i.push(x),v.push(E)}function d(e){return(t,i,n)=>{let s,r,o=0,a=t.length-1;if(a>=0&&(s=t[a])instanceof _o){if(!a&&s.type==e&&s.length==n)return s;(r=s.prop(po.lookAhead))&&(o=i[a]+s.length+r)}return p(e,t,i,n,o)}}function f(e,t,i,s,r,o,a,l){let h=[],c=[];for(;e.length>s;)h.push(e.pop()),c.push(t.pop()+i-r);e.push(p(n.types[a],h,c,o-r,l-o)),t.push(r-i)}function p(e,t,i,n,s=0,r){if(h){let e=[po.contextHash,h];r=r?[e].concat(r):[e]}if(s>25){let e=[po.lookAhead,s];r=r?[e].concat(r):[e]}return new _o(e,t,i,n,r)}function g(e,t){let i=a.fork(),n=0,r=0,l=0,h=i.end-s,c={size:0,start:0,skip:0};e:for(let s=i.pos-e;i.pos>s;){let e=i.size;if(i.id==t&&e>=0){c.size=n,c.start=r,c.skip=l,l+=4,n+=4,i.next();continue}let a=i.pos-e;if(e<0||a<s||i.start<h)break;let u=i.id>=o?4:0,d=i.start;for(i.next();i.pos>a;){if(i.size<0){if(-3!=i.size)break e;u+=4}else i.id>=o&&(u+=4);i.next()}r=d,n+=e,l+=u}return(t<0||n==e)&&(c.size=n,c.start=r,c.skip=l),c.size>4?c:void 0}function m(e,t,i){let{id:n,start:s,end:r,size:l}=a;if(a.next(),l>=0&&n<o){let o=i;if(l>4){let n=a.pos-(l-4);for(;a.pos>n;)i=m(e,t,i)}t[--i]=o,t[--i]=r-e,t[--i]=s-e,t[--i]=n}else-3==l?h=n:-4==l&&(c=n);return i}let v=[],w=[];for(;a.pos>0;)u(e.start||0,e.bufferStart||0,v,w,-1);let y=null!==(t=e.length)&&void 0!==t?t:v.length?w[0]+v[0].length:0;return new _o(l[e.topID],v.reverse(),w.reverse(),y)}(e)}}_o.empty=new _o(mo.none,[],[],0);class Co{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Co(this.buffer,this.index)}}class So{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return mo.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),i==(e+=4))return s;let r=[];for(;e<i;)r.push(this.childString(e)),e=this.buffer[e+3];return s+"("+r.join(",")+")"}findChild(e,t,i,n,s){let{buffer:r}=this,o=-1;for(let a=e;a!=t&&!(xo(s,n,r[a+1],r[a+2])&&(o=a,i>0));a=r[a+3]);return o}slice(e,t,i,n){let s=this.buffer,r=new Uint16Array(t-e);for(let n=e,o=0;n<t;)r[o++]=s[n++],r[o++]=s[n++]-i,r[o++]=s[n++]-i,r[o++]=s[n++]-e;return new So(r,n-i,this.set)}}function xo(e,t,i,n){switch(e){case-2:return i<t;case-1:return n>=t&&i<t;case 0:return i<t&&n>t;case 1:return i<=t&&n>t;case 2:return n>t;case 4:return!0}}function ko(e,t){let i=e.childBefore(t);for(;i;){let t=i.lastChild;if(!t||t.to!=i.to)break;t.type.isError&&t.from==t.to?(e=i,i=t.prevSibling):i=t}return e}function Ao(e,t,i,n){for(var s;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof Eo&&e.index<0?null:e.parent;if(!t)return e;e=t}let r=n?0:yo.IgnoreOverlays;if(n)for(let n=e,o=n.parent;o;n=o,o=n.parent)n instanceof Eo&&n.index<0&&(null===(s=o.enter(t,i,r))||void 0===s?void 0:s.from)!=n.from&&(e=o);for(;;){let n=e.enter(t,i,r);if(!n)return e;e=n}}class Eo{constructor(e,t,i,n){this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,s=0){for(let r=this;;){for(let{children:o,positions:a}=r._tree,l=t>0?o.length:-1;e!=l;e+=t){let l=o[e],h=a[e]+r.from;if(xo(n,i,h,h+l.length))if(l instanceof So){if(s&yo.ExcludeBuffers)continue;let o=l.findChild(0,l.buffer.length,t,i-h,n);if(o>-1)return new Ro(new Lo(r,l,e,h),null,o)}else if(s&yo.IncludeAnonymous||!l.type.isAnonymous||Io(l)){let o;if(!(s&yo.IgnoreMounts)&&l.props&&(o=l.prop(po.mounted))&&!o.overlay)return new Eo(o.tree,h,e,r);let a=new Eo(l,h,e,r);return s&yo.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(t<0?l.children.length-1:0,t,i,n)}}if(s&yo.IncludeAnonymous||!r.type.isAnonymous)return null;if(e=r.index>=0?r.index+t:t<0?-1:r._parent._tree.children.length,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let n;if(!(i&yo.IgnoreOverlays)&&(n=this._tree.prop(po.mounted))&&n.overlay){let i=e-this.from;for(let{from:e,to:s}of n.overlay)if((t>0?e<=i:e<i)&&(t<0?s>=i:s>i))return new Eo(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new $o(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return Ao(this,e,t,!1)}resolveInner(e,t=0){return Ao(this,e,t,!0)}enterUnfinishedNodesBefore(e){return ko(this,e)}getChild(e,t=null,i=null){let n=To(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return To(this,e,t,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return Mo(this,e)}}function To(e,t,i,n){let s=e.cursor(),r=[];if(!s.firstChild())return r;if(null!=i)for(;!s.type.is(i);)if(!s.nextSibling())return r;for(;;){if(null!=n&&s.type.is(n))return r;if(s.type.is(t)&&r.push(s.node),!s.nextSibling())return null==n?r:[]}}function Mo(e,t,i=t.length-1){for(let n=e.parent;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[i]&&t[i]!=n.name)return!1;i--}}return!0}class Lo{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class Ro{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new Ro(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&yo.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new Ro(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Ro(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Ro(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new $o(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,s=i.buffer[this.index+3];if(s>n){let r=i.buffer[this.index+1],o=i.buffer[this.index+2];e.push(i.slice(n,s,r,o)),t.push(0)}return new _o(this.type,e,t,this.to-this.from)}resolve(e,t=0){return Ao(this,e,t,!1)}resolveInner(e,t=0){return Ao(this,e,t,!0)}enterUnfinishedNodesBefore(e){return ko(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let n=To(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return To(this,e,t,i)}get node(){return this}matchContext(e){return Mo(this,e)}}class $o{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Eo)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof Eo?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&yo.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&yo.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&yo.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let n=t+e,s=e<0?-1:i._tree.children.length;n!=s;n+=e){let e=i._tree.children[n];if(this.mode&yo.IncludeAnonymous||e instanceof So||!e.type.isAnonymous||Io(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let r=e;r;r=r._parent)if(r.index==n){if(n==this.index)return r;t=r,i=s+1;break e}n=this.stack[--s]}for(let e=i;e<this.stack.length;e++)t=new Ro(this.buffer,t,this.stack[e]);return this.bufferNode=new Ro(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return Mo(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return Mo(this.node,e,n);let r=i[t.buffer[this.stack[s]]];if(!r.isAnonymous){if(e[n]&&e[n]!=r.name)return!1;n--}}return!0}}function Io(e){return e.children.some((e=>e instanceof So||!e.type.isAnonymous||Io(e)))}const Oo=new WeakMap;function Do(e,t){if(!e.isAnonymous||t instanceof So||t.type!=e)return 1;let i=Oo.get(t);if(null==i){i=1;for(let n of t.children){if(n.type!=e||!(n instanceof _o)){i=1;break}i+=Do(e,n)}Oo.set(t,i)}return i}function No(e,t,i,n,s,r,o,a,l){let h=0;for(let i=n;i<s;i++)h+=Do(e,t[i]);let c=Math.ceil(1.5*h/8),u=[],d=[];return function t(i,n,s,o,a){for(let h=s;h<o;){let s=h,f=n[h],p=Do(e,i[h]);for(h++;h<o;h++){let t=Do(e,i[h]);if(p+t>=c)break;p+=t}if(h==s+1){if(p>c){let e=i[s];t(e.children,e.positions,0,e.children.length,n[s]+a);continue}u.push(i[s])}else{let t=n[h-1]+i[h-1].length-f;u.push(No(e,i,n,s,h,f,t,null,l))}d.push(f+a-r)}}(t,i,n,s,0),(a||l)(u,d,o)}class Po{constructor(e,t,i,n,s=!1,r=!1){this.from=e,this.to=t,this.tree=i,this.offset=n,this.open=(s?1:0)|(r?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],i=!1){let n=[new Po(0,e.length,e,0,!1,i)];for(let i of t)i.to>e.length&&n.push(i);return n}static applyChanges(e,t,i=128){if(!t.length)return e;let n=[],s=1,r=e.length?e[0]:null;for(let o=0,a=0,l=0;;o++){let h=o<t.length?t[o]:null,c=h?h.fromA:1e9;if(c-a>=i)for(;r&&r.from<c;){let t=r;if(a>=t.from||c<=t.to||l){let e=Math.max(t.from,a)-l,i=Math.min(t.to,c)-l;t=e>=i?null:new Po(e,i,t.tree,t.offset+l,o>0,!!h)}if(t&&n.push(t),r.to>c)break;r=s<e.length?e[s++]:null}if(!h)break;a=h.toA,l=h.toA-h.toB}return n}}class Fo{startParse(e,t,i){return"string"==typeof e&&(e=new Bo(e)),i=i?i.length?i.map((e=>new fo(e.from,e.to))):[new fo(0,0)]:[new fo(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let n=this.startParse(e,t,i);for(;;){let e=n.advance();if(e)return e}}}class Bo{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new po({perNode:!0});let Wo=0;class Ho{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=Wo++}static define(e){if(null==e?void 0:e.base)throw new Error("Can not derive from a modified tag");let t=new Ho([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new zo;return t=>t.modified.indexOf(e)>-1?t:zo.get(t.base||t,t.modified.concat(e).sort(((e,t)=>e.id-t.id)))}}let Vo=0;class zo{constructor(){this.instances=[],this.id=Vo++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find((i=>{return i.base==e&&(n=t,s=i.modified,n.length==s.length&&n.every(((e,t)=>e==s[t])));var n,s}));if(i)return i;let n=[],s=new Ho(n,e,t);for(let e of t)e.instances.push(s);let r=Uo(t);for(let t of e.set)for(let e of r)n.push(zo.get(t,e));return s}}function Uo(e){let t=[e];for(let i=0;i<e.length;i++)for(let n of Uo(e.slice(0,i).concat(e.slice(i+1))))t.push(n);return t}function qo(e){let t=Object.create(null);for(let i in e){let n=e[i];Array.isArray(n)||(n=[n]);for(let e of i.split(" "))if(e){let i=[],s=2,r=e;for(let t=0;;){if("..."==r&&t>0&&t+3==e.length){s=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(r);if(!n)throw new RangeError("Invalid path: "+e);if(i.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),t+=n[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){s=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);r=e.slice(t)}let o=i.length-1,a=i[o];if(!a)throw new RangeError("Invalid path: "+e);let l=new jo(n,s,o>0?i.slice(0,o):null);t[a]=l.sort(t[a])}}return Ko.add(t)}const Ko=new po;class jo{constructor(e,t,i,n){this.tags=e,this.mode=t,this.context=i,this.next=n}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function Go(e,t){let i=Object.create(null);for(let t of e)if(Array.isArray(t.tag))for(let e of t.tag)i[e.id]=t.class;else i[t.tag.id]=t.class;let{scope:n,all:s=null}=t||{};return{style:e=>{let t=s;for(let n of e)for(let e of n.set){let n=i[e.id];if(n){t=t?t+" "+n:n;break}}return t},scope:n}}function Yo(e,t){let i=null;for(let n of e){let e=n.style(t);e&&(i=i?i+" "+e:e)}return i}function Qo(e,t,i,n=0,s=e.length){let r=new Jo(n,Array.isArray(t)?t:[t],i);r.highlightRange(e.cursor(),n,s,"",r.highlighters),r.flush(s)}class Jo{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,n,s){let{type:r,from:o,to:a}=e;if(o>=i||a<=t)return;r.isTop&&(s=this.highlighters.filter((e=>!e.scope||e.scope(r))));let l=n,h=r.prop(Ko),c=!1;for(;h;){if(!h.context||e.matchContext(h.context)){let e=Yo(s,h.tags);e&&(l&&(l+=" "),l+=e,1==h.mode?n+=(n?" ":"")+e:0==h.mode&&(c=!0));break}h=h.next}if(this.startSpan(e.from,l),c)return;let u=e.tree&&e.tree.prop(po.mounted);if(u&&u.overlay){let r=e.node.enter(u.overlay[0].from+o,1),h=this.highlighters.filter((e=>!e.scope||e.scope(u.tree.type))),c=e.firstChild();for(let d=0,f=o;;d++){let p=d<u.overlay.length?u.overlay[d]:null,g=p?p.from+o:a,m=Math.max(t,f),v=Math.min(i,g);if(m<v&&c)for(;e.from<v&&(this.highlightRange(e,m,v,n,s),this.startSpan(Math.min(i,e.to),l),!(e.to>=g)&&e.nextSibling()););if(!p||g>i)break;f=p.to+o,f>t&&(this.highlightRange(r.cursor(),Math.max(t,p.from+o),Math.min(i,f),n,h),this.startSpan(f,l))}c&&e.parent()}else if(e.firstChild()){do{if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,n,s),this.startSpan(Math.min(i,e.to),l)}}while(e.nextSibling());e.parent()}}}const Xo=Ho.define,Zo=Xo(),ea=Xo(),ta=Xo(ea),ia=Xo(ea),na=Xo(),sa=Xo(na),ra=Xo(na),oa=Xo(),aa=Xo(oa),la=Xo(),ha=Xo(),ca=Xo(),ua=Xo(ca),da=Xo(),fa={comment:Zo,lineComment:Xo(Zo),blockComment:Xo(Zo),docComment:Xo(Zo),name:ea,variableName:Xo(ea),typeName:ta,tagName:Xo(ta),propertyName:ia,attributeName:Xo(ia),className:Xo(ea),labelName:Xo(ea),namespace:Xo(ea),macroName:Xo(ea),literal:na,string:sa,docString:Xo(sa),character:Xo(sa),attributeValue:Xo(sa),number:ra,integer:Xo(ra),float:Xo(ra),bool:Xo(na),regexp:Xo(na),escape:Xo(na),color:Xo(na),url:Xo(na),keyword:la,self:Xo(la),null:Xo(la),atom:Xo(la),unit:Xo(la),modifier:Xo(la),operatorKeyword:Xo(la),controlKeyword:Xo(la),definitionKeyword:Xo(la),moduleKeyword:Xo(la),operator:ha,derefOperator:Xo(ha),arithmeticOperator:Xo(ha),logicOperator:Xo(ha),bitwiseOperator:Xo(ha),compareOperator:Xo(ha),updateOperator:Xo(ha),definitionOperator:Xo(ha),typeOperator:Xo(ha),controlOperator:Xo(ha),punctuation:ca,separator:Xo(ca),bracket:ua,angleBracket:Xo(ua),squareBracket:Xo(ua),paren:Xo(ua),brace:Xo(ua),content:oa,heading:aa,heading1:Xo(aa),heading2:Xo(aa),heading3:Xo(aa),heading4:Xo(aa),heading5:Xo(aa),heading6:Xo(aa),contentSeparator:Xo(oa),list:Xo(oa),quote:Xo(oa),emphasis:Xo(oa),strong:Xo(oa),link:Xo(oa),monospace:Xo(oa),strikethrough:Xo(oa),inserted:Xo(),deleted:Xo(),changed:Xo(),invalid:Xo(),meta:da,documentMeta:Xo(da),annotation:Xo(da),processingInstruction:Xo(da),definition:Ho.defineModifier(),constant:Ho.defineModifier(),function:Ho.defineModifier(),standard:Ho.defineModifier(),local:Ho.defineModifier(),special:Ho.defineModifier()};Go([{tag:fa.link,class:"tok-link"},{tag:fa.heading,class:"tok-heading"},{tag:fa.emphasis,class:"tok-emphasis"},{tag:fa.strong,class:"tok-strong"},{tag:fa.keyword,class:"tok-keyword"},{tag:fa.atom,class:"tok-atom"},{tag:fa.bool,class:"tok-bool"},{tag:fa.url,class:"tok-url"},{tag:fa.labelName,class:"tok-labelName"},{tag:fa.inserted,class:"tok-inserted"},{tag:fa.deleted,class:"tok-deleted"},{tag:fa.literal,class:"tok-literal"},{tag:fa.string,class:"tok-string"},{tag:fa.number,class:"tok-number"},{tag:[fa.regexp,fa.escape,fa.special(fa.string)],class:"tok-string2"},{tag:fa.variableName,class:"tok-variableName"},{tag:fa.local(fa.variableName),class:"tok-variableName tok-local"},{tag:fa.definition(fa.variableName),class:"tok-variableName tok-definition"},{tag:fa.special(fa.variableName),class:"tok-variableName2"},{tag:fa.definition(fa.propertyName),class:"tok-propertyName tok-definition"},{tag:fa.typeName,class:"tok-typeName"},{tag:fa.namespace,class:"tok-namespace"},{tag:fa.className,class:"tok-className"},{tag:fa.macroName,class:"tok-macroName"},{tag:fa.propertyName,class:"tok-propertyName"},{tag:fa.operator,class:"tok-operator"},{tag:fa.comment,class:"tok-comment"},{tag:fa.meta,class:"tok-meta"},{tag:fa.invalid,class:"tok-invalid"},{tag:fa.punctuation,class:"tok-punctuation"}]);var pa;const ga=new po;class ma{constructor(e,t,i=[]){this.data=e,Te.prototype.hasOwnProperty("tree")||Object.defineProperty(Te.prototype,"tree",{get(){return wa(this)}}),this.parser=t,this.extension=[Ea.of(this),Te.languageData.of(((e,t,i)=>e.facet(va(e,t,i))))].concat(i)}isActiveAt(e,t,i=-1){return va(e,t,i)==this.data}findRegions(e){let t=e.facet(Ea);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],n=(e,t)=>{if(e.prop(ga)==this.data)return void i.push({from:t,to:t+e.length});let s=e.prop(po.mounted);if(s){if(s.tree.prop(ga)==this.data){if(s.overlay)for(let e of s.overlay)i.push({from:e.from+t,to:e.to+t});else i.push({from:t,to:t+e.length});return}if(s.overlay){let e=i.length;if(n(s.tree,s.overlay[0].from+t),i.length>e)return}}for(let i=0;i<e.children.length;i++){let s=e.children[i];s instanceof _o&&n(s,e.positions[i]+t)}};return n(wa(e),0),i}get allowsNesting(){return!0}}function va(e,t,i){let n=e.facet(Ea);if(!n)return null;let s=n.data;if(n.allowsNesting)for(let n=wa(e).topNode;n;n=n.enter(t,i,yo.ExcludeBuffers))s=n.type.prop(ga)||s;return s}ma.setState=me.define();function wa(e){let t=e.field(ma.state,!1);return t?t.tree:_o.empty}class ya{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let ba=null;class _a{constructor(e,t,i=[],n,s,r,o,a){this.parser=e,this.state=t,this.fragments=i,this.tree=n,this.treeLen=s,this.viewport=r,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new _a(e,t,[],_o.empty,0,i,[],null)}startParse(){return this.parser.startParse(new ya(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=_o.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n){if(this.fragments=this.withoutTempSkipped(Po.addTree(n,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=n,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}}))}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext((()=>{for(;!(t=this.parse.advance()););})),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(Po.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=ba;ba=this;try{return e()}finally{ba=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Ca(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:n,treeLen:s,viewport:r,skipped:o}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges(((e,i,n,s)=>t.push({fromA:e,toA:i,fromB:n,toB:s}))),i=Po.applyChanges(i,t),n=_o.empty,s=0,r={from:e.mapPos(r.from,-1),to:e.mapPos(r.to,1)},this.skipped.length){o=[];for(let t of this.skipped){let i=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);i<n&&o.push({from:i,to:n})}}}return new _a(this.parser,t,i,n,s,r,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:i,to:n}=this.skipped[t];i<e.to&&n>e.from&&(this.fragments=Ca(this.fragments,i,n),this.skipped.splice(t--,1))}return!(this.skipped.length>=t)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Fo{createParse(t,i,n){let s=n[0].from,r=n[n.length-1].to;return{parsedPos:s,advance(){let t=ba;if(t){for(let e of n)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=r,new _o(mo.none,[],[],r-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return ba}}function Ca(e,t,i){return Po.applyChanges(e,[{fromA:t,toA:i,fromB:t,toB:i}])}class Sa{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Sa(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=_a.create(e.facet(Ea).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Sa(i)}}ma.state=j.define({create:Sa.init,update(e,t){for(let e of t.effects)if(e.is(ma.setState))return e.value;return t.startState.facet(Ea)!=t.state.facet(Ea)?Sa.init(t.state):e.apply(t)}});let xa=e=>{let t=setTimeout((()=>e()),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(xa=e=>{let t=-1,i=setTimeout((()=>{t=requestIdleCallback(e,{timeout:400})}),100);return()=>t<0?clearTimeout(i):cancelIdleCallback(t)});const ka="undefined"!=typeof navigator&&(null===(pa=navigator.scheduling)||void 0===pa?void 0:pa.isInputPending)?()=>navigator.scheduling.isInputPending():null,Aa=Oi.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(ma.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(ma.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=xa(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,s=i.field(ma.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let r=Date.now()+Math.min(this.chunkBudget,100,e&&!ka?Math.max(25,e.timeRemaining()-5):1e9),o=s.context.treeLen<n&&i.doc.length>n+1e3,a=s.context.work((()=>ka&&ka()||Date.now()>r),n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:ma.setState.of(new Sa(s.context))})),this.chunkBudget>0&&(!a||o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then((()=>this.scheduleWork())).catch((e=>Li(this.view.state,e))).then((()=>this.workScheduled--)),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ea=W.define({combine:e=>e.length?e[0]:null,enables:[ma.state,Aa]});const Ta=W.define(),Ma=W.define({combine:e=>{if(!e.length)return"  ";if(!/^(?: +|\t+)$/.test(e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return e[0]}});function La(e){let t=e.facet(Ma);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function Ra(e,t){let i="",n=e.tabSize;if(9==e.facet(Ma).charCodeAt(0))for(;t>=n;)i+="\t",t-=n;for(let e=0;e<t;e++)i+=" ";return i}function $a(e,t){e instanceof Te&&(e=new Ia(e));for(let i of e.state.facet(Ta)){let n=i(e,t);if(null!=n)return n}let i=wa(e.state);return i?function(e,t,i){return Na(t.resolveInner(i).enterUnfinishedNodesBefore(i),i,e)}(e,i,t):null}class Ia{constructor(e,t={}){this.state=e,this.options=t,this.unit=La(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return null!=n&&n>=i.from&&n<=i.to?s&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(e,t);return i.slice(e-n,Math.min(i.length,e+100-n))}column(e,t=1){let{text:i,from:n}=this.lineAt(e,t),s=this.countColumn(i,e-n),r=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return r>-1&&(s+=r-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return Ke(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:n}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let e=s(n);if(e>-1)return e}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Oa=new po;function Da(e){let t=e.type.prop(Oa);if(t)return t;let i,n=e.firstChild;if(n&&(i=n.type.prop(po.closedBy))){let t=e.lastChild,n=t&&i.indexOf(t.name)>-1;return e=>Wa(e,!0,1,void 0,n&&!function(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?Pa:null}function Na(e,t,i){for(;e;e=e.parent){let n=Da(e);if(n)return n(Fa.create(i,t,e))}return null}function Pa(){return 0}class Fa extends Ia{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.node=i}static create(e,t,i){return new Fa(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(Ba(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?Na(e,this.pos,this.base):0}}function Ba(e,t){for(let i=t;i;i=i.parent)if(e==i)return!0;return!1}function Wa(e,t,i,n,s){let r=e.textAfter,o=r.match(/^\s*/)[0].length,a=n&&r.slice(o,o+n.length)==n||s==e.pos+o,l=t?function(e){let t=e.node,i=t.childAfter(t.from),n=t.lastChild;if(!i)return null;let s=e.options.simulateBreak,r=e.state.doc.lineAt(i.from),o=null==s||s<=r.from?r.to:Math.min(r.to,s);for(let e=i.to;;){let s=t.childAfter(e);if(!s||s==n)return null;if(!s.type.isSkipped)return s.from<o?i:null;e=s.to}}(e):null;return l?a?e.column(l.from):e.column(l.to):e.baseIndent+(a?0:e.unit*i)}const Ha=W.define(),Va=new po;function za(e){let t=e.lastChild;return t&&t.to==e.to&&t.type.isError}function Ua(e,t,i){for(let n of e.facet(Ha)){let s=n(e,t,i);if(s)return s}return function(e,t,i){let n=wa(e);if(n.length<i)return null;let s=null;for(let r=n.resolveInner(i);r;r=r.parent){if(r.to<=i||r.from>i)continue;if(s&&r.from<t)break;let o=r.type.prop(Va);if(o&&(r.to<n.length-50||n.length==e.doc.length||!za(r))){let n=o(r,e);n&&n.from<=i&&n.from>=t&&n.to>i&&(s=n)}}return s}(e,t,i)}function qa(e,t){let i=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);return i>=n?void 0:{from:i,to:n}}const Ka=me.define({map:qa}),ja=me.define({map:qa});function Ga(e){let t=[];for(let{head:i}of e.state.selection.ranges)t.some((e=>e.from<=i&&e.to>=i))||t.push(e.lineBlockAt(i));return t}const Ya=j.define({create:()=>ci.none,update(e,t){e=e.map(t.changes);for(let i of t.effects)i.is(Ka)&&!Ja(e,i.value.from,i.value.to)?e=e.update({add:[sl.range(i.value.from,i.value.to)]}):i.is(ja)&&(e=e.update({filter:(e,t)=>i.value.from!=e||i.value.to!=t,filterFrom:i.value.from,filterTo:i.value.to}));if(t.selection){let i=!1,{head:n}=t.selection.main;e.between(n,n,((e,t)=>{e<n&&t>n&&(i=!0)})),i&&(e=e.update({filterFrom:n,filterTo:n,filter:(e,t)=>t<=n||e>=n}))}return e},provide:e=>Ds.decorations.from(e)});function Qa(e,t,i){var n;let s=null;return null===(n=e.field(Ya,!1))||void 0===n||n.between(t,i,((e,t)=>{(!s||s.from>e)&&(s={from:e,to:t})})),s}function Ja(e,t,i){let n=!1;return e.between(t,t,((e,s)=>{e==t&&s==i&&(n=!0)})),n}function Xa(e,t){return e.field(Ya,!1)?t:t.concat(me.appendConfig.of(nl()))}function Za(e,t,i=!0){let n=e.state.doc.lineAt(t.from).number,s=e.state.doc.lineAt(t.to).number;return Ds.announce.of(`${e.state.phrase(i?"Folded lines":"Unfolded lines")} ${n} ${e.state.phrase("to")} ${s}.`)}const el=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:e=>{for(let t of Ga(e)){let i=Ua(e.state,t.from,t.to);if(i)return e.dispatch({effects:Xa(e.state,[Ka.of(i),Za(e,i)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:e=>{if(!e.state.field(Ya,!1))return!1;let t=[];for(let i of Ga(e)){let n=Qa(e.state,i.from,i.to);n&&t.push(ja.of(n),Za(e,n,!1))}return t.length&&e.dispatch({effects:t}),t.length>0}},{key:"Ctrl-Alt-[",run:e=>{let{state:t}=e,i=[];for(let n=0;n<t.doc.length;){let s=e.lineBlockAt(n),r=Ua(t,s.from,s.to);r&&i.push(Ka.of(r)),n=(r?e.lineBlockAt(r.to):s).to+1}return i.length&&e.dispatch({effects:Xa(e.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:e=>{let t=e.state.field(Ya,!1);if(!t||!t.size)return!1;let i=[];return t.between(0,e.state.doc.length,((e,t)=>{i.push(ja.of({from:e,to:t}))})),e.dispatch({effects:i}),!0}}],tl={placeholderDOM:null,placeholderText:"…"},il=W.define({combine:e=>Me(e,tl)});function nl(e){let t=[Ya,al];return e&&t.push(il.of(e)),t}const sl=ci.replace({widget:new class extends li{toDOM(e){let{state:t}=e,i=t.facet(il),n=t=>{let i=e.lineBlockAt(e.posAtDOM(t.target)),n=Qa(e.state,i.from,i.to);n&&e.dispatch({effects:ja.of(n)}),t.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(e,n);let s=document.createElement("span");return s.textContent=i.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}}}),rl={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class ol extends zr{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}const al=Ds.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class ll{constructor(e,t){let i;function n(e){let t=Je.newName();return(i||(i=Object.create(null)))["."+t]=e,t}const s="string"==typeof t.all?t.all:t.all?n(t.all):void 0,r=t.scope;this.scope=r instanceof ma?e=>e.prop(ga)==r.data:r?e=>e==r:void 0,this.style=Go(e.map((e=>({tag:e.tag,class:e.class||n(Object.assign({},e,{tag:null}))}))),{all:s}).style,this.module=i?new Je(i):null,this.themeType=t.themeType}static define(e,t){return new ll(e,t||{})}}const hl=W.define(),cl=W.define({combine:e=>e.length?[e[0]]:null});function ul(e){let t=e.facet(hl);return t.length?t:e.facet(cl)}function dl(e,t){let i,n=[pl];return e instanceof ll&&(e.module&&n.push(Ds.styleModule.of(e.module)),i=e.themeType),(null==t?void 0:t.fallback)?n.push(cl.of(e)):i?n.push(hl.computeN([Ds.darkTheme],(t=>t.facet(Ds.darkTheme)==("dark"==i)?[e]:[]))):n.push(hl.of(e)),n}class fl{constructor(e){this.markCache=Object.create(null),this.tree=wa(e.state),this.decorations=this.buildDeco(e,ul(e.state))}update(e){let t=wa(e.state),i=ul(e.state),n=i!=ul(e.startState);t.length<e.view.viewport.to&&!n&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i))}buildDeco(e,t){if(!t||!this.tree.length)return ci.none;let i=new De;for(let{from:n,to:s}of e.visibleRanges)Qo(this.tree,t,((e,t,n)=>{i.add(e,t,this.markCache[n]||(this.markCache[n]=ci.mark({class:n})))}),n,s);return i.finish()}}const pl=Z.high(Oi.fromClass(fl,{decorations:e=>e.decorations})),gl=ll.define([{tag:fa.meta,color:"#7a757a"},{tag:fa.link,textDecoration:"underline"},{tag:fa.heading,textDecoration:"underline",fontWeight:"bold"},{tag:fa.emphasis,fontStyle:"italic"},{tag:fa.strong,fontWeight:"bold"},{tag:fa.strikethrough,textDecoration:"line-through"},{tag:fa.keyword,color:"#708"},{tag:[fa.atom,fa.bool,fa.url,fa.contentSeparator,fa.labelName],color:"#219"},{tag:[fa.literal,fa.inserted],color:"#164"},{tag:[fa.string,fa.deleted],color:"#a11"},{tag:[fa.regexp,fa.escape,fa.special(fa.string)],color:"#e40"},{tag:fa.definition(fa.variableName),color:"#00f"},{tag:fa.local(fa.variableName),color:"#30a"},{tag:[fa.typeName,fa.namespace],color:"#085"},{tag:fa.className,color:"#167"},{tag:[fa.special(fa.variableName),fa.macroName],color:"#256"},{tag:fa.definition(fa.propertyName),color:"#00c"},{tag:fa.comment,color:"#940"},{tag:fa.invalid,color:"#f00"}]),ml=Ds.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),vl=W.define({combine:e=>Me(e,{afterCursor:!0,brackets:"()[]{}",maxScanDistance:1e4,renderMatch:bl})}),wl=ci.mark({class:"cm-matchingBracket"}),yl=ci.mark({class:"cm-nonmatchingBracket"});function bl(e){let t=[],i=e.matched?wl:yl;return t.push(i.range(e.start.from,e.start.to)),e.end&&t.push(i.range(e.end.from,e.end.to)),t}const _l=[j.define({create:()=>ci.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let i=[],n=t.state.facet(vl);for(let e of t.state.selection.ranges){if(!e.empty)continue;let s=Sl(t.state,e.head,-1,n)||e.head>0&&Sl(t.state,e.head-1,1,n)||n.afterCursor&&(Sl(t.state,e.head,1,n)||e.head<t.state.doc.length&&Sl(t.state,e.head+1,-1,n));s&&(i=i.concat(n.renderMatch(s,t.state)))}return ci.set(i,!0)},provide:e=>Ds.decorations.from(e)}),ml];function Cl(e,t,i){let n=e.prop(t<0?po.openedBy:po.closedBy);if(n)return n;if(1==e.name.length){let n=i.indexOf(e.name);if(n>-1&&n%2==(t<0?1:0))return[i[n+t]]}return null}function Sl(e,t,i,n={}){let s=n.maxScanDistance||1e4,r=n.brackets||"()[]{}",o=wa(e),a=o.resolveInner(t,i);for(let n=a;n;n=n.parent){let s=Cl(n.type,i,r);if(s&&n.from<n.to)return xl(e,t,i,n,s,r)}return function(e,t,i,n,s,r,o){let a=i<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=i>0)return null;let h={from:i<0?t-1:t,to:i>0?t+1:t},c=e.doc.iterRange(t,i>0?e.doc.length:0),u=0;for(let e=0;!c.next().done&&e<=r;){let r=c.value;i<0&&(e+=r.length);let a=t+e*i;for(let e=i>0?0:r.length-1,t=i>0?r.length:-1;e!=t;e+=i){let t=o.indexOf(r[e]);if(!(t<0||n.resolve(a+e,1).type!=s))if(t%2==0==i>0)u++;else{if(1==u)return{start:h,end:{from:a+e,to:a+e+1},matched:t>>1==l>>1};u--}}i>0&&(e+=r.length)}return c.done?{start:h,matched:!1}:null}(e,t,i,o,a.type,s,r)}function xl(e,t,i,n,s,r){let o=n.parent,a={from:n.from,to:n.to},l=0,h=null==o?void 0:o.cursor();if(h&&(i<0?h.childBefore(n.from):h.childAfter(n.to)))do{if(i<0?h.to<=n.from:h.from>=n.to){if(0==l&&s.indexOf(h.type.name)>-1&&h.from<h.to)return{start:a,end:{from:h.from,to:h.to},matched:!0};if(Cl(h.type,i,r))l++;else if(Cl(h.type,-i,r)&&(l--,0==l))return{start:a,end:h.from==h.to?void 0:{from:h.from,to:h.to},matched:!1}}}while(i<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}const kl=Object.create(null),Al=[mo.none],El=[],Tl=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Tl[e]=Ll(kl,t);function Ml(e,t){El.indexOf(e)>-1||(El.push(e),console.warn(t))}function Ll(e,t){let i=null;for(let n of t.split(".")){let t=e[n]||fa[n];t?"function"==typeof t?i?i=t(i):Ml(n,`Modifier ${n} used at start of tag`):i?Ml(n,`Tag ${n} used as modifier`):i=t:Ml(n,`Unknown highlighting tag ${n}`)}if(!i)return 0;let n=t.replace(/ /g,"_"),s=mo.define({id:Al.length,name:n,props:[qo({[n]:i})]});return Al.push(s),s.id}function Rl(e,t){return({state:i,dispatch:n})=>{if(i.readOnly)return!1;let s=e(t,i);return!!s&&(n(i.update(s)),!0)}}const $l=Rl(Pl,0),Il=Rl(Nl,0),Ol=Rl(((e,t)=>Nl(e,t,function(e){let t=[];for(let i of e.selection.ranges){let n=e.doc.lineAt(i.from),s=i.to<=n.to?n:e.doc.lineAt(i.to),r=t.length-1;r>=0&&t[r].to>n.from?t[r].to=s.to:t.push({from:n.from,to:s.to})}return t}(t))),0);function Dl(e,t=e.selection.main.head){let i=e.languageDataAt("commentTokens",t);return i.length?i[0]:{}}function Nl(e,t,i=t.selection.ranges){let n=i.map((e=>Dl(t,e.from).block));if(!n.every((e=>e)))return null;let s=i.map(((e,i)=>function(e,{open:t,close:i},n,s){let r,o,a=e.sliceDoc(n-50,n),l=e.sliceDoc(s,s+50),h=/\s*$/.exec(a)[0].length,c=/^\s*/.exec(l)[0].length,u=a.length-h;if(a.slice(u-t.length,u)==t&&l.slice(c,c+i.length)==i)return{open:{pos:n-h,margin:h&&1},close:{pos:s+c,margin:c&&1}};s-n<=100?r=o=e.sliceDoc(n,s):(r=e.sliceDoc(n,n+50),o=e.sliceDoc(s-50,s));let d=/^\s*/.exec(r)[0].length,f=/\s*$/.exec(o)[0].length,p=o.length-f-i.length;return r.slice(d,d+t.length)==t&&o.slice(p,p+i.length)==i?{open:{pos:n+d+t.length,margin:/\s/.test(r.charAt(d+t.length))?1:0},close:{pos:s-f-i.length,margin:/\s/.test(o.charAt(p-1))?1:0}}:null}(t,n[i],e.from,e.to)));if(2!=e&&!s.every((e=>e)))return{changes:t.changes(i.map(((e,t)=>s[t]?[]:[{from:e.from,insert:n[t].open+" "},{from:e.to,insert:" "+n[t].close}])))};if(1!=e&&s.some((e=>e))){let e=[];for(let t,i=0;i<s.length;i++)if(t=s[i]){let s=n[i],{open:r,close:o}=t;e.push({from:r.pos-s.open.length,to:r.pos+r.margin},{from:o.pos-o.margin,to:o.pos+s.close.length})}return{changes:e}}return null}function Pl(e,t,i=t.selection.ranges){let n=[],s=-1;for(let{from:e,to:r}of i){let i=n.length,o=1e9;for(let i=e;i<=r;){let a=t.doc.lineAt(i);if(a.from>s&&(e==r||r>a.from)){s=a.from;let e=Dl(t,i).line;if(!e)continue;let r=/^\s*/.exec(a.text)[0].length,l=r==a.length,h=a.text.slice(r,r+e.length)==e?r:-1;r<a.text.length&&r<o&&(o=r),n.push({line:a,comment:h,token:e,indent:r,empty:l,single:!1})}i=a.to+1}if(o<1e9)for(let e=i;e<n.length;e++)n[e].indent<n[e].line.text.length&&(n[e].indent=o);n.length==i+1&&(n[i].single=!0)}if(2!=e&&n.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:i,indent:s,empty:r,single:o}of n)!o&&r||e.push({from:t.from+s,insert:i+" "});let i=t.changes(e);return{changes:i,selection:t.selection.map(i,1)}}if(1!=e&&n.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:i,token:s}of n)if(i>=0){let n=t.from+i,r=n+s.length;" "==t.text[r-t.from]&&r++,e.push({from:n,to:r})}return{changes:e}}return null}const Fl=fe.define(),Bl=fe.define(),Wl=W.define(),Hl=W.define({combine:e=>Me(e,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})});const Vl=j.define({create:()=>sh.empty,update(e,t){let i=t.state.facet(Hl),n=t.annotation(Fl);if(n){let s=t.docChanged?P.single(function(e){let t=0;return e.iterChangedRanges(((e,i)=>t=i)),t}(t.changes)):void 0,r=Yl.fromTransaction(t,s),o=n.side,a=0==o?e.undone:e.done;return a=r?Ql(a,a.length,i.minDepth,r):Zl(a,t.startState.selection),new sh(0==o?n.rest:a,0==o?a:n.rest)}let s=t.annotation(Bl);if("full"!=s&&"before"!=s||(e=e.isolate()),!1===t.annotation(ve.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let r=Yl.fromTransaction(t),o=t.annotation(ve.time),a=t.annotation(ve.userEvent);return r?e=e.addChanges(r,o,a,i.newGroupDelay,i.minDepth):t.selection&&(e=e.addSelection(t.startState.selection,o,a,i.newGroupDelay)),"full"!=s&&"after"!=s||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new sh(e.done.map(Yl.fromJSON),e.undone.map(Yl.fromJSON))});function zl(e={}){return[Vl,Hl.of(e),Ds.domEventHandlers({beforeinput(e,t){let i="historyUndo"==e.inputType?ql:"historyRedo"==e.inputType?Kl:null;return!!i&&(e.preventDefault(),i(t))}})]}function Ul(e,t){return function({state:i,dispatch:n}){if(!t&&i.readOnly)return!1;let s=i.field(Vl,!1);if(!s)return!1;let r=s.pop(e,i,t);return!!r&&(n(r),!0)}}const ql=Ul(0,!1),Kl=Ul(1,!1),jl=Ul(0,!0),Gl=Ul(1,!0);class Yl{constructor(e,t,i,n,s){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=n,this.selectionsAfter=s}setSelAfter(e){return new Yl(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new Yl(e.changes&&M.fromJSON(e.changes),[],e.mapped&&T.fromJSON(e.mapped),e.startSelection&&P.fromJSON(e.startSelection),e.selectionsAfter.map(P.fromJSON))}static fromTransaction(e,t){let i=Xl;for(let t of e.startState.facet(Wl)){let n=t(e);n.length&&(i=i.concat(n))}return!i.length&&e.changes.empty?null:new Yl(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,Xl)}static selection(e){return new Yl(void 0,Xl,void 0,void 0,e)}}function Ql(e,t,i,n){let s=t+1>i+20?t-i-1:0,r=e.slice(s,t);return r.push(n),r}function Jl(e,t){return e.length?t.length?e.concat(t):e:t}const Xl=[];function Zl(e,t){if(e.length){let i=e[e.length-1],n=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-200));return n.length&&n[n.length-1].eq(t)?e:(n.push(t),Ql(e,e.length-1,1e9,i.setSelAfter(n)))}return[Yl.selection([t])]}function eh(e){let t=e[e.length-1],i=e.slice();return i[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),i}function th(e,t){if(!e.length)return e;let i=e.length,n=Xl;for(;i;){let s=ih(e[i-1],t,n);if(s.changes&&!s.changes.empty||s.effects.length){let t=e.slice(0,i);return t[i-1]=s,t}t=s.mapped,i--,n=s.selectionsAfter}return n.length?[Yl.selection(n)]:Xl}function ih(e,t,i){let n=Jl(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):Xl,i);if(!e.changes)return Yl.selection(n);let s=e.changes.map(t),r=t.mapDesc(e.changes,!0),o=e.mapped?e.mapped.composeDesc(r):r;return new Yl(s,me.mapEffects(e.effects,t),o,e.startSelection.map(r),n)}const nh=/^(input\.type|delete)($|\.)/;class sh{constructor(e,t,i=0,n){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new sh(this.done,this.undone):this}addChanges(e,t,i,n,s){let r=this.done,o=r[r.length-1];return r=o&&o.changes&&!o.changes.empty&&e.changes&&(!i||nh.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<n&&function(e,t){let i=[],n=!1;return e.iterChangedRanges(((e,t)=>i.push(e,t))),t.iterChangedRanges(((e,t,s,r)=>{for(let e=0;e<i.length;){let t=i[e++],o=i[e++];r>=t&&s<=o&&(n=!0)}})),n}(o.changes,e.changes)||"input.type.compose"==i)?Ql(r,r.length-1,s,new Yl(e.changes.compose(o.changes),Jl(e.effects,o.effects),o.mapped,o.startSelection,Xl)):Ql(r,r.length,s,e),new sh(r,Xl,t,i)}addSelection(e,t,i,n){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Xl;return s.length>0&&t-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(r=s[s.length-1],o=e,r.ranges.length==o.ranges.length&&0===r.ranges.filter(((e,t)=>e.empty!=o.ranges[t].empty)).length)?this:new sh(Zl(this.done,e),this.undone,t,i);var r,o}addMapping(e){return new sh(th(this.done,e),th(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let n=0==e?this.done:this.undone;if(0==n.length)return null;let s=n[n.length-1];if(i&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Fl.of({side:e,rest:eh(n)}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let i=1==n.length?Xl:n.slice(0,n.length-1);return s.mapped&&(i=th(i,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Fl.of({side:e,rest:i}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}sh.empty=new sh(Xl,Xl);const rh=[{key:"Mod-z",run:ql,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Kl,preventDefault:!0},{key:"Mod-u",run:jl,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Gl,preventDefault:!0}];function oh(e,t){return P.create(e.ranges.map(t),e.mainIndex)}function ah(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function lh({state:e,dispatch:t},i){let n=oh(e.selection,i);return!n.eq(e.selection)&&(t(ah(e,n)),!0)}function hh(e,t){return P.cursor(t?e.to:e.from)}function ch(e,t){return lh(e,(i=>i.empty?e.moveByChar(i,t):hh(i,t)))}function uh(e){return e.textDirectionAt(e.state.selection.main.head)==Ui.LTR}const dh=e=>ch(e,!uh(e)),fh=e=>ch(e,uh(e));function ph(e,t){return lh(e,(i=>i.empty?e.moveByGroup(i,t):hh(i,t)))}function gh(e,t,i){if(t.type.prop(i))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function mh(e,t,i){let n,s,r=wa(e).resolveInner(t.head),o=i?po.closedBy:po.openedBy;for(let n=t.head;;){let t=i?r.childAfter(n):r.childBefore(n);if(!t)break;gh(e,t,o)?r=t:n=i?t.to:t.from}return s=r.type.prop(o)&&(n=i?Sl(e,r.from,1):Sl(e,r.to,-1))&&n.matched?i?n.end.to:n.end.from:i?r.to:r.from,P.cursor(s,i?-1:1)}function vh(e,t){return lh(e,(i=>{if(!i.empty)return hh(i,t);let n=e.moveVertically(i,t);return n.head!=i.head?n:e.moveToLineBoundary(i,t)}))}const wh=e=>vh(e,!1),yh=e=>vh(e,!0);function bh(e){return Math.max(e.defaultLineHeight,Math.min(e.dom.clientHeight,innerHeight)-5)}function _h(e,t){let{state:i}=e,n=oh(i.selection,(i=>i.empty?e.moveVertically(i,t,bh(e)):hh(i,t)));if(n.eq(i.selection))return!1;let s,r=e.coordsAtPos(i.selection.main.head),o=e.scrollDOM.getBoundingClientRect();return r&&r.top>o.top&&r.bottom<o.bottom&&r.top-o.top<=e.scrollDOM.scrollHeight-e.scrollDOM.scrollTop-e.scrollDOM.clientHeight&&(s=Ds.scrollIntoView(n.main.head,{y:"start",yMargin:r.top-o.top})),e.dispatch(ah(i,n),{effects:s}),!0}const Ch=e=>_h(e,!1),Sh=e=>_h(e,!0);function xh(e,t,i){let n=e.lineBlockAt(t.head),s=e.moveToLineBoundary(t,i);if(s.head==t.head&&s.head!=(i?n.to:n.from)&&(s=e.moveToLineBoundary(t,i,!1)),!i&&s.head==n.from&&n.length){let i=/^\s*/.exec(e.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&t.head!=n.from+i&&(s=P.cursor(n.from+i))}return s}const kh=e=>lh(e,(t=>xh(e,t,!0))),Ah=e=>lh(e,(t=>xh(e,t,!1)));function Eh(e,t,i){let n=!1,s=oh(e.selection,(t=>{let s=Sl(e,t.head,-1)||Sl(e,t.head,1)||t.head>0&&Sl(e,t.head-1,1)||t.head<e.doc.length&&Sl(e,t.head+1,-1);if(!s||!s.end)return t;n=!0;let r=s.start.from==t.head?s.end.to:s.end.from;return i?P.range(t.anchor,r):P.cursor(r)}));return!!n&&(t(ah(e,s)),!0)}function Th(e,t){let i=oh(e.state.selection,(e=>{let i=t(e);return P.range(e.anchor,i.head,i.goalColumn)}));return!i.eq(e.state.selection)&&(e.dispatch(ah(e.state,i)),!0)}function Mh(e,t){return Th(e,(i=>e.moveByChar(i,t)))}const Lh=e=>Mh(e,!uh(e)),Rh=e=>Mh(e,uh(e));function $h(e,t){return Th(e,(i=>e.moveByGroup(i,t)))}function Ih(e,t){return Th(e,(i=>e.moveVertically(i,t)))}const Oh=e=>Ih(e,!1),Dh=e=>Ih(e,!0);function Nh(e,t){return Th(e,(i=>e.moveVertically(i,t,bh(e))))}const Ph=e=>Nh(e,!1),Fh=e=>Nh(e,!0),Bh=e=>Th(e,(t=>xh(e,t,!0))),Wh=e=>Th(e,(t=>xh(e,t,!1))),Hh=({state:e,dispatch:t})=>(t(ah(e,{anchor:0})),!0),Vh=({state:e,dispatch:t})=>(t(ah(e,{anchor:e.doc.length})),!0),zh=({state:e,dispatch:t})=>(t(ah(e,{anchor:e.selection.main.anchor,head:0})),!0),Uh=({state:e,dispatch:t})=>(t(ah(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0);function qh({state:e,dispatch:t},i){if(e.readOnly)return!1;let n="delete.selection",s=e.changeByRange((e=>{let{from:t,to:s}=e;if(t==s){let e=i(t);e<t?n="delete.backward":e>t&&(n="delete.forward"),t=Math.min(t,e),s=Math.max(s,e)}return t==s?{range:e}:{changes:{from:t,to:s},range:P.cursor(t)}}));return!s.changes.empty&&(t(e.update(s,{scrollIntoView:!0,userEvent:n})),!0)}function Kh(e,t,i){if(e instanceof Ds)for(let n of e.state.facet(Ds.atomicRanges).map((t=>t(e))))n.between(t,t,((e,n)=>{e<t&&n>t&&(t=i?n:e)}));return t}const jh=(e,t)=>qh(e,(i=>{let n,s,{state:r}=e,o=r.doc.lineAt(i);if(!t&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(n=o.text.slice(0,i-o.from))){if("\t"==n[n.length-1])return i-1;let e=Ke(n,r.tabSize)%La(r)||La(r);for(let t=0;t<e&&" "==n[n.length-1-t];t++)i--;s=i}else s=w(o.text,i-o.from,t,t)+o.from,s==i&&o.number!=(t?r.doc.lines:1)&&(s+=t?1:-1);return Kh(e,s,t)})),Gh=e=>jh(e,!1),Yh=e=>jh(e,!0),Qh=(e,t)=>qh(e,(i=>{let n=i,{state:s}=e,r=s.doc.lineAt(n),o=s.charCategorizer(n);for(let e=null;;){if(n==(t?r.to:r.from)){n==i&&r.number!=(t?s.doc.lines:1)&&(n+=t?1:-1);break}let a=w(r.text,n-r.from,t)+r.from,l=r.text.slice(Math.min(n,a)-r.from,Math.max(n,a)-r.from),h=o(l);if(null!=e&&h!=e)break;" "==l&&n==i||(e=h),n=a}return Kh(e,n,t)})),Jh=e=>Qh(e,!1),Xh=e=>qh(e,(t=>{let i=e.lineBlockAt(t).to;return Kh(e,t<i?i:Math.min(e.state.doc.length,t+1),!0)}));function Zh(e){let t=[],i=-1;for(let n of e.selection.ranges){let s=e.doc.lineAt(n.from),r=e.doc.lineAt(n.to);if(n.empty||n.to!=r.from||(r=e.doc.lineAt(n.to-1)),i>=s.number){let e=t[t.length-1];e.to=r.to,e.ranges.push(n)}else t.push({from:s.from,to:r.to,ranges:[n]});i=r.number+1}return t}function ec(e,t,i){if(e.readOnly)return!1;let n=[],s=[];for(let t of Zh(e)){if(i?t.to==e.doc.length:0==t.from)continue;let r=e.doc.lineAt(i?t.to+1:t.from-1),o=r.length+1;if(i){n.push({from:t.to,to:r.to},{from:t.from,insert:r.text+e.lineBreak});for(let i of t.ranges)s.push(P.range(Math.min(e.doc.length,i.anchor+o),Math.min(e.doc.length,i.head+o)))}else{n.push({from:r.from,to:t.from},{from:t.to,insert:e.lineBreak+r.text});for(let e of t.ranges)s.push(P.range(e.anchor-o,e.head-o))}}return!!n.length&&(t(e.update({changes:n,scrollIntoView:!0,selection:P.create(s,e.selection.mainIndex),userEvent:"move.line"})),!0)}function tc(e,t,i){if(e.readOnly)return!1;let n=[];for(let t of Zh(e))i?n.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):n.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const ic=nc(!1);function nc(e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let n=t.changeByRange((i=>{let{from:n,to:s}=i,r=t.doc.lineAt(n),a=!e&&n==s&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let i,n=wa(e).resolveInner(t),s=n.childBefore(t),r=n.childAfter(t);return s&&r&&s.to<=t&&r.from>=t&&(i=s.type.prop(po.closedBy))&&i.indexOf(r.name)>-1&&e.doc.lineAt(s.to).from==e.doc.lineAt(r.from).from?{from:s.to,to:r.from}:null}(t,n);e&&(n=s=(s<=r.to?r:t.doc.lineAt(s)).to);let l=new Ia(t,{simulateBreak:n,simulateDoubleBreak:!!a}),h=$a(l,n);for(null==h&&(h=/^\s*/.exec(t.doc.lineAt(n).text)[0].length);s<r.to&&/\s/.test(r.text[s-r.from]);)s++;a?({from:n,to:s}=a):n>r.from&&n<r.from+100&&!/\S/.test(r.text.slice(0,n))&&(n=r.from);let c=["",Ra(t,h)];return a&&c.push(Ra(t,l.lineIndent(r.from,-1))),{changes:{from:n,to:s,insert:o.of(c)},range:P.cursor(n+1+c[1].length)}}));return i(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function sc(e,t){let i=-1;return e.changeByRange((n=>{let s=[];for(let r=n.from;r<=n.to;){let o=e.doc.lineAt(r);o.number>i&&(n.empty||n.to>o.from)&&(t(o,s,n),i=o.number),r=o.to+1}let r=e.changes(s);return{changes:s,range:P.range(r.mapPos(n.anchor,1),r.mapPos(n.head,1))}}))}const rc=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(sc(e,((t,i)=>{i.push({from:t.from,insert:e.facet(Ma)})})),{userEvent:"input.indent"})),!0),oc=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(sc(e,((t,i)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let s=Ke(n,e.tabSize),r=0,o=Ra(e,Math.max(0,s-La(e)));for(;r<n.length&&r<o.length&&n.charCodeAt(r)==o.charCodeAt(r);)r++;i.push({from:t.from+r,to:t.from+n.length,insert:o.slice(r)})})),{userEvent:"delete.dedent"})),!0),ac=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e=>lh(e,(t=>mh(e.state,t,!uh(e)))),shift:e=>Th(e,(t=>mh(e.state,t,!uh(e))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:e=>lh(e,(t=>mh(e.state,t,uh(e)))),shift:e=>Th(e,(t=>mh(e.state,t,uh(e))))},{key:"Alt-ArrowUp",run:({state:e,dispatch:t})=>ec(e,t,!1)},{key:"Shift-Alt-ArrowUp",run:({state:e,dispatch:t})=>tc(e,t,!1)},{key:"Alt-ArrowDown",run:({state:e,dispatch:t})=>ec(e,t,!0)},{key:"Shift-Alt-ArrowDown",run:({state:e,dispatch:t})=>tc(e,t,!0)},{key:"Escape",run:({state:e,dispatch:t})=>{let i=e.selection,n=null;return i.ranges.length>1?n=P.create([i.main]):i.main.empty||(n=P.create([P.cursor(i.main.head)])),!!n&&(t(ah(e,n)),!0)}},{key:"Mod-Enter",run:nc(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:e,dispatch:t})=>{let i=Zh(e).map((({from:t,to:i})=>P.range(t,Math.min(i+1,e.doc.length))));return t(e.update({selection:P.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:e,dispatch:t})=>{let i=oh(e.selection,(t=>{var i;let n=wa(e).resolveInner(t.head,1);for(;!(n.from<t.from&&n.to>=t.to||n.to>t.to&&n.from<=t.from)&&(null===(i=n.parent)||void 0===i?void 0:i.parent);)n=n.parent;return P.range(n.to,n.from)}));return t(ah(e,i)),!0},preventDefault:!0},{key:"Mod-[",run:oc},{key:"Mod-]",run:rc},{key:"Mod-Alt-\\",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=Object.create(null),n=new Ia(e,{overrideIndentation:e=>{let t=i[e];return null==t?-1:t}}),s=sc(e,((t,s,r)=>{let o=$a(n,t.from);if(null==o)return;/\S/.test(t.text)||(o=0);let a=/^\s*/.exec(t.text)[0],l=Ra(e,o);(a!=l||r.from<t.from+a.length)&&(i[t.from]=o,s.push({from:t.from,to:t.from+a.length,insert:l}))}));return s.changes.empty||t(e.update(s,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:e=>{if(e.state.readOnly)return!1;let{state:t}=e,i=t.changes(Zh(t).map((({from:e,to:i})=>(e>0?e--:i<t.doc.length&&i++,{from:e,to:i})))),n=oh(t.selection,(t=>e.moveVertically(t,!0))).map(i);return e.dispatch({changes:i,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:e,dispatch:t})=>Eh(e,t,!1)},{key:"Mod-/",run:e=>{let t=Dl(e.state);return t.line?$l(e):!!t.block&&Ol(e)}},{key:"Alt-A",run:Il}].concat([{key:"ArrowLeft",run:dh,shift:Lh,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e=>ph(e,!uh(e)),shift:e=>$h(e,!uh(e))},{mac:"Cmd-ArrowLeft",run:Ah,shift:Wh},{key:"ArrowRight",run:fh,shift:Rh,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:e=>ph(e,uh(e)),shift:e=>$h(e,uh(e))},{mac:"Cmd-ArrowRight",run:kh,shift:Bh},{key:"ArrowUp",run:wh,shift:Oh,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Hh,shift:zh},{mac:"Ctrl-ArrowUp",run:Ch,shift:Ph},{key:"ArrowDown",run:yh,shift:Dh,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Vh,shift:Uh},{mac:"Ctrl-ArrowDown",run:Sh,shift:Fh},{key:"PageUp",run:Ch,shift:Ph},{key:"PageDown",run:Sh,shift:Fh},{key:"Home",run:Ah,shift:Wh,preventDefault:!0},{key:"Mod-Home",run:Hh,shift:zh},{key:"End",run:kh,shift:Bh,preventDefault:!0},{key:"Mod-End",run:Vh,shift:Uh},{key:"Enter",run:ic},{key:"Mod-a",run:({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:Gh,shift:Gh},{key:"Delete",run:Yh},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Jh},{key:"Mod-Delete",mac:"Alt-Delete",run:e=>Qh(e,!0)},{mac:"Mod-Backspace",run:e=>qh(e,(t=>{let i=e.lineBlockAt(t).from;return Kh(e,t>i?i:Math.max(0,t-1),!1)}))},{mac:"Mod-Delete",run:Xh}].concat([{key:"Ctrl-b",run:dh,shift:Lh,preventDefault:!0},{key:"Ctrl-f",run:fh,shift:Rh},{key:"Ctrl-p",run:wh,shift:Oh},{key:"Ctrl-n",run:yh,shift:Dh},{key:"Ctrl-a",run:e=>lh(e,(t=>P.cursor(e.lineBlockAt(t.head).from,1))),shift:e=>Th(e,(t=>P.cursor(e.lineBlockAt(t.head).from)))},{key:"Ctrl-e",run:e=>lh(e,(t=>P.cursor(e.lineBlockAt(t.head).to,-1))),shift:e=>Th(e,(t=>P.cursor(e.lineBlockAt(t.head).to)))},{key:"Ctrl-d",run:Yh},{key:"Ctrl-h",run:Gh},{key:"Ctrl-k",run:Xh},{key:"Ctrl-Alt-h",run:Jh},{key:"Ctrl-o",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:o.of(["",""])},range:P.cursor(e.from)})));return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let i=t.from,n=e.doc.lineAt(i),s=i==n.from?i-1:w(n.text,i-n.from,!1)+n.from,r=i==n.to?i+1:w(n.text,i-n.from,!0)+n.from;return{changes:{from:s,to:r,insert:e.doc.slice(i,r).append(e.doc.slice(s,i))},range:P.cursor(r)}}));return!i.changes.empty&&(t(e.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:Sh}].map((e=>({mac:e.key,run:e.run,shift:e.shift})))));function lc(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];"string"==typeof s?e.setAttribute(n,s):null!=s&&(e[n]=s)}t++}for(;t<arguments.length;t++)hc(e,arguments[t]);return e}function hc(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var i=0;i<t.length;i++)hc(e,t[i])}}const cc="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class uc{constructor(e,t,i=0,n=e.length,s){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,n),this.bufferStart=i,this.normalize=s?e=>s(cc(e)):cc,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return S(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=x(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=k(e);let n=this.normalize(t);for(let e=0,s=i;;e++){let r=n.charCodeAt(e),o=this.match(r,s);if(o)return this.value=o,this;if(e==n.length-1)break;s==i&&e<t.length&&t.charCodeAt(e)==r&&s++}}}match(e,t){let i=null;for(let n=0;n<this.matches.length;n+=2){let s=this.matches[n],r=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?i={from:this.matches[n+1],to:t+1}:(this.matches[n]++,r=!0)),r||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?i={from:t,to:t+1}:this.matches.push(1,t)),i}}"undefined"!=typeof Symbol&&(uc.prototype[Symbol.iterator]=function(){return this});const dc={from:-1,to:-1,match:/.*/.exec("")},fc="gm"+(null==/x/.unicode?"":"u");class pc{constructor(e,t,i,n=0,s=e.length){if(this.to=s,this.curLine="",this.done=!1,this.value=dc,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new vc(e,t,i,n,s);this.re=new RegExp(t,fc+((null==i?void 0:i.ignoreCase)?"i":"")),this.iter=e.iter();let r=e.lineAt(n);this.curLineStart=r.from,this.matchPos=n,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,n=i+t[0].length;if(this.matchPos=n+(i==n?1:0),i==this.curLine.length&&this.nextLine(),i<n||i>this.value.to)return this.value={from:i,to:n,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const gc=new WeakMap;class mc{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let n=gc.get(e);if(!n||n.from>=i||n.to<=t){let n=new mc(t,e.sliceString(t,i));return gc.set(e,n),n}if(n.from==t&&n.to==i)return n;let{text:s,from:r}=n;return r>t&&(s=e.sliceString(t,r)+s,r=t),n.to<i&&(s+=e.sliceString(n.to,i)),gc.set(e,new mc(r,s)),new mc(t,s.slice(t-r,i-r))}}class vc{constructor(e,t,i,n,s){this.text=e,this.to=s,this.done=!1,this.value=dc,this.matchPos=n,this.re=new RegExp(t,fc+((null==i?void 0:i.ignoreCase)?"i":"")),this.flat=mc.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let e=this.flat.from+t.index,i=e+t[0].length;return this.value={from:e,to:i,match:t},this.matchPos=i+(e==i?1:0),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=mc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function wc(e){let t=lc("input",{class:"cm-textfield",name:"line"});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!i)return;let{state:n}=e,s=n.doc.lineAt(n.selection.main.head),[,r,o,a,l]=i,h=a?+a.slice(1):0,c=o?+o:s.number;if(o&&l){let e=c/100;r&&(e=e*("-"==r?-1:1)+s.number/n.doc.lines),c=Math.round(n.doc.lines*e)}else o&&r&&(c=c*("-"==r?-1:1)+s.number);let u=n.doc.line(Math.max(1,Math.min(n.doc.lines,c)));e.dispatch({effects:yc.of(!1),selection:P.cursor(u.from+Math.max(0,Math.min(h,u.length))),scrollIntoView:!0}),e.focus()}return{dom:lc("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:yc.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),i())},onsubmit:e=>{e.preventDefault(),i()}},lc("label",e.state.phrase("Go to line"),": ",t)," ",lc("button",{class:"cm-button",type:"submit"},e.state.phrase("go")))}}"undefined"!=typeof Symbol&&(pc.prototype[Symbol.iterator]=vc.prototype[Symbol.iterator]=function(){return this});const yc=me.define(),bc=j.define({create:()=>!0,update(e,t){for(let i of t.effects)i.is(yc)&&(e=i.value);return e},provide:e=>Vr.from(e,(e=>e?wc:null))}),_c=Ds.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Cc={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Sc=W.define({combine:e=>Me(e,Cc,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})});const xc=ci.mark({class:"cm-selectionMatch"}),kc=ci.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Ac(e,t,i,n){return!(0!=i&&e(t.sliceDoc(i-1,i))==xe.Word||n!=t.doc.length&&e(t.sliceDoc(n,n+1))==xe.Word)}const Ec=Oi.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(Sc),{state:i}=e,n=i.selection;if(n.ranges.length>1)return ci.none;let s,r=n.main,o=null;if(r.empty){if(!t.highlightWordAroundCursor)return ci.none;let e=i.wordAt(r.head);if(!e)return ci.none;o=i.charCategorizer(r.head),s=i.sliceDoc(e.from,e.to)}else{let e=r.to-r.from;if(e<t.minSelectionLength||e>200)return ci.none;if(t.wholeWords){if(s=i.sliceDoc(r.from,r.to),o=i.charCategorizer(r.head),!Ac(o,i,r.from,r.to)||!function(e,t,i,n){return e(t.sliceDoc(i,i+1))==xe.Word&&e(t.sliceDoc(n-1,n))==xe.Word}(o,i,r.from,r.to))return ci.none}else if(s=i.sliceDoc(r.from,r.to).trim(),!s)return ci.none}let a=[];for(let n of e.visibleRanges){let e=new uc(i.doc,s,n.from,n.to);for(;!e.next().done;){let{from:n,to:s}=e.value;if((!o||Ac(o,i,n,s))&&(r.empty&&n<=r.from&&s>=r.to?a.push(kc.range(n,s)):(n>=r.to||s<=r.from)&&a.push(xc.range(n,s)),a.length>t.maxMatches))return ci.none}}return ci.set(a)}},{decorations:e=>e.decorations}),Tc=Ds.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});const Mc=W.define({combine(e){var t;return{top:e.reduce(((e,t)=>null!=e?e:t.top),void 0)||!1,caseSensitive:e.reduce(((e,t)=>null!=e?e:t.caseSensitive),void 0)||!1,createPanel:(null===(t=e.find((e=>e.createPanel)))||void 0===t?void 0:t.createPanel)||(e=>new eu(e))}}});class Lc{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,fc),!0}catch(e){return!1}}(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,((e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new Dc(this):new Ic(this)}getCursor(e,t=0,i=e.length){return this.regexp?Oc(this,e,t,i):$c(this,e,t,i)}}class Rc{constructor(e){this.spec=e}}function $c(e,t,i,n){return new uc(t,e.unquoted,i,n,e.caseSensitive?void 0:e=>e.toLowerCase())}class Ic extends Rc{constructor(e){super(e)}nextMatch(e,t,i){let n=$c(this.spec,e,i,e.length).nextOverlapping();return n.done&&(n=$c(this.spec,e,0,t).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=i;;){let i=Math.max(t,n-1e4-this.spec.unquoted.length),s=$c(this.spec,e,i,n),r=null;for(;!s.nextOverlapping().done;)r=s.value;if(r)return r;if(i==t)return null;n-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let i=$c(this.spec,e,0,e.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let s=$c(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}function Oc(e,t,i,n){return new pc(t,e.search,e.caseSensitive?void 0:{ignoreCase:!0},i,n)}class Dc extends Rc{nextMatch(e,t,i){let n=Oc(this.spec,e,i,e.length).next();return n.done&&(n=Oc(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=1;;n++){let s=Math.max(t,i-1e4*n),r=Oc(this.spec,e,s,i),o=null;for(;!r.next().done;)o=r.value;if(o&&(s==t||o.from>s+10))return o;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,((t,i)=>"$"==i?"$":"&"==i?e.match[0]:"0"!=i&&+i<e.match.length?e.match[i]:t))}matchAll(e,t){let i=Oc(this.spec,e,0,e.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let s=Oc(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.length));for(;!s.next().done;)n(s.value.from,s.value.to)}}const Nc=me.define(),Pc=me.define(),Fc=j.define({create:e=>new Bc(Qc(e).create(),null),update(e,t){for(let i of t.effects)i.is(Nc)?e=new Bc(i.value.create(),e.panel):i.is(Pc)&&(e=new Bc(e.query,i.value?Yc:null));return e},provide:e=>Vr.from(e,(e=>e.panel))});class Bc{constructor(e,t){this.query=e,this.panel=t}}const Wc=ci.mark({class:"cm-searchMatch"}),Hc=ci.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Vc=Oi.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(Fc))}update(e){let t=e.state.field(Fc);(t!=e.startState.field(Fc)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return ci.none;let{view:i}=this,n=new De;for(let t=0,s=i.visibleRanges,r=s.length;t<r;t++){let{from:o,to:a}=s[t];for(;t<r-1&&a>s[t+1].from-500;)a=s[++t].to;e.highlight(i.state.doc,o,a,((e,t)=>{let s=i.state.selection.ranges.some((i=>i.from==e&&i.to==t));n.add(e,t,s?Hc:Wc)}))}return n.finish()}},{decorations:e=>e.decorations});function zc(e){return t=>{let i=t.state.field(Fc,!1);return i&&i.query.spec.valid?e(t,i):Jc(t)}}const Uc=zc(((e,{query:t})=>{let{from:i,to:n}=e.state.selection.main,s=t.nextMatch(e.state.doc,i,n);return!(!s||s.from==i&&s.to==n)&&(e.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:nu(e,s),userEvent:"select.search"}),!0)})),qc=zc(((e,{query:t})=>{let{state:i}=e,{from:n,to:s}=i.selection.main,r=t.prevMatch(i.doc,n,s);return!!r&&(e.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:nu(e,r),userEvent:"select.search"}),!0)})),Kc=zc(((e,{query:t})=>{let i=t.matchAll(e.state.doc,1e3);return!(!i||!i.length)&&(e.dispatch({selection:P.create(i.map((e=>P.range(e.from,e.to)))),userEvent:"select.search.matches"}),!0)})),jc=zc(((e,{query:t})=>{let{state:i}=e,{from:n,to:s}=i.selection.main;if(i.readOnly)return!1;let r=t.nextMatch(i.doc,n,n);if(!r)return!1;let o,a,l=[],h=[];if(r.from==n&&r.to==s&&(a=i.toText(t.getReplacement(r)),l.push({from:r.from,to:r.to,insert:a}),r=t.nextMatch(i.doc,r.from,r.to),h.push(Ds.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(n).number)+"."))),r){let t=0==l.length||l[0].from>=r.to?0:r.to-r.from-a.length;o={anchor:r.from-t,head:r.to-t},h.push(nu(e,r))}return e.dispatch({changes:l,selection:o,scrollIntoView:!!o,effects:h,userEvent:"input.replace"}),!0})),Gc=zc(((e,{query:t})=>{if(e.state.readOnly)return!1;let i=t.matchAll(e.state.doc,1e9).map((e=>{let{from:i,to:n}=e;return{from:i,to:n,insert:t.getReplacement(e)}}));if(!i.length)return!1;let n=e.state.phrase("replaced $ matches",i.length)+".";return e.dispatch({changes:i,effects:Ds.announce.of(n),userEvent:"input.replace.all"}),!0}));function Yc(e){return e.state.facet(Mc).createPanel(e)}function Qc(e,t){var i;let n=e.selection.main,s=n.empty||n.to>n.from+100?"":e.sliceDoc(n.from,n.to),r=null!==(i=null==t?void 0:t.caseSensitive)&&void 0!==i?i:e.facet(Mc).caseSensitive;return t&&!s?t:new Lc({search:s.replace(/\n/g,"\\n"),caseSensitive:r})}const Jc=e=>{let t=e.state.field(Fc,!1);if(t&&t.panel){let i=Fr(e,Yc);if(!i)return!1;let n=i.dom.querySelector("[main-field]");if(n&&n!=e.root.activeElement){let i=Qc(e.state,t.query.spec);i.valid&&e.dispatch({effects:Nc.of(i)}),n.focus(),n.select()}}else e.dispatch({effects:[Pc.of(!0),t?Nc.of(Qc(e.state,t.query.spec)):me.appendConfig.of(ru)]});return!0},Xc=e=>{let t=e.state.field(Fc,!1);if(!t||!t.panel)return!1;let i=Fr(e,Yc);return i&&i.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:Pc.of(!1)}),!0},Zc=[{key:"Mod-f",run:Jc,scope:"editor search-panel"},{key:"F3",run:Uc,shift:qc,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Uc,shift:qc,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Xc,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:e,dispatch:t})=>{let i=e.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:s}=i.main,r=[],o=0;for(let t=new uc(e.doc,e.sliceDoc(n,s));!t.next().done;){if(r.length>1e3)return!1;t.value.from==n&&(o=r.length),r.push(P.range(t.value.from,t.value.to))}return t(e.update({selection:P.create(r,o),userEvent:"select.search.matches"})),!0}},{key:"Alt-g",run:e=>{let t=Fr(e,wc);if(!t){let i=[yc.of(!0)];null==e.state.field(bc,!1)&&i.push(me.appendConfig.of([bc,_c])),e.dispatch({effects:i}),t=Fr(e,wc)}return t&&t.dom.querySelector("input").focus(),!0}},{key:"Mod-d",run:({state:e,dispatch:t})=>{let{ranges:i}=e.selection;if(i.some((e=>e.from===e.to)))return(({state:e,dispatch:t})=>{let{selection:i}=e,n=P.create(i.ranges.map((t=>e.wordAt(t.head)||P.cursor(t.head))),i.mainIndex);return!n.eq(i)&&(t(e.update({selection:n})),!0)})({state:e,dispatch:t});let n=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=n)))return!1;let s=function(e,t){let{main:i,ranges:n}=e.selection,s=e.wordAt(i.head),r=s&&s.from==i.from&&s.to==i.to;for(let i=!1,s=new uc(e.doc,t,n[n.length-1].to);;){if(s.next(),!s.done){if(i&&n.some((e=>e.from==s.value.from)))continue;if(r){let t=e.wordAt(s.value.from);if(!t||t.from!=s.value.from||t.to!=s.value.to)continue}return s.value}if(i)return null;s=new uc(e.doc,t,0,Math.max(0,n[n.length-1].from-1)),i=!0}}(e,n);return!!s&&(t(e.update({selection:e.selection.addRange(P.range(s.from,s.to),!1),effects:Ds.scrollIntoView(s.to)})),!0)},preventDefault:!0}];class eu{constructor(e){this.view=e;let t=this.query=e.state.field(Fc).query.spec;function i(e,t,i){return lc("button",{class:"cm-button",name:e,onclick:t,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=lc("input",{value:t.search,placeholder:tu(e,"Find"),"aria-label":tu(e,"Find"),class:"cm-textfield",name:"search","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=lc("input",{value:t.replace,placeholder:tu(e,"Replace"),"aria-label":tu(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=lc("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=lc("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit}),this.dom=lc("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,i("next",(()=>Uc(e)),[tu(e,"next")]),i("prev",(()=>qc(e)),[tu(e,"previous")]),i("select",(()=>Kc(e)),[tu(e,"all")]),lc("label",null,[this.caseField,tu(e,"match case")]),lc("label",null,[this.reField,tu(e,"regexp")]),...e.state.readOnly?[]:[lc("br"),this.replaceField,i("replace",(()=>jc(e)),[tu(e,"replace")]),i("replaceAll",(()=>Gc(e)),[tu(e,"replace all")]),lc("button",{name:"close",onclick:()=>Xc(e),"aria-label":tu(e,"close"),type:"button"},["×"])]])}commit(){let e=new Lc({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Nc.of(e)}))}keydown(e){var t,i,n;t=this.view,i=e,n="search-panel",Ks(Us(t.state),i,t,n)?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?qc:Uc)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),jc(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(Nc)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Mc).top}}function tu(e,t){return e.state.phrase(t)}const iu=/[\s\.,:;?!]/;function nu(e,{from:t,to:i}){let n=e.state.doc.lineAt(t),s=e.state.doc.lineAt(i).to,r=Math.max(n.from,t-30),o=Math.min(s,i+30),a=e.state.sliceDoc(r,o);if(r!=n.from)for(let e=0;e<30;e++)if(!iu.test(a[e+1])&&iu.test(a[e])){a=a.slice(e);break}if(o!=s)for(let e=a.length-1;e>a.length-30;e--)if(!iu.test(a[e-1])&&iu.test(a[e])){a=a.slice(0,e);break}return Ds.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${n.number}.`)}const su=Ds.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),ru=[Fc,Z.lowest(Vc),su];class ou{constructor(e,t,i){this.state=e,this.pos=t,this.explicit=i,this.abortListeners=[]}tokenBefore(e){let t=wa(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),n=t.text.slice(i-t.from,this.pos-t.from),s=n.search(uu(e,!1));return s<0?null:{from:i+s,to:this.pos,text:n.slice(s)}}get aborted(){return null==this.abortListeners}addEventListener(e,t){"abort"==e&&this.abortListeners&&this.abortListeners.push(t)}}function au(e){let t=Object.keys(e).join(""),i=/\w/.test(t);return i&&(t=t.replace(/\w/g,"")),`[${i?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function lu(e){let t=e.map((e=>"string"==typeof e?{label:e}:e)),[i,n]=t.every((e=>/^\w+$/.test(e.label)))?[/\w*$/,/\w+$/]:function(e){let t=Object.create(null),i=Object.create(null);for(let{label:n}of e){t[n[0]]=!0;for(let e=1;e<n.length;e++)i[n[e]]=!0}let n=au(t)+au(i)+"*$";return[new RegExp("^"+n),new RegExp(n)]}(t);return e=>{let s=e.matchBefore(n);return s||e.explicit?{from:s?s.from:e.pos,options:t,validFor:i}:null}}class hu{constructor(e,t,i){this.completion=e,this.source=t,this.match=i}}function cu(e){return e.selection.main.head}function uu(e,t){var i;let{source:n}=e,s=t&&"^"!=n[0],r="$"!=n[n.length-1];return s||r?new RegExp(`${s?"^":""}(?:${n})${r?"$":""}`,null!==(i=e.flags)&&void 0!==i?i:e.ignoreCase?"i":""):e}function du(e,t){const i=t.completion.apply||t.completion.label;let n=t.source;var s,r,o,a;"string"==typeof i?e.dispatch((s=e.state,r=i,o=n.from,a=n.to,Object.assign(Object.assign({},s.changeByRange((e=>{if(e==s.selection.main)return{changes:{from:o,to:a,insert:r},range:P.cursor(o+r.length)};let t=a-o;return!e.empty||t&&s.sliceDoc(e.from-t,e.from)!=s.sliceDoc(o,a)?{range:e}:{changes:{from:e.from-t,to:e.from,insert:r},range:P.cursor(e.from-t+r.length)}}))),{userEvent:"input.complete"}))):i(e,t.completion,n.from,n.to)}const fu=new WeakMap;function pu(e){if(!Array.isArray(e))return e;let t=fu.get(e);return t||fu.set(e,t=lu(e)),t}class gu{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let i=S(e,t),n=k(i);this.chars.push(i);let s=e.slice(t,t+n),r=s.toUpperCase();this.folded.push(S(r==s?s.toLowerCase():r,0)),t+=n}this.astral=e.length!=this.chars.length}match(e){if(0==this.pattern.length)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:n,precise:s,byWord:r}=this;if(1==t.length){let n=S(e,0);return n==t[0]?[0,0,k(n)]:n==i[0]?[-200,0,k(n)]:null}let o=e.indexOf(this.pattern);if(0==o)return[0,0,this.pattern.length];let a=t.length,l=0;if(o<0){for(let s=0,r=Math.min(e.length,200);s<r&&l<a;){let r=S(e,s);r!=t[l]&&r!=i[l]||(n[l++]=s),s+=k(r)}if(l<a)return null}let h=0,c=0,u=!1,d=0,f=-1,p=-1,g=/[a-z]/.test(e),m=!0;for(let n=0,l=Math.min(e.length,200),v=0;n<l&&c<a;){let l=S(e,n);o<0&&(h<a&&l==t[h]&&(s[h++]=n),d<a&&(l==t[d]||l==i[d]?(0==d&&(f=n),p=n+1,d++):d=0));let w,y=l<255?l>=48&&l<=57||l>=97&&l<=122?2:l>=65&&l<=90?1:0:(w=x(l))!=w.toLowerCase()?1:w!=w.toUpperCase()?2:0;(!n||1==y&&g||0==v&&0!=y)&&(t[c]==l||i[c]==l&&(u=!0)?r[c++]=n:r.length&&(m=!1)),v=y,n+=k(l)}return c==a&&0==r[0]&&m?this.result((u?-200:0)-100,r,e):d==a&&0==f?[-200-e.length,0,p]:o>-1?[-700-e.length,o,o+this.pattern.length]:d==a?[-900-e.length,f,p]:c==a?this.result((u?-200:0)-100-700+(m?0:-1100),r,e):2==t.length?null:this.result((n[0]?-700:0)-200-1100,n,e)}result(e,t,i){let n=[e-i.length],s=1;for(let e of t){let t=e+(this.astral?k(S(i,e)):1);s>1&&n[s-1]==e?n[s-1]=t:(n[s++]=e,n[s++]=t)}return n}}const mu=W.define({combine:e=>Me(e,{activateOnTyping:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,optionClass:(e,t)=>i=>function(e,t){return e?t?e+" "+t:e:t}(e(i),t(i)),addToOptions:(e,t)=>e.concat(t)})});function vu(e,t,i){if(e<=i)return{from:0,to:e};if(t<=e>>1){let e=Math.floor(t/i);return{from:e*i,to:(e+1)*i}}let n=Math.floor((e-t)/i);return{from:e-(n+1)*i,to:e-n*i}}class wu{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:e=>this.positionInfo(e),key:this};let i=e.state.field(t),{options:n,selected:s}=i.open,r=e.state.facet(mu);this.optionContent=function(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map((e=>"cm-completionIcon-"+e))),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,i){let n=document.createElement("span");n.className="cm-completionLabel";let{label:s}=e,r=0;for(let e=1;e<i.length;){let t=i[e++],o=i[e++];t>r&&n.appendChild(document.createTextNode(s.slice(r,t)));let a=n.appendChild(document.createElement("span"));a.appendChild(document.createTextNode(s.slice(t,o))),a.className="cm-completionMatchedText",r=o}return r<s.length&&n.appendChild(document.createTextNode(s.slice(r))),n},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort(((e,t)=>e.position-t.position)).map((e=>e.render))}(r),this.optionClass=r.optionClass,this.range=vu(n.length,s,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",(t=>{for(let i,s=t.target;s&&s!=this.dom;s=s.parentNode)if("LI"==s.nodeName&&(i=/-(\d+)$/.exec(s.id))&&+i[1]<n.length)return du(e,n[+i[1]]),void t.preventDefault()})),this.list=this.dom.appendChild(this.createListBox(n,i.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=vu(t.options.length,t.selected,this.view.state.facet(mu).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=t.options[t.selected],{info:n}=i;if(!n)return;let s="string"==typeof n?document.createTextNode(n):n(i);if(!s)return;"then"in s?s.then((t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t)})).catch((e=>Li(this.view.state,e,"completion info"))):this.addInfoPane(s)}}addInfoPane(e){let t=this.info=document.createElement("div");t.className="cm-tooltip cm-completionInfo",t.appendChild(e),this.dom.appendChild(t),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)n==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&function(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect();n.top<i.top?e.scrollTop-=i.top-n.top:n.bottom>i.bottom&&(e.scrollTop+=n.bottom-i.bottom)}(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=e.getBoundingClientRect();if(n.top>Math.min(innerHeight,t.bottom)-10||n.bottom<Math.max(0,t.top)+10)return null;let s=Math.max(0,Math.min(n.top,innerHeight-i.height))-t.top,r=this.view.textDirection==Ui.RTL,o=t.left,a=innerWidth-t.right;return r&&o<Math.min(i.width,a)?r=!1:!r&&a<Math.min(i.width,o)&&(r=!0),{top:s,left:r}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,t,i){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));for(let s=i.from;s<i.to;s++){let{completion:i,match:r}=e[s];const o=n.appendChild(document.createElement("li"));o.id=t+"-"+s,o.setAttribute("role","option");let a=this.optionClass(i);a&&(o.className=a);for(let e of this.optionContent){let t=e(i,this.view.state,r);t&&o.appendChild(t)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}}function yu(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}class bu{constructor(e,t,i,n,s){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=n,this.selected=s}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new bu(this.options,Su(t,e),this.tooltip,this.timestamp,e)}static build(e,t,i,n,s){let r=function(e,t){let i=[],n=0;for(let s of e)if(s.hasResult())if(!1===s.result.filter){let e=s.result.getMatch;for(let t of s.result.options){let r=[1e9-n++];if(e)for(let i of e(t))r.push(i);i.push(new hu(t,s,r))}}else{let e,n=new gu(t.sliceDoc(s.from,s.to));for(let t of s.result.options)(e=n.match(t.label))&&(null!=t.boost&&(e[0]+=t.boost),i.push(new hu(t,s,e)))}let s=[],r=null;for(let e of i.sort(ku))!r||r.label!=e.completion.label||r.detail!=e.completion.detail||null!=r.type&&null!=e.completion.type&&r.type!=e.completion.type||r.apply!=e.completion.apply?s.push(e):yu(e.completion)>yu(r)&&(s[s.length-1]=e),r=e.completion;return s}(e,t);if(!r.length)return null;let o=0;if(n&&n.selected){let e=n.options[n.selected].completion;for(let t=0;t<r.length;t++)if(r[t].completion==e){o=t;break}}return new bu(r,Su(i,o),{pos:e.reduce(((e,t)=>t.hasResult()?Math.min(e,t.from):e),1e8),create:(a=Iu,e=>new wu(e,a)),above:s.aboveCursor},n?n.timestamp:Date.now(),o);var a}map(e){return new bu(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class _u{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new _u(xu,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,i=t.facet(mu),n=(i.override||t.languageDataAt("autocomplete",cu(t)).map(pu)).map((t=>(this.active.find((e=>e.source==t))||new Eu(t,this.active.some((e=>0!=e.state))?1:0)).update(e,i)));n.length==this.active.length&&n.every(((e,t)=>e==this.active[t]))&&(n=this.active);let s=e.selection||n.some((t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to)))||!function(e,t){if(e==t)return!0;for(let i=0,n=0;;){for(;i<e.length&&!e[i].hasResult;)i++;for(;n<t.length&&!t[n].hasResult;)n++;let s=i==e.length,r=n==t.length;if(s||r)return s==r;if(e[i++].result!=t[n++].result)return!1}}(n,this.active)?bu.build(n,t,this.id,this.open,i):this.open&&e.docChanged?this.open.map(e.changes):this.open;!s&&n.every((e=>1!=e.state))&&n.some((e=>e.hasResult()))&&(n=n.map((e=>e.hasResult()?new Eu(e.source,0):e)));for(let t of e.effects)t.is($u)&&(s=s&&s.setSelected(t.value,this.id));return n==this.active&&s==this.open?this:new _u(n,this.id,s)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:Cu}}const Cu={"aria-autocomplete":"list"};function Su(e,t){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":e+"-"+t,"aria-controls":e}}const xu=[];function ku(e,t){let i=t.match[0]-e.match[0];return i||e.completion.label.localeCompare(t.completion.label)}function Au(e){return e.isUserEvent("input.type")?"input":e.isUserEvent("delete.backward")?"delete":null}class Eu{constructor(e,t,i=-1){this.source=e,this.state=t,this.explicitPos=i}hasResult(){return!1}update(e,t){let i=Au(e),n=this;i?n=n.handleUserEvent(e,i,t):e.docChanged?n=n.handleChange(e):e.selection&&0!=n.state&&(n=new Eu(n.source,0));for(let t of e.effects)if(t.is(Mu))n=new Eu(n.source,1,t.value?cu(e.state):-1);else if(t.is(Lu))n=new Eu(n.source,0);else if(t.is(Ru))for(let e of t.value)e.source==n.source&&(n=e);return n}handleUserEvent(e,t,i){return"delete"!=t&&i.activateOnTyping?new Eu(this.source,1):this.map(e.changes)}handleChange(e){return e.changes.touchesRange(cu(e.startState))?new Eu(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Eu(this.source,this.state,e.mapPos(this.explicitPos))}}class Tu extends Eu{constructor(e,t,i,n,s){super(e,2,t),this.result=i,this.from=n,this.to=s}hasResult(){return!0}handleUserEvent(e,t,i){var n;let s=e.changes.mapPos(this.from),r=e.changes.mapPos(this.to,1),o=cu(e.state);if((this.explicitPos<0?o<=s:o<this.from)||o>r||"delete"==t&&cu(e.startState)==this.from)return new Eu(this.source,"input"==t&&i.activateOnTyping?1:0);let a,l=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return function(e,t,i,n){if(!e)return!1;let s=t.sliceDoc(i,n);return"function"==typeof e?e(s,i,n,t):uu(e,!0).test(s)}(this.result.validFor,e.state,s,r)?new Tu(this.source,l,this.result,s,r):this.result.update&&(a=this.result.update(this.result,s,r,new ou(e.state,o,l>=0)))?new Tu(this.source,l,a,a.from,null!==(n=a.to)&&void 0!==n?n:cu(e.state)):new Eu(this.source,1,l)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Eu(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Tu(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}const Mu=me.define(),Lu=me.define(),Ru=me.define({map:(e,t)=>e.map((e=>e.map(t)))}),$u=me.define(),Iu=j.define({create:()=>_u.start(),update:(e,t)=>e.update(t),provide:e=>[Mr.from(e,(e=>e.tooltip)),Ds.contentAttributes.from(e,(e=>e.attrs))]});function Ou(e,t="option"){return i=>{let n=i.state.field(Iu,!1);if(!n||!n.open||Date.now()-n.open.timestamp<75)return!1;let s,r=1;"page"==t&&(s=Dr(i,n.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let o=n.open.selected+r*(e?1:-1),{length:a}=n.open.options;return o<0?o="page"==t?0:a-1:o>=a&&(o="page"==t?a-1:0),i.dispatch({effects:$u.of(o)}),!0}}class Du{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Nu=Oi.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let t of e.state.field(Iu).active)1==t.state&&this.startQuery(t)}update(e){let t=e.state.field(Iu);if(!e.selectionSet&&!e.docChanged&&e.startState.field(Iu)==t)return;let i=e.transactions.some((e=>(e.selection||e.docChanged)&&!Au(e)));for(let t=0;t<this.running.length;t++){let n=this.running[t];if(i||n.updates.length+e.transactions.length>50&&Date.now()-n.time>1e3){for(let e of n.context.abortListeners)try{e()}catch(e){Li(this.view.state,e)}n.context.abortListeners=null,this.running.splice(t--,1)}else n.updates.push(...e.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=t.active.some((e=>1==e.state&&!this.running.some((t=>t.active.source==e.source))))?setTimeout((()=>this.startUpdate()),50):-1,0!=this.composing)for(let t of e.transactions)"input"==Au(t)?this.composing=2:2==this.composing&&t.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:e}=this.view,t=e.field(Iu);for(let e of t.active)1!=e.state||this.running.some((t=>t.active.source==e.source))||this.startQuery(e)}startQuery(e){let{state:t}=this.view,i=cu(t),n=new ou(t,i,e.explicitPos==i),s=new Du(e,n);this.running.push(s),Promise.resolve(e.source(n)).then((e=>{s.context.aborted||(s.done=e||null,this.scheduleAccept())}),(e=>{this.view.dispatch({effects:Lu.of(null)}),Li(this.view.state,e)}))}scheduleAccept(){this.running.every((e=>void 0!==e.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),50))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],i=this.view.state.facet(mu);for(let n=0;n<this.running.length;n++){let s=this.running[n];if(void 0===s.done)continue;if(this.running.splice(n--,1),s.done){let n=new Tu(s.active.source,s.active.explicitPos,s.done,s.done.from,null!==(e=s.done.to)&&void 0!==e?e:cu(s.updates.length?s.updates[0].startState:this.view.state));for(let e of s.updates)n=n.update(e,i);if(n.hasResult()){t.push(n);continue}}let r=this.view.state.field(Iu).active.find((e=>e.source==s.active.source));if(r&&1==r.state)if(null==s.done){let e=new Eu(s.active.source,0);for(let t of s.updates)e=e.update(t,i);1!=e.state&&t.push(e)}else this.startQuery(r)}t.length&&this.view.dispatch({effects:Ru.of(t)})}},{eventHandlers:{blur(){let e=this.view.state.field(Iu,!1);e&&e.tooltip&&this.view.state.facet(mu).closeOnBlur&&this.view.dispatch({effects:Lu.of(null)})},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:Mu.of(!1)})),20),this.composing=0}}}),Pu=Ds.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});const Fu={brackets:["(","[","{","'",'"'],before:")]}:;>"},Bu=me.define({map(e,t){let i=t.mapPos(e,-1,E.TrackAfter);return null==i?void 0:i}}),Wu=me.define({map:(e,t)=>t.mapPos(e)}),Hu=new class extends Le{};Hu.startSide=1,Hu.endSide=-1;const Vu=j.define({create:()=>Oe.empty,update(e,t){if(t.selection){let i=t.state.doc.lineAt(t.selection.main.head).from,n=t.startState.doc.lineAt(t.startState.selection.main.head).from;i!=t.changes.mapPos(n,-1)&&(e=Oe.empty)}e=e.map(t.changes);for(let i of t.effects)i.is(Bu)?e=e.update({add:[Hu.range(i.value,i.value+1)]}):i.is(Wu)&&(e=e.update({filter:e=>e!=i.value}));return e}});function zu(e){for(let t=0;t<"()[]{}<>".length;t+=2)if("()[]{}<>".charCodeAt(t)==e)return"()[]{}<>".charAt(t+1);return x(e<128?e:e+1)}function Uu(e,t){return e.languageDataAt("closeBrackets",t)[0]||Fu}const qu="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),Ku=Ds.inputHandler.of(((e,t,i,n)=>{if((qu?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let s=e.state.selection.main;if(n.length>2||2==n.length&&1==k(S(n,0))||t!=s.from||i!=s.to)return!1;let r=function(e,t){let i=Uu(e,e.selection.main.head),n=i.brackets||Fu.brackets;for(let s of n){let r=zu(S(s,0));if(t==s)return r==s?Xu(e,s,n.indexOf(s+s+s)>-1):Qu(e,s,r,i.before||Fu.before);if(t==r&&Gu(e,e.selection.main.from))return Ju(e,s,r)}return null}(e.state,n);return!!r&&(e.dispatch(r),!0)})),ju=[{key:"Backspace",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=Uu(e,e.selection.main.head).brackets||Fu.brackets,n=null,s=e.changeByRange((t=>{if(t.empty){let n=function(e,t){let i=e.sliceString(t-2,t);return k(S(i,0))==i.length?i:i.slice(1)}(e.doc,t.head);for(let s of i)if(s==n&&Yu(e.doc,t.head)==zu(S(s,0)))return{changes:{from:t.head-s.length,to:t.head+s.length},range:P.cursor(t.head-s.length),userEvent:"delete.backward"}}return{range:n=t}}));return n||t(e.update(s,{scrollIntoView:!0})),!n}}];function Gu(e,t){let i=!1;return e.field(Vu).between(0,e.doc.length,(e=>{e==t&&(i=!0)})),i}function Yu(e,t){let i=e.sliceString(t,t+2);return i.slice(0,k(S(i,0)))}function Qu(e,t,i,n){let s=null,r=e.changeByRange((r=>{if(!r.empty)return{changes:[{insert:t,from:r.from},{insert:i,from:r.to}],effects:Bu.of(r.to+t.length),range:P.range(r.anchor+t.length,r.head+t.length)};let o=Yu(e.doc,r.head);return!o||/\s/.test(o)||n.indexOf(o)>-1?{changes:{insert:t+i,from:r.head},effects:Bu.of(r.head+t.length),range:P.cursor(r.head+t.length)}:{range:s=r}}));return s?null:e.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Ju(e,t,i){let n=null,s=e.selection.ranges.map((t=>t.empty&&Yu(e.doc,t.head)==i?P.cursor(t.head+i.length):n=t));return n?null:e.update({selection:P.create(s,e.selection.mainIndex),scrollIntoView:!0,effects:e.selection.ranges.map((({from:e})=>Wu.of(e)))})}function Xu(e,t,i){let n=null,s=e.changeByRange((s=>{if(!s.empty)return{changes:[{insert:t,from:s.from},{insert:t,from:s.to}],effects:Bu.of(s.to+t.length),range:P.range(s.anchor+t.length,s.head+t.length)};let r=s.head,o=Yu(e.doc,r);if(o==t){if(Zu(e,r))return{changes:{insert:t+t,from:r},effects:Bu.of(r+t.length),range:P.cursor(r+t.length)};if(Gu(e,r)){let n=i&&e.sliceDoc(r,r+3*t.length)==t+t+t;return{range:P.cursor(r+t.length*(n?3:1)),effects:Wu.of(r)}}}else{if(i&&e.sliceDoc(r-2*t.length,r)==t+t&&Zu(e,r-2*t.length))return{changes:{insert:t+t+t+t,from:r},effects:Bu.of(r+t.length),range:P.cursor(r+t.length)};if(e.charCategorizer(r)(o)!=xe.Word){let i=e.sliceDoc(r-1,r);if(i!=t&&e.charCategorizer(r)(i)!=xe.Word&&!function(e,t,i){let n=wa(e).resolveInner(t,-1);for(let s=0;s<5;s++){if(e.sliceDoc(n.from,n.from+i.length)==i)return!0;let s=n.to==t&&n.parent;if(!s)break;n=s}return!1}(e,r,t))return{changes:{insert:t+t,from:r},effects:Bu.of(r+t.length),range:P.cursor(r+t.length)}}}return{range:n=s}}));return n?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Zu(e,t){let i=wa(e).resolveInner(t+1);return i.parent&&i.from==t}const ed=[{key:"Ctrl-Space",run:e=>!!e.state.field(Iu,!1)&&(e.dispatch({effects:Mu.of(!0)}),!0)},{key:"Escape",run:e=>{let t=e.state.field(Iu,!1);return!(!t||!t.active.some((e=>0!=e.state)))&&(e.dispatch({effects:Lu.of(null)}),!0)}},{key:"ArrowDown",run:Ou(!0)},{key:"ArrowUp",run:Ou(!1)},{key:"PageDown",run:Ou(!0,"page")},{key:"PageUp",run:Ou(!1,"page")},{key:"Enter",run:e=>{let t=e.state.field(Iu,!1);return!(e.state.readOnly||!t||!t.open||Date.now()-t.open.timestamp<75)&&(du(e,t.open.options[t.open.selected]),!0)}}],td=Z.highest(Vs.computeN([mu],(e=>e.facet(mu).defaultKeymap?[ed]:[])));class id{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class nd{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let n=e,s=i.facet(vd).markerFilter;s&&(n=s(n));let r=ci.set(n.map((e=>e.from==e.to||e.from==e.to-1&&i.doc.lineAt(e.from).to==e.from?ci.widget({widget:new bd(e),diagnostic:e}).range(e.from):ci.mark({attributes:{class:"cm-lintRange cm-lintRange-"+e.severity},diagnostic:e}).range(e.from,e.to))),!0);return new nd(r,t,sd(r))}}function sd(e,t=null,i=0){let n=null;return e.between(i,1e9,((e,i,{spec:s})=>{if(!t||s.diagnostic==t)return n=new id(e,i,s.diagnostic),!1})),n}function rd(e,t){return!(!e.effects.some((e=>e.is(ad)))&&!e.changes.touchesRange(t.pos))}function od(e,t){return e.field(cd,!1)?t:t.concat(me.appendConfig.of([cd,Ds.decorations.compute([cd],(e=>{let{selected:t,panel:i}=e.field(cd);return t&&i&&t.from!=t.to?ci.set([ud.range(t.from,t.to)]):ci.none})),Or(dd,{hideOn:rd}),kd]))}const ad=me.define(),ld=me.define(),hd=me.define(),cd=j.define({create:()=>new nd(ci.none,null,null),update(e,t){if(t.docChanged){let i=e.diagnostics.map(t.changes),n=null;if(e.selected){let s=t.changes.mapPos(e.selected.from,1);n=sd(i,e.selected.diagnostic,s)||sd(i,null,s)}e=new nd(i,e.panel,n)}for(let i of t.effects)i.is(ad)?e=nd.init(i.value,e.panel,t.state):i.is(ld)?e=new nd(e.diagnostics,i.value?Cd.open:null,e.selected):i.is(hd)&&(e=new nd(e.diagnostics,e.panel,i.value));return e},provide:e=>[Vr.from(e,(e=>e.panel)),Ds.decorations.from(e,(e=>e.diagnostics))]});const ud=ci.mark({class:"cm-lintRange cm-lintRange-active"});function dd(e,t,i){let{diagnostics:n}=e.state.field(cd),s=[],r=2e8,o=0;n.between(t-(i<0?1:0),t+(i>0?1:0),((e,n,{spec:a})=>{t>=e&&t<=n&&(e==n||(t>e||i>0)&&(t<n||i<0))&&(s.push(a.diagnostic),r=Math.min(e,r),o=Math.max(n,o))}));let a=e.state.facet(vd).tooltipFilter;return a&&(s=a(s)),s.length?{pos:r,end:o,above:e.state.doc.lineAt(r).to<o,create:()=>({dom:fd(e,s)})}:null}function fd(e,t){return lc("ul",{class:"cm-tooltip-lint"},t.map((t=>yd(e,t,!1))))}const pd=e=>{let t=e.state.field(cd,!1);return!(!t||!t.panel)&&(e.dispatch({effects:ld.of(!1)}),!0)},gd=[{key:"Mod-Shift-m",run:e=>{let t=e.state.field(cd,!1);t&&t.panel||e.dispatch({effects:od(e.state,[ld.of(!0)])});let i=Fr(e,Cd.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0}},{key:"F8",run:e=>{let t=e.state.field(cd,!1);if(!t)return!1;let i=e.state.selection.main,n=t.diagnostics.iter(i.to+1);return!(!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to))&&(e.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)}}],md=Oi.fromClass(class{constructor(e){this.view=e,this.timeout=-1,this.set=!0;let{delay:t}=e.state.facet(vd);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){let e=Date.now();if(e<this.lintTime-10)setTimeout(this.run,this.lintTime-e);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(vd);Promise.all(t.map((e=>Promise.resolve(e(this.view))))).then((t=>{let i=t.reduce(((e,t)=>e.concat(t)));this.view.state.doc==e.doc&&this.view.dispatch(function(e,t){return{effects:od(e,[ad.of(t)])}}(this.view.state,i))}),(e=>{Li(this.view.state,e)}))}}update(e){let t=e.state.facet(vd);(e.docChanged||t!=e.startState.facet(vd))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),vd=W.define({combine:e=>Object.assign({sources:e.map((e=>e.source))},Me(e.map((e=>e.config)),{delay:750,markerFilter:null,tooltipFilter:null})),enables:md});function wd(e){let t=[];if(e)e:for(let{name:i}of e){for(let e=0;e<i.length;e++){let n=i[e];if(/[a-zA-Z]/.test(n)&&!t.some((e=>e.toLowerCase()==n.toLowerCase()))){t.push(n);continue e}}t.push("")}return t}function yd(e,t,i){var n;let s=i?wd(t.actions):[];return lc("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},lc("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage():t.message),null===(n=t.actions)||void 0===n?void 0:n.map(((i,n)=>{let r=n=>{n.preventDefault();let s=sd(e.state.field(cd).diagnostics,t);s&&i.apply(e,s.from,s.to)},{name:o}=i,a=s[n]?o.indexOf(s[n]):-1,l=a<0?o:[o.slice(0,a),lc("u",o.slice(a,a+1)),o.slice(a+1)];return lc("button",{type:"button",class:"cm-diagnosticAction",onclick:r,onmousedown:r,"aria-label":` Action: ${o}${a<0?"":` (access key "${s[n]})"`}.`},l)})),t.source&&lc("div",{class:"cm-diagnosticSource"},t.source))}class bd extends li{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return lc("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class _d{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=yd(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class Cd{constructor(e){this.view=e,this.items=[];this.list=lc("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t=>{if(27==t.keyCode)pd(this.view),this.view.focus();else if(38==t.keyCode||33==t.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==t.keyCode||34==t.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==t.keyCode)this.moveSelection(0);else if(35==t.keyCode)this.moveSelection(this.items.length-1);else if(13==t.keyCode)this.view.focus();else{if(!(t.keyCode>=65&&t.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],n=wd(i.actions);for(let s=0;s<n.length;s++)if(n[s].toUpperCase().charCodeAt(0)==t.keyCode){let t=sd(this.view.state.field(cd).diagnostics,i);t&&i.actions[s].apply(e,t.from,t.to)}}}t.preventDefault()},onclick:e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)}}),this.dom=lc("div",{class:"cm-panel-lint"},this.list,lc("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>pd(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(cd).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(cd),i=0,n=!1,s=null;for(e.between(0,this.view.state.doc.length,((e,r,{spec:o})=>{let a,l=-1;for(let e=i;e<this.items.length;e++)if(this.items[e].diagnostic==o.diagnostic){l=e;break}l<0?(a=new _d(this.view,o.diagnostic),this.items.splice(i,0,a),n=!0):(a=this.items[l],l>i&&(this.items.splice(i,l-i),n=!0)),t&&a.diagnostic==t.diagnostic?a.dom.hasAttribute("aria-selected")||(a.dom.setAttribute("aria-selected","true"),s=a):a.dom.hasAttribute("aria-selected")&&a.dom.removeAttribute("aria-selected"),i++}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();0==this.items.length&&(this.items.push(new _d(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:e,panel:t})=>{e.top<t.top?this.list.scrollTop-=t.top-e.top:e.bottom>t.bottom&&(this.list.scrollTop+=e.bottom-t.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let t=e;e=t.nextSibling,t.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=sd(this.view.state.field(cd).diagnostics,this.items[e].diagnostic);t&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:hd.of(t)})}static open(e){return new Cd(e)}}function Sd(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}function xd(e){return Sd(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const kd=Ds.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:xd("#d11")},".cm-lintRange-warning":{backgroundImage:xd("orange")},".cm-lintRange-info":{backgroundImage:xd("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});const Ad=[function(e={}){return[no.of(e),Yr(),oo]}(),function(){return ho}(),pr(),zl(),function(e={}){let t=Object.assign(Object.assign({},rl),e),i=new ol(t,!0),n=new ol(t,!1),s=Oi.fromClass(class{constructor(e){this.from=e.viewport.from,this.markers=this.buildMarkers(e)}update(e){(e.docChanged||e.viewportChanged||e.startState.facet(Ea)!=e.state.facet(Ea)||e.startState.field(Ya,!1)!=e.state.field(Ya,!1)||wa(e.startState)!=wa(e.state)||t.foldingChanged(e))&&(this.markers=this.buildMarkers(e.view))}buildMarkers(e){let t=new De;for(let s of e.viewportLineBlocks){let r=Qa(e.state,s.from,s.to)?n:Ua(e.state,s.from,s.to)?i:null;r&&t.add(s.from,s.from,r)}return t.finish()}}),{domEventHandlers:r}=t;return[s,jr({class:"cm-foldGutter",markers(e){var t;return(null===(t=e.plugin(s))||void 0===t?void 0:t.markers)||Oe.empty},initialSpacer:()=>new ol(t,!1),domEventHandlers:Object.assign(Object.assign({},r),{click:(e,t,i)=>{if(r.click&&r.click(e,t,i))return!0;let n=Qa(e.state,t.from,t.to);if(n)return e.dispatch({effects:ja.of(n)}),!0;let s=Ua(e.state,t.from,t.to);return!!s&&(e.dispatch({effects:Ka.of(s)}),!0)}})}),nl()]}(),Ys(),function(){return[rr,or]}(),Te.allowMultipleSelections.of(!0),function(){return Te.transactionFilter.of((e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let i=e.newDoc,{head:n}=e.newSelection.main,s=i.lineAt(n);if(n>s.from+200)return e;let r=i.sliceString(s.from,n);if(!t.some((e=>e.test(r))))return e;let{state:o}=e,a=-1,l=[];for(let{head:e}of o.selection.ranges){let t=o.doc.lineAt(e);if(t.from==a)continue;a=t.from;let i=$a(o,t.from);if(null==i)continue;let n=/^\s*/.exec(t.text)[0],s=Ra(o,i);n!=s&&l.push({from:t.from,to:t.from+n.length,insert:s})}return l.length?[e,{changes:l,sequential:!0}]:e}))}(),dl(gl,{fallback:!0}),function(e={}){return[vl.of(e),_l]}(),function(){return[Ku,Vu]}(),function(e={}){return[Iu,mu.of(e),Nu,td,Pu]}(),function(e){let t=(null==e?void 0:e.eventFilter)||(e=>e.altKey&&0==e.button);return Ds.mouseSelectionStyle.of(((e,i)=>t(i)?_r(e,i):null))}(),function(e={}){let[t,i]=Cr[e.key||"Alt"],n=Oi.fromClass(class{constructor(e){this.view=e,this.isDown=!1}set(e){this.isDown!=e&&(this.isDown=e,this.view.update([]))}},{eventHandlers:{keydown(e){this.set(e.keyCode==t||i(e))},keyup(e){e.keyCode!=t&&i(e)||this.set(!1)}}});return[n,Ds.contentAttributes.of((e=>{var t;return(null===(t=e.plugin(n))||void 0===t?void 0:t.isDown)?Sr:null}))]}(),function(){return yr}(),function(e){let t=[Tc,Ec];return e&&t.push(Sc.of(e)),t}(),Vs.of([...ju,...ac,...Zc,...rh,...el,...ed,...gd])];var Ed=r("jevmL");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Td=!1,Md=!1,Ld="${JSCORE_VERSION}",Rd=function(e,t){if(!e)throw $d(t)},$d=function(e){return new Error("Firebase Database ("+Ld+") INTERNAL ASSERT FAILED: "+e)},Id=function(e){const t=[];let i=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=63&s|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=63&s|128)}return t},Od={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=s>>2,c=(3&s)<<4|o>>4;let u=(15&o)<<2|l>>6,d=63&l;a||(d=64,r||(u=64)),n.push(i[h],i[c],i[u],i[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Id(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let i=0,n=0;for(;i<e.length;){const s=e[i++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[i++];t[n++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++])-65536;t[n++]=String.fromCharCode(55296+(r>>10)),t[n++]=String.fromCharCode(56320+(1023&r))}else{const r=e[i++],o=e[i++];t[n++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){const s=i[e.charAt(t++)],r=t<e.length?i[e.charAt(t)]:0;++t;const o=t<e.length?i[e.charAt(t)]:64;++t;const a=t<e.length?i[e.charAt(t)]:64;if(++t,null==s||null==r||null==o||null==a)throw Error();const l=s<<2|r>>4;if(n.push(l),64!==o){const e=r<<4&240|o>>2;if(n.push(e),64!==a){const e=o<<6&192|a;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Dd=function(e){const t=Id(e);return Od.encodeByteArray(t,!0)},Nd=function(e){return Dd(e).replace(/\./g,"")},Pd=function(e){try{return Od.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fd(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const i in t)t.hasOwnProperty(i)&&"__proto__"!==i&&(e[i]=Fd(e[i],t[i]));return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Bd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,i))}}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=t||"demo-project",n=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Nd(JSON.stringify({alg:"none",type:"JWT"})),Nd(JSON.stringify(r)),""].join(".")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Vd(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Hd())}function zd(){return!0===Td||!0===Md}class Ud extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Ud.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qd.prototype.create)}}class qd{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},n=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(Kd,((e,i)=>{const n=t[i];return null!=n?String(n):`<${i}?>`}))}(s,i):"Error",o=`${this.serviceName}: ${r} (${n}).`;return new Ud(n,o,i)}}const Kd=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(e){return JSON.parse(e)}function Gd(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yd=function(e){let t={},i={},n={},s="";try{const r=e.split(".");t=jd(Pd(r[0])||""),i=jd(Pd(r[1])||""),s=r[2],n=i.d||{},delete i.d}catch(e){}return{header:t,claims:i,data:n,signature:s}},Qd=function(e){const t=Yd(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},Jd=function(e){const t=Yd(e).claims;return"object"==typeof t&&!0===t.admin};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Xd(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Zd(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ef(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function tf(e,t,i){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=t.call(i,e[s],s,e));return n}function nf(e,t){if(e===t)return!0;const i=Object.keys(e),n=Object.keys(t);for(const s of i){if(!n.includes(s))return!1;const i=e[s],r=t[s];if(sf(i)&&sf(r)){if(!nf(i,r))return!1}else if(i!==r)return!1}for(const e of n)if(!i.includes(e))return!1;return!0}function sf(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(e){const t=[];for(const[i,n]of Object.entries(e))Array.isArray(n)?n.forEach((e=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(i)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class of{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=4294967295&(t<<1|t>>>31)}let n,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),s=1518500249):(n=o^a^l,s=1859775393):e<60?(n=o&a|l&(o|a),s=2400959708):(n=o^a^l,s=3395469782);const t=(r<<5|r>>>27)+n+h+s+i[e]&4294967295;h=l,l=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const i=t-this.blockSize;let n=0;const s=this.buf_;let r=this.inbuf_;for(;n<t;){if(0===r)for(;n<=i;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(s[r]=e.charCodeAt(n),++r,++n,r===this.blockSize){this.compress_(s),r=0;break}}else for(;n<t;)if(s[r]=e[n],++r,++n,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let i=0;for(let t=0;t<5;t++)for(let n=24;n>=0;n-=8)e[i]=this.chain_[t]>>n&255,++i;return e}}function af(e,t){const i=new lf(e,t);return i.subscribe.bind(i)}class lf{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,i){let n;if(void 0===e&&void 0===t&&void 0===i)throw new Error("Missing Observer.");n=function(e,t){if("object"!=typeof e||null===e)return!1;for(const i of t)if(i in e&&"function"==typeof e[i])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:i},void 0===n.next&&(n.next=hf),void 0===n.error&&(n.error=hf),void 0===n.complete&&(n.complete=hf);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}})),this.observers.push(n),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function hf(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cf=function(e,t,i,n){let s;if(n<t?s="at least "+t:n>i&&(s=0===i?"none":"no more than "+i),s){throw new Error(e+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+s+".")}};function uf(e,t){return`${e} failed: ${t} argument `}function df(e,t,i,n){if((!n||i)&&"function"!=typeof i)throw new Error(uf(e,t)+"must be a valid function.")}function ff(e,t,i,n){if((!n||i)&&("object"!=typeof i||null===i))throw new Error(uf(e,t)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pf=function(e){const t=[];let i=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(s>=55296&&s<=56319){const t=s-55296;n++,Rd(n<e.length,"Surrogate pair missing trail surrogate.");s=65536+(t<<10)+(e.charCodeAt(n)-56320)}s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=63&s|128):s<65536?(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=63&s|128):(t[i++]=s>>18|240,t[i++]=s>>12&63|128,t[i++]=s>>6&63|128,t[i++]=63&s|128)}return t},gf=function(e){let t=0;for(let i=0;i<e.length;i++){const n=e.charCodeAt(i);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,i++):t+=3}return t};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function mf(e){return e&&e._delegate?e._delegate:e}class vf{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class wf{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Bd;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&e.resolve(i)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[e,t]of this.instancesDeferred.entries()){i===this.normalizeInstanceIdentifier(e)&&t.resolve(n)}return n}onInit(e,t){var i;const n=this.normalizeInstanceIdentifier(t),s=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;s.add(e),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&e(r,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const n of i)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,"[DEFAULT]"===n?void 0:n),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}var n;return i||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:"[DEFAULT]":e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class yf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wf(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var bf={};i(bf,"_DEFAULT_ENTRY_NAME",(()=>Yf)),i(bf,"_apps",(()=>Jf)),i(bf,"_components",(()=>Xf)),i(bf,"_addComponent",(()=>Zf)),i(bf,"_addOrOverwriteComponent",(()=>ep)),i(bf,"_registerComponent",(()=>tp)),i(bf,"_getProvider",(()=>ip)),i(bf,"_removeServiceInstance",(()=>np)),i(bf,"_clearComponents",(()=>sp)),i(bf,"SDK_VERSION",(()=>ap)),i(bf,"initializeApp",(()=>lp)),i(bf,"getApp",(()=>hp)),i(bf,"getApps",(()=>cp)),i(bf,"deleteApp",(()=>up)),i(bf,"registerVersion",(()=>dp)),i(bf,"onLog",(()=>fp)),i(bf,"setLogLevel",(()=>pp)),i(bf,"FirebaseError",(()=>Ud));
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _f=[];var Cf,Sf;(Sf=Cf||(Cf={}))[Sf.DEBUG=0]="DEBUG",Sf[Sf.VERBOSE=1]="VERBOSE",Sf[Sf.INFO=2]="INFO",Sf[Sf.WARN=3]="WARN",Sf[Sf.ERROR=4]="ERROR",Sf[Sf.SILENT=5]="SILENT";const xf={debug:Cf.DEBUG,verbose:Cf.VERBOSE,info:Cf.INFO,warn:Cf.WARN,error:Cf.ERROR,silent:Cf.SILENT},kf=Cf.INFO,Af={[Cf.DEBUG]:"log",[Cf.VERBOSE]:"log",[Cf.INFO]:"info",[Cf.WARN]:"warn",[Cf.ERROR]:"error"},Ef=(e,t,...i)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),s=Af[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${n}]  ${e.name}:`,...i)};class Tf{constructor(e){this.name=e,this._logLevel=kf,this._logHandler=Ef,this._userLogHandler=null,_f.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Cf))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?xf[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Cf.DEBUG,...e),this._logHandler(this,Cf.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Cf.VERBOSE,...e),this._logHandler(this,Cf.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Cf.INFO,...e),this._logHandler(this,Cf.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Cf.WARN,...e),this._logHandler(this,Cf.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Cf.ERROR,...e),this._logHandler(this,Cf.ERROR,...e)}}function Mf(e,t){for(const i of _f){let n=null;t&&t.level&&(n=xf[t.level]),i.userLogHandler=null===e?null:(t,i,...s)=>{const r=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");i>=(null!=n?n:t.logLevel)&&e({level:Cf[i].toLowerCase(),message:r,args:s,type:t.name})}}}let Lf,Rf;const $f=new WeakMap,If=new WeakMap,Of=new WeakMap,Df=new WeakMap,Nf=new WeakMap;let Pf={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return If.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Of.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Wf(e[t])},set:(e,t,i)=>(e[t]=i,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ff(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Rf||(Rf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Hf(this),t),Wf($f.get(this))}:function(...t){return Wf(e.apply(Hf(this),t))}:function(t,...i){const n=e.call(Hf(this),t,...i);return Of.set(n,t.sort?t.sort():[t]),Wf(n)}}function Bf(e){return"function"==typeof e?Ff(e):(e instanceof IDBTransaction&&function(e){if(If.has(e))return;const t=new Promise(((t,i)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),n()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));If.set(e,t)}(e),t=e,(Lf||(Lf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,Pf):e);var t}function Wf(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,i)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(Wf(e.result)),n()},r=()=>{i(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&$f.set(t,e)})).catch((()=>{})),Nf.set(t,e),t}(e);if(Df.has(e))return Df.get(e);const t=Bf(e);return t!==e&&(Df.set(e,t),Nf.set(t,e)),t}const Hf=e=>Nf.get(e);function Vf(e,t,{blocked:i,upgrade:n,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=Wf(o);return n&&o.addEventListener("upgradeneeded",(e=>{n(Wf(o.result),e.oldVersion,e.newVersion,Wf(o.transaction))})),i&&o.addEventListener("blocked",(()=>i())),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}const zf=["get","getKey","getAll","getAllKeys","count"],Uf=["put","add","delete","clear"],qf=new Map;function Kf(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(qf.get(t))return qf.get(t);const i=t.replace(/FromIndex$/,""),n=t!==i,s=Uf.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!zf.includes(i))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[i](...t),s&&r.done]))[0]};return qf.set(t,r),r}Pf=(e=>({...e,get:(t,i,n)=>Kf(t,i)||e.get(t,i,n),has:(t,i)=>!!Kf(t,i)||e.has(t,i)}))(Pf);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class jf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Gf=new Tf("@firebase/app"),Yf="[DEFAULT]",Qf={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Jf=new Map,Xf=new Map;function Zf(e,t){try{e.container.addComponent(t)}catch(i){Gf.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,i)}}function ep(e,t){e.container.addOrOverwriteComponent(t)}function tp(e){const t=e.name;if(Xf.has(t))return Gf.debug(`There were multiple attempts to register component ${t}.`),!1;Xf.set(t,e);for(const t of Jf.values())Zf(t,e);return!0}function ip(e,t){const i=e.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),e.container.getProvider(t)}function np(e,t,i=Yf){ip(e,t).clearInstance(i)}function sp(){Xf.clear()}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp=new qd("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class op{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new vf("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw rp.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="9.8.3";function lp(e,t={}){if("object"!=typeof t){t={name:t}}const i=Object.assign({name:Yf,automaticDataCollectionEnabled:!1},t),n=i.name;if("string"!=typeof n||!n)throw rp.create("bad-app-name",{appName:String(n)});const s=Jf.get(n);if(s){if(nf(e,s.options)&&nf(i,s.config))return s;throw rp.create("duplicate-app",{appName:n})}const r=new yf(n);for(const e of Xf.values())r.addComponent(e);const o=new op(e,i,r);return Jf.set(n,o),o}function hp(e=Yf){const t=Jf.get(e);if(!t)throw rp.create("no-app",{appName:e});return t}function cp(){return Array.from(Jf.values())}async function up(e){const t=e.name;Jf.has(t)&&(Jf.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function dp(e,t,i){var n;let s=null!==(n=Qf[e])&&void 0!==n?n:e;i&&(s+=`-${i}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Gf.warn(e.join(" "))}tp(new vf(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}function fp(e,t){if(null!==e&&"function"!=typeof e)throw rp.create("invalid-log-argument");Mf(e,t)}function pp(e){var t;t=e,_f.forEach((e=>{e.setLogLevel(t)}))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gp=null;function mp(){return gp||(gp=Vf("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore("firebase-heartbeat-store")}}).catch((e=>{throw rp.create("storage-open",{originalErrorMessage:e.message})}))),gp}async function vp(e,t){var i;try{const i=(await mp()).transaction("firebase-heartbeat-store","readwrite"),n=i.objectStore("firebase-heartbeat-store");return await n.put(t,wp(e)),i.done}catch(e){throw rp.create("storage-set",{originalErrorMessage:null===(i=e)||void 0===i?void 0:i.message})}}function wp(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _p(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=bp();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=bp(),{heartbeatsToSend:t,unsentEntries:i}=function(e,t=1024){const i=[];let n=e.slice();for(const s of e){const e=i.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Cp(i)>t){e.dates.pop();break}}else if(i.push({agent:s.agent,dates:[s.date]}),Cp(i)>t){i.pop();break}n=n.slice(1)}return{heartbeatsToSend:i,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=Nd(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}}function bp(){return(new Date).toISOString().substring(0,10)}class _p{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return"object"==typeof indexedDB&&new Promise(((e,t)=>{try{let i=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),i||self.indexedDB.deleteDatabase(n),e(!0)},s.onupgradeneeded=()=>{i=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){var t;try{return(await mp()).transaction("firebase-heartbeat-store").objectStore("firebase-heartbeat-store").get(wp(e))}catch(e){throw rp.create("storage-get",{originalErrorMessage:null===(t=e)||void 0===t?void 0:t.message})}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return vp(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return vp(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}}}function Cp(e){return Nd(JSON.stringify({version:2,heartbeats:e})).length}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sp;Sp="",tp(new vf("platform-logger",(e=>new jf(e)),"PRIVATE")),tp(new vf("heartbeat",(e=>new yp(e)),"PRIVATE")),dp("@firebase/app","0.7.26",Sp),dp("@firebase/app","0.7.26","esm2017"),dp("fire-js","");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class xp{constructor(e,t){this._delegate=e,this.firebase=t,Zf(e,new vf("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),up(this._delegate))))}_getService(e,t=Yf){var i;this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(i=n.getComponent())||void 0===i?void 0:i.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=Yf){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Zf(this._delegate,e)}_addOrOverwriteComponent(e){ep(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp=new qd("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});const Ap=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function e(){const t=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){const t={},i={__esModule:!0,initializeApp:function(n,s={}){const r=lp(n,s);if(Xd(t,r.name))return t[r.name];const o=new e(r,i);return t[r.name]=o,o},app:n,registerVersion:dp,setLogLevel:pp,onLog:fp,apps:null,SDK_VERSION:ap,INTERNAL:{registerComponent:function(t){const s=t.name,r=s.replace("-compat","");if(tp(t)&&"PUBLIC"===t.type){const o=(e=n())=>{if("function"!=typeof e[r])throw kp.create("invalid-app-argument",{appName:s});return e[r]()};void 0!==t.serviceProps&&Fd(o,t.serviceProps),i[r]=o,e.prototype[r]=function(...e){return this._getService.bind(this,s).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?i[r]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:bf}};function n(e){if(!Xd(t,e=e||Yf))throw kp.create("no-app",{appName:e});return t[e]}return i.default=i,Object.defineProperty(i,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),n.App=e,i}(xp);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Fd(t,e)},createSubscribe:af,ErrorFactory:qd,deepExtend:Fd}),t}(),Ep=new Tf("@firebase/app-compat");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ep.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Ep.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Tp=Ap;!
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){dp("@firebase/app-compat","0.1.27",e)}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Tp.registerVersion("firebase","9.8.3","app-compat");var Mp={};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lp="";function Rp(e){Lp=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Gd(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:jd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Xd(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new $p(t)}}catch(e){}return new Ip},Dp=Op("localStorage"),Np=Op("sessionStorage"),Pp=new Tf("@firebase/database"),Fp=function(){let e=1;return function(){return e++}}(),Bp=function(e){const t=pf(e),i=new of;i.update(t);const n=i.digest();return Od.encodeByteArray(n)},Wp=function(...e){let t="";for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=Wp.apply(null,n):t+="object"==typeof n?Gd(n):n,t+=" "}return t};let Hp=null,Vp=!0;const zp=function(e,t){Rd(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Pp.logLevel=Cf.VERBOSE,Hp=Pp.log.bind(Pp),t&&Np.set("logging_enabled",!0)):"function"==typeof e?Hp=e:(Hp=null,Np.remove("logging_enabled"))},Up=function(...e){if(!0===Vp&&(Vp=!1,null===Hp&&!0===Np.get("logging_enabled")&&zp(!0)),Hp){const t=Wp.apply(null,e);Hp(t)}},qp=function(e){return function(...t){Up(e,...t)}},Kp=function(...e){const t="FIREBASE INTERNAL ERROR: "+Wp(...e);Pp.error(t)},jp=function(...e){const t=`FIREBASE FATAL ERROR: ${Wp(...e)}`;throw Pp.error(t),new Error(t)},Gp=function(...e){const t="FIREBASE WARNING: "+Wp(...e);Pp.warn(t)},Yp=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Qp=function(e,t){if(e===t)return 0;if("[MIN_NAME]"===e||"[MAX_NAME]"===t)return-1;if("[MIN_NAME]"===t||"[MAX_NAME]"===e)return 1;{const i=sg(e),n=sg(t);return null!==i?null!==n?i-n==0?e.length-t.length:i-n:-1:null!==n?1:e<t?-1:1}},Jp=function(e,t){return e===t?0:e<t?-1:1},Xp=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Gd(t))},Zp=function(e){if("object"!=typeof e||null===e)return Gd(e);const t=[];for(const i in e)t.push(i);t.sort();let i="{";for(let n=0;n<t.length;n++)0!==n&&(i+=","),i+=Gd(t[n]),i+=":",i+=Zp(e[t[n]]);return i+="}",i},eg=function(e,t){const i=e.length;if(i<=t)return[e];const n=[];for(let s=0;s<i;s+=t)s+t>i?n.push(e.substring(s,i)):n.push(e.substring(s,s+t));return n};function tg(e,t){for(const i in e)e.hasOwnProperty(i)&&t(i,e[i])}const ig=function(e){Rd(!Yp(e),"Invalid JSON number");const t=1023;let i,n,s,r,o;0===e?(n=0,s=0,i=1/e==-1/0?1:0):(i=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),t),n=r+t,s=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(n=0,s=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(i?1:0),a.reverse();const l=a.join("");let h="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()};const ng=new RegExp("^-?(0*)\\d{1,10}$"),sg=function(e){if(ng.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},rg=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw Gp("Exception was thrown by user callback.",t),e}),Math.floor(0))}},og=function(e,t){const i=setTimeout(e,t);return"object"==typeof i&&i.unref&&i.unref(),i};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ag{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,i)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,i):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Gp(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(Up("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,i)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,i):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Gp(e)}}class hg{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}hg.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const cg=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ug{constructor(e,t,i,n,s=!1,r="",o=!1){this.secure=t,this.namespace=i,this.webSocketOnly=n,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Dp.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Dp.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function dg(e,t,i){let n;if(Rd("string"==typeof t,"typeof type must == string"),Rd("object"==typeof i,"typeof params must == object"),"websocket"===t)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(i.ns=e.namespace);const s=[];return tg(i,((e,t)=>{s.push(e+"="+t)})),n+s.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(){this.counters_={}}incrementCounter(e,t=1){Xd(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Fd(void 0,this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg={},gg={};function mg(e){const t=e.toString();return pg[t]||(pg[t]=new fg),pg[t]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class vg{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&rg((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t,i,n,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=n,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=qp(e),this.stats_=mg(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),dg(t,"long_polling",e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new vg(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(zd()||"complete"===document.readyState)e();else{let t=!1;const i=function(){document.body?t||(t=!0,e()):setTimeout(i,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&i()})),window.attachEvent("onload",i))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new yg(((...e)=>{const[t,i,n,s,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=i,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);i?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(i,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,i]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,i)}),(()=>{this.onClosed_()}),this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&cg.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){wg.forceAllow_=!0}static forceDisallow(){wg.forceDisallow_=!0}static isAvailable(){return!zd()&&(!!wg.forceAllow_||!(wg.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Gd(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Dd(t),n=eg(i,1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(zd())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Gd(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class yg{constructor(e,t,i,n){if(this.onDisconnect=i,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,zd())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Fp(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=yg.createIFrame_();let i="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){i='<script>document.domain="'+document.domain+'";<\/script>'}const n="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){Up("frame writing exception"),e.stack&&Up(e.stack),Up(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Up("No IE domain setting required")}catch(t){const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",n=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+i.length<=1870))break;{const e=this.pendingSegs.shift();i=i+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(i,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(n),i()}))}addTag(e,t){zd()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const e=i.readyState;e&&"loaded"!==e&&"complete"!==e||(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Up("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch(e){}}),Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bg=null;"undefined"!=typeof MozWebSocket?bg=MozWebSocket:"undefined"!=typeof WebSocket&&(bg=WebSocket);class _g{constructor(e,t,i,n,s,r,o){this.connId=e,this.applicationId=i,this.appCheckToken=n,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=qp(this.connId),this.stats_=mg(t),this.connURL=_g.connectionURL_(t,r,o,n,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,n,s){const r={v:"5"};return!zd()&&"undefined"!=typeof location&&location.hostname&&cg.test(location.hostname)&&(r.r="f"),t&&(r.s=t),i&&(r.ls=i),n&&(r.ac=n),s&&(r.p=s),dg(e,"websocket",r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Dp.set("previous_websocket_failure",!0);try{let e;if(zd()){const e=this.nodeAdmin?"AdminNode":"Node",t={headers:{"User-Agent":`Firebase/5/${Lp}/${Mp.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const i={},n=0===this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;n&&(t.proxy={origin:n})}this.mySock=new bg(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){_g.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&null!==bg&&!_g.forceDisallow_}static previouslyFailed(){return Dp.isInMemoryStorage||!0===Dp.get("previous_websocket_failure")}markConnectionHealthy(){Dp.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=jd(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Rd(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Gd(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=eg(t,16384);i.length>1&&this.sendString_(String(i.length));for(let e=0;e<i.length;e++)this.sendString_(i[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}_g.responsesRequiredToBeHealthy=2,_g.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Cg{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[wg,_g]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=_g&&_g.isAvailable();let i=t&&!_g.previouslyFailed();if(e.webSocketOnly&&(t||Gp("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[_g];else{const e=this.transports_=[];for(const t of Cg.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);Cg.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Cg.globalTransportInitialized_=!1;class Sg{constructor(e,t,i,n,s,r,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=n,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=qp("c:"+this.id+":"),this.transportManager_=new Cg(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,i)}),Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=og((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Xp("t",e),i=Xp("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Xp("t",e),i=Xp("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Xp("t",e);if("d"in e){const i=e.d;if("h"===t)this.onHandshake_(i);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Kp("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Kp("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&Gp("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),og((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):og((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Dp.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{put(e,t,i,n){}merge(e,t,i,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e){this.allowedEvents_=e,this.listeners_={},Rd(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let e=0;e<i.length;e++)i[e].callback.apply(i[e].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const n=this.getInitialEvent(e);n&&t.apply(i,n)}off(e,t,i){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let e=0;e<n.length;e++)if(n[e].callback===t&&(!i||i===n[e].context))return void n.splice(e,1)}validateEventType_(e){Rd(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag extends kg{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Vd()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Ag}getInitialEvent(e){return Rd("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Tg(){return new Eg("")}function Mg(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Lg(e){return e.pieces_.length-e.pieceNum_}function Rg(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Eg(e.pieces_,t)}function $g(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ig(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Og(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let i=e.pieceNum_;i<e.pieces_.length-1;i++)t.push(e.pieces_[i]);return new Eg(t,0)}function Dg(e,t){const i=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)i.push(e.pieces_[t]);if(t instanceof Eg)for(let e=t.pieceNum_;e<t.pieces_.length;e++)i.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&i.push(e[t])}return new Eg(i,0)}function Ng(e){return e.pieceNum_>=e.pieces_.length}function Pg(e,t){const i=Mg(e),n=Mg(t);if(null===i)return t;if(i===n)return Pg(Rg(e),Rg(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Fg(e,t){const i=Ig(e,0),n=Ig(t,0);for(let e=0;e<i.length&&e<n.length;e++){const t=Qp(i[e],n[e]);if(0!==t)return t}return i.length===n.length?0:i.length<n.length?-1:1}function Bg(e,t){if(Lg(e)!==Lg(t))return!1;for(let i=e.pieceNum_,n=t.pieceNum_;i<=e.pieces_.length;i++,n++)if(e.pieces_[i]!==t.pieces_[n])return!1;return!0}function Wg(e,t){let i=e.pieceNum_,n=t.pieceNum_;if(Lg(e)>Lg(t))return!1;for(;i<e.pieces_.length;){if(e.pieces_[i]!==t.pieces_[n])return!1;++i,++n}return!0}class Hg{constructor(e,t){this.errorPrefix_=t,this.parts_=Ig(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=gf(this.parts_[e]);Vg(this)}}function Vg(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+zg(e))}function zg(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug extends kg{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Ug}getInitialEvent(e){return Rd("visible"===e,"Unknown event type: "+e),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg extends xg{constructor(e,t,i,n,s,r,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=n,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=qg.nextPersistentConnectionId_++,this.log_=qp("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!zd())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ug.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Ag.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const n=++this.requestNumber_,s={r:n,a:e,b:t};this.log_(Gd(s)),Rd(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[n]=i)}get(e){this.initConnection_();const t=new Bd,i={p:e._path.toString(),q:e._queryObject},n={action:"g",request:i,onComplete:e=>{const n=e.d;"ok"===e.s?(this.onDataUpdate_(i.p,n,!1,null),t.resolve(n)):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_||setTimeout((()=>{const e=this.outstandingGets_[s];void 0!==e&&n===e&&(delete this.outstandingGets_[s],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+s+" timed out on connection"),t.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(s),t.promise}listen(e,t,i,n){this.initConnection_();const s=e._queryIdentifier,r=e._path.toString();this.log_("Listen called for "+r+" "+s),this.listens.has(r)||this.listens.set(r,new Map),Rd(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Rd(!this.listens.get(r).has(s),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:t,query:e,tag:i};this.listens.get(r).set(s,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)}))}sendListen_(e){const t=e.query,i=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+i+" for "+n);const s={p:i};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;qg.warnOnListenWarnings_(r,t);(this.listens.get(i)&&this.listens.get(i).get(n))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(i,n),e.onComplete&&e.onComplete(o,r))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Xd(e,"w")){const i=Zd(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Gp(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||Jd(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Qd(e)?"auth":"gauth",i={cred:e};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(t,i,(t=>{const i=t.s,n=t.d||"error";this.authToken_===e&&("ok"===i?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,n))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,i=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)}))}unlisten(e,t){const i=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+n),Rd(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(i,n)&&this.connected_&&this.sendUnlisten_(i,n,e._queryObject,t)}sendUnlisten_(e,t,i,n){this.log_("Unlisten on "+e+" for "+t);const s={p:e};n&&(s.q=i,s.t=n),this.sendRequest("n",s)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,n){const s={p:t,d:i};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,(e=>{n&&setTimeout((()=>{n(e.s,e.d)}),Math.floor(0))}))}put(e,t,i,n){this.putInternal("p",e,t,i,n)}merge(e,t,i,n){this.putInternal("m",e,t,i,n)}putInternal(e,t,i,n,s){this.initConnection_();const r={p:t,d:i};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,(i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(i.s,i.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Gd(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Kp("Unrecognized action received from server: "+Gd(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Rd(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+qg.nextConnectionId_++,s=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,i())},l=function(e){Rd(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);r?Up("getToken() completed but was canceled"):(Up("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new Sg(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,(e=>{Gp(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),s))}catch(e){this.log_("Failed to get token: "+e),r||(this.repoInfo_.nodeAdmin&&Gp(e),a())}}}interrupt(e){Up("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Up("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ef(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;i=t?t.map((e=>Zp(e))).join("$"):"default";const n=this.removeListen_(e,i);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){const i=new Eg(e).toString();let n;if(this.listens.has(i)){const e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){Up("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Up("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";zd()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Lp.replace(/\./g,"-")]=1,Vd()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Ag.getInstance().currentlyOnline();return ef(this.interruptReasons_)&&e}}qg.nextPersistentConnectionId_=0,qg.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Kg{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Kg(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new Kg("[MIN_NAME]",e),n=new Kg("[MIN_NAME]",t);return 0!==this.compare(i,n)}minPost(){return Kg.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gg;class Yg extends jg{static get __EMPTY_NODE(){return Gg}static set __EMPTY_NODE(e){Gg=e}compare(e,t){return Qp(e.name,t.name)}isDefinedOn(e){throw $d("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Kg.MIN}maxPost(){return new Kg("[MAX_NAME]",Gg)}makePost(e,t){return Rd("string"==typeof e,"KeyIndex indexValue must always be a string."),new Kg(e,Gg)}toString(){return".key"}}const Qg=new Yg;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,t,i,n,s=null){this.isReverse_=n,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?i(e.key,t):1,n&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Xg{constructor(e,t,i,n,s){this.key=e,this.value=t,this.color=null!=i?i:Xg.RED,this.left=null!=n?n:Zg.EMPTY_NODE,this.right=null!=s?s:Zg.EMPTY_NODE}copy(e,t,i,n,s){return new Xg(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=n?n:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let n=this;const s=i(e,n.key);return n=s<0?n.copy(null,null,null,n.left.insert(e,t,i),null):0===s?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,i)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return Zg.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,n;if(i=this,t(e,i.key)<0)i.left.isEmpty()||i.left.isRed_()||i.left.left.isRed_()||(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),i.right.isEmpty()||i.right.isRed_()||i.right.left.isRed_()||(i=i.moveRedRight_()),0===t(e,i.key)){if(i.right.isEmpty())return Zg.EMPTY_NODE;n=i.right.min_(),i=i.copy(n.key,n.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Xg.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Xg.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Xg.RED=!0,Xg.BLACK=!1;class Zg{constructor(e,t=Zg.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Zg(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Xg.BLACK,null,null))}remove(e){return new Zg(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Xg.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,n=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return n?n.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(n=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Jg(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Jg(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Jg(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Jg(this.root_,null,this.comparator_,!0,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function em(e,t){return Qp(e.name,t.name)}function tm(e,t){return Qp(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let im;Zg.EMPTY_NODE=new class{copy(e,t,i,n,s){return this}insert(e,t,i){return new Xg(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const nm=function(e){return"number"==typeof e?"number:"+ig(e):"string:"+e},sm=function(e){if(e.isLeafNode()){const t=e.val();Rd("string"==typeof t||"number"==typeof t||"object"==typeof t&&Xd(t,".sv"),"Priority must be a string or number.")}else Rd(e===im||e.isEmpty(),"priority of unexpected type.");Rd(e===im||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let rm,om,am;class lm{constructor(e,t=lm.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Rd(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),sm(this.priorityNode_)}static set __childrenNodeConstructor(e){rm=e}static get __childrenNodeConstructor(){return rm}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new lm(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:lm.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ng(e)?this:".priority"===Mg(e)?this.priorityNode_:lm.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:lm.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=Mg(e);return null===i?t:t.isEmpty()&&".priority"!==i?this:(Rd(".priority"!==i||1===Lg(e),".priority must be the last token in a path"),this.updateImmediateChild(i,lm.__childrenNodeConstructor.EMPTY_NODE.updateChild(Rg(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+nm(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?ig(this.value_):this.value_,this.lazyHash_=Bp(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===lm.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof lm.__childrenNodeConstructor?-1:(Rd(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,n=lm.VALUE_TYPE_ORDER.indexOf(t),s=lm.VALUE_TYPE_ORDER.indexOf(i);return Rd(n>=0,"Unknown leaf type: "+t),Rd(s>=0,"Unknown leaf type: "+i),n===s?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}lm.VALUE_TYPE_ORDER=["object","boolean","number","string"];const hm=new class extends jg{compare(e,t){const i=e.node.getPriority(),n=t.node.getPriority(),s=i.compareTo(n);return 0===s?Qp(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Kg.MIN}maxPost(){return new Kg("[MAX_NAME]",new lm("[PRIORITY-POST]",am))}makePost(e,t){const i=om(e);return new Kg(t,new lm("[PRIORITY-POST]",i))}toString(){return".priority"}},cm=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/cm,10)),this.current_=this.count-1;const i=(n=this.count,parseInt(Array(n+1).join("1"),2));var n;this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const dm=function(e,t,i,n){e.sort(t);const s=function(t,n){const r=n-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=i?i(o):o,new Xg(a,o.node,Xg.BLACK,null,null);{const l=parseInt(r/2,10)+t,h=s(t,l),c=s(l+1,n);return o=e[l],a=i?i(o):o,new Xg(a,o.node,Xg.BLACK,h,c)}},r=function(t){let n=null,r=null,o=e.length;const a=function(t,n){const r=o-t,a=o;o-=t;const h=s(r+1,a),c=e[r],u=i?i(c):c;l(new Xg(u,c.node,n,null,h))},l=function(e){n?(n.left=e,n=e):(r=e,n=e)};for(let e=0;e<t.count;++e){const i=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));i?a(n,Xg.BLACK):(a(n,Xg.BLACK),a(n,Xg.RED))}return r}(new um(e.length));return new Zg(n||t,r)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fm;const pm={};class gm{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Rd(pm&&hm,"ChildrenNode.ts has not been loaded"),fm=fm||new gm({".priority":pm},{".priority":hm}),fm}get(e){const t=Zd(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Zg?t:null}hasIndex(e){return Xd(this.indexSet_,e.toString())}addIndex(e,t){Rd(e!==Qg,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let n=!1;const s=t.getIterator(Kg.Wrap);let r,o=s.getNext();for(;o;)n=n||e.isDefinedOn(o.node),i.push(o),o=s.getNext();r=n?dm(i,e.getCompare()):pm;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const h=Object.assign({},this.indexes_);return h[a]=r,new gm(h,l)}addToIndexes(e,t){const i=tf(this.indexes_,((i,n)=>{const s=Zd(this.indexSet_,n);if(Rd(s,"Missing index implementation for "+n),i===pm){if(s.isDefinedOn(e.node)){const i=[],n=t.getIterator(Kg.Wrap);let r=n.getNext();for(;r;)r.name!==e.name&&i.push(r),r=n.getNext();return i.push(e),dm(i,s.getCompare())}return pm}{const n=t.get(e.name);let s=i;return n&&(s=s.remove(new Kg(e.name,n))),s.insert(e,e.node)}}));return new gm(i,this.indexSet_)}removeFromIndexes(e,t){const i=tf(this.indexes_,(i=>{if(i===pm)return i;{const n=t.get(e.name);return n?i.remove(new Kg(e.name,n)):i}}));return new gm(i,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mm;class vm{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&sm(this.priorityNode_),this.children_.isEmpty()&&Rd(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return mm||(mm=new vm(new Zg(tm),null,gm.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||mm}updatePriority(e){return this.children_.isEmpty()?this:new vm(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?mm:t}}getChild(e){const t=Mg(e);return null===t?this:this.getImmediateChild(t).getChild(Rg(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Rd(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const i=new Kg(e,t);let n,s;t.isEmpty()?(n=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(i,this.children_));const r=n.isEmpty()?mm:this.priorityNode_;return new vm(n,r,s)}}updateChild(e,t){const i=Mg(e);if(null===i)return t;{Rd(".priority"!==Mg(e)||1===Lg(e),".priority must be the last token in a path");const n=this.getImmediateChild(i).updateChild(Rg(e),t);return this.updateImmediateChild(i,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,n=0,s=!0;if(this.forEachChild(hm,((r,o)=>{t[r]=o.val(e),i++,s&&vm.INTEGER_REGEXP_.test(r)?n=Math.max(n,Number(r)):s=!1})),!e&&s&&n<2*i){const e=[];for(const i in t)e[i]=t[i];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+nm(this.getPriority().val())+":"),this.forEachChild(hm,((t,i)=>{const n=i.hash();""!==n&&(e+=":"+t+":"+n)})),this.lazyHash_=""===e?"":Bp(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const n=this.resolveIndex_(i);if(n){const i=n.getPredecessorKey(new Kg(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Kg(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Kg(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,(e=>e));{const i=this.children_.getIteratorFrom(e.name,Kg.Wrap);let n=i.peek();for(;null!=n&&t.compare(n,e)<0;)i.getNext(),n=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,(e=>e));{const i=this.children_.getReverseIteratorFrom(e.name,Kg.Wrap);let n=i.peek();for(;null!=n&&t.compare(n,e)>0;)i.getNext(),n=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===wm?-1:0}withIndex(e){if(e===Qg||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new vm(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Qg||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(hm),i=t.getIterator(hm);let n=e.getNext(),s=i.getNext();for(;n&&s;){if(n.name!==s.name||!n.node.equals(s.node))return!1;n=e.getNext(),s=i.getNext()}return null===n&&null===s}return!1}return!1}}resolveIndex_(e){return e===Qg?null:this.indexMap_.get(e.toString())}}vm.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const wm=new class extends vm{constructor(){super(new Zg(tm),vm.EMPTY_NODE,gm.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return vm.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Kg,{MIN:{value:new Kg("[MIN_NAME]",vm.EMPTY_NODE)},MAX:{value:new Kg("[MAX_NAME]",wm)}}),Yg.__EMPTY_NODE=vm.EMPTY_NODE,lm.__childrenNodeConstructor=vm,im=wm,function(e){am=e}(wm);function ym(e,t=null){if(null===e)return vm.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Rd(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new lm(e,ym(t))}if(e instanceof Array){let i=vm.EMPTY_NODE;return tg(e,((t,n)=>{if(Xd(e,t)&&"."!==t.substring(0,1)){const e=ym(n);!e.isLeafNode()&&e.isEmpty()||(i=i.updateImmediateChild(t,e))}})),i.updatePriority(ym(t))}{const i=[];let n=!1;if(tg(e,((e,t)=>{if("."!==e.substring(0,1)){const s=ym(t);s.isEmpty()||(n=n||!s.getPriority().isEmpty(),i.push(new Kg(e,s)))}})),0===i.length)return vm.EMPTY_NODE;const s=dm(i,em,(e=>e.name),tm);if(n){const e=dm(i,hm.getCompare());return new vm(s,ym(t),new gm({".priority":e},{".priority":hm}))}return new vm(s,ym(t),gm.Default)}}!function(e){om=e}(ym);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class bm extends jg{constructor(e){super(),this.indexPath_=e,Rd(!Ng(e)&&".priority"!==Mg(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),n=this.extractChild(t.node),s=i.compareTo(n);return 0===s?Qp(e.name,t.name):s}makePost(e,t){const i=ym(e),n=vm.EMPTY_NODE.updateChild(this.indexPath_,i);return new Kg(t,n)}maxPost(){const e=vm.EMPTY_NODE.updateChild(this.indexPath_,wm);return new Kg("[MAX_NAME]",e)}toString(){return Ig(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _m=new class extends jg{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?Qp(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Kg.MIN}maxPost(){return Kg.MAX}makePost(e,t){const i=ym(e);return new Kg(t,i)}toString(){return".value"}},Cm="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Sm=function(){let e=0;const t=[];return function(i){const n=i===e;let s;e=i;const r=new Array(8);for(s=7;s>=0;s--)r[s]=Cm.charAt(i%64),i=Math.floor(i/64);Rd(0===i,"Cannot push at time == 0");let o=r.join("");if(n){for(s=11;s>=0&&63===t[s];s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)o+=Cm.charAt(t[s]);return Rd(20===o.length,"nextPushId: Length should be 20."),o}}(),xm=function(e){if("2147483647"===e)return"-";const t=sg(e);if(null!=t)return""+(t+1);const i=new Array(e.length);for(let t=0;t<i.length;t++)i[t]=e.charAt(t);if(i.length<786)return i.push("-"),i.join("");let n=i.length-1;for(;n>=0&&"z"===i[n];)n--;if(-1===n)return"[MAX_NAME]";const s=i[n],r=Cm.charAt(Cm.indexOf(s)+1);return i[n]=r,i.slice(0,n+1).join("")},km=function(e){if("-2147483648"===e)return"[MIN_NAME]";const t=sg(e);if(null!=t)return""+(t-1);const i=new Array(e.length);for(let t=0;t<i.length;t++)i[t]=e.charAt(t);return"-"===i[i.length-1]?1===i.length?"2147483647":(delete i[i.length-1],i.join("")):(i[i.length-1]=Cm.charAt(Cm.indexOf(i[i.length-1])-1),i.join("")+"z".repeat(786-i.length))};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Am(e){return{type:"value",snapshotNode:e}}function Em(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Tm(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Mm(e,t,i){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:i}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Lm{constructor(e){this.index_=e}updateChild(e,t,i,n,s,r){Rd(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(n).equals(i.getChild(n))&&o.isEmpty()===i.isEmpty()?e:(null!=r&&(i.isEmpty()?e.hasChild(t)?r.trackChildChange(Tm(t,o)):Rd(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?r.trackChildChange(Em(t,i)):r.trackChildChange(Mm(t,i,o))),e.isLeafNode()&&i.isEmpty()?e:e.updateImmediateChild(t,i).withIndex(this.index_))}updateFullNode(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(hm,((e,n)=>{t.hasChild(e)||i.trackChildChange(Tm(e,n))})),t.isLeafNode()||t.forEachChild(hm,((t,n)=>{if(e.hasChild(t)){const s=e.getImmediateChild(t);s.equals(n)||i.trackChildChange(Mm(t,n,s))}else i.trackChildChange(Em(t,n))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?vm.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e){this.indexedFilter_=new Lm(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Rm.getStartPost_(e),this.endPost_=Rm.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,i,n,s,r){return this.matches(new Kg(t,i))||(i=vm.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,n,s,r)}updateFullNode(e,t,i){t.isLeafNode()&&(t=vm.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(vm.EMPTY_NODE);const s=this;return t.forEachChild(hm,((e,t)=>{s.matches(new Kg(e,t))||(n=n.updateImmediateChild(e,vm.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,n,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(e){this.rangedFilter_=new Rm(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,i,n,s,r){return this.rangedFilter_.matches(new Kg(t,i))||(i=vm.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,n,s,r):this.fullLimitUpdateChild_(e,t,i,s,r)}updateFullNode(e,t,i){let n;if(t.isLeafNode()||t.isEmpty())n=vm.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=vm.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let i=0;for(;e.hasNext()&&i<this.limit_;){const t=e.getNext();let s;if(s=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),t)<=0:this.index_.compare(t,this.rangedFilter_.getEndPost())<=0,!s)break;n=n.updateImmediateChild(t.name,t.node),i++}}else{let e,i,s,r;if(n=t.withIndex(this.index_),n=n.updatePriority(vm.EMPTY_NODE),this.reverse_){r=n.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),i=this.rangedFilter_.getStartPost();const t=this.index_.getCompare();s=(e,i)=>t(i,e)}else r=n.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),i=this.rangedFilter_.getEndPost(),s=this.index_.getCompare();let o=0,a=!1;for(;r.hasNext();){const t=r.getNext();!a&&s(e,t)<=0&&(a=!0);a&&o<this.limit_&&s(t,i)<=0?o++:n=n.updateImmediateChild(t.name,vm.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,n,s){let r;if(this.reverse_){const e=this.index_.getCompare();r=(t,i)=>e(i,t)}else r=this.index_.getCompare();const o=e;Rd(o.numChildren()===this.limit_,"");const a=new Kg(t,i),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),h=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let c=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=c&&(c.name===t||o.hasChild(c.name));)c=n.getChildAfterChild(this.index_,c,this.reverse_);const u=null==c?1:r(c,a);if(h&&!i.isEmpty()&&u>=0)return null!=s&&s.trackChildChange(Mm(t,i,e)),o.updateImmediateChild(t,i);{null!=s&&s.trackChildChange(Tm(t,e));const i=o.updateImmediateChild(t,vm.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=s&&s.trackChildChange(Em(c.name,c.node)),i.updateImmediateChild(c.name,c.node)):i}}return i.isEmpty()?e:h&&r(l,a)>=0?(null!=s&&(s.trackChildChange(Tm(l.name,l.node)),s.trackChildChange(Em(t,i))),o.updateImmediateChild(t,i).updateImmediateChild(l.name,vm.EMPTY_NODE)):e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=hm}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Rd(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Rd(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:"[MIN_NAME]"}hasEnd(){return this.endSet_}getIndexEndValue(){return Rd(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Rd(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:"[MAX_NAME]"}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Rd(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===hm}copy(){const e=new Im;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Om(e,t,i){const n=e.copy();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=i?(n.startNameSet_=!0,n.indexStartName_=i):(n.startNameSet_=!1,n.indexStartName_=""),n}function Dm(e,t,i){const n=e.copy();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==i?(n.endNameSet_=!0,n.indexEndName_=i):(n.endNameSet_=!1,n.indexEndName_=""),n}function Nm(e,t){const i=e.copy();return i.index_=t,i}function Pm(e){const t={};if(e.isDefault())return t;let i;return e.index_===hm?i="$priority":e.index_===_m?i="$value":e.index_===Qg?i="$key":(Rd(e.index_ instanceof bm,"Unrecognized index type!"),i=e.index_.toString()),t.orderBy=Gd(i),e.startSet_&&(t.startAt=Gd(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Gd(e.indexStartName_))),e.endSet_&&(t.endAt=Gd(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Gd(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Fm(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let i=e.viewFrom_;""===i&&(i=e.isViewFromLeft()?"l":"r"),t.vf=i}return e.index_!==hm&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm extends xg{constructor(e,t,i,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=n,this.log_=qp("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Rd(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,n){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const r=Bm.getListenId_(e,i),o={};this.listens_[r]=o;const a=Pm(e._queryParams);this.restRequest_(s+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(s,a,!1,i),Zd(this.listens_,r)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",n(t,null)}}))}unlisten(e,t){const i=Bm.getListenId_(e,t);delete this.listens_[i]}get(e){const t=Pm(e._queryParams),i=e._path.toString(),n=new Bd;return this.restRequest_(i+".json",t,((e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(i,s,!1,null),n.resolve(s)):n.reject(new Error(s))})),n.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([n,s])=>{n&&n.accessToken&&(t.auth=n.accessToken),s&&s.token&&(t.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+rf(t);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(i&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=jd(o.responseText)}catch(e){Gp("Failed to parse JSON response for "+r+": "+o.responseText)}i(null,e)}else 401!==o.status&&404!==o.status&&Gp("Got unsuccessful REST response for "+r+" Status: "+o.status),i(o.status);i=null}},o.open("GET",r,!0),o.send()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(){this.rootNode_=vm.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hm(){return{value:null,children:new Map}}function Vm(e,t,i){if(Ng(t))e.value=i,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,i);else{const n=Mg(t);e.children.has(n)||e.children.set(n,Hm());Vm(e.children.get(n),t=Rg(t),i)}}function zm(e,t){if(Ng(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const i=e.value;return e.value=null,i.forEachChild(hm,((t,i)=>{Vm(e,new Eg(t),i)})),zm(e,t)}}if(e.children.size>0){const i=Mg(t);if(t=Rg(t),e.children.has(i)){zm(e.children.get(i),t)&&e.children.delete(i)}return 0===e.children.size}return!0}function Um(e,t,i){null!==e.value?i(t,e.value):function(e,t){e.children.forEach(((e,i)=>{t(i,e)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,((e,n)=>{Um(n,new Eg(t.toString()+"/"+e),i)}))}class qm{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&tg(this.last_,((e,i)=>{t[e]=t[e]-i})),this.last_=e,t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new qm(e);const i=1e4+2e4*Math.random();og(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;tg(e,((e,n)=>{n>0&&Xd(this.statsToReport_,e)&&(t[e]=n,i=!0)})),i&&this.server_.reportStats(t),og(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jm,Gm;function Ym(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Gm=jm||(jm={}))[Gm.OVERWRITE=0]="OVERWRITE",Gm[Gm.MERGE=1]="MERGE",Gm[Gm.ACK_USER_WRITE=2]="ACK_USER_WRITE",Gm[Gm.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Qm{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=jm.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Ng(this.path)){if(null!=this.affectedTree.value)return Rd(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Eg(e));return new Qm(Tg(),t,this.revert)}}return Rd(Mg(this.path)===e,"operationForChild called for unrelated child."),new Qm(Rg(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e,t){this.source=e,this.path=t,this.type=jm.LISTEN_COMPLETE}operationForChild(e){return Ng(this.path)?new Jm(this.source,Tg()):new Jm(this.source,Rg(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=jm.OVERWRITE}operationForChild(e){return Ng(this.path)?new Xm(this.source,Tg(),this.snap.getImmediateChild(e)):new Xm(this.source,Rg(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=jm.MERGE}operationForChild(e){if(Ng(this.path)){const t=this.children.subtree(new Eg(e));return t.isEmpty()?null:t.value?new Xm(this.source,Tg(),t.value):new Zm(this.source,Tg(),t)}return Rd(Mg(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Zm(this.source,Rg(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ng(e))return this.isFullyInitialized()&&!this.filtered_;const t=Mg(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function iv(e,t,i,n,s,r){const o=n.filter((e=>e.type===i));o.sort(((t,i)=>function(e,t,i){if(null==t.childName||null==i.childName)throw $d("Should only compare child_ events.");const n=new Kg(t.childName,t.snapshotNode),s=new Kg(i.childName,i.snapshotNode);return e.index_.compare(n,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,i))),o.forEach((i=>{const n=function(e,t,i){return"value"===t.type||"child_removed"===t.type||(t.prevName=i.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,i,r);s.forEach((s=>{s.respondsTo(i.type)&&t.push(s.createEvent(n,e.query_))}))}))}function nv(e,t){return{eventCache:e,serverCache:t}}function sv(e,t,i,n){return nv(new ev(t,i,n),e.serverCache)}function rv(e,t,i,n){return nv(e.eventCache,new ev(t,i,n))}function ov(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function av(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lv;class hv{constructor(e,t=(()=>(lv||(lv=new Zg(Jp)),lv))()){this.value=e,this.children=t}static fromObject(e){let t=new hv(null);return tg(e,((e,i)=>{t=t.set(new Eg(e),i)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Tg(),value:this.value};if(Ng(e))return null;{const i=Mg(e),n=this.children.get(i);if(null!==n){const s=n.findRootMostMatchingPathAndValue(Rg(e),t);if(null!=s){return{path:Dg(new Eg(i),s.path),value:s.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Ng(e))return this;{const t=Mg(e),i=this.children.get(t);return null!==i?i.subtree(Rg(e)):new hv(null)}}set(e,t){if(Ng(e))return new hv(t,this.children);{const i=Mg(e),n=(this.children.get(i)||new hv(null)).set(Rg(e),t),s=this.children.insert(i,n);return new hv(this.value,s)}}remove(e){if(Ng(e))return this.children.isEmpty()?new hv(null):new hv(null,this.children);{const t=Mg(e),i=this.children.get(t);if(i){const n=i.remove(Rg(e));let s;return s=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&s.isEmpty()?new hv(null):new hv(this.value,s)}return this}}get(e){if(Ng(e))return this.value;{const t=Mg(e),i=this.children.get(t);return i?i.get(Rg(e)):null}}setTree(e,t){if(Ng(e))return t;{const i=Mg(e),n=(this.children.get(i)||new hv(null)).setTree(Rg(e),t);let s;return s=n.isEmpty()?this.children.remove(i):this.children.insert(i,n),new hv(this.value,s)}}fold(e){return this.fold_(Tg(),e)}fold_(e,t){const i={};return this.children.inorderTraversal(((n,s)=>{i[n]=s.fold_(Dg(e,n),t)})),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Tg(),t)}findOnPath_(e,t,i){const n=!!this.value&&i(t,this.value);if(n)return n;if(Ng(e))return null;{const n=Mg(e),s=this.children.get(n);return s?s.findOnPath_(Rg(e),Dg(t,n),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Tg(),t)}foreachOnPath_(e,t,i){if(Ng(e))return this;{this.value&&i(t,this.value);const n=Mg(e),s=this.children.get(n);return s?s.foreachOnPath_(Rg(e),Dg(t,n),i):new hv(null)}}foreach(e){this.foreach_(Tg(),e)}foreach_(e,t){this.children.inorderTraversal(((i,n)=>{n.foreach_(Dg(e,i),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,i)=>{i.value&&e(t,i.value)}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e){this.writeTree_=e}static empty(){return new cv(new hv(null))}}function uv(e,t,i){if(Ng(t))return new cv(new hv(i));{const n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){const s=n.path;let r=n.value;const o=Pg(s,t);return r=r.updateChild(o,i),new cv(e.writeTree_.set(s,r))}{const n=new hv(i),s=e.writeTree_.setTree(t,n);return new cv(s)}}}function dv(e,t,i){let n=e;return tg(i,((e,i)=>{n=uv(n,Dg(t,e),i)})),n}function fv(e,t){if(Ng(t))return cv.empty();{const i=e.writeTree_.setTree(t,new hv(null));return new cv(i)}}function pv(e,t){return null!=gv(e,t)}function gv(e,t){const i=e.writeTree_.findRootMostValueAndPath(t);return null!=i?e.writeTree_.get(i.path).getChild(Pg(i.path,t)):null}function mv(e){const t=[],i=e.writeTree_.value;return null!=i?i.isLeafNode()||i.forEachChild(hm,((e,i)=>{t.push(new Kg(e,i))})):e.writeTree_.children.inorderTraversal(((e,i)=>{null!=i.value&&t.push(new Kg(e,i.value))})),t}function vv(e,t){if(Ng(t))return e;{const i=gv(e,t);return new cv(null!=i?new hv(i):e.writeTree_.subtree(t))}}function wv(e){return e.writeTree_.isEmpty()}function yv(e,t){return bv(Tg(),e.writeTree_,t)}function bv(e,t,i){if(null!=t.value)return i.updateChild(e,t.value);{let n=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(Rd(null!==s.value,"Priority writes must always be leaf nodes"),n=s.value):i=bv(Dg(e,t),s,i)})),i.getChild(e).isEmpty()||null===n||(i=i.updateChild(Dg(e,".priority"),n)),i}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _v(e,t){return Ov(t,e)}function Cv(e,t){const i=e.allWrites.findIndex((e=>e.writeId===t));Rd(i>=0,"removeWrite called with nonexistent writeId.");const n=e.allWrites[i];e.allWrites.splice(i,1);let s=n.visible,r=!1,o=e.allWrites.length-1;for(;s&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=i&&Sv(t,n.path)?s=!1:Wg(n.path,t.path)&&(r=!0)),o--}if(s){if(r)return function(e){e.visibleWrites=kv(e.allWrites,xv,Tg()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(n.snap)e.visibleWrites=fv(e.visibleWrites,n.path);else{tg(n.children,(t=>{e.visibleWrites=fv(e.visibleWrites,Dg(n.path,t))}))}return!0}return!1}function Sv(e,t){if(e.snap)return Wg(e.path,t);for(const i in e.children)if(e.children.hasOwnProperty(i)&&Wg(Dg(e.path,i),t))return!0;return!1}function xv(e){return e.visible}function kv(e,t,i){let n=cv.empty();for(let s=0;s<e.length;++s){const r=e[s];if(t(r)){const e=r.path;let t;if(r.snap)Wg(i,e)?(t=Pg(i,e),n=uv(n,t,r.snap)):Wg(e,i)&&(t=Pg(e,i),n=uv(n,Tg(),r.snap.getChild(t)));else{if(!r.children)throw $d("WriteRecord should have .snap or .children");if(Wg(i,e))t=Pg(i,e),n=dv(n,t,r.children);else if(Wg(e,i))if(t=Pg(e,i),Ng(t))n=dv(n,Tg(),r.children);else{const e=Zd(r.children,Mg(t));if(e){const i=e.getChild(Rg(t));n=uv(n,Tg(),i)}}}}}return n}function Av(e,t,i,n,s){if(n||s){const r=vv(e.visibleWrites,t);if(!s&&wv(r))return i;if(s||null!=i||pv(r,Tg())){const r=function(e){return(e.visible||s)&&(!n||!~n.indexOf(e.writeId))&&(Wg(e.path,t)||Wg(t,e.path))};return yv(kv(e.allWrites,r,t),i||vm.EMPTY_NODE)}return null}{const n=gv(e.visibleWrites,t);if(null!=n)return n;{const n=vv(e.visibleWrites,t);if(wv(n))return i;if(null!=i||pv(n,Tg())){return yv(n,i||vm.EMPTY_NODE)}return null}}}function Ev(e,t,i,n){return Av(e.writeTree,e.treePath,t,i,n)}function Tv(e,t){return function(e,t,i){let n=vm.EMPTY_NODE;const s=gv(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(hm,((e,t)=>{n=n.updateImmediateChild(e,t)})),n;if(i){const s=vv(e.visibleWrites,t);return i.forEachChild(hm,((e,t)=>{const i=yv(vv(s,new Eg(e)),t);n=n.updateImmediateChild(e,i)})),mv(s).forEach((e=>{n=n.updateImmediateChild(e.name,e.node)})),n}return mv(vv(e.visibleWrites,t)).forEach((e=>{n=n.updateImmediateChild(e.name,e.node)})),n}(e.writeTree,e.treePath,t)}function Mv(e,t,i,n){return function(e,t,i,n,s){Rd(n||s,"Either existingEventSnap or existingServerSnap must exist");const r=Dg(t,i);if(pv(e.visibleWrites,r))return null;{const t=vv(e.visibleWrites,r);return wv(t)?s.getChild(i):yv(t,s.getChild(i))}}(e.writeTree,e.treePath,t,i,n)}function Lv(e,t){return function(e,t){return gv(e.visibleWrites,t)}(e.writeTree,Dg(e.treePath,t))}function Rv(e,t,i,n,s,r){return function(e,t,i,n,s,r,o){let a;const l=vv(e.visibleWrites,t),h=gv(l,Tg());if(null!=h)a=h;else{if(null==i)return[];a=yv(l,i)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),i=r?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o);let l=i.getNext();for(;l&&e.length<s;)0!==t(l,n)&&e.push(l),l=i.getNext();return e}}(e.writeTree,e.treePath,t,i,n,s,r)}function $v(e,t,i){return function(e,t,i,n){const s=Dg(t,i),r=gv(e.visibleWrites,s);if(null!=r)return r;if(n.isCompleteForChild(i))return yv(vv(e.visibleWrites,s),n.getNode().getImmediateChild(i));return null}(e.writeTree,e.treePath,t,i)}function Iv(e,t){return Ov(Dg(e.treePath,t),e.writeTree)}function Ov(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;Rd("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Rd(".priority"!==i,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(i);if(n){const s=n.type;if("child_added"===t&&"child_removed"===s)this.changeMap.set(i,Mm(i,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===s)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===s)this.changeMap.set(i,Tm(i,n.oldSnap));else if("child_changed"===t&&"child_added"===s)this.changeMap.set(i,Em(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==s)throw $d("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(i,Mm(i,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nv=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class Pv{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new ev(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return $v(this.writes_,e,t)}}getChildAfterChild(e,t,i){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:av(this.viewCache_),s=Rv(this.writes_,n,t,1,i,e);return 0===s.length?null:s[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fv(e,t,i,n,s){const r=new Dv;let o,a;if(i.type===jm.OVERWRITE){const l=i;l.source.fromUser?o=Hv(e,t,l.path,l.snap,n,s,r):(Rd(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!Ng(l.path),o=Wv(e,t,l.path,l.snap,n,s,a,r))}else if(i.type===jm.MERGE){const l=i;l.source.fromUser?o=function(e,t,i,n,s,r,o){let a=t;return n.foreach(((n,l)=>{const h=Dg(i,n);Vv(t,Mg(h))&&(a=Hv(e,a,h,l,s,r,o))})),n.foreach(((n,l)=>{const h=Dg(i,n);Vv(t,Mg(h))||(a=Hv(e,a,h,l,s,r,o))})),a}(e,t,l.path,l.children,n,s,r):(Rd(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=Uv(e,t,l.path,l.children,n,s,a,r))}else if(i.type===jm.ACK_USER_WRITE){const a=i;o=a.revert?function(e,t,i,n,s,r){let o;if(null!=Lv(n,i))return t;{const a=new Pv(n,t,s),l=t.eventCache.getNode();let h;if(Ng(i)||".priority"===Mg(i)){let i;if(t.serverCache.isFullyInitialized())i=Ev(n,av(t));else{const e=t.serverCache.getNode();Rd(e instanceof vm,"serverChildren would be complete if leaf node"),i=Tv(n,e)}h=e.filter.updateFullNode(l,i,r)}else{const s=Mg(i);let c=$v(n,s,t.serverCache);null==c&&t.serverCache.isCompleteForChild(s)&&(c=l.getImmediateChild(s)),h=null!=c?e.filter.updateChild(l,s,c,Rg(i),a,r):t.eventCache.getNode().hasChild(s)?e.filter.updateChild(l,s,vm.EMPTY_NODE,Rg(i),a,r):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Ev(n,av(t)),o.isLeafNode()&&(h=e.filter.updateFullNode(h,o,r)))}return o=t.serverCache.isFullyInitialized()||null!=Lv(n,Tg()),sv(t,h,o,e.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,a.path,n,s,r):function(e,t,i,n,s,r,o){if(null!=Lv(s,i))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(Ng(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return Wv(e,t,i,l.getNode().getChild(i),s,r,a,o);if(Ng(i)){let n=new hv(null);return l.getNode().forEachChild(Qg,((e,t)=>{n=n.set(new Eg(e),t)})),Uv(e,t,i,n,s,r,a,o)}return t}{let h=new hv(null);return n.foreach(((e,t)=>{const n=Dg(i,e);l.isCompleteForPath(n)&&(h=h.set(e,l.getNode().getChild(n)))})),Uv(e,t,i,h,s,r,a,o)}}(e,t,a.path,a.affectedTree,n,s,r)}else{if(i.type!==jm.LISTEN_COMPLETE)throw $d("Unknown operation type: "+i.type);o=function(e,t,i,n,s){const r=t.serverCache,o=rv(t,r.getNode(),r.isFullyInitialized()||Ng(i),r.isFiltered());return Bv(e,o,i,n,Nv,s)}(e,t,i.path,n,r)}const l=r.getChanges();return function(e,t,i){const n=t.eventCache;if(n.isFullyInitialized()){const s=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=ov(e);(i.length>0||!e.eventCache.isFullyInitialized()||s&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&i.push(Am(ov(t)))}}(t,o,l),{viewCache:o,changes:l}}function Bv(e,t,i,n,s,r){const o=t.eventCache;if(null!=Lv(n,i))return t;{let a,l;if(Ng(i))if(Rd(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const i=av(t),s=Tv(n,i instanceof vm?i:vm.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),s,r)}else{const i=Ev(n,av(t));a=e.filter.updateFullNode(t.eventCache.getNode(),i,r)}else{const h=Mg(i);if(".priority"===h){Rd(1===Lg(i),"Can't have a priority with additional path components");const s=o.getNode();l=t.serverCache.getNode();const r=Mv(n,i,s,l);a=null!=r?e.filter.updatePriority(s,r):o.getNode()}else{const c=Rg(i);let u;if(o.isCompleteForChild(h)){l=t.serverCache.getNode();const e=Mv(n,i,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=$v(n,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,s,r):o.getNode()}}return sv(t,a,o.isFullyInitialized()||Ng(i),e.filter.filtersNodes())}}function Wv(e,t,i,n,s,r,o,a){const l=t.serverCache;let h;const c=o?e.filter:e.filter.getIndexedFilter();if(Ng(i))h=c.updateFullNode(l.getNode(),n,null);else if(c.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(i,n);h=c.updateFullNode(l.getNode(),e,null)}else{const e=Mg(i);if(!l.isCompleteForPath(i)&&Lg(i)>1)return t;const s=Rg(i),r=l.getNode().getImmediateChild(e).updateChild(s,n);h=".priority"===e?c.updatePriority(l.getNode(),r):c.updateChild(l.getNode(),e,r,s,Nv,null)}const u=rv(t,h,l.isFullyInitialized()||Ng(i),c.filtersNodes());return Bv(e,u,i,s,new Pv(s,u,r),a)}function Hv(e,t,i,n,s,r,o){const a=t.eventCache;let l,h;const c=new Pv(s,t,r);if(Ng(i))h=e.filter.updateFullNode(t.eventCache.getNode(),n,o),l=sv(t,h,!0,e.filter.filtersNodes());else{const s=Mg(i);if(".priority"===s)h=e.filter.updatePriority(t.eventCache.getNode(),n),l=sv(t,h,a.isFullyInitialized(),a.isFiltered());else{const r=Rg(i),h=a.getNode().getImmediateChild(s);let u;if(Ng(r))u=n;else{const e=c.getCompleteChild(s);u=null!=e?".priority"===$g(r)&&e.getChild(Og(r)).isEmpty()?e:e.updateChild(r,n):vm.EMPTY_NODE}if(h.equals(u))l=t;else{l=sv(t,e.filter.updateChild(a.getNode(),s,u,r,c,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Vv(e,t){return e.eventCache.isCompleteForChild(t)}function zv(e,t,i){return i.foreach(((e,i)=>{t=t.updateChild(e,i)})),t}function Uv(e,t,i,n,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,h=t;l=Ng(i)?n:new hv(null).setTree(i,n);const c=t.serverCache.getNode();return l.children.inorderTraversal(((i,n)=>{if(c.hasChild(i)){const l=zv(0,t.serverCache.getNode().getImmediateChild(i),n);h=Wv(e,h,new Eg(i),l,s,r,o,a)}})),l.children.inorderTraversal(((i,n)=>{const l=!t.serverCache.isCompleteForChild(i)&&void 0===n.value;if(!c.hasChild(i)&&!l){const l=zv(0,t.serverCache.getNode().getImmediateChild(i),n);h=Wv(e,h,new Eg(i),l,s,r,o,a)}})),h}class qv{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,n=new Lm(i.getIndex()),s=(r=i).loadsAllData()?new Lm(r.getIndex()):r.hasLimit()?new $m(r):new Rm(r);var r;this.processor_=function(e){return{filter:e}}(s);const o=t.serverCache,a=t.eventCache,l=n.updateFullNode(vm.EMPTY_NODE,o.getNode(),null),h=s.updateFullNode(vm.EMPTY_NODE,a.getNode(),null),c=new ev(l,o.isFullyInitialized(),n.filtersNodes()),u=new ev(h,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=nv(u,c),this.eventGenerator_=new tv(this.query_)}get query(){return this.query_}}function Kv(e,t){const i=av(e.viewCache_);return i&&(e.query._queryParams.loadsAllData()||!Ng(t)&&!i.getImmediateChild(Mg(t)).isEmpty())?i.getChild(t):null}function jv(e){return 0===e.eventRegistrations_.length}function Gv(e,t,i){const n=[];if(i){Rd(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(i,s);t&&n.push(t)}))}if(t){let i=[];for(let n=0;n<e.eventRegistrations_.length;++n){const s=e.eventRegistrations_[n];if(s.matches(t)){if(t.hasAnyCallback()){i=i.concat(e.eventRegistrations_.slice(n+1));break}}else i.push(s)}e.eventRegistrations_=i}else e.eventRegistrations_=[];return n}function Yv(e,t,i,n){t.type===jm.MERGE&&null!==t.source.queryId&&(Rd(av(e.viewCache_),"We should always have a full cache before handling merges"),Rd(ov(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,r=Fv(e.processor_,s,t,i,n);var o,a;return o=e.processor_,a=r.viewCache,Rd(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),Rd(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),Rd(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=r.viewCache,Qv(e,r.changes,r.viewCache.eventCache.getNode(),null)}function Qv(e,t,i,n){const s=n?[n]:e.eventRegistrations_;return function(e,t,i,n){const s=[],r=[];return t.forEach((t=>{var i;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((i=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:i}))})),iv(e,s,"child_removed",t,n,i),iv(e,s,"child_added",t,n,i),iv(e,s,"child_moved",r,n,i),iv(e,s,"child_changed",t,n,i),iv(e,s,"value",t,n,i),s}(e.eventGenerator_,t,i,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jv,Xv;class Zv{constructor(){this.views=new Map}}function ew(e,t,i,n){const s=t.source.queryId;if(null!==s){const r=e.views.get(s);return Rd(null!=r,"SyncTree gave us an op for an invalid query."),Yv(r,t,i,n)}{let s=[];for(const r of e.views.values())s=s.concat(Yv(r,t,i,n));return s}}function tw(e,t,i,n,s){const r=t._queryIdentifier,o=e.views.get(r);if(!o){let e=Ev(i,s?n:null),r=!1;e?r=!0:n instanceof vm?(e=Tv(i,n),r=!1):(e=vm.EMPTY_NODE,r=!1);const o=nv(new ev(e,r,!1),new ev(n,s,!1));return new qv(t,o)}return o}function iw(e,t,i,n,s,r){const o=tw(e,t,n,s,r);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,i),function(e,t){const i=e.viewCache_.eventCache,n=[];i.getNode().isLeafNode()||i.getNode().forEachChild(hm,((e,t)=>{n.push(Em(e,t))}));return i.isFullyInitialized()&&n.push(Am(i.getNode())),Qv(e,n,i.getNode(),t)}(o,i)}function nw(e,t,i,n){const s=t._queryIdentifier,r=[];let o=[];const a=lw(e);if("default"===s)for(const[t,s]of e.views.entries())o=o.concat(Gv(s,i,n)),jv(s)&&(e.views.delete(t),s.query._queryParams.loadsAllData()||r.push(s.query));else{const t=e.views.get(s);t&&(o=o.concat(Gv(t,i,n)),jv(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||r.push(t.query)))}return a&&!lw(e)&&r.push(new(Rd(Jv,"Reference.ts has not been loaded"),Jv)(t._repo,t._path)),{removed:r,events:o}}function sw(e){const t=[];for(const i of e.views.values())i.query._queryParams.loadsAllData()||t.push(i);return t}function rw(e,t){let i=null;for(const n of e.views.values())i=i||Kv(n,t);return i}function ow(e,t){if(t._queryParams.loadsAllData())return hw(e);{const i=t._queryIdentifier;return e.views.get(i)}}function aw(e,t){return null!=ow(e,t)}function lw(e){return null!=hw(e)}function hw(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cw=1;class uw{constructor(e){this.listenProvider_=e,this.syncPointTree_=new hv(null),this.pendingWriteTree_={visibleWrites:cv.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function dw(e,t,i,n,s){return function(e,t,i,n,s){Rd(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:i,writeId:n,visible:s}),s&&(e.visibleWrites=uv(e.visibleWrites,t,i)),e.lastWriteId=n}(e.pendingWriteTree_,t,i,n,s),s?bw(e,new Xm({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,i)):[]}function fw(e,t,i,n){!function(e,t,i,n){Rd(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:i,writeId:n,visible:!0}),e.visibleWrites=dv(e.visibleWrites,t,i),e.lastWriteId=n}(e.pendingWriteTree_,t,i,n);const s=hv.fromObject(i);return bw(e,new Zm({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,s))}function pw(e,t,i=!1){const n=function(e,t){for(let i=0;i<e.allWrites.length;i++){const n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(Cv(e.pendingWriteTree_,t)){let t=new hv(null);return null!=n.snap?t=t.set(Tg(),!0):tg(n.children,(e=>{t=t.set(new Eg(e),!0)})),bw(e,new Qm(n.path,t,i))}return[]}function gw(e,t,i){return bw(e,new Xm({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}function mw(e,t,i,n){const s=t._path,r=e.syncPointTree_.get(s);let o=[];if(r&&("default"===t._queryIdentifier||aw(r,t))){const a=nw(r,t,i,n);0===r.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const l=a.removed;o=a.events;const h=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),c=e.syncPointTree_.findOnPath(s,((e,t)=>lw(t)));if(h&&!c){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const i=function(e){return e.fold(((e,t,i)=>{if(t&&lw(t)){return[hw(t)]}{let e=[];return t&&(e=sw(t)),tg(i,((t,i)=>{e=e.concat(i)})),e}}))}(t);for(let t=0;t<i.length;++t){const n=i[t],s=n.query,r=Sw(e,n);e.listenProvider_.startListening(Mw(s),xw(e,s),r.hashFn,r.onComplete)}}}if(!c&&l.length>0&&!n)if(h){const i=null;e.listenProvider_.stopListening(Mw(t),i)}else l.forEach((t=>{const i=e.queryToTagMap.get(kw(t));e.listenProvider_.stopListening(Mw(t),i)}));!function(e,t){for(let i=0;i<t.length;++i){const n=t[i];if(!n._queryParams.loadsAllData()){const t=kw(n),i=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(i)}}}(e,l)}return o}function vw(e,t,i){const n=t._path;let s=null,r=!1;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const i=Pg(e,n);s=s||rw(t,i),r=r||lw(t)}));let o,a=e.syncPointTree_.get(n);if(a?(r=r||lw(a),s=s||rw(a,Tg())):(a=new Zv,e.syncPointTree_=e.syncPointTree_.set(n,a)),null!=s)o=!0;else{o=!1,s=vm.EMPTY_NODE;e.syncPointTree_.subtree(n).foreachChild(((e,t)=>{const i=rw(t,Tg());i&&(s=s.updateImmediateChild(e,i))}))}const l=aw(a,t);if(!l&&!t._queryParams.loadsAllData()){const i=kw(t);Rd(!e.queryToTagMap.has(i),"View does not exist, but we have a tag");const n=cw++;e.queryToTagMap.set(i,n),e.tagToQueryMap.set(n,i)}let h=iw(a,t,i,_v(e.pendingWriteTree_,n),s,o);if(!l&&!r){const i=ow(a,t);h=h.concat(function(e,t,i){const n=t._path,s=xw(e,t),r=Sw(e,i),o=e.listenProvider_.startListening(Mw(t),s,r.hashFn,r.onComplete),a=e.syncPointTree_.subtree(n);if(s)Rd(!lw(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold(((e,t,i)=>{if(!Ng(e)&&t&&lw(t))return[hw(t).query];{let e=[];return t&&(e=e.concat(sw(t).map((e=>e.query)))),tg(i,((t,i)=>{e=e.concat(i)})),e}}));for(let i=0;i<t.length;++i){const n=t[i];e.listenProvider_.stopListening(Mw(n),xw(e,n))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,i))}return h}function ww(e,t,i){const n=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,((e,i)=>{const n=rw(i,Pg(e,t));if(n)return n}));return Av(n,t,s,i,!0)}function yw(e,t){const i=t._path;let n=null;e.syncPointTree_.foreachOnPath(i,((e,t)=>{const s=Pg(e,i);n=n||rw(t,s)}));let s=e.syncPointTree_.get(i);s?n=n||rw(s,Tg()):(s=new Zv,e.syncPointTree_=e.syncPointTree_.set(i,s));const r=null!=n,o=r?new ev(n,!0,!1):null;return function(e){return ov(e.viewCache_)}(tw(s,t,_v(e.pendingWriteTree_,t._path),r?o.getNode():vm.EMPTY_NODE,r))}function bw(e,t){return _w(t,e.syncPointTree_,null,_v(e.pendingWriteTree_,Tg()))}function _w(e,t,i,n){if(Ng(e.path))return Cw(e,t,i,n);{const s=t.get(Tg());null==i&&null!=s&&(i=rw(s,Tg()));let r=[];const o=Mg(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=i?i.getImmediateChild(o):null,t=Iv(n,o);r=r.concat(_w(a,l,e,t))}return s&&(r=r.concat(ew(s,e,n,i))),r}}function Cw(e,t,i,n){const s=t.get(Tg());null==i&&null!=s&&(i=rw(s,Tg()));let r=[];return t.children.inorderTraversal(((t,s)=>{const o=i?i.getImmediateChild(t):null,a=Iv(n,t),l=e.operationForChild(t);l&&(r=r.concat(Cw(l,s,o,a)))})),s&&(r=r.concat(ew(s,e,n,i))),r}function Sw(e,t){const i=t.query,n=xw(e,i);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||vm.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return n?function(e,t,i){const n=Aw(e,i);if(n){const i=Ew(n),s=i.path,r=i.queryId,o=Pg(s,t);return Tw(e,s,new Jm(Ym(r),o))}return[]}(e,i._path,n):function(e,t){return bw(e,new Jm({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,i._path);{const n=function(e,t){let i="Unknown Error";"too_big"===e?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?i="Client doesn't have permission to access the desired data.":"unavailable"===e&&(i="The service is unavailable");const n=new Error(e+" at "+t._path.toString()+": "+i);return n.code=e.toUpperCase(),n}(t,i);return mw(e,i,null,n)}}}}function xw(e,t){const i=kw(t);return e.queryToTagMap.get(i)}function kw(e){return e._path.toString()+"$"+e._queryIdentifier}function Aw(e,t){return e.tagToQueryMap.get(t)}function Ew(e){const t=e.indexOf("$");return Rd(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Eg(e.substr(0,t))}}function Tw(e,t,i){const n=e.syncPointTree_.get(t);Rd(n,"Missing sync point for query tag that we're tracking");return ew(n,i,_v(e.pendingWriteTree_,t),null)}function Mw(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Rd(Xv,"Reference.ts has not been loaded"),Xv)(e._repo,e._path):e}class Lw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Lw(t)}node(){return this.node_}}class Rw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Dg(this.path_,e);return new Rw(this.syncTree_,t)}node(){return ww(this.syncTree_,this.path_)}}const $w=function(e,t,i){return e&&"object"==typeof e?(Rd(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Iw(e[".sv"],t,i):"object"==typeof e[".sv"]?Ow(e[".sv"],t):void Rd(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Iw=function(e,t,i){if("timestamp"===e)return i.timestamp;Rd(!1,"Unexpected server value: "+e)},Ow=function(e,t,i){e.hasOwnProperty("increment")||Rd(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const n=e.increment;"number"!=typeof n&&Rd(!1,"Unexpected increment value: "+n);const s=t.node();if(Rd(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return n;const r=s.getValue();return"number"!=typeof r?n:r+n},Dw=function(e,t,i,n){return Pw(t,new Rw(i,e),n)},Nw=function(e,t,i){return Pw(e,new Lw(t),i)};function Pw(e,t,i){const n=e.getPriority().val(),s=$w(n,t.getImmediateChild(".priority"),i);let r;if(e.isLeafNode()){const n=e,r=$w(n.getValue(),t,i);return r!==n.getValue()||s!==n.getPriority().val()?new lm(r,ym(s)):e}{const n=e;return r=n,s!==n.getPriority().val()&&(r=r.updatePriority(new lm(s))),n.forEachChild(hm,((e,n)=>{const s=Pw(n,t.getImmediateChild(e),i);s!==n&&(r=r.updateImmediateChild(e,s))})),r}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Bw(e,t){let i=t instanceof Eg?t:new Eg(t),n=e,s=Mg(i);for(;null!==s;){const e=Zd(n.node.children,s)||{children:{},childCount:0};n=new Fw(s,n,e),i=Rg(i),s=Mg(i)}return n}function Ww(e){return e.node.value}function Hw(e,t){e.node.value=t,Kw(e)}function Vw(e){return e.node.childCount>0}function zw(e,t){tg(e.node.children,((i,n)=>{t(new Fw(i,e,n))}))}function Uw(e,t,i,n){i&&!n&&t(e),zw(e,(e=>{Uw(e,t,!0,n)})),i&&n&&t(e)}function qw(e){return new Eg(null===e.parent?e.name:qw(e.parent)+"/"+e.name)}function Kw(e){null!==e.parent&&function(e,t,i){const n=function(e){return void 0===Ww(e)&&!Vw(e)}(i),s=Xd(e.node.children,t);n&&s?(delete e.node.children[t],e.node.childCount--,Kw(e)):n||s||(e.node.children[t]=i.node,e.node.childCount++,Kw(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.parent,e.name,e)}const jw=/[\[\].#$\/\u0000-\u001F\u007F]/,Gw=/[\[\].#$\u0000-\u001F\u007F]/,Yw=function(e){return"string"==typeof e&&0!==e.length&&!jw.test(e)},Qw=function(e){return"string"==typeof e&&0!==e.length&&!Gw.test(e)},Jw=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!Yp(e)||e&&"object"==typeof e&&Xd(e,".sv")},Xw=function(e,t,i,n){n&&void 0===t||Zw(uf(e,"value"),t,i)},Zw=function(e,t,i){const n=i instanceof Eg?new Hg(i,e):i;if(void 0===t)throw new Error(e+"contains undefined "+zg(n));if("function"==typeof t)throw new Error(e+"contains a function "+zg(n)+" with contents = "+t.toString());if(Yp(t))throw new Error(e+"contains "+t.toString()+" "+zg(n));if("string"==typeof t&&t.length>10485760/3&&gf(t)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+zg(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let i=!1,s=!1;if(tg(t,((t,r)=>{if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!Yw(t)))throw new Error(e+" contains an invalid key ("+t+") "+zg(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,a;a=t,(o=n).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(a),o.byteLength_+=gf(a),Vg(o),Zw(e,r,n),function(e){const t=e.parts_.pop();e.byteLength_-=gf(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)})),i&&s)throw new Error(e+' contains ".value" child '+zg(n)+" in addition to actual children.")}},ey=function(e,t,i,n){if(n&&void 0===t)return;const s=uf(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");const r=[];tg(t,((e,t)=>{const n=new Eg(e);if(Zw(s,t,Dg(i,n)),".priority"===$g(n)&&!Jw(t))throw new Error(s+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(n)})),function(e,t){let i,n;for(i=0;i<t.length;i++){n=t[i];const s=Ig(n);for(let t=0;t<s.length;t++)if(".priority"===s[t]&&t===s.length-1);else if(!Yw(s[t]))throw new Error(e+"contains an invalid key ("+s[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Fg);let s=null;for(i=0;i<t.length;i++){if(n=t[i],null!==s&&Wg(s,n))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString());s=n}}(s,r)},ty=function(e,t,i){if(!i||void 0!==t){if(Yp(t))throw new Error(uf(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Jw(t))throw new Error(uf(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},iy=function(e,t,i,n){if(!(n&&void 0===i||Yw(i)))throw new Error(uf(e,t)+'was an invalid key = "'+i+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ny=function(e,t,i,n){if(!(n&&void 0===i||Qw(i)))throw new Error(uf(e,t)+'was an invalid path = "'+i+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},sy=function(e,t){if(".info"===Mg(t))throw new Error(e+" failed = Can't modify data under /.info/")},ry=function(e,t){const i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Yw(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Qw(e)}(i))throw new Error(uf(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class oy{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ay(e,t){let i=null;for(let n=0;n<t.length;n++){const s=t[n],r=s.getPath();null===i||Bg(r,i.path)||(e.eventLists_.push(i),i=null),null===i&&(i={events:[],path:r}),i.events.push(s)}i&&e.eventLists_.push(i)}function ly(e,t,i){ay(e,i),cy(e,(e=>Bg(e,t)))}function hy(e,t,i){ay(e,i),cy(e,(e=>Wg(e,t)||Wg(t,e)))}function cy(e,t){e.recursionDepth_++;let i=!0;for(let n=0;n<e.eventLists_.length;n++){const s=e.eventLists_[n];if(s){t(s.path)?(uy(e.eventLists_[n]),e.eventLists_[n]=null):i=!1}}i&&(e.eventLists_=[]),e.recursionDepth_--}function uy(e){for(let t=0;t<e.events.length;t++){const i=e.events[t];if(null!==i){e.events[t]=null;const n=i.getEventRunner();Hp&&Up("event: "+i.toString()),rg(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e,t,i,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new oy,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Hm(),this.transactionQueueTree_=new Fw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function fy(e,t,i){if(e.stats_=mg(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Bm(e.repoInfo_,((t,i,n,s)=>{my(e,t,i,n,s)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>vy(e,!0)),0);else{if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Gd(i)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new qg(e.repoInfo_,t,((t,i,n,s)=>{my(e,t,i,n,s)}),(t=>{vy(e,t)}),(t=>{!function(e,t){tg(t,((t,i)=>{wy(e,t,i)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,i),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const i=e.toString();return gg[i]||(gg[i]=t()),gg[i]}(e.repoInfo_,(()=>new Km(e.stats_,e.server_))),e.infoData_=new Wm,e.infoSyncTree_=new uw({startListening:(t,i,n,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=gw(e.infoSyncTree_,t._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),wy(e,"connected",!1),e.serverSyncTree_=new uw({startListening:(t,i,n,s)=>(e.server_.listen(t,n,i,((i,n)=>{const r=s(i,n);hy(e.eventQueue_,t._path,r)})),[]),stopListening:(t,i)=>{e.server_.unlisten(t,i)}})}function py(e){const t=e.infoData_.getNode(new Eg(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function gy(e){return(t=(t={timestamp:py(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function my(e,t,i,n,s){e.dataUpdateCount++;const r=new Eg(t);i=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,i):i;let o=[];if(s)if(n){const t=tf(i,(e=>ym(e)));o=function(e,t,i,n){const s=Aw(e,n);if(s){const n=Ew(s),r=n.path,o=n.queryId,a=Pg(r,t),l=hv.fromObject(i);return Tw(e,r,new Zm(Ym(o),a,l))}return[]}(e.serverSyncTree_,r,t,s)}else{const t=ym(i);o=function(e,t,i,n){const s=Aw(e,n);if(null!=s){const n=Ew(s),r=n.path,o=n.queryId,a=Pg(r,t);return Tw(e,r,new Xm(Ym(o),a,i))}return[]}(e.serverSyncTree_,r,t,s)}else if(n){const t=tf(i,(e=>ym(e)));o=function(e,t,i){const n=hv.fromObject(i);return bw(e,new Zm({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,r,t)}else{const t=ym(i);o=gw(e.serverSyncTree_,r,t)}let a=r;o.length>0&&(a=My(e,r)),hy(e.eventQueue_,a,o)}function vy(e,t){wy(e,"connected",t),!1===t&&function(e){ky(e,"onDisconnectEvents");const t=gy(e),i=Hm();Um(e.onDisconnect_,Tg(),((n,s)=>{const r=Dw(n,s,e.serverSyncTree_,t);Vm(i,n,r)}));let n=[];Um(i,Tg(),((t,i)=>{n=n.concat(gw(e.serverSyncTree_,t,i));const s=Oy(e,t);My(e,s)})),e.onDisconnect_=Hm(),hy(e.eventQueue_,Tg(),n)}(e)}function wy(e,t,i){const n=new Eg("/.info/"+t),s=ym(i);e.infoData_.updateSnapshot(n,s);const r=gw(e.infoSyncTree_,n,s);hy(e.eventQueue_,n,r)}function yy(e){return e.nextWriteId_++}function by(e,t,i,n,s){ky(e,"set",{path:t.toString(),value:i,priority:n});const r=gy(e),o=ym(i,n),a=ww(e.serverSyncTree_,t),l=Nw(o,a,r),h=yy(e),c=dw(e.serverSyncTree_,t,l,h,!0);ay(e.eventQueue_,c),e.server_.put(t.toString(),o.val(!0),((i,n)=>{const r="ok"===i;r||Gp("set at "+t+" failed: "+i);const o=pw(e.serverSyncTree_,h,!r);hy(e.eventQueue_,t,o),Ay(e,s,i,n)}));const u=Oy(e,t);My(e,u),hy(e.eventQueue_,u,[])}function _y(e,t,i){e.server_.onDisconnectCancel(t.toString(),((n,s)=>{"ok"===n&&zm(e.onDisconnect_,t),Ay(e,i,n,s)}))}function Cy(e,t,i,n){const s=ym(i);e.server_.onDisconnectPut(t.toString(),s.val(!0),((i,r)=>{"ok"===i&&Vm(e.onDisconnect_,t,s),Ay(e,n,i,r)}))}function Sy(e,t,i){let n;n=".info"===Mg(t._path)?mw(e.infoSyncTree_,t,i):mw(e.serverSyncTree_,t,i),ly(e.eventQueue_,t._path,n)}function xy(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}function ky(e,...t){let i="";e.persistentConnection_&&(i=e.persistentConnection_.id+":"),Up(i,...t)}function Ay(e,t,i,n){t&&rg((()=>{if("ok"===i)t(null);else{const e=(i||"error").toUpperCase();let s=e;n&&(s+=": "+n);const r=new Error(s);r.code=e,t(r)}}))}function Ey(e,t,i){return ww(e.serverSyncTree_,t,i)||vm.EMPTY_NODE}function Ty(e,t=e.transactionQueueTree_){if(t||Iy(e,t),Ww(t)){const i=Ry(e,t);Rd(i.length>0,"Sending zero length transaction queue");i.every((e=>0===e.status))&&function(e,t,i){const n=i.map((e=>e.currentWriteId)),s=Ey(e,t,n);let r=s;const o=s.hash();for(let e=0;e<i.length;e++){const n=i[e];Rd(0===n.status,"tryToSendTransactionQueue_: items in queue should all be run."),n.status=1,n.retryCount++;const s=Pg(t,n.path);r=r.updateChild(s,n.currentOutputSnapshotRaw)}const a=r.val(!0),l=t;e.server_.put(l.toString(),a,(n=>{ky(e,"transaction put response",{path:l.toString(),status:n});let s=[];if("ok"===n){const n=[];for(let t=0;t<i.length;t++)i[t].status=2,s=s.concat(pw(e.serverSyncTree_,i[t].currentWriteId)),i[t].onComplete&&n.push((()=>i[t].onComplete(null,!0,i[t].currentOutputSnapshotResolved))),i[t].unwatcher();Iy(e,Bw(e.transactionQueueTree_,t)),Ty(e,e.transactionQueueTree_),hy(e.eventQueue_,t,s);for(let e=0;e<n.length;e++)rg(n[e])}else{if("datastale"===n)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{Gp("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=n}My(e,t)}}),o)}(e,qw(t),i)}else Vw(t)&&zw(t,(t=>{Ty(e,t)}))}function My(e,t){const i=Ly(e,t),n=qw(i);return function(e,t,i){if(0===t.length)return;const n=[];let s=[];const r=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let a=0;a<t.length;a++){const l=t[a],h=Pg(i,l.path);let c,u=!1;if(Rd(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)u=!0,c=l.abortReason,s=s.concat(pw(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)u=!0,c="maxretry",s=s.concat(pw(e.serverSyncTree_,l.currentWriteId,!0));else{const i=Ey(e,l.path,r);l.currentInputSnapshot=i;const n=t[a].update(i.val());if(void 0!==n){Zw("transaction failed: Data returned ",n,l.path);let t=ym(n);"object"==typeof n&&null!=n&&Xd(n,".priority")||(t=t.updatePriority(i.getPriority()));const o=l.currentWriteId,a=gy(e),h=Nw(t,i,a);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=h,l.currentWriteId=yy(e),r.splice(r.indexOf(o),1),s=s.concat(dw(e.serverSyncTree_,l.path,h,l.currentWriteId,l.applyLocally)),s=s.concat(pw(e.serverSyncTree_,o,!0))}else u=!0,c="nodata",s=s.concat(pw(e.serverSyncTree_,l.currentWriteId,!0))}hy(e.eventQueue_,i,s),s=[],u&&(t[a].status=2,o=t[a].unwatcher,setTimeout(o,Math.floor(0)),t[a].onComplete&&("nodata"===c?n.push((()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot))):n.push((()=>t[a].onComplete(new Error(c),!1,null)))))}var o;Iy(e,e.transactionQueueTree_);for(let e=0;e<n.length;e++)rg(n[e]);Ty(e,e.transactionQueueTree_)}(e,Ry(e,i),n),n}function Ly(e,t){let i,n=e.transactionQueueTree_;for(i=Mg(t);null!==i&&void 0===Ww(n);)n=Bw(n,i),i=Mg(t=Rg(t));return n}function Ry(e,t){const i=[];return $y(e,t,i),i.sort(((e,t)=>e.order-t.order)),i}function $y(e,t,i){const n=Ww(t);if(n)for(let e=0;e<n.length;e++)i.push(n[e]);zw(t,(t=>{$y(e,t,i)}))}function Iy(e,t){const i=Ww(t);if(i){let e=0;for(let t=0;t<i.length;t++)2!==i[t].status&&(i[e]=i[t],e++);i.length=e,Hw(t,i.length>0?i:void 0)}zw(t,(t=>{Iy(e,t)}))}function Oy(e,t){const i=qw(Ly(e,t)),n=Bw(e.transactionQueueTree_,t);return function(e,t,i){let n=i?e:e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(n,(t=>{Dy(e,t)})),Dy(e,n),Uw(n,(t=>{Dy(e,t)})),i}function Dy(e,t){const i=Ww(t);if(i){const n=[];let s=[],r=-1;for(let t=0;t<i.length;t++)3===i[t].status||(1===i[t].status?(Rd(r===t-1,"All SENT items should be at beginning of queue."),r=t,i[t].status=3,i[t].abortReason="set"):(Rd(0===i[t].status,"Unexpected transaction status in abort"),i[t].unwatcher(),s=s.concat(pw(e.serverSyncTree_,i[t].currentWriteId,!0)),i[t].onComplete&&n.push(i[t].onComplete.bind(null,new Error("set"),!1,null))));-1===r?Hw(t,void 0):i.length=r+1,hy(e.eventQueue_,qw(t),s);for(let e=0;e<n.length;e++)rg(n[e])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny=function(e,t){const i=Py(e),n=i.namespace;"firebase.com"===i.domain&&jp(i.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===i.domain||jp("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),i.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Gp("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===i.scheme||"wss"===i.scheme;return{repoInfo:new ug(i.host,i.secure,n,s,t,"",n!==i.subdomain),path:new Eg(i.pathString)}},Py=function(e){let t="",i="",n="",s="",r="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let c=e.indexOf("/");-1===c&&(c=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(c,u)),c<u&&(s=function(e){let t="";const i=e.split("/");for(let e=0;e<i.length;e++)if(i[e].length>0){let n=i[e];try{n=decodeURIComponent(n.replace(/\+/g," "))}catch(e){}t+="/"+n}return t}(e.substring(c,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const i of e.split("&")){if(0===i.length)continue;const n=i.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Gp(`Invalid query segment '${i}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));h=t.indexOf(":"),h>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;const f=t.slice(0,h);if("localhost"===f.toLowerCase())i="localhost";else if(f.split(".").length<=2)i=f;else{const e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),i=t.substring(e+1),r=n}"ns"in d&&(r=d.ns)}return{host:t,port:l,domain:i,subdomain:n,secure:o,scheme:a,pathString:s,namespace:r}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Fy{constructor(e,t,i,n){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=n}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Gd(this.snapshot.exportVal())}}class By{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Rd(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Bd;return _y(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){sy("OnDisconnect.remove",this._path);const e=new Bd;return Cy(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){sy("OnDisconnect.set",this._path),Xw("OnDisconnect.set",e,this._path,!1);const t=new Bd;return Cy(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){sy("OnDisconnect.setWithPriority",this._path),Xw("OnDisconnect.setWithPriority",e,this._path,!1),ty("OnDisconnect.setWithPriority",t,!1);const i=new Bd;return function(e,t,i,n,s){const r=ym(i,n);e.server_.onDisconnectPut(t.toString(),r.val(!0),((i,n)=>{"ok"===i&&Vm(e.onDisconnect_,t,r),Ay(0,s,i,n)}))}(this._repo,this._path,e,t,i.wrapCallback((()=>{}))),i.promise}update(e){sy("OnDisconnect.update",this._path),ey("OnDisconnect.update",e,this._path,!1);const t=new Bd;return function(e,t,i,n){if(ef(i))return Up("onDisconnect().update() called with empty data.  Don't do anything."),void Ay(0,n,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),i,((s,r)=>{"ok"===s&&tg(i,((i,n)=>{const s=ym(n);Vm(e.onDisconnect_,Dg(t,i),s)})),Ay(0,n,s,r)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e,t,i,n){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=n}get key(){return Ng(this._path)?null:$g(this._path)}get ref(){return new Ky(this._repo,this._path)}get _queryIdentifier(){const e=Fm(this._queryParams),t=Zp(e);return"{}"===t?"default":t}get _queryObject(){return Fm(this._queryParams)}isEqual(e){if(!((e=mf(e))instanceof Vy))return!1;const t=this._repo===e._repo,i=Bg(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&i&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let i=e.pieceNum_;i<e.pieces_.length;i++)""!==e.pieces_[i]&&(t+="/"+encodeURIComponent(String(e.pieces_[i])));return t||"/"}(this._path)}}function zy(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Uy(e){let t=null,i=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(i=e.getIndexEndValue()),e.getIndex()===Qg){const n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if("[MIN_NAME]"!==e.getIndexStartName())throw new Error(n);if("string"!=typeof t)throw new Error(s)}if(e.hasEnd()){if("[MAX_NAME]"!==e.getIndexEndName())throw new Error(n);if("string"!=typeof i)throw new Error(s)}}else if(e.getIndex()===hm){if(null!=t&&!Jw(t)||null!=i&&!Jw(i))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Rd(e.getIndex()instanceof bm||e.getIndex()===_m,"unknown index type."),null!=t&&"object"==typeof t||null!=i&&"object"==typeof i)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function qy(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Ky extends Vy{constructor(e,t){super(e,t,new Im,!1)}get parent(){const e=Og(this._path);return null===e?null:new Ky(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class jy{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Eg(e),i=Qy(this.ref,e);return new jy(this._node.getChild(t),i,hm)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,i)=>e(new jy(i,Qy(this.ref,t),hm))))}hasChild(e){const t=new Eg(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Gy(e,t){return(e=mf(e))._checkNotDeleted("ref"),void 0!==t?Qy(e._root,t):e._root}function Yy(e,t){(e=mf(e))._checkNotDeleted("refFromURL");const i=Ny(t,e._repo.repoInfo_.nodeAdmin);ry("refFromURL",i);const n=i.repoInfo;return e._repo.repoInfo_.isCustomHost()||n.host===e._repo.repoInfo_.host||jp("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+e._repo.repoInfo_.host+")"),Gy(e,i.path.toString())}function Qy(e,t){var i,n,s,r;return null===Mg((e=mf(e))._path)?(i="child",n="path",r=!1,(s=t)&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),ny(i,n,s,r)):ny("child","path",t,!1),new Ky(e._repo,Dg(e._path,t))}function Jy(e,t){e=mf(e),sy("push",e._path),Xw("push",t,e._path,!0);const i=py(e._repo),n=Sm(i),s=Qy(e,n),r=Qy(e,n);let o;return o=null!=t?Xy(r,t).then((()=>r)):Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Xy(e,t){e=mf(e),sy("set",e._path),Xw("set",t,e._path,!1);const i=new Bd;return by(e._repo,e._path,t,null,i.wrapCallback((()=>{}))),i.promise}function Zy(e,t){e=mf(e),sy("setPriority",e._path),ty("setPriority",t,!1);const i=new Bd;return by(e._repo,Dg(e._path,".priority"),t,null,i.wrapCallback((()=>{}))),i.promise}function eb(e,t,i){if(sy("setWithPriority",e._path),Xw("setWithPriority",t,e._path,!1),ty("setWithPriority",i,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const n=new Bd;return by(e._repo,e._path,t,i,n.wrapCallback((()=>{}))),n.promise}function tb(e,t){ey("update",t,e._path,!1);const i=new Bd;return function(e,t,i,n){ky(e,"update",{path:t.toString(),value:i});let s=!0;const r=gy(e),o={};if(tg(i,((i,n)=>{s=!1,o[i]=Dw(Dg(t,i),ym(n),e.serverSyncTree_,r)})),s)Up("update() called with empty data.  Don't do anything."),Ay(0,n,"ok",void 0);else{const s=yy(e),r=fw(e.serverSyncTree_,t,o,s);ay(e.eventQueue_,r),e.server_.merge(t.toString(),i,((i,r)=>{const o="ok"===i;o||Gp("update at "+t+" failed: "+i);const a=pw(e.serverSyncTree_,s,!o),l=a.length>0?My(e,t):t;hy(e.eventQueue_,l,a),Ay(0,n,i,r)})),tg(i,(i=>{const n=Oy(e,Dg(t,i));My(e,n)})),hy(e.eventQueue_,t,[])}}(e._repo,e._path,t,i.wrapCallback((()=>{}))),i.promise}function ib(e){return function(e,t){const i=yw(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then((i=>{const n=ym(i).withIndex(t._queryParams.getIndex()),s=gw(e.serverSyncTree_,t._path,n);return ly(e.eventQueue_,t._path,s),Promise.resolve(n)}),(i=>(ky(e,"get for query "+Gd(t)+" failed: "+i),Promise.reject(new Error(i)))))}((e=mf(e))._repo,e).then((t=>new jy(t,new Ky(e._repo,e._path),e._queryParams.getIndex())))}class nb{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const i=t._queryParams.getIndex();return new Fy("value",this,new jy(e.snapshotNode,new Ky(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new By(this,e,t):null}matches(e){return e instanceof nb&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class sb{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new By(this,e,t):null}createEvent(e,t){Rd(null!=e.childName,"Child events should have a childName.");const i=Qy(new Ky(t._repo,t._path),e.childName),n=t._queryParams.getIndex();return new Fy(e.type,this,new jy(e.snapshotNode,i,n),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof sb&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function rb(e,t,i,n,s){let r;if("object"==typeof n&&(r=void 0,s=n),"function"==typeof n&&(r=n),s&&s.onlyOnce){const t=i,n=(i,n)=>{Sy(e._repo,e,a),t(i,n)};n.userCallback=i.userCallback,n.context=i.context,i=n}const o=new Wy(i,r||void 0),a="value"===t?new nb(o):new sb(t,o);return function(e,t,i){let n;n=".info"===Mg(t._path)?vw(e.infoSyncTree_,t,i):vw(e.serverSyncTree_,t,i),ly(e.eventQueue_,t._path,n)}(e._repo,e,a),()=>Sy(e._repo,e,a)}function ob(e,t,i,n){return rb(e,"value",t,i,n)}function ab(e,t,i,n){return rb(e,"child_added",t,i,n)}function lb(e,t,i,n){return rb(e,"child_changed",t,i,n)}function hb(e,t,i,n){return rb(e,"child_moved",t,i,n)}function cb(e,t,i,n){return rb(e,"child_removed",t,i,n)}function ub(e,t,i){let n=null;const s=i?new Wy(i):null;"value"===t?n=new nb(s):t&&(n=new sb(t,s)),Sy(e._repo,e,n)}class db{}class fb extends db{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xw("endAt",this._value,e._path,!0);const t=Dm(e._queryParams,this._value,this._key);if(qy(t),Uy(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Vy(e._repo,e._path,t,e._orderByCalled)}}function pb(e,t){return iy("endAt","key",t,!0),new fb(e,t)}class gb extends db{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xw("endBefore",this._value,e._path,!1);const t=function(e,t,i){let n,s;return e.index_===Qg?("string"==typeof t&&(t=km(t)),s=Dm(e,t,i)):(n=null==i?"[MIN_NAME]":km(i),s=Dm(e,t,n)),s.endBeforeSet_=!0,s}(e._queryParams,this._value,this._key);if(qy(t),Uy(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Vy(e._repo,e._path,t,e._orderByCalled)}}function mb(e,t){return iy("endBefore","key",t,!0),new gb(e,t)}class vb extends db{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xw("startAt",this._value,e._path,!0);const t=Om(e._queryParams,this._value,this._key);if(qy(t),Uy(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Vy(e._repo,e._path,t,e._orderByCalled)}}function wb(e=null,t){return iy("startAt","key",t,!0),new vb(e,t)}class yb extends db{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Xw("startAfter",this._value,e._path,!1);const t=function(e,t,i){let n;if(e.index_===Qg)"string"==typeof t&&(t=xm(t)),n=Om(e,t,i);else{let s;s=null==i?"[MAX_NAME]":xm(i),n=Om(e,t,s)}return n.startAfterSet_=!0,n}(e._queryParams,this._value,this._key);if(qy(t),Uy(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Vy(e._repo,e._path,t,e._orderByCalled)}}function bb(e,t){return iy("startAfter","key",t,!0),new yb(e,t)}class _b extends db{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Vy(e._repo,e._path,function(e,t){const i=e.copy();return i.limitSet_=!0,i.limit_=t,i.viewFrom_="l",i}(e._queryParams,this._limit),e._orderByCalled)}}function Cb(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new _b(e)}class Sb extends db{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Vy(e._repo,e._path,function(e,t){const i=e.copy();return i.limitSet_=!0,i.limit_=t,i.viewFrom_="r",i}(e._queryParams,this._limit),e._orderByCalled)}}function xb(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Sb(e)}class kb extends db{constructor(e){super(),this._path=e}_apply(e){zy(e,"orderByChild");const t=new Eg(this._path);if(Ng(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new bm(t),n=Nm(e._queryParams,i);return Uy(n),new Vy(e._repo,e._path,n,!0)}}function Ab(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ny("orderByChild","path",e,!1),new kb(e)}class Eb extends db{_apply(e){zy(e,"orderByKey");const t=Nm(e._queryParams,Qg);return Uy(t),new Vy(e._repo,e._path,t,!0)}}class Tb extends db{_apply(e){zy(e,"orderByPriority");const t=Nm(e._queryParams,hm);return Uy(t),new Vy(e._repo,e._path,t,!0)}}class Mb extends db{_apply(e){zy(e,"orderByValue");const t=Nm(e._queryParams,_m);return Uy(t),new Vy(e._repo,e._path,t,!0)}}class Lb extends db{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Xw("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new fb(this._value,this._key)._apply(new vb(this._value,this._key)._apply(e))}}function Rb(e,t){return iy("equalTo","key",t,!0),new Lb(e,t)}function $b(e,...t){let i=mf(e);for(const e of t)i=e._apply(i);return i}!function(e){Rd(!Jv,"__referenceConstructor has already been defined"),Jv=e}(Ky),function(e){Rd(!Xv,"__referenceConstructor has already been defined"),Xv=e}(Ky);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ib={};let Ob=!1;function Db(e,t,i,n,s){let r=n||e.options.databaseURL;void 0===r&&(e.options.projectId||jp("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Up("Using default host for project ",e.options.projectId),r=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=Ny(r,s),h=l.repoInfo;void 0!==Mp&&Mp.env&&(a=Mp.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r=`http://${a}?ns=${h.namespace}`,l=Ny(r,s),h=l.repoInfo):o=!l.repoInfo.secure;const c=s&&o?new hg(hg.OWNER):new lg(e.name,e.options,t);ry("Invalid Firebase Database URL",l),Ng(l.path)||jp("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,i,n){let s=Ib[t.name];s||(s={},Ib[t.name]=s);let r=s[e.toURLString()];r&&jp("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return r=new dy(e,Ob,i,n),s[e.toURLString()]=r,r}(h,e,c,new ag(e.name,i));return new Nb(u,e)}class Nb{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(fy(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ky(this._repo,Tg())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const i=Ib[t];i&&i[e.key]===e||jp(`Database ${t}(${e.repoInfo_}) has already been deleted.`),xy(e),delete i[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&jp("Cannot call "+e+" on a deleted database.")}}function Pb(){Cg.IS_TRANSPORT_INITIALIZED&&Gp("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Fb(){Pb(),wg.forceDisallow()}function Bb(){Pb(),_g.forceDisallow(),wg.forceAllow()}function Wb(e,t,i,n={}){(e=mf(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&jp("Cannot call useEmulator() after instance has already been initialized.");const s=e._repoInternal;let r;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&jp('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new hg(hg.OWNER);else if(n.mockUserToken){const t="string"==typeof n.mockUserToken?n.mockUserToken:Wd(n.mockUserToken,e.app.options.projectId);r=new hg(t)}!function(e,t,i,n){e.repoInfo_=new ug(`${t}:${i}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),n&&(e.authTokenProvider_=n)}(s,t,i,r)}function Hb(e,t){zp(e,t)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Vb={".sv":"timestamp"};function zb(e){return{".sv":{increment:e}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ub{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function qb(e,t,i){var n;if(e=mf(e),sy("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";const s=null===(n=null==i?void 0:i.applyLocally)||void 0===n||n,r=new Bd,o=ob(e,(()=>{}));return function(e,t,i,n,s,r){ky(e,"transaction on "+t);const o={path:t,update:i,onComplete:n,status:null,order:Fp(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Ey(e,t,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(void 0===l)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Zw("transaction failed: Data returned ",l,o.path),o.status=0;const i=Bw(e.transactionQueueTree_,t),n=Ww(i)||[];let s;n.push(o),Hw(i,n),"object"==typeof l&&null!==l&&Xd(l,".priority")?(s=Zd(l,".priority"),Rd(Jw(s),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):s=(ww(e.serverSyncTree_,t)||vm.EMPTY_NODE).getPriority().val();const r=gy(e),h=ym(l,s),c=Nw(h,a,r);o.currentOutputSnapshotRaw=h,o.currentOutputSnapshotResolved=c,o.currentWriteId=yy(e);const u=dw(e.serverSyncTree_,t,c,o.currentWriteId,o.applyLocally);hy(e.eventQueue_,t,u),Ty(e,e.transactionQueueTree_)}}(e._repo,e._path,t,((t,i,n)=>{let s=null;t?r.reject(t):(s=new jy(n,new Ky(e._repo,e._path),hm),r.resolve(new Ub(i,s)))}),o,s),r.promise}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qg.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},qg.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){Rp(ap),tp(new vf("database",((e,{instanceIdentifier:t})=>Db(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),dp("@firebase/database","0.13.1",e),dp("@firebase/database","0.13.1","esm2017")}();const Kb=new Tf("@firebase/database-compat"),jb=function(e){const t="FIREBASE WARNING: "+e;Kb.warn(t)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Gb{constructor(e){this._delegate=e}cancel(e){cf("OnDisconnect.cancel",0,1,arguments.length),df("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then((()=>e(null)),(t=>e(t))),t}remove(e){cf("OnDisconnect.remove",0,1,arguments.length),df("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then((()=>e(null)),(t=>e(t))),t}set(e,t){cf("OnDisconnect.set",1,2,arguments.length),df("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then((()=>t(null)),(e=>t(e))),i}setWithPriority(e,t,i){cf("OnDisconnect.setWithPriority",2,3,arguments.length),df("OnDisconnect.setWithPriority","onComplete",i,!0);const n=this._delegate.setWithPriority(e,t);return i&&n.then((()=>i(null)),(e=>i(e))),n}update(e,t){if(cf("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,jb("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}df("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then((()=>t(null)),(e=>t(e))),i}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return cf("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(e,t){this._database=e,this._delegate=t}val(){return cf("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return cf("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return cf("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return cf("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return cf("DataSnapshot.child",0,1,arguments.length),e=String(e),ny("DataSnapshot.child","path",e,!1),new Qb(this._database,this._delegate.child(e))}hasChild(e){return cf("DataSnapshot.hasChild",1,1,arguments.length),ny("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return cf("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return cf("DataSnapshot.forEach",1,1,arguments.length),df("DataSnapshot.forEach","action",e,!1),this._delegate.forEach((t=>e(new Qb(this._database,t))))}hasChildren(){return cf("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return cf("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return cf("DataSnapshot.ref",0,0,arguments.length),new Xb(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Jb{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,n){var s;cf("Query.on",2,4,arguments.length),df("Query.on","callback",t,!1);const r=Jb.getCancelAndContextArgs_("Query.on",i,n),o=(e,i)=>{t.call(r.context,new Qb(this.database,e),i)};o.userCallback=t,o.context=r.context;const a=null===(s=r.cancel)||void 0===s?void 0:s.bind(r.context);switch(e){case"value":return ob(this._delegate,o,a),t;case"child_added":return ab(this._delegate,o,a),t;case"child_removed":return cb(this._delegate,o,a),t;case"child_changed":return lb(this._delegate,o,a),t;case"child_moved":return hb(this._delegate,o,a),t;default:throw new Error(uf("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(cf("Query.off",0,3,arguments.length),function(e,t,i){if(!i||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(uf(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),df("Query.off","callback",t,!0),ff("Query.off","context",i,!0),t){const n=()=>{};n.userCallback=t,n.context=i,ub(this._delegate,e,n)}else ub(this._delegate,e)}get(){return ib(this._delegate).then((e=>new Qb(this.database,e)))}once(e,t,i,n){cf("Query.once",1,4,arguments.length),df("Query.once","callback",t,!0);const s=Jb.getCancelAndContextArgs_("Query.once",i,n),r=new Bd,o=(e,i)=>{const n=new Qb(this.database,e);t&&t.call(s.context,n,i),r.resolve(n)};o.userCallback=t,o.context=s.context;const a=e=>{s.cancel&&s.cancel.call(s.context,e),r.reject(e)};switch(e){case"value":ob(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":ab(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":cb(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":lb(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":hb(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(uf("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return r.promise}limitToFirst(e){return cf("Query.limitToFirst",1,1,arguments.length),new Jb(this.database,$b(this._delegate,Cb(e)))}limitToLast(e){return cf("Query.limitToLast",1,1,arguments.length),new Jb(this.database,$b(this._delegate,xb(e)))}orderByChild(e){return cf("Query.orderByChild",1,1,arguments.length),new Jb(this.database,$b(this._delegate,Ab(e)))}orderByKey(){return cf("Query.orderByKey",0,0,arguments.length),new Jb(this.database,$b(this._delegate,new Eb))}orderByPriority(){return cf("Query.orderByPriority",0,0,arguments.length),new Jb(this.database,$b(this._delegate,new Tb))}orderByValue(){return cf("Query.orderByValue",0,0,arguments.length),new Jb(this.database,$b(this._delegate,new Mb))}startAt(e=null,t){return cf("Query.startAt",0,2,arguments.length),new Jb(this.database,$b(this._delegate,wb(e,t)))}startAfter(e=null,t){return cf("Query.startAfter",0,2,arguments.length),new Jb(this.database,$b(this._delegate,bb(e,t)))}endAt(e=null,t){return cf("Query.endAt",0,2,arguments.length),new Jb(this.database,$b(this._delegate,pb(e,t)))}endBefore(e=null,t){return cf("Query.endBefore",0,2,arguments.length),new Jb(this.database,$b(this._delegate,mb(e,t)))}equalTo(e,t){return cf("Query.equalTo",1,2,arguments.length),new Jb(this.database,$b(this._delegate,Rb(e,t)))}toString(){return cf("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return cf("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(cf("Query.isEqual",1,1,arguments.length),!(e instanceof Jb)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const n={cancel:void 0,context:void 0};if(t&&i)n.cancel=t,df(e,"cancel",n.cancel,!0),n.context=i,ff(e,"context",n.context,!0);else if(t)if("object"==typeof t&&null!==t)n.context=t;else{if("function"!=typeof t)throw new Error(uf(e,"cancelOrContext")+" must either be a cancel callback or a context object.");n.cancel=t}return n}get ref(){return new Xb(this.database,new Ky(this._delegate._repo,this._delegate._path))}}class Xb extends Jb{constructor(e,t){super(e,new Vy(t._repo,t._path,new Im,!1)),this.database=e,this._delegate=t}getKey(){return cf("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return cf("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new Xb(this.database,Qy(this._delegate,e))}getParent(){cf("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Xb(this.database,e):null}getRoot(){return cf("Reference.root",0,0,arguments.length),new Xb(this.database,this._delegate.root)}set(e,t){cf("Reference.set",1,2,arguments.length),df("Reference.set","onComplete",t,!0);const i=Xy(this._delegate,e);return t&&i.then((()=>t(null)),(e=>t(e))),i}update(e,t){if(cf("Reference.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let i=0;i<e.length;++i)t[""+i]=e[i];e=t,jb("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}sy("Reference.update",this._delegate._path),df("Reference.update","onComplete",t,!0);const i=tb(this._delegate,e);return t&&i.then((()=>t(null)),(e=>t(e))),i}setWithPriority(e,t,i){cf("Reference.setWithPriority",2,3,arguments.length),df("Reference.setWithPriority","onComplete",i,!0);const n=eb(this._delegate,e,t);return i&&n.then((()=>i(null)),(e=>i(e))),n}remove(e){cf("Reference.remove",0,1,arguments.length),df("Reference.remove","onComplete",e,!0);const t=(i=this._delegate,sy("remove",i._path),Xy(i,null));var i;return e&&t.then((()=>e(null)),(t=>e(t))),t}transaction(e,t,i){cf("Reference.transaction",1,3,arguments.length),df("Reference.transaction","transactionUpdate",e,!1),df("Reference.transaction","onComplete",t,!0),function(e,t,i,n){if((!n||void 0!==i)&&"boolean"!=typeof i)throw new Error(uf(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",i,!0);const n=qb(this._delegate,e,{applyLocally:i}).then((e=>new Yb(e.committed,new Qb(this.database,e.snapshot))));return t&&n.then((e=>t(null,e.committed,e.snapshot)),(e=>t(e,!1,null))),n}setPriority(e,t){cf("Reference.setPriority",1,2,arguments.length),df("Reference.setPriority","onComplete",t,!0);const i=Zy(this._delegate,e);return t&&i.then((()=>t(null)),(e=>t(e))),i}push(e,t){cf("Reference.push",0,2,arguments.length),df("Reference.push","onComplete",t,!0);const i=Jy(this._delegate,e),n=i.then((e=>new Xb(this.database,e)));t&&n.then((()=>t(null)),(e=>t(e)));const s=new Xb(this.database,i);return s.then=n.then.bind(n),s.catch=n.catch.bind(n,void 0),s}onDisconnect(){return sy("Reference.onDisconnect",this._delegate._path),new Gb(new Hy(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Fb,forceLongPolling:Bb}}useEmulator(e,t,i={}){Wb(this._delegate,e,t,i)}ref(e){if(cf("database.ref",0,1,arguments.length),e instanceof Xb){const t=Yy(this._delegate,e.toString());return new Xb(this,t)}{const t=Gy(this._delegate,e);return new Xb(this,t)}}refFromURL(e){cf("database.refFromURL",1,1,arguments.length);const t=Yy(this._delegate,e);return new Xb(this,t)}goOffline(){return cf("database.goOffline",0,0,arguments.length),(e=mf(e=this._delegate))._checkNotDeleted("goOffline"),void xy(e._repo);var e}goOnline(){return cf("database.goOnline",0,0,arguments.length),(e=mf(e=this._delegate))._checkNotDeleted("goOnline"),void((t=e._repo).persistentConnection_&&t.persistentConnection_.resume("repo_interrupt"));var e,t}}Zb.ServerValue={TIMESTAMP:Vb,increment:e=>zb(e)};var e_=Object.freeze({__proto__:null,initStandalone:
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function({app:e,url:t,version:i,customAuthImpl:n,namespace:s,nodeAdmin:r=!1}){Rp(i);const o=new wf("auth-internal",new yf("database-standalone"));return o.setComponent(new vf("auth-internal",(()=>n),"PRIVATE")),{instance:new Zb(Db(e,o,void 0,t,r),e),namespace:s}}});
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t_=Zb.ServerValue;var i_;(i_=Tp).INTERNAL.registerComponent(new vf("database-compat",((e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),n=e.getProvider("database").getImmediate({identifier:t});return new Zb(n,i)}),"PUBLIC").setServiceProps({Reference:Xb,Query:Jb,Database:Zb,DataSnapshot:Qb,enableLogging:Hb,INTERNAL:e_,ServerValue:t_}).setMultipleInstances(!0)),i_.registerVersion("@firebase/database-compat","0.2.1");const n_={makeEventEmitter:function(e,t){e.prototype.allowedEvents_=t,e.prototype.on=function(e,t,i){this.validateEventType_(e),this.eventListeners_=this.eventListeners_||{},this.eventListeners_[e]=this.eventListeners_[e]||[],this.eventListeners_[e].push({callback:t,context:i})},e.prototype.off=function(e,t){this.validateEventType_(e),this.eventListeners_=this.eventListeners_||{};for(var i=this.eventListeners_[e]||[],n=0;n<i.length;n++)if(i[n].callback===t)return void i.splice(n,1)},e.prototype.trigger=function(e){this.eventListeners_=this.eventListeners_||{};for(var t=this.eventListeners_[e]||[],i=0;i<t.length;i++)t[i].callback.apply(t[i].context,Array.prototype.slice.call(arguments,1))},e.prototype.validateEventType_=function(e){if(this.allowedEvents_){for(var t=!1,i=0;i<this.allowedEvents_.length;i++)if(this.allowedEvents_[i]===e){t=!0;break}if(!t)throw new Error('Unknown event "'+e+'"')}}},elt:function(e,t,i){var n=document.createElement(e);if("string"==typeof t)n_.setTextContent(n,t);else if(t)for(var s=0;s<t.length;++s)n.appendChild(t[s]);for(var r in i||{})n.setAttribute(r,i[r]);return n},setTextContent:function(e,t){e.innerHTML="",e.appendChild(document.createTextNode(t))},on:function(e,t,i,n){e.addEventListener?e.addEventListener(t,i,n||!1):e.attachEvent&&e.attachEvent("on"+t,i)},off:function(e,t,i,n){e.removeEventListener?e.removeEventListener(t,i,n||!1):e.detachEvent&&e.detachEvent("on"+t,i)},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},stopEvent:function(e){n_.preventDefault(e),n_.stopPropagation(e)},stopEventAnd:function(e){return function(t){return e(t),n_.stopEvent(t),!1}},trim:function(e){return e.replace(/^\s+/g,"").replace(/\s+$/g,"")},stringEndsWith:function(e,t){for(var i="string"==typeof t?[t]:t,n=0;n<i.length;n++){t=i[n];if(-1!==e.indexOf(t,e.length-t.length))return!0}return!1},assert:function(e,t){if(!e)throw new Error(t||"assertion error")},log:function(){if("undefined"!=typeof console&&void 0!==console.log){for(var e=["Firepad:"],t=0;t<arguments.length;t++)e.push(arguments[t]);console.log.apply(console,e)}}},s_=function(){function e(e){this.type=e,this.chars=null,this.text=null,this.attributes=null,"insert"===e?(this.text=arguments[1],n_.assert("string"==typeof this.text),this.attributes=arguments[2]||{},n_.assert("object"==typeof this.attributes)):"delete"===e?(this.chars=arguments[1],n_.assert("number"==typeof this.chars)):"retain"===e&&(this.chars=arguments[1],n_.assert("number"==typeof this.chars),this.attributes=arguments[2]||{},n_.assert("object"==typeof this.attributes))}return e.prototype.isInsert=function(){return"insert"===this.type},e.prototype.isDelete=function(){return"delete"===this.type},e.prototype.isRetain=function(){return"retain"===this.type},e.prototype.equals=function(e){return this.type===e.type&&this.text===e.text&&this.chars===e.chars&&this.attributesEqual(e.attributes)},e.prototype.attributesEqual=function(e){for(var t in this.attributes)if(this.attributes[t]!==e[t])return!1;for(t in e)if(this.attributes[t]!==e[t])return!1;return!0},e.prototype.hasEmptyAttributes=function(){var e=!0;for(var t in this.attributes){e=!1;break}return e},e}(),r_=function(){function e(){if(!this||this.constructor!==e)return new e;this.ops=[],this.baseLength=0,this.targetLength=0}function t(e){var t=e.ops;switch(t.length){case 1:return t[0];case 2:return t[0].isRetain()?t[1]:t[1].isRetain()?t[0]:null;case 3:if(t[0].isRetain()&&t[2].isRetain())return t[1]}return null}function i(e){return e.ops[0].isRetain()?e.ops[0].chars:0}return e.prototype.equals=function(e){if(this.baseLength!==e.baseLength)return!1;if(this.targetLength!==e.targetLength)return!1;if(this.ops.length!==e.ops.length)return!1;for(var t=0;t<this.ops.length;t++)if(!this.ops[t].equals(e.ops[t]))return!1;return!0},e.prototype.retain=function(e,t){if("number"!=typeof e||e<0)throw new Error("retain expects a positive integer.");if(0===e)return this;this.baseLength+=e,this.targetLength+=e,t=t||{};var i=this.ops.length>0?this.ops[this.ops.length-1]:null;return i&&i.isRetain()&&i.attributesEqual(t)?i.chars+=e:this.ops.push(new s_("retain",e,t)),this},e.prototype.insert=function(e,t){if("string"!=typeof e)throw new Error("insert expects a string");if(""===e)return this;t=t||{},this.targetLength+=e.length;var i=this.ops.length>0?this.ops[this.ops.length-1]:null,n=this.ops.length>1?this.ops[this.ops.length-2]:null;return i&&i.isInsert()&&i.attributesEqual(t)?i.text+=e:i&&i.isDelete()?n&&n.isInsert()&&n.attributesEqual(t)?n.text+=e:(this.ops[this.ops.length-1]=new s_("insert",e,t),this.ops.push(i)):this.ops.push(new s_("insert",e,t)),this},e.prototype.delete=function(e){if("string"==typeof e&&(e=e.length),"number"!=typeof e||e<0)throw new Error("delete expects a positive integer or a string");if(0===e)return this;this.baseLength+=e;var t=this.ops.length>0?this.ops[this.ops.length-1]:null;return t&&t.isDelete()?t.chars+=e:this.ops.push(new s_("delete",e)),this},e.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()},e.prototype.clone=function(){for(var t=new e,i=0;i<this.ops.length;i++)this.ops[i].isRetain()?t.retain(this.ops[i].chars,this.ops[i].attributes):this.ops[i].isInsert()?t.insert(this.ops[i].text,this.ops[i].attributes):t.delete(this.ops[i].chars);return t},e.prototype.toString=function(){return(Array.prototype.map||function(e){for(var t=[],i=0,n=this.length;i<n;i++)t[i]=e(this[i]);return t}).call(this.ops,(function(e){return e.isRetain()?"retain "+e.chars:e.isInsert()?"insert '"+e.text+"'":"delete "+e.chars})).join(", ")},e.prototype.toJSON=function(){for(var e=[],t=0;t<this.ops.length;t++)this.ops[t].hasEmptyAttributes()||e.push(this.ops[t].attributes),"retain"===this.ops[t].type?e.push(this.ops[t].chars):"insert"===this.ops[t].type?e.push(this.ops[t].text):"delete"===this.ops[t].type&&e.push(-this.ops[t].chars);return 0===e.length&&e.push(0),e},e.fromJSON=function(t){for(var i=new e,n=0,s=t.length;n<s;n++){var r=t[n],o={};"object"==typeof r&&(o=r,r=t[++n]),"number"==typeof r?r>0?i.retain(r,o):i.delete(-r):(n_.assert("string"==typeof r),i.insert(r,o))}return i},e.prototype.apply=function(e,t,i){if(t=t||[],i=i||[],e.length!==this.baseLength)throw new Error("The operation's base length must be equal to the string's length.");for(var n,s,r=[],o=0,a=0,l=this.ops,h=0,c=l.length;h<c;h++){var u=l[h];if(u.isRetain()){if(a+u.chars>e.length)throw new Error("Operation can't retain more characters than are left in the string.");for(r[o++]=e.slice(a,a+u.chars),n=0;n<u.chars;n++){var d=t[a+n]||{},f={};for(s in d)f[s]=d[s],n_.assert(!1!==f[s]);for(s in u.attributes)!1===u.attributes[s]?delete f[s]:f[s]=u.attributes[s],n_.assert(!1!==f[s]);i.push(f)}a+=u.chars}else if(u.isInsert())for(r[o++]=u.text,n=0;n<u.text.length;n++){var p={};for(s in u.attributes)p[s]=u.attributes[s],n_.assert(!1!==p[s]);i.push(p)}else a+=u.chars}if(a!==e.length)throw new Error("The operation didn't operate on the whole string.");var g=r.join("");return n_.assert(g.length===i.length),g},e.prototype.invert=function(t){for(var i=0,n=new e,s=this.ops,r=0,o=s.length;r<o;r++){var a=s[r];a.isRetain()?(n.retain(a.chars),i+=a.chars):a.isInsert()?n.delete(a.text.length):(n.insert(t.slice(i,i+a.chars)),i+=a.chars)}return n},e.prototype.compose=function(t){if(this.targetLength!==t.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");function i(e,t,i){var n,s={};for(n in e)s[n]=e[n];for(n in t)i&&!1===t[n]?delete s[n]:s[n]=t[n];return s}for(var n,s=new e,r=this.clone().ops,o=t.clone().ops,a=0,l=0,h=r[a++],c=o[l++];void 0!==h||void 0!==c;)if(h&&h.isDelete())s.delete(h.chars),h=r[a++];else if(c&&c.isInsert())s.insert(c.text,c.attributes),c=o[l++];else{if(void 0===h)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===c)throw new Error("Cannot compose operations: first operation is too long.");if(h.isRetain()&&c.isRetain())n=i(h.attributes,c.attributes),h.chars>c.chars?(s.retain(c.chars,n),h.chars-=c.chars,c=o[l++]):h.chars===c.chars?(s.retain(h.chars,n),h=r[a++],c=o[l++]):(s.retain(h.chars,n),c.chars-=h.chars,h=r[a++]);else if(h.isInsert()&&c.isDelete())h.text.length>c.chars?(h.text=h.text.slice(c.chars),c=o[l++]):h.text.length===c.chars?(h=r[a++],c=o[l++]):(c.chars-=h.text.length,h=r[a++]);else if(h.isInsert()&&c.isRetain())n=i(h.attributes,c.attributes,!0),h.text.length>c.chars?(s.insert(h.text.slice(0,c.chars),n),h.text=h.text.slice(c.chars),c=o[l++]):h.text.length===c.chars?(s.insert(h.text,n),h=r[a++],c=o[l++]):(s.insert(h.text,n),c.chars-=h.text.length,h=r[a++]);else{if(!h.isRetain()||!c.isDelete())throw new Error("This shouldn't happen: op1: "+JSON.stringify(h)+", op2: "+JSON.stringify(c));h.chars>c.chars?(s.delete(c.chars),h.chars-=c.chars,c=o[l++]):h.chars===c.chars?(s.delete(c.chars),h=r[a++],c=o[l++]):(s.delete(h.chars),c.chars-=h.chars,h=r[a++])}}return s},e.prototype.shouldBeComposedWith=function(e){if(this.isNoop()||e.isNoop())return!0;var n=i(this),s=i(e),r=t(this),o=t(e);return!(!r||!o)&&(r.isInsert()&&o.isInsert()?n+r.text.length===s:!(!r.isDelete()||!o.isDelete())&&(s+o.chars===n||n===s))},e.prototype.shouldBeComposedWithInverted=function(e){if(this.isNoop()||e.isNoop())return!0;var n=i(this),s=i(e),r=t(this),o=t(e);return!(!r||!o)&&(r.isInsert()&&o.isInsert()?n+r.text.length===s||n===s:!(!r.isDelete()||!o.isDelete())&&s+o.chars===n)},e.transformAttributes=function(e,t){var i,n={},s={},r={};for(i in e)r[i]=!0;for(i in t)r[i]=!0;for(i in r){var o=e[i],a=t[i];n_.assert(null!=o||null!=a),null==o?s[i]=a:null==a?n[i]=o:o===a||(n[i]=o)}return[n,s]},e.transform=function(t,i){if(t.baseLength!==i.baseLength)throw new Error("Both operations have to have the same base length");for(var n=new e,s=new e,r=t.clone().ops,o=i.clone().ops,a=0,l=0,h=r[a++],c=o[l++];void 0!==h||void 0!==c;)if(h&&h.isInsert())n.insert(h.text,h.attributes),s.retain(h.text.length),h=r[a++];else if(c&&c.isInsert())n.retain(c.text.length),s.insert(c.text,c.attributes),c=o[l++];else{if(void 0===h)throw new Error("Cannot transform operations: first operation is too short.");if(void 0===c)throw new Error("Cannot transform operations: first operation is too long.");var u;if(h.isRetain()&&c.isRetain()){var d=e.transformAttributes(h.attributes,c.attributes);h.chars>c.chars?(u=c.chars,h.chars-=c.chars,c=o[l++]):h.chars===c.chars?(u=c.chars,h=r[a++],c=o[l++]):(u=h.chars,c.chars-=h.chars,h=r[a++]),n.retain(u,d[0]),s.retain(u,d[1])}else if(h.isDelete()&&c.isDelete())h.chars>c.chars?(h.chars-=c.chars,c=o[l++]):h.chars===c.chars?(h=r[a++],c=o[l++]):(c.chars-=h.chars,h=r[a++]);else if(h.isDelete()&&c.isRetain())h.chars>c.chars?(u=c.chars,h.chars-=c.chars,c=o[l++]):h.chars===c.chars?(u=c.chars,h=r[a++],c=o[l++]):(u=h.chars,c.chars-=h.chars,h=r[a++]),n.delete(u);else{if(!h.isRetain()||!c.isDelete())throw new Error("The two operations aren't compatible");h.chars>c.chars?(u=c.chars,h.chars-=c.chars,c=o[l++]):h.chars===c.chars?(u=h.chars,h=r[a++],c=o[l++]):(u=h.chars,c.chars-=h.chars,h=r[a++]),s.delete(u)}}return[n,s]},e.prototype.transform=function(t){return e.transform(this,t)},e}(),o_=function(e){function t(e,t,i){this.ref_=e,this.ready_=!1,this.firebaseCallbacks_=[],this.zombie_=!1,this.document_=new r_,this.revision_=0,this.pendingReceivedRevisions_={};var n=this;if(t){this.setUserId(t),this.setColor(i);var s=e.root.child(".info/connected");this.firebaseOn_(s,"value",(function(e){!0===e.val()&&n.initializeUserData_()}),this),this.on("ready",(function(){n.monitorCursors_()}))}else this.userId_=e.push().key;setTimeout((function(){n.monitorHistory_()}),0)}function i(e,t){if(!e)throw new Error(t||"assertion error")}n_.makeEventEmitter(t,["ready","cursor","operation","ack","retry"]),t.prototype.dispose=function(){var e=this;this.removeFirebaseCallbacks_(),this.handleInitialRevisions_=()=>{},this.ready_?(this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("color").remove()),this.ref_=null,this.document_=null,this.zombie_=!0):this.on("ready",(function(){e.dispose()}))},t.prototype.setUserId=function(e){this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("cursor").onDisconnect().cancel(),this.userRef_.child("color").remove(),this.userRef_.child("color").onDisconnect().cancel()),this.userId_=e,this.userRef_=this.ref_.child("users").child(e),this.initializeUserData_()},t.prototype.isHistoryEmpty=function(){return i(this.ready_,"Not ready yet."),0===this.revision_},t.prototype.sendOperation=function(e,t){var n=this;if(this.ready_){i(this.document_.targetLength===e.baseLength,"sendOperation() called with invalid operation.");var r=s(this.revision_);this.sent_={id:r,op:e},function e(i,s){n.ref_.child("history").child(i).transaction((function(e){if(null===e)return s}),(function(r,o,a){if(r){if("disconnect"!==r.message)throw n_.log("Transaction failure!",r),r;n.sent_&&n.sent_.id===i?setTimeout((function(){e(i,s)}),0):t&&t(r,!1)}else t&&t(null,o)}),!1)}(r,{a:n.userId_,o:e.toJSON(),t:Tp.database.ServerValue.TIMESTAMP})}else this.on("ready",(function(){n.trigger("retry")}))},t.prototype.sendCursor=function(e){this.userRef_.child("cursor").set(e),this.cursor_=e},t.prototype.setColor=function(e){this.userRef_.child("color").set(e),this.color_=e},t.prototype.getDocument=function(){return this.document_},t.prototype.registerCallbacks=function(e){for(var t in e)this.on(t,e[t])},t.prototype.initializeUserData_=function(){this.userRef_.child("cursor").onDisconnect().remove(),this.userRef_.child("color").onDisconnect().remove(),this.sendCursor(this.cursor_||null),this.setColor(this.color_||null)},t.prototype.monitorCursors_=function(){var e=this.ref_.child("users"),t=this;function i(e){var i=e.key,n=e.val();t.trigger("cursor",i,n.cursor,n.color)}this.firebaseOn_(e,"child_added",i),this.firebaseOn_(e,"child_changed",i),this.firebaseOn_(e,"child_removed",(function(e){var i=e.key;t.trigger("cursor",i,null)}))},t.prototype.monitorHistory_=function(){var e=this;this.ref_.child("checkpoint").once("value",(function(t){if(!e.zombie_){var s=t.child("id").val(),r=t.child("o").val(),o=t.child("a").val();null!=r&&null!=s&&null!==o?(e.pendingReceivedRevisions_[s]={o:r,a:o},e.checkpointRevision_=function(e){i(e.length>0&&e[0]===n[e.length+8]);for(var t=0,s=1;s<e.length;s++)t*=n.length,t+=n.indexOf(e[s]);return t}(s),e.monitorHistoryStartingAt_(e.checkpointRevision_+1)):(e.checkpointRevision_=0,e.monitorHistoryStartingAt_(e.checkpointRevision_))}}))},t.prototype.monitorHistoryStartingAt_=function(e){var t=this.ref_.child("history").startAt(null,s(e)),i=this;setTimeout((function(){i.firebaseOn_(t,"child_added",(function(e){var t=e.key;i.pendingReceivedRevisions_[t]=e.val(),i.ready_&&i.handlePendingReceivedRevisions_()})),t.once("value",(function(){i.handleInitialRevisions_()}))}),0)},t.prototype.handleInitialRevisions_=function(){i(!this.ready_,"Should not be called multiple times."),this.revision_=this.checkpointRevision_;for(var e=s(this.revision_),t=this.pendingReceivedRevisions_;null!=t[e];){var n=this.parseRevision_(t[e]);n?this.document_=this.document_.compose(n.operation):n_.log("Invalid operation.",this.ref_.toString(),e,t[e]),delete t[e],this.revision_++,e=s(this.revision_)}this.trigger("operation",this.document_),this.ready_=!0;var r=this;setTimeout((function(){r.trigger("ready")}),0)},t.prototype.handlePendingReceivedRevisions_=function(){for(var e=this.pendingReceivedRevisions_,t=s(this.revision_),i=!1;null!=e[t];){this.revision_++;var n=this.parseRevision_(e[t]);n?(this.document_=this.document_.compose(n.operation),this.sent_&&t===this.sent_.id?this.sent_.op.equals(n.operation)&&n.author===this.userId_?(this.revision_%100==0&&this.saveCheckpoint_(),this.sent_=null,this.trigger("ack")):(i=!0,this.trigger("operation",n.operation)):this.trigger("operation",n.operation)):n_.log("Invalid operation.",this.ref_.toString(),t,e[t]),delete e[t],t=s(this.revision_)}i&&(this.sent_=null,this.trigger("retry"))},t.prototype.parseRevision_=function(e){if("object"!=typeof e)return null;if("string"!=typeof e.a||"object"!=typeof e.o)return null;var t=null;try{t=r_.fromJSON(e.o)}catch(e){return null}return t.baseLength!==this.document_.targetLength?null:{author:e.a,operation:t}},t.prototype.saveCheckpoint_=function(){this.ref_.child("checkpoint").set({a:this.userId_,o:this.document_.toJSON(),id:s(this.revision_-1)})},t.prototype.firebaseOn_=function(e,t,i,n){return this.firebaseCallbacks_.push({ref:e,eventType:t,callback:i,context:n}),e.on(t,i,n),i},t.prototype.firebaseOff_=function(e,t,i,n){e.off(t,i,n);for(var s=0;s<this.firebaseCallbacks_.length;s++){var r=this.firebaseCallbacks_[s];if(r.ref===e&&r.eventType===t&&r.callback===i&&r.context===n){this.firebaseCallbacks_.splice(s,1);break}}},t.prototype.removeFirebaseCallbacks_=function(){for(var e=0;e<this.firebaseCallbacks_.length;e++){var t=this.firebaseCallbacks_[e];t.ref.off(t.eventType,t.callback,t.context)}this.firebaseCallbacks_=[]};var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function s(e){if(0===e)return"A0";for(var t="";e>0;){var i=e%n.length;t=n[i]+t,e-=i,e/=n.length}return n[t.length+9]+t}return t}(),a_={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"},l_={LINE_SENTINEL_CHARACTER:"",ENTITY_SENTINEL_CHARACTER:""},h_=function(){var e=a_.ENTITY_SENTINEL,t=e+"_";function i(e,t){if(!(this instanceof i))return new i(e,t);this.type=e,this.info=t||{}}return i.prototype.toAttributes=function(){var i={};for(var n in i[e]=this.type,this.info)i[t+n]=this.info[n];return i},i.fromAttributes=function(n){var s=n[e],r={};for(var o in n)0===o.indexOf(t)&&(r[o.substr(t.length)]=n[o]);return new i(s,r)},i}();let c_=null;const u_=()=>c_||window.document,d_=e=>c_=e,f_=function(){function e(){this.entities_={};var e=["src","alt","width","height","style","class"];this.register("img",{render:function(e){n_.assert(e.src,"image entity should have 'src'!");for(var t=["src","alt","width","height","style","class"],i="<img ",n=0;n<t.length;n++){var s=t[n];s in e&&(i+=" "+s+'="'+e[s]+'"')}return i+=">"},fromElement:function(t){for(var i={},n=0;n<e.length;n++){var s=e[n];t.hasAttribute(s)&&(i[s]=t.getAttribute(s))}return i}})}return e.prototype.register=function(e,t){n_.assert(t.render,"Entity options should include a 'render' function!"),n_.assert(t.fromElement,"Entity options should include a 'fromElement' function!"),this.entities_[e]=t},e.prototype.renderToElement=function(e,t){return this.tryRenderToElement_(e,"render",t)},e.prototype.exportToElement=function(e){var t=this.tryRenderToElement_(e,"export")||this.tryRenderToElement_(e,"getHtml")||this.tryRenderToElement_(e,"render");return t.setAttribute("data-firepad-entity",e.type),t},e.prototype.updateElement=function(e,t){var i=e.type,n=e.info;this.entities_[i]&&void 0!==this.entities_[i].update&&this.entities_[i].update(n,t)},e.prototype.fromElement=function(e){var t=e.getAttribute("data-firepad-entity");if(t||(t=e.nodeName.toLowerCase()),t&&this.entities_[t]){var i=this.entities_[t].fromElement(e);return new h_(t,i)}},e.prototype.tryRenderToElement_=function(e,t,i){var n=e.type,s=e.info;if(this.entities_[n]&&this.entities_[n][t]){var r=u_(),o=this.entities_[n][t](s,i,r);if(o){if("string"==typeof o){var a=u_().createElement("div");return a.innerHTML=o,a.childNodes[0]}if("object"==typeof o)return n_.assert(void 0!==o.nodeType,"Error rendering "+n+" entity.  render() function must return an html string or a DOM element."),o}}},e.prototype.entitySupportsUpdate=function(e){return this.entities_[e]&&this.entities_[e].update},e}(),p_=function(){function e(t){if(!(this instanceof e))return new e(t);this.attributes=t||{},this.attributes[a_.LINE_SENTINEL]=!0}return e.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"},e.prototype.cloneWithNewAttribute_=function(t,i){var n={};for(var s in this.attributes)n[s]=this.attributes[s];return!1===i?delete n[t]:n[t]=i,new e(n)},e.prototype.indent=function(e){return this.cloneWithNewAttribute_(a_.LINE_INDENT,e)},e.prototype.align=function(e){return this.cloneWithNewAttribute_(a_.LINE_ALIGN,e)},e.prototype.listItem=function(e){return n_.assert(!1===e||"u"===e||"o"===e||"t"===e||"tc"===e),this.cloneWithNewAttribute_(a_.LIST_TYPE,e)},e.prototype.getIndent=function(){return this.attributes[a_.LINE_INDENT]||0},e.prototype.getAlign=function(){return this.attributes[a_.LINE_ALIGN]||0},e.prototype.getListItem=function(){return this.attributes[a_.LIST_TYPE]||!1},e}(),g_=function(){function e(t){if(!(this instanceof e))return new e(t);this.attributes=t||{}}return e.prototype.cloneWithNewAttribute_=function(t,i){var n={};for(var s in this.attributes)n[s]=this.attributes[s];return!1===i?delete n[t]:n[t]=i,new e(n)},e.prototype.bold=function(e){return this.cloneWithNewAttribute_(a_.BOLD,e)},e.prototype.italic=function(e){return this.cloneWithNewAttribute_(a_.ITALIC,e)},e.prototype.underline=function(e){return this.cloneWithNewAttribute_(a_.UNDERLINE,e)},e.prototype.strike=function(e){return this.cloneWithNewAttribute_(a_.STRIKE,e)},e.prototype.font=function(e){return this.cloneWithNewAttribute_(a_.FONT,e)},e.prototype.fontSize=function(e){return this.cloneWithNewAttribute_(a_.FONT_SIZE,e)},e.prototype.color=function(e){return this.cloneWithNewAttribute_(a_.COLOR,e)},e.prototype.backgroundColor=function(e){return this.cloneWithNewAttribute_(a_.BACKGROUND_COLOR,e)},e}(),m_=function e(t,i){if(!(this instanceof e))return new e(t,i);this.text=t,this.formatting=i||g_()},v_=function e(t,i){if(!(this instanceof e))return new e(t,i);"[object Array]"!==Object.prototype.toString.call(t)&&(t=void 0===t?[]:[t]),this.textPieces=t,this.formatting=i||p_()},w_=function(){var e,{LIST_TYPE:t}=p_;function i(e,i,n){this.listType=e||t.UNORDERED,this.lineFormatting=i||p_(),this.textFormatting=n||g_()}function n(){this.lines=[],this.currentLine=[],this.currentLineListItemType=null}i.prototype.withTextFormatting=function(e){return new i(this.listType,this.lineFormatting,e)},i.prototype.withLineFormatting=function(e){return new i(this.listType,e,this.textFormatting)},i.prototype.withListType=function(e){return new i(e,this.lineFormatting,this.textFormatting)},i.prototype.withIncreasedIndent=function(){var e=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new i(this.listType,e,this.textFormatting)},i.prototype.withAlign=function(e){var t=this.lineFormatting.align(e);return new i(this.listType,t,this.textFormatting)},n.prototype.newlineIfNonEmpty=function(e){this.cleanLine_(),this.currentLine.length>0&&this.newline(e)},n.prototype.newlineIfNonEmptyOrListItem=function(e){this.cleanLine_(),(this.currentLine.length>0||null!==this.currentLineListItemType)&&this.newline(e)},n.prototype.newline=function(e){this.cleanLine_();var t=e.lineFormatting;null!==this.currentLineListItemType&&(t=t.listItem(this.currentLineListItemType),this.currentLineListItemType=null),this.lines.push(v_(this.currentLine,t)),this.currentLine=[]},n.prototype.makeListItem=function(e){this.currentLineListItemType=e},n.prototype.cleanLine_=function(){if(this.currentLine.length>0){var e=this.currentLine.length-1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,""),this.currentLine[e].text=this.currentLine[e].text.replace(/ +$/g,"");for(var t=0;t<this.currentLine.length;t++)this.currentLine[t].text=this.currentLine[t].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var s=s||{ELEMENT_NODE:1,TEXT_NODE:3};function r(i,n,r){if(i.nodeType===s.ELEMENT_NODE){var a=e.fromElement(i);if(a)return void r.currentLine.push(new m_(l_.ENTITY_SENTINEL_CHARACTER,new g_(a.toAttributes())))}switch(i.nodeType){case s.TEXT_NODE:var l=i.nodeValue.replace(/[ \n\t]+/g," ");r.currentLine.push(m_(l,n.textFormatting));break;case s.ELEMENT_NODE:switch(n=function(e,t){for(var i=e.textFormatting,n=e.lineFormatting,s=t.split(";"),r=0;r<s.length;r++){var o=s[r].split(":");if(2===o.length){var a=n_.trim(o[0]).toLowerCase(),l=n_.trim(o[1]).toLowerCase();switch(a){case"text-decoration":var h=l.indexOf("underline")>=0,c=l.indexOf("line-through")>=0;i=i.underline(h).strike(c);break;case"font-weight":var u="bold"===l||parseInt(l)>=600;i=i.bold(u);break;case"font-style":var d="italic"===l||"oblique"===l;i=i.italic(d);break;case"color":i=i.color(l);break;case"background-color":i=i.backgroundColor(l);break;case"text-align":n=n.align(l);break;case"font-size":var f=null,p=["px","pt","%","em","xx-small","x-small","small","medium","large","x-large","xx-large","smaller","larger"];n_.stringEndsWith(l,p)?f=l:parseInt(l)&&(f=parseInt(l)+"px"),f&&(i=i.fontSize(f));break;case"font-family":var g=n_.trim(l.split(",")[0]);g=(g=g.replace(/['"]/g,"")).replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),i=i.font(g)}}}return e.withLineFormatting(n).withTextFormatting(i)}(n,i.getAttribute("style")||""),i.nodeName.toLowerCase()){case"div":case"h1":case"h2":case"h3":case"p":r.newlineIfNonEmpty(n),o(i,n,r),r.newlineIfNonEmpty(n);break;case"center":n=n.withAlign("center"),r.newlineIfNonEmpty(n),o(i,n.withAlign("center"),r),r.newlineIfNonEmpty(n);break;case"b":case"strong":o(i,n.withTextFormatting(n.textFormatting.bold(!0)),r);break;case"u":o(i,n.withTextFormatting(n.textFormatting.underline(!0)),r);break;case"i":case"em":o(i,n.withTextFormatting(n.textFormatting.italic(!0)),r);break;case"s":o(i,n.withTextFormatting(n.textFormatting.strike(!0)),r);break;case"font":var h=i.getAttribute("face"),c=i.getAttribute("color"),u=parseInt(i.getAttribute("size"));h&&(n=n.withTextFormatting(n.textFormatting.font(h))),c&&(n=n.withTextFormatting(n.textFormatting.color(c))),u&&(n=n.withTextFormatting(n.textFormatting.fontSize(u))),o(i,n,r);break;case"br":r.newline(n);break;case"ul":r.newlineIfNonEmptyOrListItem(n);var d="firepad-todo"===i.getAttribute("class")?t.TODO:t.UNORDERED;o(i,n.withListType(d).withIncreasedIndent(),r),r.newlineIfNonEmpty(n);break;case"ol":r.newlineIfNonEmptyOrListItem(n),o(i,n.withListType(t.ORDERED).withIncreasedIndent(),r),r.newlineIfNonEmpty(n);break;case"li":!function(e,i,n){n.newlineIfNonEmptyOrListItem(i);var s="firepad-checked"===e.getAttribute("class")?t.TODOCHECKED:i.listType;n.makeListItem(s);var r=n.currentLine;o(e,i,n),(r===n.currentLine||n.currentLine.length>0)&&n.newline(i)}(i,n,r);break;case"style":break;default:o(i,n,r)}}}function o(e,t,i){if(e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++)r(e.childNodes[n],t,i)}return function(t,s){var o=u_().createElement("div");o.innerHTML=t,e=s;var a=new n;return r(o,new i,a),a.lines}}(),y_=function(){var{LIST_TYPE:e}=p_;function t(t){return t===e.ORDERED?"<ol>":t===e.UNORDERED?"<ul>":'<ul class="firepad-todo">'}function i(t){return t===e.ORDERED?"</ol>":"</ul>"}function n(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")}return function(s,r){for(var o,a,l="",h=!0,c=[],u=!1,d=!0,f=!0,p=0,g=s.ops[p],m=!1;g;){n_.assert(g.isInsert());var v=g.attributes;if(h){h=!1;var w=0,y=null,b="left";a_.LINE_SENTINEL in v&&(w=v[a_.LINE_INDENT]||0,y=v[a_.LIST_TYPE]||null,b=v[a_.LINE_ALIGN]||"left"),y&&(w=w||1),u?(l+="</li>",u=!1):d||(f&&(l+="<br/>"),l+="</div>"),d=!1,n_.assert(w>=0,"Indent must not be negative.");for(;c.length>w||w===c.length&&null!==y&&(o=y,a=c[c.length-1],!(o===a||o===e.TODO&&a===e.TODOCHECKED||o===e.TODOCHECKED&&a===e.TODO));)l+=i(c.pop());for(;c.length<w;){var _=y||e.UNORDERED;m=y==e.TODO||y==e.TODOCHECKED||m,l+=t(_),c.push(_)}var C="left"!==b?' style="text-align:'+b+'"':"";if(y){var S="";switch(y){case e.TODOCHECKED:S=' class="firepad-checked"';break;case e.TODO:S=' class="firepad-unchecked"'}l+="<li"+S+C+">",u=!0}else l+="<div"+C+">";f=!0}if(a_.LINE_SENTINEL in v)g=s.ops[++p];else if(a_.ENTITY_SENTINEL in v){for(var x=0;x<g.text.length;x++){var k=h_.fromAttributes(v);l+=r.exportToElement(k).outerHTML}g=s.ops[++p]}else{var A="",E="";for(var T in v){var M,L,R=v[T];T===a_.BOLD||T===a_.ITALIC||T===a_.UNDERLINE||T===a_.STRIKE?(n_.assert(!0===R),M=L=T):T===a_.FONT_SIZE?(M='span style="font-size: '+R,M+="string"!=typeof R||-1===R.indexOf("px",R.length-2)?'px"':'"',L="span"):T===a_.FONT?(M='span style="font-family: '+R+'"',L="span"):T===a_.COLOR?(M='span style="color: '+R+'"',L="span"):T===a_.BACKGROUND_COLOR?(M='span style="background-color: '+R+'"',L="span"):n_.log(!1,"Encountered unknown attribute while rendering html: "+T),M&&(A+="<"+M+">"),L&&(E="</"+L+">"+E)}var $=g.text,I=$.indexOf("\n");I>=0?(h=!0,g=I<$.length-1?new s_("insert",$.substr(I+1),v):s.ops[++p],$=$.substr(0,I)):g=s.ops[++p],($=$.replace(/  +/g,(function(e){return new Array(e.length+1).join(" ")})).replace(/^ /," ").replace(/ $/," ")).length>0&&(f=!1),l+=A+n($)+E}}for(u?l+="</li>":d||(f&&(l+="&nbsp;"),l+="</div>");c.length>0;)l+=i(c.pop());return m&&(l='<style>ul.firepad-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.firepad-todo > li { padding-left: 1em; text-indent: -1em; } ul.firepad-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.firepad-todo > li.firepad-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+l),l}}(),b_=function(e,t){var i=[];function n(t,n){t instanceof m_&&(n=t.formatting.attributes,t=t.text),i.push({string:t,attributes:n}),e="\n"===t[t.length-1]}function s(t,i){e&&n(l_.LINE_SENTINEL_CHARACTER,t.formatting.attributes);for(var s=0;s<t.textPieces.length;s++)n(t.textPieces[s]);i&&n("\n")}for(var r=0;r<t.length;r++)t[r]instanceof v_?s(t[r],r<t.length-1):n(t[r]);return i},__=function(){function e(e,t){this.position=e,this.selectionEnd=t}return e.fromJSON=function(t){return new e(t.position,t.selectionEnd)},e.prototype.equals=function(e){return this.position===e.position&&this.selectionEnd===e.selectionEnd},e.prototype.compose=function(e){return e},e.prototype.transform=function(t){function i(e){for(var i=e,n=t.ops,s=0,r=t.ops.length;s<r&&(n[s].isRetain()?e-=n[s].chars:n[s].isInsert()?i+=n[s].text.length:(i-=Math.min(e,n[s].chars),e-=n[s].chars),!(e<0));s++);return i}var n=i(this.position);return this.position===this.selectionEnd?new e(n,n):new e(n,i(this.selectionEnd))},e}(),C_=function(){function e(){this.state=i}function t(){}e.prototype.setState=function(e){this.state=e},e.prototype.applyClient=function(e){this.setState(this.state.applyClient(this,e))},e.prototype.applyServer=function(e){this.setState(this.state.applyServer(this,e))},e.prototype.serverAck=function(){this.setState(this.state.serverAck(this))},e.prototype.serverRetry=function(){this.setState(this.state.serverRetry(this))},e.prototype.sendOperation=function(e){throw new Error("sendOperation must be defined in child class")},e.prototype.applyOperation=function(e){throw new Error("applyOperation must be defined in child class")},e.Synchronized=t,t.prototype.applyClient=function(e,t){return e.sendOperation(t),new n(t)},t.prototype.applyServer=function(e,t){return e.applyOperation(t),this},t.prototype.serverAck=function(e){throw new Error("There is no pending operation.")},t.prototype.serverRetry=function(e){throw new Error("There is no pending operation.")};var i=new t;function n(e){this.outstanding=e}function s(e,t){this.outstanding=e,this.buffer=t}return e.AwaitingConfirm=n,n.prototype.applyClient=function(e,t){return new s(this.outstanding,t)},n.prototype.applyServer=function(e,t){var i=this.outstanding.transform(t);return e.applyOperation(i[1]),new n(i[0])},n.prototype.serverAck=function(e){return i},n.prototype.serverRetry=function(e){return e.sendOperation(this.outstanding),this},e.AwaitingWithBuffer=s,s.prototype.applyClient=function(e,t){var i=this.buffer.compose(t);return new s(this.outstanding,i)},s.prototype.applyServer=function(e,t){var i=this.outstanding.transform(t),n=this.buffer.transform(i[1]);return e.applyOperation(n[1]),new s(i[0],n[0])},s.prototype.serverRetry=function(e){var t=this.outstanding.compose(this.buffer);return e.sendOperation(t),new n(t)},s.prototype.serverAck=function(e){return e.sendOperation(this.buffer),new n(this.buffer)},e}(),S_=function(){var e="normal",t="undoing",i="redoing";function n(t){this.maxItems=t||50,this.state=e,this.dontCompose=!1,this.undoStack=[],this.redoStack=[]}function s(e,t){for(var i=[],n=t.constructor,s=e.length-1;s>=0;s--){var r=n.transform(e[s],t);"function"==typeof r[0].isNoop&&r[0].isNoop()||i.push(r[0]),t=r[1]}return i.reverse()}return n.prototype.add=function(e,n){if(this.state===t)this.redoStack.push(e),this.dontCompose=!0;else if(this.state===i)this.undoStack.push(e),this.dontCompose=!0;else{var s=this.undoStack;!this.dontCompose&&n&&s.length>0?s.push(e.compose(s.pop())):(s.push(e),s.length>this.maxItems&&s.shift()),this.dontCompose=!1,this.redoStack=[]}},n.prototype.transform=function(e){this.undoStack=s(this.undoStack,e),this.redoStack=s(this.redoStack,e)},n.prototype.performUndo=function(i){if(this.state=t,0===this.undoStack.length)throw new Error("undo not possible");i(this.undoStack.pop()),this.state=e},n.prototype.performRedo=function(t){if(this.state=i,0===this.redoStack.length)throw new Error("redo not possible");t(this.redoStack.pop()),this.state=e},n.prototype.canUndo=function(){return 0!==this.undoStack.length},n.prototype.canRedo=function(){return 0!==this.redoStack.length},n.prototype.isUndoing=function(){return this.state===t},n.prototype.isRedoing=function(){return this.state===i},n}(),x_=function(e){function t(e,t){this.wrapped=e,this.meta=t}function i(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function n(e,t){return e&&"object"==typeof e&&"function"==typeof e.transform?e.transform(t):e}return t.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)},t.prototype.invert=function(){var e=this.meta;return new t(this.wrapped.invert.apply(this.wrapped,arguments),e&&"object"==typeof e&&"function"==typeof e.invert?e.invert.apply(e,arguments):e)},t.prototype.compose=function(e){return new t(this.wrapped.compose(e.wrapped),function(e,t){if(e&&"object"==typeof e){if("function"==typeof e.compose)return e.compose(t);var n={};return i(e,n),i(t,n),n}return t}(this.meta,e.meta))},t.transform=function(e,i){var s=e.wrapped.transform(i.wrapped);return[new t(s[0],n(e.meta,i.wrapped)),new t(s[1],n(i.meta,e.wrapped))]},t.prototype.transform=function(e){return t.transform(this,e)},t}(),k_=function(){function e(e,t){this.cursorBefore=e,this.cursorAfter=t}function t(e,t){this.id=e,this.editorAdapter=t}function i(e,t){C_.call(this),this.serverAdapter=e,this.editorAdapter=t,this.undoManager=new S_,this.clients={};var i=this;this.editorAdapter.registerCallbacks({change:function(e,t){i.onChange(e,t)},cursorActivity:function(){i.onCursorActivity()},blur:function(){i.onBlur()},focus:function(){i.onFocus()}}),this.editorAdapter.registerUndo((function(){i.undo()})),this.editorAdapter.registerRedo((function(){i.redo()})),this.serverAdapter.registerCallbacks({ack:function(){i.serverAck(),i.focused&&i.state instanceof C_.Synchronized&&(i.updateCursor(),i.sendCursor(i.cursor)),i.emitStatus()},retry:function(){i.serverRetry()},operation:function(e){i.applyServer(e)},cursor:function(e,t,n){if(i.serverAdapter.userId_!==e&&i.state instanceof C_.Synchronized){var s=i.getClientObject(e);t?(n&&s.setColor(n),s.updateCursor(__.fromJSON(t))):s.removeCursor()}}})}return e.prototype.invert=function(){return new e(this.cursorAfter,this.cursorBefore)},e.prototype.compose=function(t){return new e(this.cursorBefore,t.cursorAfter)},e.prototype.transform=function(t){return new e(this.cursorBefore?this.cursorBefore.transform(t):null,this.cursorAfter?this.cursorAfter.transform(t):null)},t.prototype.setColor=function(e){this.color=e},t.prototype.updateCursor=function(e){this.removeCursor(),this.cursor=e,this.mark=this.editorAdapter.setOtherCursor(e,this.color,this.id)},t.prototype.removeCursor=function(){this.mark&&this.mark.clear()},function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}(i,C_),i.prototype.getClientObject=function(e){var i=this.clients[e];return i||(this.clients[e]=new t(e,this.editorAdapter))},i.prototype.applyUnredo=function(e){this.undoManager.add(this.editorAdapter.invertOperation(e)),this.editorAdapter.applyOperation(e.wrapped),this.cursor=e.meta.cursorAfter,this.cursor&&this.editorAdapter.setCursor(this.cursor),this.applyClient(e.wrapped)},i.prototype.undo=function(){var e=this;this.undoManager.canUndo()&&this.undoManager.performUndo((function(t){e.applyUnredo(t)}))},i.prototype.redo=function(){var e=this;this.undoManager.canRedo()&&this.undoManager.performRedo((function(t){e.applyUnredo(t)}))},i.prototype.onChange=function(t,i){var n=this.cursor;this.updateCursor();var s,r=this.undoManager.undoStack.length>0&&i.shouldBeComposedWithInverted((s=this.undoManager.undoStack,s[s.length-1]).wrapped),o=new e(this.cursor,n);this.undoManager.add(new x_(i,o),r),this.applyClient(t)},i.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()},i.prototype.onCursorActivity=function(){var e=this.cursor;this.updateCursor(),!this.focused||e&&this.cursor.equals(e)||this.sendCursor(this.cursor)},i.prototype.onBlur=function(){this.cursor=null,this.sendCursor(null),this.focused=!1},i.prototype.onFocus=function(){this.focused=!0,this.onCursorActivity()},i.prototype.sendCursor=function(e){this.state instanceof C_.AwaitingWithBuffer||this.serverAdapter.sendCursor(e)},i.prototype.sendOperation=function(e){this.serverAdapter.sendOperation(e),this.emitStatus()},i.prototype.applyOperation=function(e){this.editorAdapter.applyOperation(e),this.updateCursor(),this.undoManager.transform(new x_(e,null))},i.prototype.emitStatus=function(){var e=this;setTimeout((function(){e.trigger("synced",e.state instanceof C_.Synchronized)}),0)},i}();n_.makeEventEmitter(k_,["synced"]);const A_=function(){function e(e){this.rtcm=e,this.cm=e.codeMirror,s(this,"onChange"),s(this,"onAttributesChange"),s(this,"onCursorActivity"),s(this,"onFocus"),s(this,"onBlur"),this.rtcm.on("change",this.onChange),this.rtcm.on("attributesChange",this.onAttributesChange),this.cm.on("cursorActivity",this.onCursorActivity),this.cm.on("focus",this.onFocus),this.cm.on("blur",this.onBlur)}function t(e,t){return e.line<t.line?-1:e.line>t.line?1:e.ch<t.ch?-1:e.ch>t.ch?1:0}function i(e){var t=e.lineCount()-1;return e.indexFromPos({line:t,ch:e.getLine(t).length})}function n(e,t){if(!e)throw new Error(t||"assertion error")}function s(e,t){var i=e[t];e[t]=function(){i.apply(e,arguments)}}function r(e){for(var t in e)return!1;return!0}function o(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");3===(e=e.replace(/^#/,"")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var i=parseInt(e,16),n=[i>>16,i>>8&255,255&i],s="rgb";return function(e){return null!=e}(t)&&(s="rgba",n.push(t)),s+"("+n.join(",")+")"}return e.prototype.detach=function(){this.rtcm.off("change",this.onChange),this.rtcm.off("attributesChange",this.onAttributesChange),this.cm.off("cursorActivity",this.onCursorActivity),this.cm.off("focus",this.onFocus),this.cm.off("blur",this.onBlur)},e.operationFromCodeMirrorChanges=function(e,t){for(var n=i(t),s=(new r_).retain(n),r=(new r_).retain(n),o=e.length-1;o>=0;o--){var a=e[o],l=a.start,h=n-l-a.text.length;s=(new r_).retain(l).delete(a.removed.length).insert(a.text,a.attributes).retain(h).compose(s),r=r.compose((new r_).retain(l).delete(a.text.length).insert(a.removed,a.removedAttributes).retain(h)),n+=a.removed.length-a.text.length}return[s,r]},e.operationFromAttributesChanges=function(e,t){for(var s=i(t),r=new r_,o=new r_,a=0,l=0;l<e.length;l++){var h=e[l],c=h.start-a;n(c>=0),r.retain(c),o.retain(c);var u=h.end-h.start;r.retain(u,h.attributes),o.retain(u,h.attributesInverse),a=h.start+u}return r.retain(s-a),o.retain(s-a),[r,o]},e.prototype.registerCallbacks=function(e){this.callbacks=e},e.prototype.onChange=function(t,i){if("RTCMADAPTER"!==i[0].origin){var n=e.operationFromCodeMirrorChanges(i,this.cm);this.trigger("change",n[0],n[1])}},e.prototype.onAttributesChange=function(t,i){if("RTCMADAPTER"!==i[0].origin){var n=e.operationFromAttributesChanges(i,this.cm);this.trigger("change",n[0],n[1])}},e.prototype.onCursorActivity=function(){var e=this;setTimeout((function(){e.trigger("cursorActivity")}),1)},e.prototype.onFocus=function(){this.trigger("focus")},e.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")},e.prototype.getValue=function(){return this.cm.getValue()},e.prototype.getCursor=function(){var e,i=this.cm,n=i.getCursor(),s=i.indexFromPos(n);if(i.somethingSelected()){var r=i.getCursor(!0),o=0===t(n,r)?i.getCursor(!1):r;e=i.indexFromPos(o)}else e=s;return new __(s,e)},e.prototype.setCursor=function(e){this.cm.setSelection(this.cm.posFromIndex(e.position),this.cm.posFromIndex(e.selectionEnd))},e.prototype.addStyleRule=function(e){if("undefined"!=typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var t=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet}if(!this.addedStyleRules[e])return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)}},e.prototype.setOtherCursor=function(e,t,i){var n=this.cm.posFromIndex(e.position);if("string"==typeof t&&t.match(/^#[a-fA-F0-9]{3,6}$/)){var s=this.rtcm.end();if("object"==typeof e&&"number"==typeof e.position&&"number"==typeof e.selectionEnd&&!(e.position<0||e.position>s||e.selectionEnd<0||e.selectionEnd>s)){if(e.position===e.selectionEnd){var r=this.cm.cursorCoords(n),a=document.createElement("span");return a.className="other-client",a.style.borderLeftWidth="2px",a.style.borderLeftStyle="solid",a.style.borderLeftColor=t,a.style.marginLeft=a.style.marginRight="-1px",a.style.height=.9*(r.bottom-r.top)+"px",a.setAttribute("data-clientid",i),a.style.zIndex=0,this.cm.setBookmark(n,{widget:a,insertLeft:!0})}var l,h,c="selection-"+t.replace("#",""),u="."+c+" { background: "+o(t)+";\n background: "+o(t,.4)+";}";return this.addStyleRule(u),e.selectionEnd>e.position?(l=n,h=this.cm.posFromIndex(e.selectionEnd)):(l=this.cm.posFromIndex(e.selectionEnd),h=n),this.cm.markText(l,h,{className:c})}}},e.prototype.trigger=function(e){var t=Array.prototype.slice.call(arguments,1),i=this.callbacks&&this.callbacks[e];i&&i.apply(this,t)},e.prototype.applyOperation=function(e){e.ops.length>10&&this.rtcm.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var t=e.ops,i=0,n=0,s=t.length;n<s;n++){var o=t[n];o.isRetain()?(r(o.attributes)||this.rtcm.updateTextAttributes(i,i+o.chars,(function(e){for(var t in o.attributes)!1===o.attributes[t]?delete e[t]:e[t]=o.attributes[t]}),"RTCMADAPTER",!0),i+=o.chars):o.isInsert()?(this.rtcm.insertText(i,o.text,o.attributes,"RTCMADAPTER"),i+=o.text.length):o.isDelete()&&this.rtcm.removeText(i,i+o.chars,"RTCMADAPTER")}e.ops.length>10&&(this.rtcm.codeMirror.getWrapperElement().setAttribute("style",""),this.rtcm.codeMirror.refresh())},e.prototype.registerUndo=function(e){this.cm.undo=e},e.prototype.registerRedo=function(e){this.cm.redo=e},e.prototype.invertOperation=function(e){for(var t,i,n=0,s=this.rtcm.codeMirror,o=new r_,a=0;a<e.wrapped.ops.length;a++){var l=e.wrapped.ops[a];if(l.isRetain())if(r(l.attributes))o.retain(l.chars),n+=l.chars;else for(t=this.rtcm.getAttributeSpans(n,n+l.chars),i=0;i<t.length;i++){var h={};for(var c in l.attributes){var u=l.attributes[c],d=t[i].attributes[c];!1===u?d&&(h[c]=d):u!==d&&(h[c]=d||!1)}o.retain(t[i].length,h),n+=t[i].length}else if(l.isInsert())o.delete(l.text.length);else if(l.isDelete()){var f=s.getRange(s.posFromIndex(n),s.posFromIndex(n+l.chars));t=this.rtcm.getAttributeSpans(n,n+l.chars);var p=0;for(i=0;i<t.length;i++)o.insert(f.substr(p,t[i].length),t[i].attributes),p+=t[i].length;n+=l.chars}}return new x_(o,e.meta.invert())},e}(),E_=function(){function e(e,t){this.pos=e,this.length=t}return e.prototype.end=function(){return this.pos+this.length},e}(),T_=function(){function e(e,t){if(!e)throw new Error("AnnotationList assertion failed"+(t?": "+t:""))}function t(e,t){this.pos=e,this.length=t.length,this.annotation=t.annotation,this.attachedObject_=t.attachedObject}function i(e,t){this.pos=e,this.length=t.length,this.annotation=t.annotation,this.node_=t}t.prototype.getAttachedObject=function(){return this.attachedObject_},i.prototype.attachObject=function(e){this.node_.attachedObject=e};var n={equals:function(){return!1}};function s(e){this.head_=new r(0,n),this.changeHandler_=e}function r(e,t){this.length=e,this.annotation=t,this.attachedObject=null,this.next=null}return s.prototype.insertAnnotatedSpan=function(t,i){this.wrapOperation_(new E_(t.pos,0),(function(s,o){e(!o||null===o.next);var a=new r(t.length,i);if(o){e(t.pos>s&&t.pos<s+o.length);var l=new r(0,n);return l.next=new r(t.pos-s,o.annotation),l.next.next=a,a.next=new r(s+o.length-t.pos,o.annotation),l.next}return a}))},s.prototype.removeSpan=function(t){0!==t.length&&this.wrapOperation_(t,(function(i,s){e(null!==s);var o=new r(0,n),a=o;for(t.pos>i&&(a.next=new r(t.pos-i,s.annotation),a=a.next);t.end()>i+s.length;)i+=s.length,s=s.next;var l=i+s.length-t.end();return l>0&&(a.next=new r(l,s.annotation)),o.next}))},s.prototype.updateSpan=function(t,i){0!==t.length&&this.wrapOperation_(t,(function(s,o){e(null!==o);var a=new r(0,n),l=a,h=s,c=t.pos-h;for(e(c<o.length),c>0&&(l.next=new r(c,o.annotation),h+=(l=l.next).length);null!==o&&t.end()>=s+o.length;){var u=s+o.length-h;l.next=new r(u,i(o.annotation,u)),l=l.next,s+=o.length,o=o.next,h=s}var d=t.end()-h;return d>0&&(e(d<o.length),l.next=new r(d,i(o.annotation,d)),h+=(l=l.next).length,l.next=new r(s+o.length-h,o.annotation)),a.next}))},s.prototype.wrapOperation_=function(e,n){if(e.pos<0)throw new Error("Span start cannot be negative.");var s,o=[],a=[],l=this.getAffectedNodes_(e);null!==l.start?(s=l.end.next,l.end.next=null):s=l.succ;var h=n(l.startPos,l.start),c=!1,u=!1;if(h){var d;for(this.mergeNodesWithSameAnnotations_(h),l.pred&&l.pred.annotation.equals(h.annotation)?(c=!0,h.length+=l.pred.length,l.beforePred.next=h,d=l.predPos):(l.beforeStart.next=h,d=l.startPos);h.next;)a.push(new i(d,h)),d+=h.length,h=h.next;l.succ&&l.succ.annotation.equals(h.annotation)?(h.length+=l.succ.length,u=!0,h.next=l.succ.next):h.next=s,a.push(new i(d,h))}else l.pred&&l.succ&&l.pred.annotation.equals(l.succ.annotation)?(c=!0,u=!0,h=new r(l.pred.length+l.succ.length,l.pred.annotation),l.beforePred.next=h,h.next=l.succ.next,a.push(new i(l.startPos-l.pred.length,h))):l.beforeStart.next=s;c&&o.push(new t(l.predPos,l.pred));for(var f=l.startPos,p=l.start;null!==p;)o.push(new t(f,p)),f+=p.length,p=p.next;u&&o.push(new t(f,l.succ)),this.changeHandler_(o,a)},s.prototype.getAffectedNodes_=function(e){for(var t={},i=null,n=this.head_,s=n.next,r=0;null!==s&&e.pos>=r+s.length;)r+=s.length,i=n,n=s,s=s.next;if(null===s&&(0!==e.length||e.pos!==r))throw new Error("Span start exceeds the bounds of the AnnotationList.");for(t.startPos=r,0===e.length&&e.pos===r?t.start=null:t.start=s,t.beforeStart=n,r===e.pos&&r>0?(t.pred=n,t.predPos=r-n.length,t.beforePred=i):t.pred=null;null!==s&&e.end()>r;)r+=s.length,n=s,s=s.next;if(e.end()>r)throw new Error("Span end exceeds the bounds of the AnnotationList.");return 0===e.length&&e.end()===r?t.end=null:t.end=n,t.succ=r===e.end()?s:null,t},s.prototype.mergeNodesWithSameAnnotations_=function(e){if(e)for(var t=null,i=e;i;)t&&t.annotation.equals(i.annotation)?(t.length+=i.length,t.next=i.next):t=i,i=i.next},s.prototype.forEach=function(e){for(var t=this.head_.next;null!==t;)e(t.length,t.annotation,t.attachedObject),t=t.next},s.prototype.getAnnotatedSpansForPos=function(e){for(var i=0,n=this.head_.next,s=null;null!==n&&i+n.length<=e;)i+=n.length,s=n,n=n.next;if(null===n&&i!==e)throw new Error("pos exceeds the bounds of the AnnotationList");var r=[];return i===e&&s&&r.push(new t(i-s.length,s)),n&&r.push(new t(i,n)),r},s.prototype.getAnnotatedSpansForSpan=function(e){if(0===e.length)return[];for(var t=[],i=this.getAffectedNodes_(e),n=i.startPos,s=i.start;null!==s&&n<e.end();){var r=Math.max(n,e.pos),o=Math.min(n+s.length,e.end()),a=new E_(r,o-r);a.annotation=s.annotation,t.push(a),n+=s.length,s=s.next}return t},s.prototype.count=function(){for(var t=0,i=this.head_.next,n=null;null!==i;)n&&e(!n.annotation.equals(i.annotation)),n=i,i=i.next,t++;return t},r.prototype.clone=function(){var e=new r(this.spanLength,this.annotation);return e.next=this.next,e},s}(),M_=function(){var e={c:"color",bc:"background-color",fs:"font-size",li:function(e){return"padding-left: "+40*e+"px"}},t={};function i(e,t,i){this.codeMirror=e,this.options_=i||{},this.entityManager_=t,this.currentAttributes_=null;var n=this;this.annotationList_=new T_((function(e,t){n.onAnnotationsChanged_(e,t)})),this.initAnnotationList_(),h(this,"onCodeMirrorBeforeChange_"),h(this,"onCodeMirrorChange_"),h(this,"onCursorActivity_"),parseInt(CodeMirror.version)>=4?this.codeMirror.on("changes",this.onCodeMirrorChange_):this.codeMirror.on("change",this.onCodeMirrorChange_),this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.on("cursorActivity",this.onCursorActivity_),this.changeId_=0,this.outstandingChanges_={},this.dirtyLines_=[]}n_.makeEventEmitter(i,["change","attributesChange","newLine"]);var n=l_.LINE_SENTINEL_CHARACTER,s=l_.ENTITY_SENTINEL_CHARACTER;function r(e,t){return e.line-t.line||e.ch-t.ch}function o(e,t){return r(e,t)<=0}function a(e){if(0===e.length)return 0;for(var t=0,i=0;i<e.length;i++)t+=e[i].length;return t+e.length-1}function l(e){this.attributes=e||{}}function h(e,t){var i=e[t];e[t]=function(){i.apply(e,arguments)}}return i.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.off("change",this.onCodeMirrorChange_),this.codeMirror.off("changes",this.onCodeMirrorChange_),this.codeMirror.off("cursorActivity",this.onCursorActivity_),this.clearAnnotations_()},i.prototype.toggleAttribute=function(e,t){var i=t||!0;if(this.emptySelection_()){var n=this.getCurrentAttributes_();n[e]===i?delete n[e]:n[e]=i,this.currentAttributes_=n}else{var s=this.getCurrentAttributes_()[e]!==i&&i;this.setAttribute(e,s)}},i.prototype.setAttribute=function(e,t){var i=this.codeMirror;if(this.emptySelection_()){var n=this.getCurrentAttributes_();!1===t?delete n[e]:n[e]=t,this.currentAttributes_=n}else this.updateTextAttributes(i.indexFromPos(i.getCursor("start")),i.indexFromPos(i.getCursor("end")),(function(i){!1===t?delete i[e]:i[e]=t})),this.updateCurrentAttributes_()},i.prototype.updateTextAttributes=function(e,t,i,n,s){var r=[],o=e,a=this;this.annotationList_.updateSpan(new E_(e,t-e),(function(e,t){var h={};for(var c in e.attributes)h[c]=e.attributes[c];h[a_.LINE_SENTINEL]&&!s||i(h);var u={},d={};return a.computeChangedAttributes_(e.attributes,h,u,d),function(e){for(var t in e)return!1;return!0}(u)||r.push({start:o,end:o+t,attributes:u,attributesInverse:d,origin:n}),o+=t,new l(h)})),r.length>0&&this.trigger("attributesChange",this,r)},i.prototype.computeChangedAttributes_=function(e,t,i,n){var s,r={};for(s in e)r[s]=!0;for(s in t)r[s]=!0;for(s in r)s in t?s in e?e[s]!==t[s]&&(i[s]=t[s],n[s]=e[s]):(i[s]=t[s],n[s]=!1):(i[s]=!1,n[s]=e[s])},i.prototype.toggleLineAttribute=function(e,t){var i,n=this.getCurrentLineAttributes_();i=(!(e in n)||n[e]!==t)&&t,this.setLineAttribute(e,i)},i.prototype.setLineAttribute=function(e,t){this.updateLineAttributesForSelection((function(i){!1===t?delete i[e]:i[e]=t}))},i.prototype.updateLineAttributesForSelection=function(e){var t=this.codeMirror,i=t.getCursor("start"),n=t.getCursor("end"),s=i.line,r=n.line,o=t.getLine(r),a=this.areLineSentinelCharacters_(o.substr(0,n.ch));r>s&&a&&r--,this.updateLineAttributes(s,r,e)},i.prototype.updateLineAttributes=function(e,t,i){for(var s=e;s<=t;s++){var r=this.codeMirror.getLine(s),o=this.codeMirror.indexFromPos({line:s,ch:0});if(r[0]!==n){var a={};a[a_.LINE_SENTINEL]=!0,i(a),this.insertText(o,n,a)}else this.updateTextAttributes(o,o+1,i,null,!0)}},i.prototype.replaceText=function(e,t,i,n,s){this.changeId_++;var r="cmrt-"+this.changeId_;this.outstandingChanges_[r]={origOrigin:s,attributes:n};var o=this.codeMirror,a=o.posFromIndex(e),l="number"==typeof t?o.posFromIndex(t):null;o.replaceRange(i,a,l,r)},i.prototype.insertText=function(e,t,i,n){var s=this.codeMirror,r=s.getCursor(),o="RTCMADAPTER"==n&&!s.somethingSelected()&&e==s.indexFromPos(r);this.replaceText(e,null,t,i,n),o&&s.setCursor(r)},i.prototype.removeText=function(e,t,i){var n=this.codeMirror;n.replaceRange("",n.posFromIndex(e),n.posFromIndex(t),i)},i.prototype.insertEntityAtCursor=function(e,t,i){var n=this.codeMirror,s=n.indexFromPos(n.getCursor("head"));this.insertEntityAt(s,e,t,i)},i.prototype.insertEntityAt=function(e,t,i,n){this.codeMirror;this.insertEntity_(e,new h_(t,i),n)},i.prototype.insertEntity_=function(e,t,i){this.replaceText(e,null,s,t.toAttributes(),i)},i.prototype.getAttributeSpans=function(e,t){for(var i=[],n=this.annotationList_.getAnnotatedSpansForSpan(new E_(e,t-e)),s=0;s<n.length;s++)i.push({length:n[s].length,attributes:n[s].annotation.attributes});return i},i.prototype.end=function(){var e=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:e,ch:this.codeMirror.getLine(e).length})},i.prototype.getRange=function(e,t){var i=this.codeMirror.posFromIndex(e),n=this.codeMirror.posFromIndex(t);return this.codeMirror.getRange(i,n)},i.prototype.initAnnotationList_=function(){var e=this.end();0!==e&&this.annotationList_.insertAnnotatedSpan(new E_(0,e),new l)},i.prototype.onAnnotationsChanged_=function(e,t){var i,n={};this.tryToUpdateEntitiesInPlace(e,t);for(var s=0;s<e.length;s++){var r=e[s].annotation.attributes;a_.LINE_SENTINEL in r&&(n[this.codeMirror.posFromIndex(e[s].pos).line]=!0),(i=e[s].getAttachedObject())&&i.clear()}for(s=0;s<t.length;s++){var o=t[s].annotation,a=a_.LINE_SENTINEL in o.attributes,l=a_.ENTITY_SENTINEL in o.attributes,h=this.codeMirror.posFromIndex(t[s].pos);if(a)n[h.line]=!0;else if(l)this.markEntity_(t[s]);else{var c=this.getClassNameForAttributes_(o.attributes);if(""!==c){var u=this.codeMirror.posFromIndex(t[s].pos+t[s].length);i=this.codeMirror.markText(h,u,{className:c}),t[s].attachObject(i)}}}for(var d in n)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(d))),this.queueLineMarking_()},i.prototype.tryToUpdateEntitiesInPlace=function(e,t){for(var i=e.length;i--;)for(var n=e[i],s=t.length;s--;){var r=t[s];if(n.pos==r.pos&&n.length==r.length&&n.annotation.attributes.ent&&n.annotation.attributes.ent==r.annotation.attributes.ent){var o=r.annotation.attributes.ent;if(this.entityManager_.entitySupportsUpdate(o)){e.splice(i,1),t.splice(s,1);var a=n.getAttachedObject();a.update(r.annotation.attributes),r.attachObject(a)}}}},i.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var e=this;this.lineMarkTimeout_=setTimeout((function(){e.lineMarkTimeout_=null;for(var t=[],i=0;i<e.dirtyLines_.length;i++){var n=e.codeMirror.getLineNumber(e.dirtyLines_[i]);t.push(Number(n))}e.dirtyLines_=[],t.sort((function(e,t){return e-t}));var s=-1;for(i=0;i<t.length;i++){var r=t[i];r>s&&(s=e.markLineSentinelCharactersForChangedLines_(r,r))}}),0)}},i.prototype.addStyleWithCSS_=function(e){var t=document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i)},i.prototype.getClassNameForAttributes_=function(i){var n="";for(var s in i){var r=i[s];if(s===a_.LINE_SENTINEL)n_.assert(!0===r,"LINE_SENTINEL attribute should be true if it exists.");else{var o=(this.options_.cssPrefix||"cmrt-")+s;if(!0!==r){s===a_.FONT_SIZE&&"string"!=typeof r&&(r+="px");var a=r.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");if(o+="-"+a,e[s]&&(t[s]||(t[s]={}),!t[s][a])){t[s][a]=!0;var l=e[s],h="function"==typeof l?l(r):l+": "+r,c=s==a_.LINE_INDENT?"pre."+o:"."+o;if(this.addStyleWithCSS_(c+" { "+h+" }"),s===a_.LINE_INDENT){c="pre.CodeMirror-line."+o;this.addStyleWithCSS_(c+" { "+h+" }")}}}n=n+" "+o}}return n},i.prototype.markEntity_=function(e){for(var t=e.annotation.attributes,i=h_.fromAttributes(t),n=this.codeMirror,s=this,r=[],o=0;o<e.length;o++){var a=n.posFromIndex(e.pos+o),l=n.posFromIndex(e.pos+o+1),h={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},c=this.createEntityHandle_(i,e.pos),u=this.entityManager_.renderToElement(i,c);u&&(h.replacedWith=u);var d=n.markText(a,l,h);r.push(d),c.setMarker(d)}e.attachObject({clear:function(){for(var e=0;e<r.length;e++)r[e].clear()},update:function(e){for(var t=h_.fromAttributes(e),i=0;i<r.length;i++)s.entityManager_.updateElement(t,r[i].replacedWith)}}),this.queueRefresh_()},i.prototype.queueRefresh_=function(){var e=this;this.refreshTimer_||(this.refreshTimer_=setTimeout((function(){e.codeMirror.refresh(),e.refreshTimer_=null}),0))},i.prototype.createEntityHandle_=function(e,t){var i=null,n=this;function s(){if(i){var e=i.find();return e?n.codeMirror.indexFromPos(e.from):null}return t}return{find:s,remove:function(){var e=s();null!=e&&(n.codeMirror.focus(),n.removeText(e,e+1))},replace:function(t){var i=a_.ENTITY_SENTINEL,r=i+"_",o=s();n.updateTextAttributes(o,o+1,(function(n){for(var s in n)delete n[s];for(var o in n[i]=e.type,t)n[r+o]=t[o]}))},setMarker:function(e){i=e}}},i.prototype.lineClassRemover_=function(e){var t=this.codeMirror,i=t.getLineHandle(e);return{clear:function(){t.removeLineClass(i,"text",".*")}}},i.prototype.emptySelection_=function(){var e=this.codeMirror.getCursor("start"),t=this.codeMirror.getCursor("end");return e.line===t.line&&e.ch===t.ch},i.prototype.onCodeMirrorBeforeChange_=function(e,t){if("+input"===t.origin||"paste"===t.origin){for(var i=[],r=0;r<t.text.length;r++){var o=t.text[r];o=o.replace(new RegExp("["+n+s+"]","g"),""),i.push(o)}t.update(t.from,t.to,i)}},i.prototype.onCodeMirrorChange_=function(e,t){if("object"==typeof t.from){for(var i=[];t;)i.push(t),t=t.next;t=i}for(var n=this.convertCoordinateSystemForChanges_(t),s=[],r=0;r<n.length;r++){var o,a=n[r],h=a.start,c=(a.end,a.text),u=a.removed,d=a.origin;if(u.length>0){for(var f=this.annotationList_.getAnnotatedSpansForSpan(new E_(h,u.length)),p=0,g=0;g<f.length;g++){var m=f[g];s.push({start:h,end:h+m.length,removedAttributes:m.annotation.attributes,removed:u.substr(p,m.length),attributes:{},text:"",origin:a.origin}),p+=m.length}this.annotationList_.removeSpan(new E_(h,u.length))}if(c.length>0)"+input"===a.origin||"paste"===a.origin?o=this.currentAttributes_||{}:d in this.outstandingChanges_?(o=this.outstandingChanges_[d].attributes,d=this.outstandingChanges_[d].origOrigin,delete this.outstandingChanges_[d]):o={},this.annotationList_.insertAnnotatedSpan(new E_(h,c.length),new l(o)),s.push({start:h,end:h,removedAttributes:{},removed:"",text:c,attributes:o,origin:d})}this.markLineSentinelCharactersForChanges_(t),s.length>0&&this.trigger("change",this,s)},i.prototype.convertCoordinateSystemForChanges_=function(e){var t=this,i=function(e){return t.codeMirror.indexFromPos(e)};function n(e,t){return function(i){return o(i,t.from)?e(i):o(t.to,i)?e({line:i.line+t.text.length-1-(t.to.line-t.from.line),ch:t.to.line<i.line?i.ch:t.text.length<=1?i.ch-(t.to.ch-t.from.ch)+a(t.text):i.ch-t.to.ch+(n=t.text,n[n.length-1]).length})+a(t.removed)-a(t.text):t.from.line===i.line?e(t.from)+i.ch-t.from.ch:e(t.from)+a(t.removed.slice(0,i.line-t.from.line))+1+i.ch;var n}}for(var s=[],r=e.length-1;r>=0;r--){var l=e[r],h=(i=n(i,l))(l.from),c=l.removed.join("\n"),u=l.text.join("\n");s.unshift({start:h,end:h+c.length,removed:c,text:u,origin:l.origin})}return s},i.prototype.markLineSentinelCharactersForChanges_=function(e){for(var t=Number.MAX_VALUE,i=-1,s=0;s<e.length;s++){var r=e[s],o=r.from.line;r.from.ch;(r.removed.length>1||r.removed[0].indexOf(n)>=0)&&(t=Math.min(t,o),i=Math.max(i,o)),r.text.length>1?(t=Math.min(t,o),i=Math.max(i,o+r.text.length-1)):r.text[0].indexOf(n)>=0&&(t=Math.min(t,o),i=Math.max(i,o))}i=Math.min(i,this.codeMirror.lineCount()-1),this.markLineSentinelCharactersForChangedLines_(t,i)},i.prototype.markLineSentinelCharactersForChangedLines_=function(e,t){if(e<Number.MAX_VALUE)for(;e>0&&this.lineIsListItemOrIndented_(e-1);)e--;if(t>-1)for(var i=this.codeMirror.lineCount();t+1<i&&this.lineIsListItemOrIndented_(t+1);)t++;for(var s=[],r=this.codeMirror,o=e;o<=t;o++){var a=r.getLine(o),l=r.getLineHandle(o);if(r.removeLineClass(l,"text",".*"),a.length>0)for(var h=a.indexOf(n);h>=0;){for(var c=h;h<a.length&&a[h]===n;){for(var u=r.findMarksAt({line:o,ch:h}),d=0;d<u.length;d++)u[d].isForLineSentinel&&u[d].clear();h++}this.markLineSentinelCharacters_(o,c,h,s),h=a.indexOf(n,h)}else s=[]}return t},i.prototype.markLineSentinelCharacters_=function(e,t,i,n){var s=this.codeMirror,r=null,o=null,a=function(){var e=o.find();return e?e.from.line:null};if(0===t){var l=this.getLineAttributes_(e),h=l[a_.LIST_TYPE],c=l[a_.LINE_INDENT]||0;for(h&&0===c&&(c=1);c>=n.length;)n.push(1);"o"===h?(r=this.makeOrderedListElement_(n[c]),n[c]++):"u"===h?(r=this.makeUnorderedListElement_(),n[c]=1):"t"===h?(r=this.makeTodoListElement_(!1,a),n[c]=1):"tc"===h&&(r=this.makeTodoListElement_(!0,a),n[c]=1);var u=this.getClassNameForAttributes_(l);""!==u&&this.codeMirror.addLineClass(e,"text",u),n[c+1]=1}var d={inclusiveLeft:!0,collapsed:!0};r&&(d.replacedWith=r),(o=s.markText({line:e,ch:t},{line:e,ch:i},d)).isForLineSentinel=!0},i.prototype.makeOrderedListElement_=function(e){return n_.elt("div",e+".",{class:"firepad-list-left"})},i.prototype.makeUnorderedListElement_=function(){return n_.elt("div","•",{class:"firepad-list-left"})},i.prototype.toggleTodo=function(e){var t,i=a_.LIST_TYPE,n=this.getCurrentLineAttributes_();!(i in n)||"t"!==n[i]&&"tc"!==n[i]?t="t":"t"===n[i]?t="tc":"tc"===n[i]&&(t=!!e&&"t"),this.setLineAttribute(i,t)},i.prototype.makeTodoListElement_=function(e,t){var i={type:"checkbox",class:"firepad-todo-left"};e&&(i.checked=!0);var n=n_.elt("input",!1,i),s=this;return n_.on(n,"click",n_.stopEventAnd((function(e){s.codeMirror.setCursor({line:t(),ch:1}),s.toggleTodo(!0)}))),n},i.prototype.lineIsListItemOrIndented_=function(e){var t=this.getLineAttributes_(e);return!1!==(t[a_.LIST_TYPE]||!1)||0!==(t[a_.LINE_INDENT]||0)},i.prototype.onCursorActivity_=function(){var e=this;setTimeout((function(){e.updateCurrentAttributes_()}),1)},i.prototype.getCurrentAttributes_=function(){return this.currentAttributes_||this.updateCurrentAttributes_(),this.currentAttributes_},i.prototype.updateCurrentAttributes_=function(){var e=this.codeMirror,t=e.indexFromPos(e.getCursor("anchor")),i=e.indexFromPos(e.getCursor("head")),s=i;if(t>i){for(;s<this.end();){var r=this.getRange(s,s+1);if("\n"!==r&&r!==n)break;s++}s<this.end()&&s++}else for(;s>0&&("\n"===(r=this.getRange(s-1,s))||r===n);)s--;var o=this.annotationList_.getAnnotatedSpansForPos(s);this.currentAttributes_={};var a={};for(var l in o.length>0&&!(a_.LINE_SENTINEL in o[0].annotation.attributes)?a=o[0].annotation.attributes:o.length>1&&(n_.assert(!(a_.LINE_SENTINEL in o[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),a=o[1].annotation.attributes),a)"l"!==l&&"lt"!==l&&"li"!==l&&0!==l.indexOf(a_.ENTITY_SENTINEL)&&(this.currentAttributes_[l]=a[l])},i.prototype.getCurrentLineAttributes_=function(){var e=this.codeMirror,t=e.getCursor("anchor"),i=e.getCursor("head"),n=i.line;return 0===i.ch&&t.line<i.line&&n--,this.getLineAttributes_(n)},i.prototype.getLineAttributes_=function(e){var t={},i=this.codeMirror.getLine(e);if(i.length>0&&i[0]===n){var s=this.codeMirror.indexFromPos({line:e,ch:0}),r=this.annotationList_.getAnnotatedSpansForSpan(new E_(s,1));for(var o in n_.assert(1===r.length),r[0].annotation.attributes)t[o]=r[0].annotation.attributes[o]}return t},i.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new E_(0,this.end()),(function(e,t){return new l({})}))},i.prototype.newline=function(){var e=this.codeMirror,t=this;if(this.emptySelection_()){var i=e.getCursor("head").line,n=this.getLineAttributes_(i),s=n[a_.LIST_TYPE];s&&1===e.getLine(i).length?this.updateLineAttributes(i,i,(function(e){delete e[a_.LIST_TYPE],delete e[a_.LINE_INDENT]})):(e.replaceSelection("\n","end","+input"),this.updateLineAttributes(i+1,i+1,(function(e){for(var r in n)e[r]=n[r];"tc"===s&&(e[a_.LIST_TYPE]="t"),t.trigger("newLine",{line:i+1,attr:e})})))}else e.replaceSelection("\n","end","+input")},i.prototype.deleteLeft=function(){var e=this.codeMirror,t=e.getCursor("head"),i=this.getLineAttributes_(t.line),n=i[a_.LIST_TYPE],s=i[a_.LINE_INDENT],r=this.emptySelection_()&&1===t.ch;r&&n?this.updateLineAttributes(t.line,t.line,(function(e){delete e[a_.LIST_TYPE],delete e[a_.LINE_INDENT]})):r&&s&&s>0?this.unindent():e.deleteH(-1,"char")},i.prototype.deleteRight=function(){var e=this.codeMirror,t=e.getCursor("head"),i=e.getLine(t.line),s=this.areLineSentinelCharacters_(i),r=t.line+1<e.lineCount()?e.getLine(t.line+1):"";this.emptySelection_()&&s&&r[0]===n?(e.replaceRange("",{line:t.line,ch:0},{line:t.line+1,ch:0},"+input"),e.setCursor({line:t.line,ch:0})):e.deleteH(1,"char")},i.prototype.indent=function(){this.updateLineAttributesForSelection((function(e){var t=e[a_.LINE_INDENT],i=e[a_.LIST_TYPE];t?e[a_.LINE_INDENT]++:e[a_.LINE_INDENT]=i?2:1}))},i.prototype.unindent=function(){this.updateLineAttributesForSelection((function(e){var t=e[a_.LINE_INDENT];t&&t>1?e[a_.LINE_INDENT]=t-1:(delete e[a_.LIST_TYPE],delete e[a_.LINE_INDENT])}))},i.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(n,"g"),"")},i.prototype.areLineSentinelCharacters_=function(e){for(var t=0;t<e.length;t++)if(e[t]!==n)return!1;return!0},l.prototype.equals=function(e){if(!(e instanceof l))return!1;var t;for(t in this.attributes)if(e.attributes[t]!==this.attributes[t])return!1;for(t in e.attributes)if(e.attributes[t]!==this.attributes[t])return!1;return!0},i}(),L_=function(e){function t(e){this.imageInsertionUI=e,this.element_=this.makeElement_()}return n_.makeEventEmitter(t,["bold","italic","underline","strike","font","font-size","color","left","center","right","unordered-list","ordered-list","todo-list","indent-increase","indent-decrease","undo","redo","insert-image"]),t.prototype.element=function(){return this.element_},t.prototype.makeButton_=function(e,t){var i=this;t=t||e;var n=n_.elt("a",[n_.elt("span","",{class:"firepad-tb-"+t})],{class:"firepad-btn"});return n_.on(n,"click",n_.stopEventAnd((function(){i.trigger(e)}))),n},t.prototype.makeElement_=function(){var e=this,t=this.makeFontDropdown_(),i=this.makeFontSizeDropdown_(),n=this.makeColorDropdown_(),s=[n_.elt("div",[t],{class:"firepad-btn-group"}),n_.elt("div",[i],{class:"firepad-btn-group"}),n_.elt("div",[n],{class:"firepad-btn-group"}),n_.elt("div",[e.makeButton_("bold"),e.makeButton_("italic"),e.makeButton_("underline"),e.makeButton_("strike","strikethrough")],{class:"firepad-btn-group"}),n_.elt("div",[e.makeButton_("unordered-list","list-2"),e.makeButton_("ordered-list","numbered-list"),e.makeButton_("todo-list","list")],{class:"firepad-btn-group"}),n_.elt("div",[e.makeButton_("indent-decrease"),e.makeButton_("indent-increase")],{class:"firepad-btn-group"}),n_.elt("div",[e.makeButton_("left","paragraph-left"),e.makeButton_("center","paragraph-center"),e.makeButton_("right","paragraph-right")],{class:"firepad-btn-group"}),n_.elt("div",[e.makeButton_("undo"),e.makeButton_("redo")],{class:"firepad-btn-group"})];e.imageInsertionUI&&s.push(n_.elt("div",[e.makeButton_("insert-image")],{class:"firepad-btn-group"}));var r=n_.elt("div",s,{class:"firepad-toolbar-wrapper"}),o=n_.elt("div",null,{class:"firepad-toolbar"});return o.appendChild(r),o},t.prototype.makeFontDropdown_=function(){for(var e=["Arial","Comic Sans MS","Courier New","Impact","Times New Roman","Verdana"],t=[],i=0;i<e.length;i++){var n=n_.elt("span",e[i]);n.setAttribute("style","font-family:"+e[i]),t.push({content:n,value:e[i]})}return this.makeDropdown_("Font","font",t)},t.prototype.makeFontSizeDropdown_=function(){for(var e=[9,10,12,14,18,24,32,42],t=[],i=0;i<e.length;i++){var n=n_.elt("span",e[i].toString());n.setAttribute("style","font-size:"+e[i]+"px; line-height:"+(e[i]-6)+"px;"),t.push({content:n,value:e[i]})}return this.makeDropdown_("Size","font-size",t,"px")},t.prototype.makeColorDropdown_=function(){for(var e=["black","red","green","blue","yellow","cyan","magenta","grey"],t=[],i=0;i<e.length;i++){var n=n_.elt("div");n.className="firepad-color-dropdown-item",n.setAttribute("style","background-color:"+e[i]),t.push({content:n,value:e[i]})}return this.makeDropdown_("Color","color",t)},t.prototype.makeDropdown_=function(e,t,i,n){n=n||"";var s=this,r=n_.elt("a",e+" ▾",{class:"firepad-btn firepad-dropdown"}),o=n_.elt("ul",[],{class:"firepad-dropdown-menu"});r.appendChild(o);var a=!1;var l=!1;function h(){a&&(o.style.display="",n_.off(document,"click",h,!0),a=!1),l=!0,setTimeout((function(){l=!1}),0)}function c(e,i){"object"!=typeof e&&(e=document.createTextNode(String(e)));var r=n_.elt("a",[e]);n_.on(r,"click",n_.stopEventAnd((function(){h(),s.trigger(t,i+n)}))),o.appendChild(r)}for(var u=0;u<i.length;u++){c(i[u].content,i[u].value)}return n_.on(r,"click",n_.stopEventAnd((function(){l||a||(o.style.display="block",n_.on(document,"click",h,!0),a=!0)}))),r},t}(),R_=function(){class e{constructor(e){var t;this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),this.ace=e,this.aceSession=this.ace.getSession(),this.aceDoc=this.aceSession.getDocument(),this.aceDoc.setNewLineMode("unix"),this.grabDocumentState(),this.ace.on("change",this.onChange),this.ace.on("blur",this.onBlur),this.ace.on("focus",this.onFocus),this.aceSession.selection.on("changeCursor",this.onCursorActivity),null==this.aceRange&&(this.aceRange=(null!=(t=ace.require)?t:void 0)("ace/range").Range)}grabDocumentState(){return this.lastDocLines=this.aceDoc.getAllLines(),this.lastCursorRange=this.aceSession.selection.getRange()}detach(){return this.ace.removeListener("change",this.onChange),this.ace.removeListener("blur",this.onBlur),this.ace.removeListener("focus",this.onFocus),this.aceSession.selection.removeListener("changeCursor",this.onCursorActivity)}onChange(e){var t;if(!this.ignoreChanges)return t=this.operationFromACEChange(e),this.trigger("change",...t),this.grabDocumentState()}onBlur(){if(this.ace.selection.isEmpty())return this.trigger("blur")}onFocus(){return this.trigger("focus")}onCursorActivity(){return setTimeout((()=>this.trigger("cursorActivity")),0)}operationFromACEChange(e){var t,i,n,s,r,o,a;return e.data?("insertLines"===(s=(i=e.data).action)||"removeLines"===s?(a=i.lines.join("\n")+"\n",i.action.replace("Lines","")):(a=i.text.replace(this.aceDoc.getNewLineCharacter(),"\n"),i.action.replace("Text","")),o=this.indexFromPos(i.range.start)):(a=e.lines.join("\n"),o=this.indexFromPos(e.start)),r=this.lastDocLines.join("\n").length-o,"remove"===e.action&&(r-=a.length),n=(new r_).retain(o).insert(a).retain(r),t=(new r_).retain(o).delete(a).retain(r),"remove"===e.action?[t,n]:[n,t]}applyOperationToACE(e){var t,i,n,s,r,o,a,l;for(i=0,n=0,s=(a=e.ops).length;n<s;n++)(r=a[n]).isRetain()?i+=r.chars:r.isInsert()?(this.aceDoc.insert(this.posFromIndex(i),r.text),i+=r.text.length):r.isDelete()&&(t=this.posFromIndex(i),l=this.posFromIndex(i+r.chars),o=this.aceRange.fromPoints(t,l),this.aceDoc.remove(o));return this.grabDocumentState()}posFromIndex(e){var t,i,n,s,r;for(r=t=0,i=(s=this.aceDoc.$lines).length;t<i&&!(e<=(n=s[r]).length);r=++t)e-=n.length+1;return{row:r,column:e}}indexFromPos(e,t){var i,n,s,r;for(null==t&&(t=this.lastDocLines),n=0,i=s=0,r=e.row;0<=r?s<r:s>r;i=0<=r?++s:--s)n+=this.lastDocLines[i].length+1;return n+e.column}getValue(){return this.aceDoc.getValue()}getCursor(){var e,t,i;try{i=this.indexFromPos(this.aceSession.selection.getRange().start,this.aceDoc.$lines),t=this.indexFromPos(this.aceSession.selection.getRange().end,this.aceDoc.$lines)}catch(n){n;try{i=this.indexFromPos(this.lastCursorRange.start),t=this.indexFromPos(this.lastCursorRange.end)}catch(n){e=n,console.log("Couldn't figure out the cursor range:",e,"-- setting it to 0:0."),[i,t]=[0,0]}}return i>t&&([i,t]=[t,i]),new __(i,t)}setCursor(e){var t,i;return i=this.posFromIndex(e.position),t=this.posFromIndex(e.selectionEnd),e.position>e.selectionEnd&&([i,t]=[t,i]),this.aceSession.selection.setSelectionRange(new this.aceRange(i.row,i.column,t.row,t.column))}setOtherCursor(e,t,i){var n,s,r,o,a,l,h;return null==this.otherCursors&&(this.otherCursors={}),(r=this.otherCursors[i])&&(r.start.detach(),r.end.detach(),this.aceSession.removeMarker(r.id)),h=this.posFromIndex(e.position),o=this.posFromIndex(e.selectionEnd),e.selectionEnd<e.position&&([h,o]=[o,h]),n=`other-client-selection-${t.replace("#","")}`,(a=e.position===e.selectionEnd)&&(n=n.replace("selection","cursor")),s=`.${n} {\n  position: absolute;\n  background-color: ${a?"transparent":t};\n  border-left: 2px solid ${t};\n}`,this.addStyleRule(s),this.otherCursors[i]=r=new this.aceRange(h.row,h.column,o.row,o.column),l=this,r.clipRows=function(){var e;return(e=l.aceRange.prototype.clipRows.apply(this,arguments)).isEmpty=function(){return!1},e},r.start=this.aceDoc.createAnchor(r.start),r.end=this.aceDoc.createAnchor(r.end),r.id=this.aceSession.addMarker(r,n,"text"),{clear:()=>(r.start.detach(),r.end.detach(),this.aceSession.removeMarker(r.id))}}addStyleRule(e){var t;if("undefined"!=typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},t=document.createElement("style"),document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet),!this.addedStyleRules[e]))return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)}registerCallbacks(e){this.callbacks=e}trigger(e,...t){var i,n;return null!=(i=this.callbacks)&&null!=(n=i[e])?n.apply(this,t):void 0}applyOperation(e){return e.isNoop()||(this.ignoreChanges=!0),this.applyOperationToACE(e),this.ignoreChanges=!1}registerUndo(e){return this.ace.undo=e}registerRedo(e){return this.ace.redo=e}invertOperation(e){return e.invert(this.getValue())}}return e.prototype.ignoreChanges=!1,e}();var $_=function(e,t,i){return"."+e+" {\n  position: relative;\nbackground-color: "+t+";\nborder-left: 2px solid "+i+";\n}"},I_=function(e,t){if("undefined"==typeof document||null===document)return!1;if(-1===this.addedStyleRules.indexOf(e)){var i=document.createElement("style"),n=document.createTextNode(t);i.appendChild(n),document.head.appendChild(i),this.addedStyleRules.push(e)}},O_=function(){function e(e){if(!e||"function"!=typeof e.getModel)throw new Error("MonacoAdapter: Incorrect Parameter Recieved in constructor, expected valid Monaco Instance");this.monaco=e,this.monacoModel=this.monaco.getModel(),this.lastDocLines=this.monacoModel.getLinesContent(),this.lastCursorRange=this.monaco.getSelection(),this.callbacks={},this.otherCursors=[],this.addedStyleRules=[],this.ignoreChanges=!1,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),this.changeHandler=this.monaco.onDidChangeModelContent(this.onChange),this.didBlurHandler=this.monaco.onDidBlurEditorWidget(this.onBlur),this.didFocusHandler=this.monaco.onDidFocusEditorWidget(this.onFocus),this.didChangeCursorPositionHandler=this.monaco.onDidChangeCursorPosition(this.onCursorActivity)}return e.prototype.detach=function(){this.changeHandler.dispose(),this.didBlurHandler.dispose(),this.didFocusHandler.dispose(),this.didChangeCursorPositionHandler.dispose()},e.prototype.getCursor=function(){var e=this.monaco.getSelection();null==e&&(e=this.lastCursorRange);var t=e.getStartPosition(),i=e.getEndPosition(),n=this.monacoModel.getOffsetAt(t),s=this.monacoModel.getOffsetAt(i);if(n>s){var r=[s,n];n=r[0],s=r[1]}return new __(n,s)},e.prototype.setCursor=function(e){var t=e.position,i=e.selectionEnd,n=this.monacoModel.getPositionAt(t),s=this.monacoModel.getPositionAt(i);if(t>i){var r=[s,n];n=r[0],s=r[1]}this.monaco.setSelection(new monaco.Range(n.lineNumber,n.column,s.lineNumber,s.column))},e.prototype.setOtherCursor=function(e,t,i){if("object"!=typeof e||"number"!=typeof e.position||"number"!=typeof e.selectionEnd)return!1;if("string"!=typeof t||!t.match(/^#[a-fA-F0-9]{3,6}$/))return!1;var n=e.position,s=e.selectionEnd;if(n<0||s<0)return!1;var r=this.otherCursors.find((function(e){return e.clientID===i}));r||(r={clientID:i,decoration:[]},this.otherCursors.push(r)),r.decoration=this.monaco.deltaDecorations(r.decoration,[]);var o,a,l="other-client-selection-"+t.replace("#","");n===s?(l=l.replace("selection","cursor"),o=$_(l,"transparent",t),a=I_.call(this,l,o)):(o=$_(l,t,t),a=I_.call(this,l,o)),0==a&&console.log("Monaco Adapter: Failed to add some css style.\nPlease make sure you're running on supported environment.");var h=this.monacoModel.getPositionAt(n),c=this.monacoModel.getPositionAt(s);if(n>s){var u=[c,h];h=u[0],c=u[1]}r.decoration=this.monaco.deltaDecorations(r.decoration,[{range:new monaco.Range(h.lineNumber,h.column,c.lineNumber,c.column),options:{className:l}}]);var d=this;return{clear:function(){r.decoration=d.monaco.deltaDecorations(r.decoration,[])}}},e.prototype.registerCallbacks=function(e){this.callbacks=Object.assign({},this.callbacks,e)},e.prototype.registerUndo=function(e){if("function"!=typeof e)throw new Error("MonacoAdapter: registerUndo method expects a callback function in parameter");this.callbacks.undo=e},e.prototype.registerRedo=function(e){if("function"!=typeof e)throw new Error("MonacoAdapter: registerRedo method expects a callback function in parameter");this.callbacks.redo=e},e.prototype.operationFromMonacoChanges=function(e,t,i){var n,s,r,o=e.text,a=e.rangeLength,l=e.rangeOffset,h=t.length+i-l;return 0===o.length&&a>0?(r=t.slice(l,l+a),n=(new r_).retain(l).delete(a).retain(h-a),s=(new r_).retain(l).insert(r).retain(h-a)):o.length>0&&a>0?(r=t.slice(l,l+a),n=(new r_).retain(l).delete(a).insert(o).retain(h-a),s=(new r_).retain(l).delete(o.length).insert(r).retain(h-a)):(n=(new r_).retain(l).insert(o).retain(h),s=(new r_).retain(l).delete(o).retain(h)),[n,s]},e.prototype.onChange=function(e){var t=this;if(!this.ignoreChanges){var i=this.lastDocLines.join(this.monacoModel.getEOL()),n=0;if(!e.changes){var s=(new r_).retain(i.length);this.trigger("change",s,s)}e.changes.forEach((function(e){var s=t.operationFromMonacoChanges(e,i,n);n+=s[0].targetLength-s[0].baseLength,t.trigger.apply(t,["change"].concat(s))})),this.lastDocLines=this.monacoModel.getLinesContent()}},e.prototype.trigger=function(e){if(this.callbacks.hasOwnProperty(e)){var t=this.callbacks[e],i=[];if(arguments.length>1)for(var n=1;n<arguments.length;n++)i.push(arguments[n]);t.apply(null,i)}},e.prototype.onBlur=function(){this.monaco.getSelection().isEmpty()&&this.trigger("blur")},e.prototype.onFocus=function(){this.trigger("focus")},e.prototype.onCursorActivity=function(){var e=this;setTimeout((function(){return e.trigger("cursorActivity")}),1)},e.prototype.applyOperation=function(e){e.isNoop()||(this.ignoreChanges=!0);var t=e.ops,i=0,n=this;t.forEach((function(e){if(e.isRetain())i+=e.chars;else if(e.isInsert()){var t=n.monacoModel.getPositionAt(i);n.monaco.executeEdits("my-source",[{range:new monaco.Range(t.lineNumber,t.column,t.lineNumber,t.column),text:e.text,forceMoveMarkers:!0}]),i+=e.text.length}else if(e.isDelete()){var s=n.monacoModel.getPositionAt(i),r=n.monacoModel.getPositionAt(i+e.chars);n.monaco.executeEdits("my-source",[{range:new monaco.Range(s.lineNumber,s.column,r.lineNumber,r.column),text:"",forceMoveMarkers:!0}])}})),this.lastDocLines=this.monacoModel.getLinesContent(),this.ignoreChanges=!1},e.prototype.invertOperation=function(e){e.invert(this.getValue())},e}(),D_=function(){function e(e){this.cm=e,this.lastDocLines=this.cm.state.doc.text,this.lastCursorRange=this.cm.state.selection.main,this.callbacks={},this.otherCursors=[],this.addedStyleRules=[],this.ignoreChanges=!1,this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this);this.cm.dispatch({effects:me.appendConfig.of(this.cm.constructor.updateListener.of((e=>{if(e.docChanged&&(!e.transactions[0]||!e.transactions[0].annotations.some((e=>"firepad"==e.type)))){let t=0,i=new r_,n=new r_;e.changes.toJSON().forEach((s=>{if("number"==typeof s)0!=s&&(t+=s,i=i.retain(s),n=n.retain(s));else if("object"==typeof s){const[r,...o]=s;if(r>0&&(i=i.delete(r),n=n.insert(e.startState.sliceDoc(t,t+r))),o){const e=o.join("\n");i=i.insert(e),n=n.delete(e.length)}}})),this.trigger("change",i,n)}this.lastDocLines=this.cm.state.doc.text})))})}return e.prototype.detach=function(){},e.prototype.getCursor=function(){var e=this.cm.state.selection.main;null==e&&(e=this.lastCursorRange);var t=e.from,i=e.to;if(t>i){var n=[i,t];t=n[0],i=n[1]}return new __(t,i)},e.prototype.setCursor=function(e){var t=e.position,i=e.selectionEnd;this.cm.dispatch({selection:{anchor:t,head:i}})},e.prototype.setOtherCursor=function(e,t,i){},e.prototype.registerCallbacks=function(e){this.callbacks=Object.assign({},this.callbacks,e)},e.prototype.registerUndo=function(e){if("function"!=typeof e)throw new Error("CodeMirror6Adapter: registerUndo method expects a callback function in parameter");this.callbacks.undo=e},e.prototype.registerRedo=function(e){if("function"!=typeof e)throw new Error("CodeMirror6Adapter: registerRedo method expects a callback function in parameter");this.callbacks.redo=e},e.prototype.trigger=function(e){if(this.callbacks.hasOwnProperty(e)){var t=this.callbacks[e],i=[];if(arguments.length>1)for(var n=1;n<arguments.length;n++)i.push(arguments[n]);t.apply(null,i)}},e.prototype.onBlur=function(){this.monaco.getSelection().isEmpty()&&this.trigger("blur")},e.prototype.onFocus=function(){this.trigger("focus")},e.prototype.onCursorActivity=function(){var e=this;setTimeout((function(){return e.trigger("cursorActivity")}),1)},e.prototype.applyOperation=function(e){e.isNoop()||(this.ignoreChanges=!0);var t=e.ops,i=0,n=this;t.forEach((function(e){e.isRetain()?i+=e.chars:e.isInsert()?(n.cm.dispatch({annotations:[new fe("firepad",!0)],changes:{from:i,to:i,insert:e.text}}),i+=e.text.length):e.isDelete()&&n.cm.dispatch({annotations:[new fe("firepad",!0)],changes:{from:i,to:i+e.chars,insert:""}})})),this.lastDocLines=this.cm.state.doc.text,this.ignoreChanges=!1},e.prototype.invertOperation=function(e){e.invert(this.getValue())},e}();!function(){function e(t){if(!(this instanceof e))return new e(t);var i;i="string"==typeof t?Tp.database().refFromURL(t):t,this.entityManager_=new f_,this.firebaseAdapter_=new o_(i),this.ready_=!1,this.zombie_=!1}e.prototype.getDocument=function(e){var t=this;if(t.ready_)return e(t.firebaseAdapter_.getDocument());t.firebaseAdapter_.on("ready",(function(){t.ready_=!0,e(t.firebaseAdapter_.getDocument())}))},e.prototype.getText=function(e){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");this.getDocument((function(t){var i=t.apply("");for(var n in l_)i=i.replace(new RegExp(l_[n],"g"),"");e(i)}))},e.prototype.setText=function(e,t){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");var i=r_().insert(e);this.sendOperationWithRetry(i,t)},e.prototype.initializeFakeDom=function(e){if("object"==typeof u_())e();else{const i=(0,t.require)("jsdom"),{JSDOM:n}=i,{window:s}=new n("<head></head><body></body>");if(u_())return s.close(),e();d_(s.document),e()}},e.prototype.getHtml=function(e){var t=this;if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");t.initializeFakeDom((function(){t.getDocument((function(i){e(y_(i,t.entityManager_))}))}))},e.prototype.setHtml=function(e,t){var i=this;if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");i.initializeFakeDom((function(){for(var n=w_(e,i.entityManager_),s=b_(!0,n),r=new r_,o=0;o<s.length;o++)r.insert(s[o].string,s[o].attributes);i.sendOperationWithRetry(r,t)}))},e.prototype.sendOperationWithRetry=function(e,t){var i=this;i.getDocument((function(n){var s=e.clone().delete(n.targetLength);i.firebaseAdapter_.sendOperation(s,(function(n,s){s?void 0!==t&&t(null,s):i.sendOperationWithRetry(e,t)}))}))},e.prototype.dispose=function(){this.zombie_=!0,this.firebaseAdapter_.dispose()}}();let N_;try{N_=Function("return this")()}catch(e){N_=window}const P_=function(){var{LIST_TYPE:e}=p_,t=N_.CodeMirror,i=N_.ace;N_.monaco;function n(e,r,o){if(!(this instanceof n))return new n(e,r,o);if(!t&&!i&&!N_.monaco&&"CodeMirror6"!==r.type)throw new Error("Couldn't find CodeMirror, ACE or Monaco.  Did you forget to include codemirror.js/ace.js or import monaco?");if(this.zombie_=!1,"CodeMirror6"===r.type){this.codeMirror6_=this.editor_=r.editor;if(""!==this.codeMirror6_.state.doc.toString())throw new Error("Can't initialize Firepad with a CodeMirror6 instance that already contains text.")}else if(t&&r instanceof t){this.codeMirror_=this.editor_=r;var a=this.codeMirror_.getValue();if(""!==a)throw new Error("Can't initialize Firepad with a CodeMirror instance that already contains text.")}else if(i&&r&&r.session instanceof i.EditSession){if(this.ace_=this.editor_=r,""!==(a=this.ace_.getValue()))throw new Error("Can't initialize Firepad with an ACE instance that already contains text.")}else if(N_.monaco&&r&&r instanceof N_.monaco.constructor){if(N_.monaco,this.monaco_=this.editor_=r,""!==(a=this.monaco_.getValue()))throw new Error("Can't initialize Firepad with a Monaco instance that already contains text.")}else this.codeMirror_=this.editor_=new t(r);var l;l=this.codeMirror6_?this.codeMirror6_.dom:this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_?this.ace_.container:this.monaco_.getDomNode(),this.firepadWrapper_=n_.elt("div",null,{class:"firepad"}),l.parentNode.replaceChild(this.firepadWrapper_,l),this.firepadWrapper_.appendChild(l),this.editor_.firepad=this,this.options_=o||{},this.getOption("richTextShortcuts",!1)&&(t.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.firepadWrapper_.className+=" firepad-richtext"),this.imageInsertionUI=this.getOption("imageInsertionUI",!0),this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.firepadWrapper_.className+=" firepad-richtext firepad-with-toolbar"),this.addPoweredByLogo_(),this.codeMirror_&&this.codeMirror_.refresh();var h=this.getOption("userId",e.push().key),c=this.getOption("userColor",function(e){for(var t=1,i=0;i<e.length;i++)t=17*(t+e.charCodeAt(i))%360;return function(e,t,i){if(0===t)return s(i,i,i);var n=i<.5?i*(1+t):i+t-t*i,r=2*i-n,o=function(e){return e<0&&(e+=1),e>1&&(e-=1),6*e<1?r+6*(n-r)*e:2*e<1?n:3*e<2?r+6*(n-r)*(2/3-e):r};return s(o(e+1/3),o(e),o(e-1/3))}(t/360,1,.75)}(h));this.entityManager_=new f_,this.firebaseAdapter_=new o_(e,h,c),this.codeMirror6_?this.editorAdapter_=new D_(this.codeMirror6_,this.options_):this.codeMirror_?(this.richTextCodeMirror_=new M_(this.codeMirror_,this.entityManager_,{cssPrefix:"firepad-"}),this.editorAdapter_=new A_(this.richTextCodeMirror_)):this.ace_?this.editorAdapter_=new R_(this.ace_):this.editorAdapter_=new O_(this.monaco_),this.client_=new k_(this.firebaseAdapter_,this.editorAdapter_);var u=this;this.firebaseAdapter_.on("cursor",(function(){u.trigger.apply(u,["cursor"].concat([].slice.call(arguments)))})),this.codeMirror_&&this.richTextCodeMirror_.on("newLine",(function(){u.trigger.apply(u,["newLine"].concat([].slice.call(arguments)))})),this.firebaseAdapter_.on("ready",(function(){u.ready_=!0,u.ace_&&u.editorAdapter_.grabDocumentState(),u.monaco_&&u.editorAdapter_.grabDocumentState();var e=u.getOption("defaultText",null);e&&u.isHistoryEmpty()&&u.setText(e),u.trigger("ready")})),this.client_.on("synced",(function(e){u.trigger("synced",e)})),"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet.cssText=":before,:after{content:none !important;}",e.appendChild(t),setTimeout((function(){e.removeChild(t)}),0)})}function s(e,t,i){function n(e){var t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t}return"#"+n(e)+n(t)+n(i)}return n_.makeEventEmitter(n),n.fromCodeMirror=n,n.fromACE=n,n.fromMonaco=n,n.fromCodeMirror6=(e,t,...i)=>n(e,{type:"CodeMirror6",editor:t},...i),n.prototype.dispose=function(){var e;this.zombie_=!0,e=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_?this.ace_.container:this.monaco_.getDomNode(),this.firepadWrapper_.removeChild(e),this.firepadWrapper_.parentNode.replaceChild(e,this.firepadWrapper_),this.editor_.firepad=null,this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default"),this.firebaseAdapter_.dispose(),this.editorAdapter_.detach(),this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()},n.prototype.setUserId=function(e){this.firebaseAdapter_.setUserId(e)},n.prototype.setUserColor=function(e){this.firebaseAdapter_.setColor(e)},n.prototype.getText=function(){return this.assertReady_("getText"),this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_?this.ace_.getSession().getDocument().getValue():this.monaco_.getModel().getValue()},n.prototype.setText=function(e){if(this.assertReady_("setText"),this.codeMirror6_)this.codeMirror6_.state.doc.toString();else{if(this.monaco_)return this.monaco_.getModel().setValue(e);if(this.ace_)return this.ace_.getSession().getDocument().setValue(e);this.codeMirror_.getWrapperElement().style.display="none",this.codeMirror_.setValue(""),this.insertText(0,e),this.codeMirror_.getWrapperElement().style.display="",this.codeMirror_.refresh()}this.editorAdapter_.setCursor({position:0,selectionEnd:0})},n.prototype.insertTextAtCursor=function(e){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),e)},n.prototype.insertText=function(e,t){n_.assert(!this.ace_,"Not supported for ace yet."),n_.assert(!this.monaco_,"Not supported for monaco yet."),this.assertReady_("insertText"),"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=this;i.codeMirror_.operation((function(){for(var n=b_(0===e,t),s=0;s<n.length;s++){var r=n[s].string,o=n[s].attributes;i.richTextCodeMirror_.insertText(e,r,o),e+=r.length}}))},n.prototype.getOperationForSpan=function(e,t){for(var i=this.richTextCodeMirror_.getRange(e,t),n=this.richTextCodeMirror_.getAttributeSpans(e,t),s=0,r=new r_,o=0;o<n.length;o++)r.insert(i.substr(s,n[o].length),n[o].attributes),s+=n[o].length;return r},n.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)},n.prototype.getHtmlFromSelection=function(){var e=this.codeMirror_.getCursor("start"),t=this.codeMirror_.getCursor("end"),i=this.codeMirror_.indexFromPos(e),n=this.codeMirror_.indexFromPos(t);return this.getHtmlFromRange(i,n)},n.prototype.getHtmlFromRange=function(e,t){this.assertReady_("getHtmlFromRange");var i=null!=e&&null!=t?this.getOperationForSpan(e,t):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return y_(i,this.entityManager_)},n.prototype.insertHtml=function(e,t){var i=w_(t,this.entityManager_);this.insertText(e,i)},n.prototype.insertHtmlAtCursor=function(e){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),e)},n.prototype.setHtml=function(e){var t=w_(e,this.entityManager_);this.setText(t)},n.prototype.isHistoryEmpty=function(){return this.assertReady_("isHistoryEmpty"),this.firebaseAdapter_.isHistoryEmpty()},n.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(a_.BOLD),this.codeMirror_.focus()},n.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(a_.ITALIC),this.codeMirror_.focus()},n.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(a_.UNDERLINE),this.codeMirror_.focus()},n.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(a_.STRIKE),this.codeMirror_.focus()},n.prototype.fontSize=function(e){this.richTextCodeMirror_.setAttribute(a_.FONT_SIZE,e),this.codeMirror_.focus()},n.prototype.font=function(e){this.richTextCodeMirror_.setAttribute(a_.FONT,e),this.codeMirror_.focus()},n.prototype.color=function(e){this.richTextCodeMirror_.setAttribute(a_.COLOR,e),this.codeMirror_.focus()},n.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(a_.BACKGROUND_COLOR,"rgba(255,255,0,.65)"),this.codeMirror_.focus()},n.prototype.align=function(e){if("left"!==e&&"center"!==e&&"right"!==e)throw new Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(a_.LINE_ALIGN,e),this.codeMirror_.focus()},n.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(a_.LIST_TYPE,"o"),this.codeMirror_.focus()},n.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(a_.LIST_TYPE,"u"),this.codeMirror_.focus()},n.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo(),this.codeMirror_.focus()},n.prototype.newline=function(){this.richTextCodeMirror_.newline()},n.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()},n.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()},n.prototype.indent=function(){this.richTextCodeMirror_.indent(),this.codeMirror_.focus()},n.prototype.unindent=function(){this.richTextCodeMirror_.unindent(),this.codeMirror_.focus()},n.prototype.undo=function(){this.codeMirror_.undo()},n.prototype.redo=function(){this.codeMirror_.redo()},n.prototype.insertEntity=function(e,t,i){this.richTextCodeMirror_.insertEntityAtCursor(e,t,i)},n.prototype.insertEntityAt=function(e,t,i,n){this.richTextCodeMirror_.insertEntityAt(e,t,i,n)},n.prototype.registerEntity=function(e,t){this.entityManager_.register(e,t)},n.prototype.getOption=function(e,t){return e in this.options_?this.options_[e]:t},n.prototype.assertReady_=function(e){if(!this.ready_)throw new Error('You must wait for the "ready" event before calling '+e+".");if(this.zombie_)throw new Error("You can't use a Firepad after calling dispose()!  [called "+e+"]")},n.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")},n.prototype.makeDialog_=function(e,t){var i=this,n=n_.elt("input",null,{class:"firepad-dialog-input",id:e,type:"text",placeholder:t,autofocus:"autofocus"}),s=n_.elt("a","Submit",{class:"firepad-btn",id:"submitbtn"});n_.on(s,"click",n_.stopEventAnd((function(){var t=document.getElementById("overlay");t.style.visibility="hidden";var n=document.getElementById(e).value;null!==n&&i.insertEntity(e,{src:n}),i.firepadWrapper_.removeChild(t)})));var r=n_.elt("a","Cancel",{class:"firepad-btn"});n_.on(r,"click",n_.stopEventAnd((function(){var e=document.getElementById("overlay");e.style.visibility="hidden",i.firepadWrapper_.removeChild(e)})));var o=n_.elt("div",[s,r],{class:"firepad-btn-group"}),a=n_.elt("div",[n,o],{class:"firepad-dialog-div"}),l=n_.elt("div",[a],{class:"firepad-dialog",id:"overlay"});this.firepadWrapper_.appendChild(l)},n.prototype.addToolbar_=function(){this.toolbar=new L_(this.imageInsertionUI),this.toolbar.on("undo",this.undo,this),this.toolbar.on("redo",this.redo,this),this.toolbar.on("bold",this.bold,this),this.toolbar.on("italic",this.italic,this),this.toolbar.on("underline",this.underline,this),this.toolbar.on("strike",this.strike,this),this.toolbar.on("font-size",this.fontSize,this),this.toolbar.on("font",this.font,this),this.toolbar.on("color",this.color,this),this.toolbar.on("left",(function(){this.align("left")}),this),this.toolbar.on("center",(function(){this.align("center")}),this),this.toolbar.on("right",(function(){this.align("right")}),this),this.toolbar.on("ordered-list",this.orderedList,this),this.toolbar.on("unordered-list",this.unorderedList,this),this.toolbar.on("todo-list",this.todo,this),this.toolbar.on("indent-increase",this.indent,this),this.toolbar.on("indent-decrease",this.unindent,this),this.toolbar.on("insert-image",this.makeImageDialog_,this),this.firepadWrapper_.insertBefore(this.toolbar.element(),this.firepadWrapper_.firstChild)},n.prototype.addPoweredByLogo_=function(){var e=n_.elt("a",null,{class:"powered-by-firepad"});e.setAttribute("href","http://www.firepad.io/"),e.setAttribute("target","_blank"),this.firepadWrapper_.appendChild(e)},n.prototype.initializeKeyMap_=function(){function e(e){return function(t){setTimeout((function(){e.call(t.firepad)}),0)}}t.keyMap.richtext={"Ctrl-B":e(this.bold),"Cmd-B":e(this.bold),"Ctrl-I":e(this.italic),"Cmd-I":e(this.italic),"Ctrl-U":e(this.underline),"Cmd-U":e(this.underline),"Ctrl-H":e(this.highlight),"Cmd-H":e(this.highlight),Enter:e(this.newline),Delete:e(this.deleteRight),Backspace:e(this.deleteLeft),Tab:e(this.indent),"Shift-Tab":e(this.unindent),fallthrough:["default"]}},n}();Object.assign(P_,{Formatting:g_,Text:m_,Entity:h_,LineFormatting:p_,Line:v_,TextOperation:r_,RichTextCodeMirrorAdapter:A_,ACEAdapter:R_,MonacoAdapter:O_});var F_=P_;const B_=Tp.initializeApp({apiKey:prompt("Insert your Firebase apiKey").trim(),databaseURL:prompt("Insert your Firebase databaseURL").trim()}),W_=Tp.database(B_);document.addEventListener("DOMContentLoaded",(()=>{const t=e(Ed).edit("ace-editor");t.setOptions({showPrintMargin:!1,maxLines:1/0,fontSize:"100%"}),F_.fromACE(W_.ref("firepad-test-database"),t,{defaultText:"hello"});const i=new Ds({extensions:[Ad],parent:document.getElementById("codemirror-editor")});F_.fromCodeMirror6(W_.ref("firepad-test-database"),i,{defaultText:"hello"})}));</script> </body></html>